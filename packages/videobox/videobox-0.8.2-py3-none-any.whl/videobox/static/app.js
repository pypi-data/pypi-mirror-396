var e,t,o,r,n;let a;e=document.querySelector("#search-query"),t=document.querySelector("#search-suggestions"),o=null,(Videobox={error:function(e){return Error(`Server returned error ${e.status} while handling request`)},downloadTorrent:function(e,t,o){var r=new FormData;r.append("template",t),fetch(e,{method:"POST",body:r}).then(e=>{if(!e.ok)throw Videobox.error(e);e.text().then(e=>{o.target.closest("button").outerHTML=e})})},removeTorrent:function(e,t){fetch(e,{method:"DELETE"}).then(e=>{if(!e.ok)throw Videobox.error(e);e.text().then(e=>{t.target.closest(".torrent-download").remove()})})},followSeries:function(e,t,o){var r=new FormData;r.append("following",t),fetch(`/series/follow/${e}`,{method:"POST",body:r}).then(e=>{if(!e.ok)throw Videobox.error(e);e.text().then(e=>{o.target.closest("button").outerHTML=e})})},suggest:(r=()=>{var o=e.value;o.length<3||fetch(`/suggest?query=${o}`).then(e=>{if(!e.ok)throw Videobox.error(e);e.text().then(e=>{t.innerHTML=e})})},function(){let e=this,t=arguments,o=n&&!a;clearTimeout(a),a=setTimeout(()=>{a=null,n||r.apply(e,t)},200),o&&r.apply(e,t)}),openSearchDialog:function(o){e.value="",t.replaceChildren(),Videobox.openDialog(o,"#search-dialog")},openDialog:function(e,t){var o=document.querySelector(t);return o.showModal(),o.addEventListener("click",e=>{e.target===e.currentTarget?e.currentTarget.close():"close"in e.target.dataset&&o.close()}),o},trackDownloadProgress:function(e,t=!0){t&&null==o?o=window.setInterval(()=>{"visible"==document.visibilityState&&fetch("/download-progress").then(t=>{if(!t.ok)throw Videobox.error(t);t.json().then(t=>{e(t)})})},750):t||(window.clearInterval(o),o=null)},updateSeriesPage:function(e){var t=document.getElementById("row-download-done");t&&e.forEach(e=>{var o=document.getElementById(`r${e.info_hash}`);if(o){var r=o.querySelector(".releases__download");if("D"==o.dataset.status);else if("D"==e.state){var n=t.content.cloneNode(!0);r.replaceChildren(n)}else{var a=r.querySelector("span");a&&(a.textContent=`${e.progress}%`)}}var s=document.getElementById(`download-progress-${e.info_hash}`);s&&(s.querySelector(".download-progress__stats").innerHTML=e.stats,s.querySelector("progress").setAttribute("value",e.progress))})},updateStatusPage:function(e){e.forEach(e=>{var t=document.getElementById(`r${e.info_hash}`);t&&"D"!=t.dataset.status&&(t.querySelector(".download-progress__stats").innerHTML=e.stats,t.querySelector("progress").setAttribute("value",e.progress));var o=document.getElementById(`download-progress-${e.info_hash}`);o&&(o.querySelector(".download-progress__stats").innerHTML=e.stats,o.querySelector("progress").setAttribute("value",e.progress))})},loadSettings:function(e){var t=Videobox.openDialog(e,"#dialog");fetch("/settings").then(e=>{if(!e.ok)throw Videobox.error(e);e.text().then(e=>{t.innerHTML=e})}),t.addEventListener("submit",e=>{var o=new FormData(e.target);fetch("/settings",{method:"POST",body:o}).then(e=>{if(!e.ok)throw Videobox.error(e);t.close()}),e.preventDefault()})},loadReleaseInfo:function(e,t){var o=Videobox.openDialog(e,"#dialog");fetch(`/release/${t}`).then(e=>{if(!e.ok)throw Videobox.error(e);e.text().then(e=>{o.innerHTML=e})})},loadMore:function(e){var t=document.querySelector(".load-more-wrapper");fetch(e).then(e=>{if(!e.ok)throw Videobox.error(e);e.text().then(e=>{t.querySelector("button").remove();var o=document.createElement("template");o.innerHTML=e,t.appendChild(o.content.firstElementChild).scrollIntoView({behavior:"smooth",block:"start"})})})},filterSeries:function(e,t){var o=document.querySelector(".episode-wrapper"),r=new FormData(e);r.append("async","1");var n=new URLSearchParams(r).toString(),a=e.getAttribute("action");t.preventDefault(),fetch(`${a}?${n}`).then(e=>{if(!e.ok)throw Videobox.error(e);e.text().then(e=>{o.innerHTML=e})}),r.delete("async"),n=new URLSearchParams(r).toString(),history.pushState({},"",`${a}?${n}`)},setup:function(){var e=document.getElementById("form-filters");e&&new IntersectionObserver(([e])=>e.target.classList.toggle("pinned",e.intersectionRatio<1),{threshold:[1]}).observe(e),window.addEventListener("popstate",e=>{location.reload()})}}).setup();
//# sourceMappingURL=app.js.map
