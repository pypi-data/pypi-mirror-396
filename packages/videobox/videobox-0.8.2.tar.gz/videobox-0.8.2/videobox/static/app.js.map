{"mappings":"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","sources":["<anon>","assets/app.js"],"sourcesContent":["(() => {\n// import { carouselFromSelector  } from \"./carousel\";\n// import Chart from 'chart.js/auto';\n// import 'chartjs-adapter-dayjs-4/dist/chartjs-adapter-dayjs-4.esm';\nconst $2cdf45ff1f92daa7$var$MIN_QUERY_LENGTH = 3;\nfunction $2cdf45ff1f92daa7$var$debounce(func, wait, immediate) {\n    let timeout;\n    return function() {\n        let context = this, args = arguments;\n        let later = ()=>{\n            timeout = null;\n            if (!immediate) func.apply(context, args);\n        };\n        let callNow = immediate && !timeout;\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n        if (callNow) func.apply(context, args);\n    };\n}\nvar $2cdf45ff1f92daa7$var$searchQuery = document.querySelector(\"#search-query\");\nvar $2cdf45ff1f92daa7$var$searchSuggestions = document.querySelector(\"#search-suggestions\");\n//var serverAlertEl = document.querySelector(\"#server-alert\");\nvar $2cdf45ff1f92daa7$var$trackDownloadProgressTimerID = null;\nVideobox = {\n    error: function(response) {\n        return new Error(`Server returned error ${response.status} while handling request`);\n    },\n    downloadTorrent: function(url, template, event) {\n        var formData = new FormData();\n        formData.append(\"template\", template);\n        fetch(url, {\n            method: \"POST\",\n            body: formData\n        }).then((response)=>{\n            if (!response.ok) throw Videobox.error(response);\n            response.text().then((text)=>{\n                var buttonEl = event.target.closest(\"button\");\n                buttonEl.outerHTML = text;\n            // Start updating page if needed \n            // Videobox.trackDownloadProgress(Videobox.updateSeriesPage)\n            });\n        });\n    },\n    removeTorrent: function(url, event) {\n        fetch(url, {\n            method: \"DELETE\"\n        }).then((response)=>{\n            if (!response.ok) throw Videobox.error(response);\n            response.text().then((text)=>{\n                var divEl = event.target.closest(\".torrent-download\");\n                divEl.remove();\n            });\n        });\n    },\n    followSeries: function(seriesId, newValue, event) {\n        var formData = new FormData();\n        formData.append(\"following\", newValue);\n        fetch(`/series/follow/${seriesId}`, {\n            method: \"POST\",\n            body: formData\n        }).then((response)=>{\n            if (!response.ok) throw Videobox.error(response);\n            response.text().then((text)=>{\n                var buttonEl = event.target.closest(\"button\");\n                buttonEl.outerHTML = text;\n            });\n        });\n    },\n    suggest: $2cdf45ff1f92daa7$var$debounce(()=>{\n        var query = $2cdf45ff1f92daa7$var$searchQuery.value;\n        if (query.length < $2cdf45ff1f92daa7$var$MIN_QUERY_LENGTH) return;\n        fetch(`/suggest?query=${query}`).then((response)=>{\n            if (!response.ok) throw Videobox.error(response);\n            response.text().then((text)=>{\n                $2cdf45ff1f92daa7$var$searchSuggestions.innerHTML = text;\n            });\n        });\n    }, 200),\n    // sync: function () {\n    //     var el = document.querySelector(\"#update-dialog\");\n    //     var eventSource = new EventSource(\"/sync/events\");\n    //     eventSource.addEventListener(\"sync-progress\", (e) => {\n    //         el.innerHTML = e.data;\n    //     });\n    //     eventSource.addEventListener(\"sync-done\", (e) => {\n    //         el.innerHTML = e.data;\n    //         eventSource.close()\n    //     });\n    //     eventSource.addEventListener(\"error\", (e) => {\n    //         eventSource.close()\n    //     });\n    // },\n    openSearchDialog: function(event) {\n        // Reset any previous search and suggestion - https://stackoverflow.com/a/65413839\n        $2cdf45ff1f92daa7$var$searchQuery.value = \"\";\n        $2cdf45ff1f92daa7$var$searchSuggestions.replaceChildren();\n        Videobox.openDialog(event, \"#search-dialog\");\n    },\n    // closeDialog: function (event, dialogSelector) {\n    //     var dialog = document.querySelector(dialogSelector);\n    //     dialog.classList.remove(\"in\");\n    //     // TODO: wait for animation to end\n    //     dialog.close();\n    //     // Avoid to submit page\n    //     event.preventDefault();\n    // },\n    openDialog: function(event, dialogSelector) {\n        var dialog = document.querySelector(dialogSelector);\n        dialog.showModal();\n        // Close dialog when clicking on backdrop\n        dialog.addEventListener(\"click\", (event)=>{\n            if (event.target === event.currentTarget) // dialog.replaceChildren();\n            //dialog.innerHTML = '';\n            event.currentTarget.close();\n            else if (\"close\" in event.target.dataset) dialog.close();\n        });\n        return dialog;\n    },\n    trackDownloadProgress: function(callback, start = true) {\n        if (start && $2cdf45ff1f92daa7$var$trackDownloadProgressTimerID == null) $2cdf45ff1f92daa7$var$trackDownloadProgressTimerID = window.setInterval(()=>{\n            if (document.visibilityState == \"visible\") fetch(`/download-progress`).then((response)=>{\n                if (!response.ok) throw Videobox.error(response);\n                response.json().then((torrents)=>{\n                    callback(torrents);\n                });\n            });\n        }, 750 // ms\n        );\n        else if (!start) {\n            window.clearInterval($2cdf45ff1f92daa7$var$trackDownloadProgressTimerID);\n            $2cdf45ff1f92daa7$var$trackDownloadProgressTimerID = null;\n        }\n    },\n    updateSeriesPage: function(torrents) {\n        var templateDone = document.getElementById(\"row-download-done\");\n        if (templateDone) torrents.forEach((torrent)=>{\n            // Update release table\n            var trEl = document.getElementById(`r${torrent[\"info_hash\"]}`);\n            if (trEl) {\n                var tdEl = trEl.querySelector(\".releases__download\");\n                if (trEl.dataset.status == \"D\") ;\n                else if (torrent[\"state\"] == \"D\") {\n                    // Just downloaded\n                    var clonedEl = templateDone.content.cloneNode(true);\n                    tdEl.replaceChildren(clonedEl);\n                } else {\n                    // In progress, avoid to replace children\n                    //  to keep the ongoing CSS animation\n                    var spanEl = tdEl.querySelector(\"span\");\n                    if (spanEl) spanEl.textContent = `${torrent[\"progress\"]}%`;\n                }\n            }\n            // Update release dialog\n            var progressEl = document.getElementById(`download-progress-${torrent[\"info_hash\"]}`);\n            if (progressEl) {\n                progressEl.querySelector(\".download-progress__stats\").innerHTML = torrent[\"stats\"];\n                progressEl.querySelector(\"progress\").setAttribute(\"value\", torrent[\"progress\"]);\n            }\n        });\n    },\n    updateStatusPage: function(torrents) {\n        torrents.forEach((torrent)=>{\n            // Update downloads table row\n            var trEl = document.getElementById(`r${torrent[\"info_hash\"]}`);\n            // No need to keep updating status if already downloaded\n            if (trEl && trEl.dataset.status != \"D\") {\n                trEl.querySelector(\".download-progress__stats\").innerHTML = torrent[\"stats\"];\n                trEl.querySelector(\"progress\").setAttribute(\"value\", torrent[\"progress\"]);\n            }\n            // Update release dialog\n            var progressEl = document.getElementById(`download-progress-${torrent[\"info_hash\"]}`);\n            if (progressEl) {\n                progressEl.querySelector(\".download-progress__stats\").innerHTML = torrent[\"stats\"];\n                progressEl.querySelector(\"progress\").setAttribute(\"value\", torrent[\"progress\"]);\n            }\n        });\n    },\n    loadSettings: function(event) {\n        var dialog = Videobox.openDialog(event, \"#dialog\");\n        fetch(\"/settings\").then((response)=>{\n            if (!response.ok) throw Videobox.error(response);\n            response.text().then((text)=>{\n                dialog.innerHTML = text;\n            });\n        });\n        dialog.addEventListener(\"submit\", (event)=>{\n            var formData = new FormData(event.target);\n            fetch(\"/settings\", {\n                method: \"POST\",\n                body: formData\n            }).then((response)=>{\n                if (!response.ok) throw Videobox.error(response);\n                dialog.close();\n            });\n            event.preventDefault();\n        });\n    },\n    loadReleaseInfo: function(event, releaseId) {\n        var dialog = Videobox.openDialog(event, \"#dialog\");\n        fetch(`/release/${releaseId}`).then((response)=>{\n            if (!response.ok) throw Videobox.error(response);\n            response.text().then((text)=>{\n                dialog.innerHTML = text;\n            });\n        });\n    },\n    loadMore: function(url) {\n        var wrapper = document.querySelector(\".load-more-wrapper\");\n        fetch(url).then((response)=>{\n            if (!response.ok) throw Videobox.error(response);\n            response.text().then((text)=>{\n                var button = wrapper.querySelector(\"button\");\n                button.remove();\n                var template = document.createElement(\"template\");\n                template.innerHTML = text;\n                var child = wrapper.appendChild(template.content.firstElementChild);\n                child.scrollIntoView({\n                    behavior: \"smooth\",\n                    block: \"start\"\n                });\n            });\n        });\n    },\n    filterSeries: function(form, event) {\n        var wrapper = document.querySelector(\".episode-wrapper\");\n        var formData = new FormData(form);\n        formData.append(\"async\", \"1\");\n        var queryString = new URLSearchParams(formData).toString();\n        var url = form.getAttribute(\"action\");\n        event.preventDefault();\n        fetch(`${url}?${queryString}`).then((response)=>{\n            if (!response.ok) throw Videobox.error(response);\n            response.text().then((text)=>{\n                wrapper.innerHTML = text;\n            });\n        });\n        // Return the whole page when reloding after the user clicks back/forward\n        formData.delete(\"async\");\n        queryString = new URLSearchParams(formData).toString();\n        history.pushState({}, \"\", `${url}?${queryString}`);\n    },\n    // loadChart: function (el) {\n    //     const dailyCounts = chartData.map(item => { return { x: item.date, y: item.count } });\n    //     var ctx = el.getContext('2d');\n    //     const chart = new Chart(el, {\n    //         data: {\n    //             datasets: [{\n    //                 type: 'line',\n    //                 data: dailyCounts,\n    //                 fill: true,\n    //                 backgroundColor: '#253e52',\n    //                 borderColor: '#e37dd7',\n    //                 borderWidth: 1,\n    //                 pointBorderWidth: 0,\n    //                 pointRadius: 0,\n    //                 pointHitRadius: 0,\n    //                 // pointBorderColor: '#e37dd7',\n    //                 // pointBackgroundColor: '#fff',\n    //             }\n    //             ]\n    //         },\n    //         options: {\n    //             responsive: false,\n    //             // maintainAspectRatio: true,\n    //             layout: {\n    //                 padding: -10\n    //             },                \n    //             plugins: {\n    //                 tooltip: { enabled: false },\n    //                 legend: { display: false },\n    //             },\n    //             scales: {\n    //                 xAxis: { display: false },\n    //                 x: {\n    //                     grid: { display: false },\n    //                     ticks: { display: false },\n    //                     type: 'time',\n    //                     time: {\n    //                         unit: 'week',\n    //                         // tooltipFormat: 'MMM D, YYYY',\n    //                     }\n    //                 },\n    //                 yAxis: { display: false },\n    //                 y: {                        \n    //                     beginAtZero: true,\n    //                     grid: { display: false },\n    //                     ticks: { display: false },\n    //                 }\n    //             }\n    //         }\n    //     });\n    // },\n    setup: function() {\n        // var carousels = carouselFromSelector('.carousel__items');\n        var filtersEl = document.getElementById(\"form-filters\");\n        if (filtersEl) {\n            const observer = new IntersectionObserver(// Check if pinned or not \n            ([e])=>e.target.classList.toggle(\"pinned\", e.intersectionRatio < 1), {\n                threshold: [\n                    1\n                ]\n            });\n            observer.observe(filtersEl);\n        }\n        window.addEventListener(\"popstate\", (event)=>{\n            // Reload page on back/forward navigation\n            location.reload();\n        });\n    }\n};\nVideobox.setup();\n\n})();\n//# sourceMappingURL=app.js.map\n","// import { carouselFromSelector  } from \"./carousel\";\n// import Chart from 'chart.js/auto';\n// import 'chartjs-adapter-dayjs-4/dist/chartjs-adapter-dayjs-4.esm';\n\nconst MIN_QUERY_LENGTH = 3;\n\nfunction debounce(func, wait, immediate) {\n    let timeout;\n    return function () {\n        let context = this, args = arguments;\n        let later = () => {\n            timeout = null;\n            if (!immediate) func.apply(context, args);\n        };\n        let callNow = immediate && !timeout;\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n        if (callNow) func.apply(context, args);\n    };\n};\n\nvar searchQuery = document.querySelector(\"#search-query\");\nvar searchSuggestions = document.querySelector(\"#search-suggestions\");\n//var serverAlertEl = document.querySelector(\"#server-alert\");\nvar trackDownloadProgressTimerID = null;\n\nVideobox = {\n\n    error: function(response) {\n        return new Error(`Server returned error ${response.status} while handling request`);\n    },\n\n    downloadTorrent: function (url, template, event) {\n        var formData = new FormData();\n        formData.append('template', template)        \n        fetch(url, { method: 'POST', body: formData })\n            .then((response) => {\n                if (!response.ok) {\n                    throw Videobox.error(response);\n                }\n                response.text().then((text) => {\n                    var buttonEl = event.target.closest('button');\n                    buttonEl.outerHTML = text;\n                    // Start updating page if needed \n                    // Videobox.trackDownloadProgress(Videobox.updateSeriesPage)\n                });\n            });\n    },\n\n    removeTorrent: function (url, event) {\n        fetch(url, { method: 'DELETE' })\n            .then((response) => {\n                if (!response.ok) {\n                    throw Videobox.error(response);\n                }\n                response.text().then((text) => {\n                    var divEl = event.target.closest('.torrent-download');\n                    divEl.remove();\n                });\n            });\n    },\n\n    followSeries: function (seriesId, newValue, event) {\n        var formData = new FormData();\n        formData.append('following', newValue)\n        fetch(`/series/follow/${seriesId}`, { method: 'POST', body: formData })\n            .then((response) => {\n                if (!response.ok) {\n                    throw Videobox.error(response);\n                }\n                response.text().then((text) => {\n                    var buttonEl = event.target.closest('button');\n                    buttonEl.outerHTML = text;\n                });\n            });\n    },\n\n    suggest: debounce(() => {\n        var query = searchQuery.value;\n        if (query.length < MIN_QUERY_LENGTH) {\n            return;\n        }\n        fetch(`/suggest?query=${query}`)\n            .then((response) => {\n                if (!response.ok) {\n                    throw Videobox.error(response);\n                }\n                response.text().then((text) => {\n                    searchSuggestions.innerHTML = text;\n                });\n            });\n    }, 200),\n\n    // sync: function () {\n    //     var el = document.querySelector(\"#update-dialog\");\n    //     var eventSource = new EventSource(\"/sync/events\");\n    //     eventSource.addEventListener(\"sync-progress\", (e) => {\n    //         el.innerHTML = e.data;\n    //     });\n    //     eventSource.addEventListener(\"sync-done\", (e) => {\n    //         el.innerHTML = e.data;\n    //         eventSource.close()\n    //     });\n    //     eventSource.addEventListener(\"error\", (e) => {\n    //         eventSource.close()\n    //     });\n    // },\n\n    openSearchDialog: function (event) {\n        // Reset any previous search and suggestion - https://stackoverflow.com/a/65413839\n        searchQuery.value = \"\";\n        searchSuggestions.replaceChildren();\n        Videobox.openDialog(event, '#search-dialog');\n    },\n\n    // closeDialog: function (event, dialogSelector) {\n    //     var dialog = document.querySelector(dialogSelector);\n    //     dialog.classList.remove(\"in\");\n    //     // TODO: wait for animation to end\n    //     dialog.close();\n    //     // Avoid to submit page\n    //     event.preventDefault();\n    // },\n\n    openDialog: function (event, dialogSelector) {\n        var dialog = document.querySelector(dialogSelector);\n        dialog.showModal();\n        // Close dialog when clicking on backdrop\n        dialog.addEventListener('click', event => {\n            if (event.target === event.currentTarget) {\n                // dialog.replaceChildren();\n                //dialog.innerHTML = '';\n                event.currentTarget.close();\n            } else if('close' in event.target.dataset) {\n                dialog.close();\n            }\n        })\n        return dialog;\n    },\n\n    trackDownloadProgress: function (callback, start = true) {\n        if (start && trackDownloadProgressTimerID == null) {\n            trackDownloadProgressTimerID = window.setInterval(() => {\n                if (document.visibilityState == 'visible') {\n                    fetch(`/download-progress`)\n                        .then((response) => {\n                            if (!response.ok) {\n                                throw Videobox.error(response);\n                            }\n                            response.json().then((torrents) => {\n                                callback(torrents);\n                            });\n                        });\n\n                }\n            },\n                750 // ms\n            )\n        } else if (!start) {\n            window.clearInterval(trackDownloadProgressTimerID);\n            trackDownloadProgressTimerID = null;\n        }\n    },\n\n    updateSeriesPage: function (torrents) {\n        var templateDone = document.getElementById(\"row-download-done\");\n        if(templateDone) {\n            torrents.forEach(torrent => {\n                // Update release table\n                var trEl = document.getElementById(`r${torrent['info_hash']}`);\n                if(trEl) {\n                    var tdEl = trEl.querySelector('.releases__download');\n                    if (trEl.dataset.status == 'D') {\n                        // Already downloaded, do nothing\n                    } else if (torrent['state'] == 'D') {\n                        // Just downloaded\n                        var clonedEl = templateDone.content.cloneNode(true);\n                        tdEl.replaceChildren(clonedEl);                \n                    } else {\n                        // In progress, avoid to replace children\n                        //  to keep the ongoing CSS animation\n                        var spanEl = tdEl.querySelector(\"span\");\n                        if(spanEl) {\n                            spanEl.textContent = `${torrent['progress']}%`;              \n                        }\n                    }\n                }\n                \n                // Update release dialog\n                var progressEl = document.getElementById(`download-progress-${torrent['info_hash']}`);\n                if (progressEl) {\n                    progressEl.querySelector('.download-progress__stats').innerHTML = torrent['stats']\n                    progressEl.querySelector('progress').setAttribute('value', torrent['progress']);\n                }\n            })\n        }\n    },\n\n    updateStatusPage: function (torrents) {\n        torrents.forEach(torrent => {\n            // Update downloads table row\n            var trEl = document.getElementById(`r${torrent['info_hash']}`);\n            // No need to keep updating status if already downloaded\n            if (trEl && trEl.dataset.status != 'D') {\n                trEl.querySelector('.download-progress__stats').innerHTML = torrent['stats'];\n                trEl.querySelector('progress').setAttribute('value', torrent['progress']);\n            }\n\n            // Update release dialog\n            var progressEl = document.getElementById(`download-progress-${torrent['info_hash']}`);\n            if (progressEl) {\n                progressEl.querySelector('.download-progress__stats').innerHTML = torrent['stats']\n                progressEl.querySelector('progress').setAttribute('value', torrent['progress']);\n            }            \n        })\n    },\n\n    loadSettings: function (event) {\n        var dialog = Videobox.openDialog(event, '#dialog');\n        fetch(\"/settings\")\n            .then((response) => {\n                if (!response.ok) {\n                    throw Videobox.error(response);\n                }\n                response.text().then((text) => {\n                    dialog.innerHTML = text;\n                });\n            });\n        dialog.addEventListener('submit', (event) => {\n            var formData = new FormData(event.target);\n            fetch(\"/settings\", { method: 'POST', body: formData })\n                .then((response) => {\n                    if (!response.ok) {\n                        throw Videobox.error(response);\n                    }\n                    dialog.close();\n                });\n            event.preventDefault();\n        })\n    },\n\n    loadReleaseInfo: function (event, releaseId) {\n        var dialog = Videobox.openDialog(event, '#dialog');\n        fetch(`/release/${releaseId}`)\n            .then((response) => {\n                if (!response.ok) {\n                    throw Videobox.error(response);\n                }\n                response.text().then((text) => {\n                    dialog.innerHTML = text;\n                });\n            });\n    },\n\n    loadMore: function (url) {\n        var wrapper = document.querySelector(\".load-more-wrapper\");\n        fetch(url)\n            .then((response) => {\n                if (!response.ok) {\n                    throw Videobox.error(response);\n                }\n                response.text().then((text) => {\n                    var button = wrapper.querySelector(\"button\");\n                    button.remove();\n                    var template = document.createElement('template');\n                    template.innerHTML = text;\n                    var child = wrapper.appendChild(template.content.firstElementChild);\n                    child.scrollIntoView({ behavior: \"smooth\", block: \"start\" })\n                });\n            });\n    },\n\n    filterSeries: function (form, event) {\n        var wrapper = document.querySelector(\".episode-wrapper\");\n        var formData = new FormData(form);\n        formData.append('async', \"1\");\n        var queryString = new URLSearchParams(formData).toString()\n        var url = form.getAttribute('action');\n        event.preventDefault();\n        fetch(`${url}?${queryString}`)\n            .then((response) => {\n                if (!response.ok) {\n                    throw Videobox.error(response);\n                }\n                response.text().then((text) => {\n                    wrapper.innerHTML = text;   \n                });\n            });\n        // Return the whole page when reloding after the user clicks back/forward\n        formData.delete('async');\n        queryString = new URLSearchParams(formData).toString()\n        history.pushState({}, \"\", `${url}?${queryString}`);\n    },\n\n    // loadChart: function (el) {\n    //     const dailyCounts = chartData.map(item => { return { x: item.date, y: item.count } });\n    //     var ctx = el.getContext('2d');\n    //     const chart = new Chart(el, {\n    //         data: {\n    //             datasets: [{\n    //                 type: 'line',\n    //                 data: dailyCounts,\n    //                 fill: true,\n    //                 backgroundColor: '#253e52',\n    //                 borderColor: '#e37dd7',\n    //                 borderWidth: 1,\n    //                 pointBorderWidth: 0,\n    //                 pointRadius: 0,\n    //                 pointHitRadius: 0,\n    //                 // pointBorderColor: '#e37dd7',\n    //                 // pointBackgroundColor: '#fff',\n    //             }\n    //             ]\n    //         },\n    //         options: {\n    //             responsive: false,\n    //             // maintainAspectRatio: true,\n    //             layout: {\n    //                 padding: -10\n    //             },                \n    //             plugins: {\n    //                 tooltip: { enabled: false },\n    //                 legend: { display: false },\n    //             },\n    //             scales: {\n    //                 xAxis: { display: false },\n    //                 x: {\n    //                     grid: { display: false },\n    //                     ticks: { display: false },\n    //                     type: 'time',\n    //                     time: {\n    //                         unit: 'week',\n    //                         // tooltipFormat: 'MMM D, YYYY',\n    //                     }\n    //                 },\n    //                 yAxis: { display: false },\n    //                 y: {                        \n    //                     beginAtZero: true,\n    //                     grid: { display: false },\n    //                     ticks: { display: false },\n    //                 }\n    //             }\n    //         }\n    //     });\n    // },\n    setup: function() {\n        // var carousels = carouselFromSelector('.carousel__items');\n        var filtersEl = document.getElementById('form-filters');\n        if(filtersEl) {\n            const observer = new IntersectionObserver( \n                // Check if pinned or not \n                ([e]) => e.target.classList.toggle(\"pinned\", e.intersectionRatio < 1),\n                { threshold: [1] }\n              );\n            observer.observe(filtersEl);\n        }\n        \n        window.addEventListener(\"popstate\", (event) => {\n            // Reload page on back/forward navigation\n            location.reload();\n        }); \n    }\n}\n\nVideobox.setup();"],"names":["$2cdf45ff1f92daa7$var$searchQuery","$2cdf45ff1f92daa7$var$searchSuggestions","$2cdf45ff1f92daa7$var$trackDownloadProgressTimerID","func","immediate","timeout","document","querySelector","Videobox","error","response","Error","status","downloadTorrent","url","template","event","formData","FormData","append","fetch","method","body","then","ok","text","buttonEl","target","closest","outerHTML","removeTorrent","divEl","remove","followSeries","seriesId","newValue","suggest","query","value","length","innerHTML","context","args","arguments","callNow","clearTimeout","setTimeout","apply","openSearchDialog","replaceChildren","openDialog","dialogSelector","dialog","showModal","addEventListener","currentTarget","close","dataset","trackDownloadProgress","callback","start","window","setInterval","visibilityState","json","torrents","clearInterval","updateSeriesPage","templateDone","getElementById","forEach","torrent","trEl","tdEl","clonedEl","content","cloneNode","spanEl","textContent","progressEl","setAttribute","updateStatusPage","loadSettings","preventDefault","loadReleaseInfo","releaseId","loadMore","wrapper","button","createElement","child","appendChild","firstElementChild","scrollIntoView","behavior","block","filterSeries","form","queryString","URLSearchParams","toString","getAttribute","delete","history","pushState","setup","filtersEl","observer","IntersectionObserver","e","classList","toggle","intersectionRatio","threshold","observe","location","reload"],"version":3,"file":"app.js.map"}