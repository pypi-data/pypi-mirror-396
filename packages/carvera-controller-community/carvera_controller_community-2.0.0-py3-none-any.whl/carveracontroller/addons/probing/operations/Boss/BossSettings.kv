<BossSettings>:
    ScrollView:
        do_scroll_x: False
        size_hint: 1,1
        bar_width: 4
        bar_inactive_color: [.7,.7,.7,.9]
        StackLayout:
            height: self.minimum_height
            size_hint_y: None
            spacing:dp(3)
            padding:dp(1)
            halign:'right'
            wcs_drop_content: wcs_drop_content.__self__  # hack to prevent gc from removing object per https://kivy.org/doc/stable/guide/lang.html#referencing-widgets

            ProbeSettingLabel:
                label_text: 'X:'
                ToolTipTextInput:
                    id: XAxisDistance
                    tooltip_txt: tr._('Boss Diameter in X')
                    tooltip_image: ''
                    multiline: False
                    halign:'right'
                    input_type: 'number'
                    input_filter: 'float'
                    text: root.get_setting('XAxisDistance')
                    on_text: root.setting_changed('XAxisDistance', self.text)

            ProbeSettingLabel:
                label_text: 'Y:'
                ToolTipTextInput:
                    id: YAxisDistance
                    tooltip_txt: tr._('Boss Diameter in Y')
                    tooltip_image: ''
                    multiline: False
                    halign:'right'
                    input_type: 'number'
                    input_filter: 'float'
                    text: root.get_setting('YAxisDistance')
                    on_text: root.setting_changed('YAxisDistance', self.text)

            ProbeSettingLabel:
                label_text: 'J:'
                ToolTipTextInput:
                    id: ProbeClearance
                    tooltip_txt: tr._('When Probing a boss, this is added to the X and Y values when moving outside the boss. Defaults to 4mm')
                    tooltip_image: ''
                    multiline: False
                    halign:'right'
                    input_type: 'number'
                    input_filter: 'float'
                    text: root.get_setting('ProbeClearance')
                    on_text: root.setting_changed('ProbeClearance', self.text)

            ProbeSettingLabel:
                label_text: 'D Tip Dia:'
                ToolTipTextInput:
                    id: ProbeTipDiameter
                    tooltip_txt: tr._('Effective Diameter of Probe Tip. Measure with M460')
                    tooltip_image: 'addons/probing/data/icons_1024x768/general_parameters/probe_parameter_d.png'
                    tooltip_image_size: 200,200
                    multiline: False
                    halign:'right'
                    input_type: 'number'
                    input_filter: 'float'
                    text: root.get_setting('ProbeTipDiameter')
                    on_text: root.setting_changed('ProbeTipDiameter', self.text)

            ProbeSettingLabel:
                label_text: 'H Pocket Depth:'
                tooltip_txt: 'test'
                ToolTipTextInput:
                    id: PocketProbeDepth
                    tooltip_txt: tr._('Distance to probe straight down before performing remainder of probing operations')
                    tooltip_image: 'addons/probing/data/icons_1024x768/outside_center/outside_center_parameter_h.png'
                    multiline: False
                    halign:'right'
                    input_type: 'number'
                    input_filter: 'float'
                    text: root.get_setting('PocketProbeDepth')
                    on_text: root.setting_changed('PocketProbeDepth', self.text)

            ProbeSettingLabel:
                label_text: 'F Feed Rate:'
                ToolTipTextInput:
                    id: FastFeedRate
                    tooltip_txt: tr._('Optional probing feed rate override')
                    tooltip_image: ''
                    multiline: False
                    halign:'right'
                    input_type: 'number'
                    input_filter: 'float'
                    text: root.get_setting('FastFeedRate')
                    on_text: root.setting_changed('FastFeedRate', self.text)

            ProbeSettingLabel:
                label_text: 'K Rapid:'
                ToolTipTextInput:
                    id: RapidFeedRate
                    tooltip_txt: tr._('Optional rapid feed rate override')
                    tooltip_image: ''
                    multiline: False
                    halign:'right'
                    input_type: 'number'
                    input_filter: 'float'
                    text: root.get_setting('RapidFeedRate')
                    on_text: root.setting_changed('RapidFeedRate', self.text)

            ProbeSettingLabel:
                label_text: 'L Repeat:'
                ToolTipTextInput:
                    id: RepeatOperationCount
                    tooltip_txt: tr._('Number of times to repeat the probing operation')
                    tooltip_image: ''
                    multiline: False
                    halign:'right'
                    input_type: 'number'
                    input_filter: 'float'
                    text: root.get_setting('RepeatOperationCount')
                    on_text: root.setting_changed('RepeatOperationCount', self.text)

            ProbeSettingLabel:
                label_text: 'R Edge Retract:'
                ToolTipTextInput:
                    id: EdgeRetractDistance
                    tooltip_txt: tr._('Distance away from surface to retract before double tapping the probe')
                    tooltip_image: ''
                    multiline: False
                    halign:'right'
                    input_type: 'number'
                    input_filter: 'float'
                    text: root.get_setting('EdgeRetractDistance')
                    on_text: root.setting_changed('EdgeRetractDistance', self.text)

            ProbeSettingLabel:
                label_text: 'C Btm Retract:'
                ToolTipTextInput:
                    id: BottomSurfaceRetract
                    tooltip_txt: tr._('If Pocket Depth is enabled, how far above the surface to raise before continuing the operation')
                    tooltip_image: 'addons/probing/data/icons_1024x768/outside_center/outside_center_parameter_c.png'
                    multiline: False
                    halign:'right'
                    input_type: 'number'
                    input_filter: 'float'
                    text: root.get_setting('BottomSurfaceRetract')
                    on_text: root.setting_changed('BottomSurfaceRetract', self.text)
            
            ProbeSettingLabel:
                label_text: 'Q Angle:'
                ToolTipTextInput:
                    tooltip_txt: tr._('Degrees to rotate the XY coordinate plane when probing.')
                    tooltip_image: 'addons/probing/data/icons_1024x768/general_parameters/probe_parameter_q.png'
                    tooltip_image_size: 200,200
                    multiline: False
                    halign:'right'
                    input_type: 'number'
                    input_filter: 'float'
                    text: root.get_setting('QAngle')
                    on_text: root.setting_changed('QAngle', self.text)

            ProbeSettingLabel:
                label_text: 'E Probe Depth'
                ToolTipTextInput:
                    id: ProbeDepth
                    tooltip_txt: tr._('How far below the start height to move down for probing the sides of the boss/block')
                    tooltip_image: 'addons/probing/data/icons_1024x768/outside_center/outside_center_parameter_e.png'
                    multiline: False
                    halign:'right'
                    input_type: 'number'
                    input_filter: 'float'
                    text: root.get_setting('ProbeDepth')
                    on_text: root.setting_changed('ProbeDepth', self.text)

            ProbeSettingLabel:
                label_text: 'S Zero WCS Axis:'
                hint_text: 'Zero X/Y/Z Position'

                ToolTipButton:
                    id: ZeroXYPosition
                    # In the below get_setting() returns an int, so doing an inline mapping to the display text here
                    text: ["Disabled", "X/Y", "X/Y/Z"][int(root.get_setting('ZeroXYPosition') or '0')]
                    tooltip_txt: tr._('This switch will set your current WCS to the center of the bore/pocket you are probing')
                    on_parent: wcs_drop_content.dismiss()
                    on_release: wcs_drop_content.open(self)
                
                    DropDown:
                        id: wcs_drop_content
                        on_select: ZeroXYPosition.text = f'{args[1]}'

                        Button:
                            id: wcs_btn1
                            text: tr._('Disabled')
                            size_hint_y: None
                            height: '40dp'
                            on_release:
                                root.setting_changed('ZeroXYPosition', "0")
                                wcs_drop_content.select(self.text)
                        
                        Button:
                            id: wcs_btn2
                            text: tr._('X/Y')
                            size_hint_y: None
                            height: '40dp'
                            on_release:
                                root.setting_changed('ZeroXYPosition', "1")
                                wcs_drop_content.select(self.text)
                        
                        Button:
                            id: wcs_btn3
                            text: tr._('X/Y/Z')
                            size_hint_y: None
                            height: '40dp'
                            on_release:
                                root.setting_changed('ZeroXYPosition', "2")
                                wcs_drop_content.select(self.text)

            ProbeSettingLabel:
                label_text: 'I Normally Closed:'
                hint_text: ''
                ToolTipSwitch:
                    id: UseProbeNormallyClosed
                    tooltip_txt: tr._('Enable this switch if you have a normally closed probe instead of a normally open one')
                    canvas.before:
                        Color:
                            rgba: 50/255, 50/255, 50/255, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    active: root.get_setting('UseProbeNormallyClosed') == "1"
                    on_active: root.setting_changed('UseProbeNormallyClosed', "1" if self.active else "0")