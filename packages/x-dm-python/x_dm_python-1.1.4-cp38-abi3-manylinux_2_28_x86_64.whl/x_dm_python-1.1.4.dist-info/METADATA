Metadata-Version: 2.4
Name: x_dm_python
Version: 1.1.4
Classifier: Programming Language :: Rust
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Requires-Dist: pytest>=7.0 ; extra == 'test'
Requires-Dist: pytest-asyncio>=0.21 ; extra == 'test'
Provides-Extra: test
Summary: Twitter DM æ‰¹é‡å¹¶å‘å‘é€åº“ (Rust å®ç°, æä¾› Python ç»‘å®š)
Author-email: robin <robin528919@gmail.com>
Requires-Python: >=3.8
Description-Content-Type: text/markdown; charset=UTF-8; variant=GFM
Project-URL: Homepage, https://github.com/yourusername/twitter-dm-static
Project-URL: Repository, https://github.com/yourusername/twitter-dm-static.git
Project-URL: Issues, https://github.com/yourusername/twitter-dm-static/issues

# Twitter DM Python

åŸºäº Rust å¼€å‘çš„ Twitter ç§ä¿¡æ‰¹é‡å‘é€åº“ï¼Œæä¾›äº†å•æ¡å’Œæ‰¹é‡å¹¶å‘å‘é€ç§ä¿¡çš„åŠŸèƒ½ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **å•æ¡ç§ä¿¡å‘é€**: å‘æŒ‡å®šç”¨æˆ·å‘é€å•æ¡ç§ä¿¡
- ğŸ“¦ **æ‰¹é‡å¹¶å‘å‘é€**: åŒæ—¶å‘å¤šä¸ªç”¨æˆ·å‘é€ç§ä¿¡ï¼Œæé«˜æ•ˆç‡
- ğŸ”’ **å®‰å…¨è®¤è¯**: åŸºäº cookies çš„ Twitter è®¤è¯æœºåˆ¶
- ğŸ“ **è¯¦ç»†æ—¥å¿—**: å®Œæ•´çš„å‘é€æ—¥å¿—å’Œé”™è¯¯è¿½è¸ª
- âš¡ **é«˜æ€§èƒ½**: ä½¿ç”¨ Tokio å®ç°çœŸæ­£çš„å¹¶å‘è¯·æ±‚
- ğŸ **Python ç»‘å®š**: é€šè¿‡ PyO3 æä¾›å®Œå…¨å¼‚æ­¥çš„ Python æ¥å£

## ğŸ“¦ å®‰è£…

### ä»æºç æ„å»º Python æ‰©å±•

```bash
# å®‰è£… maturin (Python åŒ…æ„å»ºå·¥å…·)
pip install maturin

# å¼€å‘æ¨¡å¼å®‰è£… (å¿«é€Ÿæµ‹è¯•)
maturin develop

# æˆ–è€…æ„å»º release wheel
maturin build --release
```

### ä½¿ç”¨ Rust

åœ¨ `Cargo.toml` ä¸­æ·»åŠ ä¾èµ–:

```toml
[dependencies]
x_dm_python = { path = "." }
tokio = { version = "1", features = ["full"] }
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Python ä½¿ç”¨ç¤ºä¾‹ (å¼‚æ­¥ API)

> **é‡è¦**: ä»ç‰ˆæœ¬ 1.0.0 å¼€å§‹ï¼ŒPython API å·²å®Œå…¨åˆ‡æ¢ä¸ºå¼‚æ­¥ã€‚

```python
import asyncio
import x_dm_python

async def main():
    # åˆå§‹åŒ–å®¢æˆ·ç«¯ (éœ€è¦æœ‰æ•ˆçš„ cookies)
    cookies = "ct0=your_csrf_token; auth_token=your_auth_token; twid=u%3D123456789"
    client = x_dm_python.Twitter(cookies)

    # å‘é€å•æ¡ç§ä¿¡ (å¼‚æ­¥)
    result = await client.send_direct_message("123456789", "Hello from Python!")
    if result.success:
        print(f"ç§ä¿¡å‘é€æˆåŠŸ! Event ID: {result.event_id}")
    else:
        print(f"ç§ä¿¡å‘é€å¤±è´¥: {result.error_msg}")

    # æ‰¹é‡å‘é€ç§ä¿¡ (å¼‚æ­¥å¹¶å‘)
    user_ids = ["user_id_1", "user_id_2", "user_id_3"]
    message = "è¿™æ˜¯ä¸€æ¡æ‰¹é‡æµ‹è¯•æ¶ˆæ¯ï¼"
    batch_result = await client.send_batch_direct_messages(user_ids, message)

    print(f"æˆåŠŸ: {batch_result.success_count}, å¤±è´¥: {batch_result.failure_count}")
    for res in batch_result.results:
        if res.success:
            print(f"ç”¨æˆ· {res.user_id} å‘é€æˆåŠŸ")
        else:
            print(f"ç”¨æˆ· {res.user_id} å‘é€å¤±è´¥: {res.error_msg}")

# è¿è¡Œå¼‚æ­¥ä¸»å‡½æ•°
asyncio.run(main())
```

æ›´å¤šå¼‚æ­¥ç¤ºä¾‹è¯·å‚è€ƒ [`examples/python_async_example.py`](examples/python_async_example.py)

### Rust ä½¿ç”¨ç¤ºä¾‹

```rust
use x_dm_python::Twitter;

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    // åˆå§‹åŒ–å®¢æˆ·ç«¯
    let cookies = "ct0=your_csrf_token; auth_token=your_auth_token; twid=u%3D123456789";
    let client = Twitter::new(cookies.to_string(), None)?;

    // å‘é€å•æ¡ç§ä¿¡
    let result = client.send_direct_message("123456789", "Hello, World!").await?;
    if result.success {
        println!("ç§ä¿¡å‘é€æˆåŠŸ!");
    }

    // æ‰¹é‡å‘é€ç§ä¿¡
    let user_ids = vec!["123456789".to_string(), "987654321".to_string()];
    let results = client.send_batch_direct_messages(user_ids, "æ‰¹é‡æ¶ˆæ¯", None).await?;

    println!("æˆåŠŸ: {}, å¤±è´¥: {}", results.success_count, results.failure_count);

    Ok(())
}
```

## ğŸ“– API æ–‡æ¡£

### Twitter ç±»

#### Python API

> **æ³¨æ„**: æ‰€æœ‰æ¶‰åŠ I/O çš„æ–¹æ³•å‡ä¸ºå¼‚æ­¥æ–¹æ³•ï¼Œä½¿ç”¨ `await` è°ƒç”¨

- `Twitter(cookies: str, proxy_url: Optional[str] = None)`: åˆ›å»º Twitter å®¢æˆ·ç«¯
- `async send_direct_message(user_id: str, message: str) -> DMResult`: å‘é€å•æ¡ç§ä¿¡
- `async send_batch_direct_messages(user_ids: List[str], message: str, ...) -> BatchDMResult`: æ‰¹é‡å‘é€ç§ä¿¡
- `validate_cookies() -> bool`: éªŒè¯ cookies æ˜¯å¦æœ‰æ•ˆ
- `get_cookies() -> str`: è·å–å½“å‰ cookies

#### Rust API

- `Twitter::new(cookies: String, proxy_url: Option<String>) -> Result<Self>`: åˆ›å»º Twitter å®¢æˆ·ç«¯
- `async fn send_direct_message(&self, user_id: &str, message: &str) -> Result<DMResult>`: å‘é€å•æ¡ç§ä¿¡
- `async fn send_batch_direct_messages(&self, user_ids: Vec<String>, message: &str, client_transaction_ids: Option<Vec<String>>) -> Result<BatchDMResult>`: æ‰¹é‡å‘é€ç§ä¿¡
- `fn validate_cookies(&self) -> bool`: éªŒè¯ cookies æ˜¯å¦æœ‰æ•ˆ

### DMResult ç»“æ„ä½“

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|-----|------|------|
| `success` | `bool` | å‘é€æ˜¯å¦æˆåŠŸ |
| `user_id` | `str/String` | ç›®æ ‡ç”¨æˆ·ID |
| `message` | `str/String` | å‘é€çš„æ¶ˆæ¯å†…å®¹ |
| `error_msg` | `str/String` | é”™è¯¯ä¿¡æ¯(å¦‚æœæœ‰) |
| `http_status` | `int/u16` | HTTP çŠ¶æ€ç  |
| `event_id` | `Optional[str]/Option<String>` | Twitter å“åº”ä¸­çš„äº‹ä»¶ID |

### BatchDMResult ç»“æ„ä½“

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|-----|------|------|
| `success_count` | `int/usize` | æˆåŠŸå‘é€çš„æ•°é‡ |
| `failure_count` | `int/usize` | å‘é€å¤±è´¥çš„æ•°é‡ |
| `results` | `List[DMResult]/Vec<DMResult>` | æ¯ä¸ªç§ä¿¡çš„è¯¦ç»†å‘é€ç»“æœ |

## ğŸ” è·å– Twitter Cookies

1. åœ¨æµè§ˆå™¨ä¸­ç™»å½• Twitter
2. æ‰“å¼€å¼€å‘è€…å·¥å…· (F12)
3. è½¬åˆ° Network æ ‡ç­¾é¡µ
4. å‘é€ä¸€æ¡ç§ä¿¡
5. åœ¨è¯·æ±‚å¤´ä¸­æ‰¾åˆ° Cookie å­—æ®µ
6. å¤åˆ¶å®Œæ•´çš„ Cookie å€¼

**é‡è¦**: è¯·ç¡®ä¿ cookies åŒ…å«ä»¥ä¸‹å¿…è¦å­—æ®µï¼š
- `ct0`: CSRFä»¤ç‰Œ
- `auth_token`: è®¤è¯ä»¤ç‰Œ
- `twid`: ç”¨æˆ·ID

## âš ï¸ æ³¨æ„äº‹é¡¹

### å®‰å…¨æ€§
- ğŸ” **ä¿æŠ¤ cookies**: ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç  cookiesï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶
- ğŸš« **é¿å…æ»¥ç”¨**: éµå®ˆ Twitter çš„ä½¿ç”¨æ¡æ¬¾ï¼Œé¿å…å‘é€åƒåœ¾ä¿¡æ¯
- â±ï¸ **è¯·æ±‚é¢‘ç‡**: æ³¨æ„æ§åˆ¶è¯·æ±‚é¢‘ç‡ï¼Œé¿å…è§¦å‘ååƒåœ¾æœºåˆ¶

### æ€§èƒ½ä¼˜åŒ–
- ğŸ“Š **å¹¶å‘æ§åˆ¶**: æ‰¹é‡å‘é€æ—¶è‡ªåŠ¨å¹¶å‘ï¼Œæ— éœ€æ‰‹åŠ¨æ§åˆ¶
- â° **è¶…æ—¶è®¾ç½®**: é»˜è®¤è¯·æ±‚è¶…æ—¶ 30 ç§’
- ğŸ“ **æ—¥å¿—çº§åˆ«**: ä½¿ç”¨ç¯å¢ƒå˜é‡ `RUST_LOG=debug` è®¾ç½®æ—¥å¿—çº§åˆ«

## ğŸ—ï¸ æ¶æ„è®¾è®¡

æœ¬é¡¹ç›®é‡‡ç”¨**ç»„åˆæ¨¡å¼ + Trait æŠ½è±¡**çš„æ¨¡å—åŒ–æ¶æ„ï¼š

### æ¨¡å—ç»„ç»‡
- **common æ¨¡å—**: è®¤è¯ã€HTTP å®¢æˆ·ç«¯ã€é”™è¯¯å¤„ç†
- **x æ¨¡å—**: X (Twitter) åŠŸèƒ½æ¨¡å—
  - **dm å­æ¨¡å—**: ç§ä¿¡å‘é€åŠŸèƒ½
  - **upload å­æ¨¡å—**: å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
- **python æ¨¡å—**: Python ç»‘å®šå±‚
- **lib.rs**: èšåˆå¯¼å‡ºå±‚

### ä½¿ç”¨æ–¹å¼

**èšåˆä½¿ç”¨ï¼ˆæ¨èï¼‰**
```rust
use x_dm_python::Twitter;

// é€šè¿‡ Twitter ç»Ÿä¸€å®¢æˆ·ç«¯è®¿é—®
let twitter = Twitter::new(cookies, proxy)?;

// å‘é€ç§ä¿¡
twitter.send_direct_message("user_id", "message", None).await?;

// ä¸Šä¼ å›¾ç‰‡
twitter.upload_image(image_bytes, MediaCategory::DmImage).await?;
```

**ç‹¬ç«‹æ¨¡å—ä½¿ç”¨**
```rust
use x_dm_python::x::dm::{DMClient, DMService};
use x_dm_python::x::upload::{UploadClient, UploadService};

// åªä½¿ç”¨ DM åŠŸèƒ½
let dm = DMClient::new(auth.clone(), client.clone());
dm.send_message("user_id", "message", None).await?;

// åªä½¿ç”¨ Upload åŠŸèƒ½
let upload = UploadClient::new(auth.clone(), client.clone());
upload.upload_from_bytes(image_bytes, MediaCategory::DmImage).await?;
```

### æŠ€æœ¯æ ˆ
- ğŸš€ **å¹¶å‘**: Tokio å¼‚æ­¥è¿è¡Œæ—¶
- ğŸ”Œ **Python ç»‘å®š**: PyO3 0.26 + pyo3-async-runtimes
- ğŸ“ **æ—¥å¿—**: tracing
- ğŸ”’ **é”™è¯¯å¤„ç†**: Result<T, E>
- ğŸ“¦ **JSON**: serde_json
- ğŸŒ **HTTP**: rquest (æ”¯æŒ JA3/JA4 æŒ‡çº¹ç»•è¿‡)

## ğŸ“ å¼€å‘

### æ„å»º

```bash
# æ„å»º Rust åº“
cargo build --release

# æ„å»ºå¸¦ Python ç»‘å®šçš„åº“ (ä½¿ç”¨ maturin)
maturin develop  # å¼€å‘æ¨¡å¼
# æˆ–è€…æ„å»º release wheel
maturin build --release

# è¿è¡Œæµ‹è¯•
cargo test
```

### æµ‹è¯•

æœ¬é¡¹ç›®éµå¾ª Rust å®˜æ–¹æµ‹è¯•æœ€ä½³å®è·µï¼Œåˆ†ä¸º**å•å…ƒæµ‹è¯•**å’Œ**é›†æˆæµ‹è¯•**ï¼š

#### å•å…ƒæµ‹è¯•

å•å…ƒæµ‹è¯•ä½äº `src/` ç›®å½•ä¸­ï¼Œä¸è¢«æµ‹è¯•ä»£ç åœ¨åŒä¸€æ–‡ä»¶ï¼š

```bash
# è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
cargo test

# è¿è¡Œç‰¹å®šæ¨¡å—çš„æµ‹è¯•
cargo test upload::types::tests
cargo test upload::client::tests

# å¸¦æ—¥å¿—è¾“å‡ºçš„æµ‹è¯•
RUST_LOG=debug cargo test -- --nocapture
```

**å•å…ƒæµ‹è¯•è¦†ç›–**ï¼š
- âœ… `src/upload/types.rs`: ç±»å‹å®šä¹‰å’Œåºåˆ—åŒ–æµ‹è¯•ï¼ˆ9ä¸ªæµ‹è¯•ï¼‰
- âœ… `src/upload/client.rs`: MD5 è®¡ç®—å’Œæ•°æ®å¤„ç†æµ‹è¯•ï¼ˆ4ä¸ªæµ‹è¯•ï¼‰
- âœ… `src/common/auth.rs`: Cookie è§£æå’Œè®¤è¯æµ‹è¯•
- âœ… `src/dm/client.rs`: ç§ä¿¡å‘é€é€»è¾‘æµ‹è¯•

#### é›†æˆæµ‹è¯•

é›†æˆæµ‹è¯•ä½äº `tests/` ç›®å½•ï¼Œæµ‹è¯•å®Œæ•´çš„ API ä½¿ç”¨åœºæ™¯ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆè·³è¿‡éœ€è¦çœŸå® cookies çš„é›†æˆæµ‹è¯•ï¼‰
cargo test

# è¿è¡Œé›†æˆæµ‹è¯•ï¼ˆéœ€è¦çœŸå® Twitter cookiesï¼‰
TWITTER_COOKIES="ct0=xxx; auth_token=yyy; twid=u%3D123" cargo test -- --ignored

# è¿è¡Œç‰¹å®šçš„é›†æˆæµ‹è¯•
cargo test test_upload_tweet_image -- --ignored
```

**é›†æˆæµ‹è¯•è¦†ç›–**ï¼š
- âœ… `tests/integration_upload.rs`: å›¾ç‰‡ä¸Šä¼ å®Œæ•´æµç¨‹æµ‹è¯•
  - `test_upload_tweet_image`: æ¨æ–‡å›¾ç‰‡ä¸Šä¼ 
  - `test_upload_dm_image`: ç§ä¿¡å›¾ç‰‡ä¸Šä¼ 
  - `test_upload_banner_image`: æ¨ªå¹…å›¾ç‰‡ä¸Šä¼ 
  - `test_upload_multiple_images`: æ‰¹é‡ä¸Šä¼ æµ‹è¯•
  - `test_cookies_validation`: Cookies éªŒè¯
  - `test_media_category_enum`: åª’ä½“ç±»åˆ«æšä¸¾æµ‹è¯•

**æ³¨æ„äº‹é¡¹**ï¼š
- ğŸš« **é»˜è®¤è·³è¿‡é›†æˆæµ‹è¯•**ï¼šé›†æˆæµ‹è¯•æ ‡è®°ä¸º `#[ignore]`ï¼Œéœ€è¦çœŸå® cookies æ‰èƒ½è¿è¡Œ
- ğŸ” **ç¯å¢ƒå˜é‡**ï¼šé€šè¿‡ `TWITTER_COOKIES` ä¼ é€’è®¤è¯ä¿¡æ¯
- âœ… **ç‹¬ç«‹è¿è¡Œ**ï¼šå•å…ƒæµ‹è¯•å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–å¤–éƒ¨æœåŠ¡

#### Python æµ‹è¯•

```bash
# Python æµ‹è¯• (éœ€å…ˆå®‰è£…)
maturin develop
python -m pytest tests/
```

## ğŸ“š æ–‡æ¡£ç´¢å¼•

æœ¬é¡¹ç›®æä¾›äº†å®Œæ•´çš„æŠ€æœ¯æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç ï¼š

### æ ¸å¿ƒæ–‡æ¡£

- **[CLAUDE.md](CLAUDE.md)** - é¡¹ç›®è§„èŒƒå’Œæ¶æ„è®¾è®¡
- **[docs/API.md](docs/API.md)** - Twitter API è¯¦ç»†è§„æ ¼
- **[docs/TESTING.md](docs/TESTING.md)** - æµ‹è¯•ç­–ç•¥å’Œè¯¦ç»†è¯´æ˜
- **[docs/LOGGING.md](docs/LOGGING.md)** - æ—¥å¿—ä½¿ç”¨è§„èŒƒ
- **[docs/DEVELOPMENT.md](docs/DEVELOPMENT.md)** - å¼€å‘æŒ‡å—

### ä»£ç ç¤ºä¾‹

- **[examples/upload_single.rs](examples/upload_single.rs)** - å•æ¬¡ä¸Šä¼ ç¤ºä¾‹
- **[examples/upload_batch.rs](examples/upload_batch.rs)** - æ‰¹é‡ä¸Šä¼ åŒä¸€å¼ å›¾ç‰‡ç¤ºä¾‹
- **[examples/dm_with_media.rs](examples/dm_with_media.rs)** - å¸¦å›¾ç‰‡ç§ä¿¡ç¤ºä¾‹
- **[examples/dm_batch.py](examples/dm_batch.py)** - Python æ‰¹é‡ç§ä¿¡ç¤ºä¾‹

---

## ğŸ“œ è®¸å¯è¯

MIT License

## ğŸ”— ç›¸å…³é“¾æ¥

- [Rust æ–‡æ¡£](https://docs.rs)
- [PyO3 æ–‡æ¡£](https://pyo3.rs)
- [Maturin æ–‡æ¡£](https://maturin.rs)
- [Tokio æ–‡æ¡£](https://tokio.rs)

