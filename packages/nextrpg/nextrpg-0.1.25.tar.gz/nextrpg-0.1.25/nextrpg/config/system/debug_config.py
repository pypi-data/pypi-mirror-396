import logging
from dataclasses import dataclass
from enum import IntEnum, auto
from functools import cached_property
from typing import Any

from frozendict import frozendict

from nextrpg.core.time import Millisecond
from nextrpg.drawing.color import Color

type LOG_LEVEL = int


class LogLevel(IntEnum):
    DEBUG = auto()
    INFO = auto()
    ERROR = auto()

    @cached_property
    def stdlib(self) -> LOG_LEVEL:
        return _LOG_LEVEL[self]


_LOG_LEVEL = {
    LogLevel.DEBUG: logging.DEBUG,
    LogLevel.INFO: logging.INFO,
    LogLevel.ERROR: logging.ERROR,
}


@dataclass(frozen=True)
class DebugConfig:
    drawing_background_color: Color | None = Color(0, 0, 255, 16)
    collision_rectangle_color: Color | None = Color(255, 0, 0, 64)
    start_event_rectangle_color: Color | None = Color(0, 255, 255, 64)
    move_object_color: Color | None = Color(255, 255, 0, 180)
    npc_path_color: Color | None = Color(0, 255, 0, 64)
    draw_group_link_color: Color | None = Color(255, 0, 255, 200)
    player_collide_with_others: bool = True
    log_background_color: Color | None = Color(0, 0, 0, 64)
    log_level: LogLevel = LogLevel.DEBUG
    log_duration: Millisecond = 2000
    exclude_loggers: tuple[str, ...] = ()
    console_log_configs: frozendict[str, Any] = frozendict()


def log_only(log_level: LogLevel = LogLevel.DEBUG) -> DebugConfig:
    return DebugConfig(
        drawing_background_color=None,
        collision_rectangle_color=None,
        start_event_rectangle_color=None,
        move_object_color=None,
        npc_path_color=None,
        draw_group_link_color=None,
        player_collide_with_others=False,
        log_level=log_level,
    )
