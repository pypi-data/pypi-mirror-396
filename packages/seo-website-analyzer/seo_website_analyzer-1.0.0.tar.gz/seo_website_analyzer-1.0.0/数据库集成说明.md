# SEO检查器数据库集成说明

## 🎯 功能概述

SEO检查器现在支持将检查结果保存到数据库中，实现问题跟踪、趋势分析和团队协作。

## 🏗️ 系统架构

```
Python SEO检查器 → API客户端 → Next.js API → MySQL数据库 → 管理界面
```

## 📋 使用步骤

### 1. 数据库迁移

```bash
# 生成Prisma客户端
npx prisma generate

# 推送数据库结构变更
npx prisma db push
```

### 2. 配置SEO检查器

编辑 `seo_config.json` 文件：

```json
{
  "database": {
    "enabled": true,
    "api_url": "http://localhost:3000",
    "api_key": "your-api-key-here"
  }
}
```

### 3. 运行SEO检查

```bash
# 检查单个网站
python seo_checker.py https://example.com/

# 检查多个网站
python seo_checker.py https://site1.com/ https://site2.com/
```

### 4. 查看管理界面

访问 `http://localhost:3000/admin/seo-check` 查看和管理SEO问题。

## 🔧 功能特性

### 问题跟踪
- **问题生命周期**: 首次出现、最后出现、出现次数
- **问题去重**: 基于问题代码和URL避免重复记录
- **状态管理**: 支持标记问题为已解决

### 数据分析
- **多维度筛选**: 按域名、问题类型、严重性、解决状态筛选
- **统计信息**: 问题总数、严重性分布、解决率等
- **趋势分析**: 问题出现频率和解决情况

### 团队协作
- **问题分配**: 可以标记问题为已解决
- **进度跟踪**: 实时查看问题解决进度
- **历史记录**: 完整的问题处理历史

## 📊 数据库表结构

### website_seo_issues 表
- `id`: 主键
- `domain`: 域名
- `page_url`: 页面URL
- `issue_code`: 问题唯一代码
- `issue_name`: 问题名称
- `issue_type`: 问题类型
- `issue_severity`: 问题严重性
- `issue_description`: 问题描述
- `issue_suggestion`: 改进建议
- `first_occurrence`: 首次出现时间
- `last_occurrence`: 最后出现时间
- `occurrence_count`: 出现次数
- `is_resolved`: 是否已解决
- `resolved_at`: 解决时间

## 🚀 API接口

### 提交问题数据
```http
POST /api/admin/seo-check
Content-Type: application/json
X-API-Key: your-api-key

{
  "issues": [
    {
      "domain": "example.com",
      "page_url": "https://example.com/page",
      "issue_code": "title_a1b2c3d4",
      "issue_name": "标题缺失",
      "issue_type": "title",
      "issue_severity": "critical",
      "issue_description": "页面缺少title标签",
      "issue_suggestion": "请为页面添加title标签"
    }
  ]
}
```

### 获取问题列表
```http
GET /api/admin/seo-check?domain=example.com&issueType=title&page=1&limit=20
X-API-Key: your-api-key
```

### 标记问题已解决
```http
PUT /api/admin/seo-check/{id}/resolve
X-API-Key: your-api-key
```

## 🧪 测试

运行测试脚本验证集成：

```bash
python test_database_integration.py
```

## 📱 管理界面

访问 `/admin/seo-check` 可以：

1. **查看问题列表**: 支持多维度筛选和分页
2. **问题详情**: 查看问题的详细信息和改进建议
3. **状态管理**: 标记问题为已解决
4. **统计分析**: 查看问题分布和趋势

## 🔍 问题排查

### 常见问题

1. **API连接失败**
   - 检查Next.js服务器是否运行
   - 验证API密钥是否正确
   - 确认数据库连接正常

2. **数据未保存**
   - 检查配置文件中的数据库设置
   - 验证API URL是否正确
   - 查看控制台错误信息

3. **管理界面无法访问**
   - 确认用户已登录
   - 检查路由配置
   - 验证数据库表是否已创建

### 调试方法

1. **查看日志**: 检查Python和Next.js的控制台输出
2. **API测试**: 使用测试脚本验证API连接
3. **数据库检查**: 直接查询数据库确认数据是否保存

## 🎉 总结

SEO检查器数据库集成提供了完整的问题跟踪和管理解决方案，支持：

- ✅ 自动化SEO问题检测和记录
- ✅ 问题生命周期跟踪
- ✅ 团队协作和进度管理
- ✅ 数据分析和趋势监控
- ✅ 用户友好的管理界面

现在您可以高效地管理和跟踪网站的SEO问题了！
