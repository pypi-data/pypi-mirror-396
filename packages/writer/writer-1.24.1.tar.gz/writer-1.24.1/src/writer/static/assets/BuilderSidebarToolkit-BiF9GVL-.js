import{d as Z,V as ee,i as B,r as I,a as S,u as te,c as u,bp as re,bq as $,w as ae,o as c,b as ne,au as se,R as oe,z as k,g as h,x as g,W as ie,y as C,A as le,f as m,S as E,D as x,E as q,t as R,G as ue,bj as ce,aq as de,bk as V,ax as pe,aM as me,_ as fe}from"./index-SYnWB7Y3.js";import{B as he}from"./BuilderApp-BgtIE8iY.js";import"./WdsCheckbox-liKUs9JY.js";import"./marked.esm-273vDTCT.js";const ge={key:0,class:"sharedBlueprintNotice"},ve={class:"header"},_e={class:"tools"},be=["data-writer-tooltip","data-component-type","onDragstart"],ye={class:"name"},Be=["data-writer-tooltip","onClick"],Se={class:"BuilderSidebarPanel__footer__actions"},ke=Z({__name:"BuilderSidebarToolkit",setup(Ce){const{pushToast:w}=ee(),j=B(S.isAutogenModalShown,I(!1));function F(){j.value=!0}const l=B(S.core),v=B(S.builderManager),P=te(l),{removeComponentsSubtree:W}=pe(l,v,P),{removeInsertionCandidacy:N}=me(l),d=I(""),f=u(()=>Array.isArray(l.featureFlags.value)&&l.featureFlags.value.includes("shared_blueprints")),b=v.activeRootId,M=u(()=>f.value?l.getComponents("blueprints_root",{sortedByPosition:!0}).filter(e=>{var r;return((r=e.content)==null?void 0:r.isSharedBlueprint)===!0}):[]),O=new Set(["blueprints_runblueprint","blueprints_apitrigger","blueprints_uieventtrigger","blueprints_crontrigger"]),_=u(()=>{var r;if(b.value!=="blueprints_root")return!1;const t=l.activePageId.value;if(!t)return!1;const e=l.getComponentById(t);return((r=e==null?void 0:e.content)==null?void 0:r.isSharedBlueprint)===!0}),U=["Layout","Content","Input","Embed","Writer","Logic","Triggers","Other","Shared Blueprints"],p=u(()=>v.mode.value=="blueprints"?"blueprints":"core"),T=u(()=>{const t=U.map(e=>[e,G(e)]).filter(([e,r])=>r.length>0||e==="Shared Blueprints"&&b.value=="blueprints_root"&&f.value&&!_.value);return Object.fromEntries(t)}),z=u(()=>{if(d.value)return Object.values(T.value).reduce((t,e)=>t+e.length,0)}),K=u(()=>p.value=="core"?"Interface toolkit":p.value=="blueprints"?"Blueprints toolkit":"Toolkit");function G(t){if(t==="Shared Blueprints"){if(!f.value||_.value)return[];const a=M.value.map(o=>{var A,D;const y=((A=o.content)==null?void 0:A.key)||"Untitled Blueprint",Y=((D=o.content)==null?void 0:D.description)||"A shared blueprint";return{type:`blueprints_shared:${o.id}`,name:y,description:Y,category:"Shared Blueprints",sourceBlueprintId:o.id}}),s=d.value.toLocaleLowerCase();return a.filter(o=>!s||o.name.toLocaleLowerCase().includes(s)).sort((o,y)=>o.name.localeCompare(y.name,void 0,{sensitivity:"base"}))}const r=re().filter(a=>{const s=$(a);return!(a.startsWith("shared_")||s.category!=t||!s.toolkit&&p.value!=="core"||s.toolkit&&s.toolkit!==p.value||s.deprecated||_.value&&O.has(a))}).map(a=>{const{name:s,description:L,category:o}=$(a);return{type:a,name:s,description:L,category:o??"Other"}}),i=d.value.toLocaleLowerCase();return r.filter(a=>!i||a.name.toLocaleLowerCase().includes(i)).sort((a,s)=>a.name.localeCompare(s.name,void 0,{sensitivity:"base"}))}function H(t,e,r){v.setSelection(null);const i=r?`application/json;writer=blueprints_shared,${r}`:`application/json;writer=${e},`;t.dataTransfer.setData(i,"{}")}function J(t){N(t)}function Q(t){return t.sourceBlueprintId?["/components/blueprints_category_Logic.svg"].map(e=>V(e)):[`/components/${t.type}.svg`,`/components/${p.value=="blueprints"?"blueprints_":""}category_${t.category}.svg`].map(e=>V(e))}function X(t,e){if(confirm(`Are you sure you want to delete the shared blueprint "${e}"?`))try{W(t),w({type:"success",message:`Shared blueprint '${e}' deleted.`})}catch(r){w({type:"error",message:`Failed to delete shared blueprint: ${r instanceof Error?r.message:String(r)}`})}}return ae(p,()=>{d.value=""}),(t,e)=>(c(),ne(he,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=r=>d.value=r),class:"BuilderSidebarToolkit",placeholder:K.value,"search-count":z.value},se({default:k(()=>[_.value?(c(),m("div",ge,[g(C,{name:"info"}),e[2]||(e[2]=h("span",null,"Some blocks are hidden because they can't be used in shared blueprints.",-1))])):E("",!0),(c(!0),m(x,null,q(T.value,(r,i)=>(c(),m("div",{key:i,class:"category"},[h("div",ve,R(i),1),h("div",_e,[(c(!0),m(x,null,q(r,n=>(c(),m("div",{key:n.type,class:ue(["tool",{"tool--shared":i==="Shared Blueprints"&&f.value}]),"data-writer-tooltip":n.description,"data-writer-tooltip-placement":"right","data-writer-tooltip-gap":"8",draggable:"true","data-component-type":n.type,onDragend:e[0]||(e[0]=a=>J(a)),onDragstart:a=>H(a,n.type,n.sourceBlueprintId)},[g(ce,{alt:`(Icon for ${n.name})`,draggable:"false",urls:Q(n),"loader-max-width-px":18,"loader-max-height-px":18},null,8,["alt","urls"]),h("div",ye,R(n.name),1),i==="Shared Blueprints"&&f.value&&n.sourceBlueprintId?(c(),m("button",{key:0,class:"tool__delete","data-writer-tooltip":`Delete ${n.name}`,"data-writer-tooltip-placement":"right",onClick:de(a=>X(n.sourceBlueprintId,n.name),["stop"])},[g(C,{name:"trash"})],8,Be)):E("",!0)],42,be))),128))])]))),128))]),_:2},[oe(b)=="blueprints_root"?{name:"footer",fn:k(()=>[h("div",Se,[g(ie,{variant:"special",size:"small",class:"BuilderSidebarPanel__footer__btn",onClick:F},{default:k(()=>[g(C,{name:"wand-sparkles"}),e[3]||(e[3]=le(" Autogenerate "))]),_:1})])]),key:"0"}:void 0]),1032,["modelValue","placeholder","search-count"]))}}),De=fe(ke,[["__scopeId","data-v-18d3732b"]]);export{De as default};
