import{a as ce,B as pe}from"./BuilderApp-BgtIE8iY.js";import{c as m,d as H,r as J,i as N,a as O,u as Z,w as F,aX as me,aW as ge,L as S,o as d,b as T,z as b,g as h,f as v,D as B,x as _,y as k,S as y,R as c,t as z,E as W,br as ve,C as U,ax as ee,l as fe,aM as he,_ as te,W as j,A as X}from"./index-SYnWB7Y3.js";import"./WdsCheckbox-liKUs9JY.js";import"./marked.esm-273vDTCT.js";function ne(p,s){function o(r){if(!s.value)return!0;const t=p.getComponentDefinition(r.type);return!!(t!=null&&t.name.toLocaleLowerCase().includes(s.value)||Object.values(r.content).filter(f=>typeof f=="string"&&f.toLocaleLowerCase().includes(s.value)).length>0)}return{isComponentMatchingQuery:o}}function ye(p,s,o){const{isComponentMatchingQuery:r}=ne(p,s);return{searchResultCount:m(()=>{if(!s.value)return;let u=0;for(const f of p.getComponentsNested(o.value))r(f)&&u++;return u})}}function Ce(p,s,o){const{isComponentMatchingQuery:r}=ne(p,s),t=m(()=>!s.value||r(o.value));return{hasMatchingChildren:m(()=>{if(!s.value)return!0;for(const f of p.getComponentsNested(o.value.id))if(r(f))return!0;return!1}),matched:t}}const _e={class:"BuilderSidebarComponentTreeBranch__nameRight"},be={class:"previewText"},Be=H({__name:"BuilderSidebarComponentTreeBranch",props:{componentId:{type:String,required:!0},query:{type:String,required:!1,default:""}},emits:["expandBranch"],setup(p,{emit:s}){const o=p,r=J(),t=N(O.core),u=N(O.builderManager),f=m(()=>u.isComponentIdSelected(o.componentId)),C=Z(t),{createAndInsertComponent:q,moveComponent:P,goToComponentParentPage:R,isDraggingAllowed:L}=ee(t,u,C),{getComponentInfoFromDrag:x,removeInsertionCandidacy:A,isParentSuitable:D}=he(t),{isComponentVisible:V}=fe(t),i=s,l=m(()=>{var e;return((e=o.query)==null?void 0:e.toLocaleLowerCase())??""}),n=m(()=>t.getComponentById(o.componentId)),{hasMatchingChildren:w,matched:ae}=Ce(t,l,n);F(w,e=>{var a;return(a=r.value)==null?void 0:a.toggleCollapse(!e)},{immediate:!0});const Y=m(()=>t.getComponents(o.componentId,{sortedByPosition:!0}).filter(e=>{var a;return((a=t.getComponentDefinition(e.type))==null?void 0:a.category)!=="Internal"})),{name:oe,previewText:G}=me(t,n);async function re(e){R(o.componentId),await S(),u.handleSelectionFromEvent(e,o.componentId,void 0,"tree"),$()}function $(){r.value&&(r.value.expand(),i("expandBranch"))}function se(){var M;const e=(M=r.value)==null?void 0:M.$el;if(!e)return;const a=e.closest(".BuilderSidebarComponentTree"),g=a.getBoundingClientRect(),I=r.value.$el.offsetTop-g.height/2,E=r.value.$el.offsetLeft-g.left-16;a.scrollTo({top:I,left:Math.max(0,E),behavior:"smooth"})}function ie(e){u.setSelection(null),e.dataTransfer.setData(`application/json;writer=${n.value.type},${n.value.id}`,"{}")}function le(e){A(e)}function de(e){const a=x(e);if(!a)return;const{draggedType:g,draggedId:I}=a;D(o.componentId,I,g)&&e.preventDefault()}function ue(e){const a=x(e);if(!a)return;const{draggedType:g,draggedId:I,sourceBlueprintId:E}=a;if(I)P(I,n.value.id);else{const M=E?{content:{sourceBlueprintId:E}}:void 0;q(g,n.value.id,void 0,M)}A(e)}const K=m(()=>{if(!t.activePageId.value)return!1;const e=t.getComponents(u.activeRootId.value).some(g=>g.id===t.activePageId.value);return ge.has(n.value.type)&&e&&o.componentId!==t.activePageId.value});return F(t.activePageId,()=>{var e;t.activePageId.value&&K.value&&((e=r.value)==null||e.toggleCollapse(!0))}),F(u.firstSelectedItem,async e=>{e&&e.componentId===o.componentId&&e.source!="tree"&&($(),await S(),se())},{immediate:!0}),(e,a)=>n.value?(d(),T(ce,{key:0,ref_key:"treeBranch",ref:r,class:"BuilderSidebarComponentTreeBranch","component-id":p.componentId,name:c(oe),query:p.query,"has-children":Y.value.length>0,"data-automation-key":n.value.type,draggable:c(L)(p.componentId),matched:c(ae),selected:f.value,variant:c(ve).has(n.value.type)?"root":void 0,"disable-collapse":c(U).has(n.value.type),"no-nested-space":c(U).has(n.value.type),collapsed:K.value,onSelect:re,onDragover:de,onDragstart:ie,onDragend:le,onDrop:ue},{nameRight:b(()=>[h("span",_e,[Object.keys(n.value.handlers??{}).length>0?(d(),v(B,{key:0},[a[0]||(a[0]=h("span",{class:"middot"},null,-1)),_(k,{name:"zap"})],64)):y("",!0),c(V)(n.value.id)?y("",!0):(d(),v(B,{key:1},[a[1]||(a[1]=h("span",{class:"middot"},null,-1)),_(k,{name:"eye-off"})],64)),n.value.isCodeManaged?(d(),v(B,{key:2},[a[2]||(a[2]=h("span",{class:"middot"},null,-1)),_(k,{name:"square-terminal"})],64)):y("",!0),c(G)?(d(),v(B,{key:3},[a[3]||(a[3]=h("span",{class:"middot"},null,-1)),h("span",be,z(c(G)),1)],64)):y("",!0)])]),children:b(()=>[(d(!0),v(B,null,W(Y.value,g=>(d(),T(Q,{key:g.id,"component-id":g.id,query:p.query,onExpandBranch:$},null,8,["component-id","query"]))),128))]),_:1},8,["component-id","name","query","has-children","data-automation-key","draggable","matched","selected","variant","disable-collapse","no-nested-space","collapsed"])):y("",!0)}}),Q=te(Be,[["__scopeId","data-v-a553e087"]]),Ie={key:0},Te={key:1,class:"sections"},ke={class:"section__header"},Se={class:"section__title"},Pe={class:"section__content"},xe={key:0,class:"section__empty"},Ae={class:"add"},De=H({__name:"BuilderSidebarComponentTree",setup(p){const s=N(O.core),o=N(O.builderManager),r=J(""),t=Z(s),{createAndInsertComponent:u,setContentValue:f}=ee(s,o,t),C=o.activeRootId,{searchResultCount:q}=ye(s,r,C),P=m(()=>s.getComponents("blueprints_root",{sortedByPosition:!0})),R=m(()=>P.value.filter(i=>{var l;return!((l=i.content)!=null&&l.isSharedBlueprint)})),L=m(()=>P.value.filter(i=>{var l;return(l=i.content)==null?void 0:l.isSharedBlueprint})),x=m(()=>{var l;const i=[{key:"blueprints",title:"Blueprints",items:R.value,addAction:"add-blueprint",onAdd:D,emptyText:"No blueprints yet"}];return(l=s.featureFlags.value)!=null&&l.includes("shared_blueprints")&&i.push({key:"shared-blueprints",title:"Shared Blueprints",items:L.value,addAction:"add-shared-blueprint",onAdd:V,emptyText:"No shared blueprints yet"}),i});async function A(){const i=u("page","root");s.setActivePageId(i),await S(),o.setSelection(i),t.track("ui_page_added")}async function D(){const i=u("blueprints_blueprint","blueprints_root");s.setActivePageId(i),await S(),o.setSelection(i),t.track("blueprints_new_added")}async function V(){const i=u("blueprints_blueprint","blueprints_root");f(i,"isSharedBlueprint",!0),s.setActivePageId(i),await S(),o.setSelection(i),t.track("blueprints_shared_added")}return(i,l)=>(d(),T(pe,{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=n=>r.value=n),class:"BuilderSidebarComponentTree",placeholder:"Component tree","search-count":c(q)},{footer:b(()=>[h("div",Ae,[c(C)=="root"?(d(),T(j,{key:0,variant:"special",size:"small","data-automation-action":"add-page",onClick:A},{default:b(()=>[_(k,{name:"plus"}),l[1]||(l[1]=X(" Add page "))]),_:1})):y("",!0),c(C)=="blueprints_root"?(d(),T(j,{key:1,variant:"special",size:"small","data-automation-action":"add-blueprint-footer",onClick:D},{default:b(()=>[_(k,{name:"plus"}),l[2]||(l[2]=X(" Add blueprint "))]),_:1})):y("",!0)])]),default:b(()=>[c(C)=="root"?(d(),v("div",Ie,[_(Q,{class:"rootBranch","component-id":c(C),query:r.value},null,8,["component-id","query"])])):c(C)=="blueprints_root"?(d(),v("div",Te,[(d(!0),v(B,null,W(x.value,n=>(d(),v("div",{key:n.key,class:"section"},[h("div",ke,[h("span",Se,z(n.title),1),_(j,{variant:"neutral",size:"smallIcon","data-automation-action":n.addAction,onClick:n.onAdd},{default:b(()=>[_(k,{name:"plus"})]),_:2},1032,["data-automation-action","onClick"])]),h("div",Pe,[(d(!0),v(B,null,W(n.items,w=>(d(),T(Q,{key:w.id,"component-id":w.id,query:r.value},null,8,["component-id","query"]))),128)),n.items.length===0?(d(),v("div",xe,z(n.emptyText),1)):y("",!0)])]))),128))])):y("",!0)]),_:1},8,["modelValue","search-count"]))}}),Oe=te(De,[["__scopeId","data-v-678509d3"]]);export{Oe as default};
