# generated by datamodel-codegen:
#   filename:  inference_graph_recipe.schema.json
#   timestamp: 2025-12-15T10:37:44+00:00

from __future__ import annotations

from typing import Annotated, Literal, Optional, Union

from pydantic import BaseModel, ConfigDict, Field, RootModel


class ConstTensorFloat64Data(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    data_type: Literal['float64']
    data: list[float]


class ConstTensorInt64Data(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    data_type: Literal['int64']
    data: list[int]


class ConstTensorUint64Data(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    data_type: Literal['uint64']
    data: list[int]


class ImageSize(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    height: Annotated[int, Field(ge=1)]
    width: Annotated[int, Field(ge=1)]


class TargetSizeSourceTopic(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    source_type: Literal['topic']
    topic: Annotated[
        str, Field(pattern='^[a-zA-Z0-9_]+\\/[a-zA-Z0-9_]+([?]timeout=\\d+)?$')
    ]


class TargetSizeSourceImageSize(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    source_type: Literal['image_size']
    size: ImageSize


class ThresholdSourceTopic(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    source_type: Literal['topic']
    topic: Annotated[
        str, Field(pattern='^[a-zA-Z0-9_]+\\/[a-zA-Z0-9_]+([?]timeout=\\d+)?$')
    ]


class ThresholdSourceValue(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    source_type: Literal['value']
    value: Annotated[float, Field(ge=0.0, le=1.0)]


class ImagePatchesNode(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    node_type: Literal['image_patches']
    name: str
    input_image: Annotated[
        str, Field(pattern='^[a-zA-Z0-9_]+\\/[a-zA-Z0-9_]+([?]timeout=\\d+)?$')
    ]
    input_bounding_boxes: Annotated[
        str, Field(pattern='^[a-zA-Z0-9_]+\\/[a-zA-Z0-9_]+([?]timeout=\\d+)?$')
    ]
    input_target_size: Annotated[
        Union[TargetSizeSourceTopic, TargetSizeSourceImageSize],
        Field(
            description='Source for the target size, either from a topic or a constant ImageSize.',
            discriminator='source_type',
        ),
    ]
    output_port_name: Annotated[str, Field(pattern='^[a-zA-Z0-9_-]+$')]


class ImageResizeNode(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    node_type: Literal['image_resize']
    name: str
    input_size: Annotated[
        str, Field(pattern='^[a-zA-Z0-9_]+\\/[a-zA-Z0-9_]+([?]timeout=\\d+)?$')
    ]
    input_image: Annotated[
        str, Field(pattern='^[a-zA-Z0-9_]+\\/[a-zA-Z0-9_]+([?]timeout=\\d+)?$')
    ]
    output_port_name: Annotated[str, Field(pattern='^[a-zA-Z0-9_-]+$')]


class ModelSourceFromNetworkExperimentId(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    source_type: Literal['network_experiment_id']
    network_experiment_id: Annotated[
        str,
        Field(
            description='Model from a network experiment ID.',
            pattern='^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$',
        ),
    ]


class ModelSourceFromNetworkId(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    source_type: Literal['network_id']
    network_id: Annotated[
        str,
        Field(
            description='Model from a network ID.',
            pattern='^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$',
        ),
    ]


class VirtualCameraNode(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    node_type: Literal['virtual_camera']
    name: str
    path: str
    output_port_name: Annotated[str, Field(pattern='^[a-zA-Z0-9_-]+$')]


class BoundingBoxFilterNode(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    node_type: Literal['bounding_box_filter']
    name: str
    input_bounding_boxes: Annotated[
        str, Field(pattern='^[a-zA-Z0-9_]+\\/[a-zA-Z0-9_]+([?]timeout=\\d+)?$')
    ]
    input_score_threshold: Annotated[
        Optional[Union[ThresholdSourceTopic, ThresholdSourceValue]],
        Field(
            description='Source for a threshold value (0.0-1.0), either from a topic or a constant value.',
            discriminator='source_type',
        ),
    ] = None
    input_iou_threshold: Annotated[
        Optional[Union[ThresholdSourceTopic, ThresholdSourceValue]],
        Field(
            description='Source for a threshold value (0.0-1.0), either from a topic or a constant value.',
            discriminator='source_type',
        ),
    ] = None
    output_port_name: Annotated[str, Field(pattern='^[a-zA-Z0-9_-]+$')]


class ConstTensorNode(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    node_type: Literal['const_tensor']
    name: str
    shape: list[int]
    data: Annotated[
        Union[ConstTensorUint64Data, ConstTensorInt64Data, ConstTensorFloat64Data],
        Field(
            description='Base type for constant tensor data.', discriminator='data_type'
        ),
    ]
    output_port_name: Annotated[str, Field(pattern='^[a-zA-Z0-9_-]+$')]


class ClassificationNode(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    node_type: Literal['image_classification']
    name: str
    input_image: Annotated[
        str, Field(pattern='^[a-zA-Z0-9_]+\\/[a-zA-Z0-9_]+([?]timeout=\\d+)?$')
    ]
    model_source: Annotated[
        Union[ModelSourceFromNetworkId, ModelSourceFromNetworkExperimentId],
        Field(
            description='Base type for the source of the model.',
            discriminator='source_type',
        ),
    ]
    output_port_name: Annotated[str, Field(pattern='^[a-zA-Z0-9_-]+$')]


class ObjectDetectionNode(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    node_type: Literal['image_object_detection']
    name: str
    input_image: Annotated[
        str, Field(pattern='^[a-zA-Z0-9_]+\\/[a-zA-Z0-9_]+([?]timeout=\\d+)?$')
    ]
    model_source: Annotated[
        Union[ModelSourceFromNetworkId, ModelSourceFromNetworkExperimentId],
        Field(
            description='Base type for the source of the model.',
            discriminator='source_type',
        ),
    ]
    scale_bounding_boxes: Optional[bool] = True
    output_port_name: Annotated[str, Field(pattern='^[a-zA-Z0-9_-]+$')]


class OcrNode(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    node_type: Literal['image_ocr']
    name: str
    input_image: Annotated[
        str, Field(pattern='^[a-zA-Z0-9_]+\\/[a-zA-Z0-9_]+([?]timeout=\\d+)?$')
    ]
    model_source: Annotated[
        Union[ModelSourceFromNetworkId, ModelSourceFromNetworkExperimentId],
        Field(
            description='Base type for the source of the model.',
            discriminator='source_type',
        ),
    ]
    output_port_name: Annotated[str, Field(pattern='^[a-zA-Z0-9_-]+$')]


class ImageSegmentationNode(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    node_type: Literal['image_segmentation']
    name: str
    input_image: Annotated[
        str, Field(pattern='^[a-zA-Z0-9_]+\\/[a-zA-Z0-9_]+([?]timeout=\\d+)?$')
    ]
    model_source: Annotated[
        Union[ModelSourceFromNetworkId, ModelSourceFromNetworkExperimentId],
        Field(
            description='Base type for the source of the model.',
            discriminator='source_type',
        ),
    ]
    output_port_name: Annotated[str, Field(pattern='^[a-zA-Z0-9_-]+$')]


class ImageInstanceSegmentationNode(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    node_type: Literal['image_instance_segmentation']
    name: str
    input_image: Annotated[
        str, Field(pattern='^[a-zA-Z0-9_]+\\/[a-zA-Z0-9_]+([?]timeout=\\d+)?$')
    ]
    model_source: Annotated[
        Union[ModelSourceFromNetworkId, ModelSourceFromNetworkExperimentId],
        Field(
            description='Base type for the source of the model.',
            discriminator='source_type',
        ),
    ]
    output_bounding_boxes: Annotated[str, Field(pattern='^[a-zA-Z0-9_-]+$')]
    output_segmentations: Annotated[str, Field(pattern='^[a-zA-Z0-9_-]+$')]


class ImageAnomalyDetectionNode(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    node_type: Literal['image_anomaly_detection']
    name: str
    input_image: Annotated[
        str, Field(pattern='^[a-zA-Z0-9_]+\\/[a-zA-Z0-9_]+([?]timeout=\\d+)?$')
    ]
    model_source: Annotated[
        Union[ModelSourceFromNetworkId, ModelSourceFromNetworkExperimentId],
        Field(
            description='Base type for the source of the model.',
            discriminator='source_type',
        ),
    ]
    output_anomaly_scores: Annotated[str, Field(pattern='^[a-zA-Z0-9_-]+$')]
    output_segmentations: Annotated[str, Field(pattern='^[a-zA-Z0-9_-]+$')]


class InferenceGraphRecipe(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    nodes: list[
        Union[
            ConstTensorNode,
            ImageResizeNode,
            ImagePatchesNode,
            VirtualCameraNode,
            ClassificationNode,
            ObjectDetectionNode,
            OcrNode,
            BoundingBoxFilterNode,
            ImageSegmentationNode,
            ImageInstanceSegmentationNode,
            ImageAnomalyDetectionNode,
        ]
    ]
    license_id: str
    created_at: Annotated[
        int, Field(description='Unix timestamp when the recipe was created')
    ]
