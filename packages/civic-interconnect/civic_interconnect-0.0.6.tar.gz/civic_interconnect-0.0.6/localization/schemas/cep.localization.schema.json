{
  "$id": "https://raw.githubusercontent.com/civic-interconnect/civic-interconnect/main/schemas/core/cep.localization.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "CEP Localization Configuration",
  "description": "Defines jurisdiction-specific normalization and localization rules for Civic Interconnect (CEP). These configurations drive name normalization, abbreviation expansion, and entity type standardization for a given jurisdiction.",
  "type": "object",
  "properties": {
    "jurisdiction": {
      "type": "string",
      "description": "Primary jurisdiction for which these localization rules apply. For example, ISO 3166-1 or 3166-2 style codes such as 'US' or 'US-MN'. Special value 'BASE' may be used for global or cross-jurisdiction defaults.",
      "pattern": "^[A-Z]{2}(-[A-Z0-9]{1,3})?$|^BASE$"
    },
    "parent": {
      "type": ["string", "null"],
      "description": "Optional parent localization configuration identifier (for example, 'BASE' or 'US'). When set, the current configuration extends and overrides rules from the parent."
    },
    "version": {
      "type": "string",
      "description": "Semantic version of this localization configuration.",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    },
    "updated_timestamp": {
      "type": "string",
      "description": "Timestamp when this localization file was last updated, in UTC.",
      "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$"
    },
    "config_hash": {
      "type": "string",
      "description": "Optional SHA-256 hash of the canonicalized localization configuration, excluding this field itself. Used to prove exactly which rules were applied.",
      "pattern": "^[a-f0-9]{64}$"
    },

    "abbreviations": {
      "type": "object",
      "description": "Common abbreviations and short forms mapped to their normalized text. Keys SHOULD be lowercase tokens used in input data; values SHOULD be the normalized phrase used during canonicalization.",
      "additionalProperties": {
        "type": "string",
        "maxLength": 256
      }
    },

    "agency_names": {
      "type": "object",
      "description": "Agency names that need special handling, such as multi word patterns or known aliases. Keys are patterns or raw forms seen in the data; values are the normalized form used for matching and SNFEI generation.",
      "additionalProperties": {
        "type": "string",
        "maxLength": 512
      }
    },

    "entity_types": {
      "type": "object",
      "description": "Mappings from raw entity type labels (for example, '501c3', 'k-12') to normalized phrases used during canonicalization. Keys are as observed in the wild; values are the normalized form.",
      "additionalProperties": {
        "type": "string",
        "maxLength": 256
      }
    },

    "rules": {
      "type": "array",
      "description": "Optional ordered list of normalization rules. These allow more complex transformations than simple abbreviation maps, such as regex based replacements or context specific rewrites.",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Stable identifier for this rule within the configuration. Useful for debugging and logging.",
            "maxLength": 64
          },
          "description": {
            "type": "string",
            "description": "Human readable explanation of what this rule does.",
            "maxLength": 512
          },
          "scope": {
            "type": "string",
            "description": "Optional scope indicating which fields this rule should apply to.",
            "enum": ["all", "entity-name", "agency-name", "entity-type"]
          },
          "pattern": {
            "type": "string",
            "description": "Text or regular expression to match in the input. If is_regex is true, this MUST be a valid regular expression."
          },
          "replacement": {
            "type": "string",
            "description": "Replacement text applied when the pattern matches."
          },
          "is_regex": {
            "type": "boolean",
            "description": "If true, the pattern is interpreted as a regular expression; otherwise, it is treated as a literal substring match.",
            "default": false
          },
          "case_sensitive": {
            "type": "boolean",
            "description": "If true, matching is case sensitive; otherwise, matching SHOULD be case insensitive.",
            "default": false
          },
          "enabled": {
            "type": "boolean",
            "description": "If false, this rule is ignored without needing to remove it from the configuration.",
            "default": true
          },
          "order": {
            "type": "integer",
            "description": "Optional explicit order for rule application. Lower numbers are applied earlier. If omitted, rules are applied in array order.",
            "minimum": 0
          }
        },
        "required": ["pattern", "replacement"],
        "additionalProperties": false
      }
    },

    "stop_words": {
      "type": "array",
      "description": "Optional list of stop words or tokens to remove before computing normalized names or hashes such as SNFEI. Tokens SHOULD be lowercase strings as they appear after initial normalization.",
      "items": {
        "type": "string",
        "maxLength": 64
      }
    }
  },
  "required": ["jurisdiction", "version", "updated_timestamp"],
  "additionalProperties": false
}
