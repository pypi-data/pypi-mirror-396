{
  "$id": "https://raw.githubusercontent.com/civic-interconnect/civic-interconnect/main/schemas/core/cep.record-envelope.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "CEP Record Envelope",
  "description": "Shared envelope for all CEP records (entity, relationship, exchange, p3tag, etc.).",
  "type": "object",
  "properties": {
    "recordKind": {
      "type": "string",
      "description": "High-level record category.",
      "enum": ["entity", "relationship", "exchange", "p3tag"]
    },
    "recordSchemaUri": {
      "type": "string",
      "format": "uri",
      "description": "URI of the specific schema used for this record instance."
    },
    "schemaVersion": {
      "type": "string",
      "description": "Semantic version of the record schema (e.g. 1.0.0).",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    },
    "revisionNumber": {
      "type": "integer",
      "minimum": 1,
      "description": "Monotonic revision number for fact changes to this record."
    },
    "verifiableId": {
      "type": "string",
      "description": "Stable CEP identifier for this record instance."
    },
    "recordTypeUri": {
      "type": "string",
      "format": "uri",
      "description": "Type URI rooted in a CEP vocabulary (entity-type, relationship-type, exchange-type, p3tag-type, etc.)."
    },
    "status": {
      "$ref": "#/$defs/status"
    },
    "timestamps": {
      "$ref": "#/$defs/timestamps"
    },
    "attestations": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/attestation"
      },
      "description": "Attestations supporting the facts in this record."
    },
    "ctags": {
      "type": "array",
      "description": "Optional Context Tags (CTags) attached to this record. CTags express interpretive, analytic, or contextual facts about the record without changing its canonical identity or payload.",
      "items": {
        "$ref": "https://raw.githubusercontent.com/civic-interconnect/civic-interconnect/main/schemas/core/cep.ctag.schema.json"
      }
    }
  },
  "required": [
    "recordKind",
    "recordSchemaUri",
    "schemaVersion",
    "revisionNumber",
    "verifiableId",
    "recordTypeUri",
    "status",
    "timestamps",
    "attestations"
  ],
  "$defs": {
    "status": {
      "type": "object",
      "description": "Lifecycle status of the record.",
      "properties": {
        "statusCode": {
          "type": "string",
          "description": "Status code for the record lifecycle.",
          "enum": ["ACTIVE", "INACTIVE", "DEPRECATED", "PENDING"]
        },
        "statusReason": {
          "type": "string",
          "description": "Optional human-readable explanation for the status."
        },
        "statusEffectiveDate": {
          "type": "string",
          "format": "date",
          "description": "Date on which this status became effective."
        }
      },
      "required": ["statusCode", "statusEffectiveDate"],
      "additionalProperties": false
    },
    "timestamps": {
      "type": "object",
      "description": "Shared timestamps for record lifecycle and validity.",
      "properties": {
        "firstSeenAt": {
          "type": "string",
          "format": "date-time",
          "description": "Time when this record was first observed by CEP."
        },
        "lastUpdatedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Time when this record was last updated in CEP."
        },
        "validFrom": {
          "type": "string",
          "format": "date-time",
          "description": "Start of the interval during which the facts are considered valid."
        },
        "validTo": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "End of the interval during which the facts are considered valid (null if open-ended)."
        }
      },
      "required": ["firstSeenAt", "lastUpdatedAt", "validFrom"],
      "additionalProperties": false
    },
    "attestation": {
      "type": "object",
      "description": "Evidence about who asserted these facts and how.",
      "properties": {
        "attestationTimestamp": {
          "type": "string",
          "format": "date-time"
        },
        "attestorId": {
          "type": "string",
          "description": "Identifier for the attesting agent (person, system, organization)."
        },
        "verificationMethodUri": {
          "type": "string",
          "format": "uri",
          "description": "URI of the verification method used."
        },
        "proofType": {
          "type": "string",
          "description": "Type of proof used (aligned with VC / security vocabularies where possible)."
        },
        "proofPurpose": {
          "type": "string",
          "description": "Purpose of the proof (e.g., assertionMethod)."
        },
        "proofValue": {
          "type": "string",
          "description": "Opaque proof value (signature, hash, or empty for manual)."
        },
        "sourceSystem": {
          "type": "string",
          "description": "Human-readable name or code for the upstream source system."
        },
        "sourceReference": {
          "type": "string",
          "description": "Identifier for the record in the upstream source (filing id, row id, URL, etc.)."
        },
        "anchorUri": {
          "anyOf": [{ "type": "string", "format": "uri" }, { "type": "null" }],
          "description": "Optional URI that anchors this attestation externally (transparency log entry, archived doc URL, IPFS URI, ledger tx, etc.)."
        }
      },
      "required": [
        "attestationTimestamp",
        "attestorId",
        "verificationMethodUri",
        "proofType",
        "proofPurpose"
      ],
      "additionalProperties": false
    }
  },
  "additionalProperties": true
}
