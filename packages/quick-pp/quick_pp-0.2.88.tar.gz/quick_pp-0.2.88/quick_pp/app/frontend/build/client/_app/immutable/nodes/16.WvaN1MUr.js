import{p as Ce,F as we,e as l,v as Ee,l as O,g as e,m as v,H as h,b as Qe,i as Re,f as w,k as b,w as W,t as u,c as De,n as g,r as f,J as K,K as Xe,M as et,N as ie,I as d,O as tt,z as at,_ as pe,G as C,C as rt,h as it,S as Ne,Z as st,P as lt,R as ot,Y as nt,Q as ct}from"../chunks/B2f41zB7.js";import{_ as dt}from"../chunks/PPVm8Dsz.js";import{B as Me}from"../chunks/BjKtTXPK.js";import{w as ke,h as mt,f as vt}from"../chunks/BhLg-KJu.js";import{D as pt}from"../chunks/DlkK8I-2.js";import{P as ut}from"../chunks/Cs5iii9O.js";const ft=()=>({title:"Permeability",subtitle:"Permeability estimations for the selected well"}),qt=Object.freeze(Object.defineProperty({__proto__:null,load:ft},Symbol.toStringTag,{value:"Module"}));var ht=w("<option> </option>"),bt=w('<div><label class="text-xs" for="swirr-input">Swirr (irreducible water saturation)</label> <input id="swirr-input" class="input" type="number" step="0.01" min="0" max="1"/></div>'),gt=w('<div class="flex items-end"><div class="text-xs text-muted-foreground">Requires: VCLAY, VSILT, PHIT</div></div>'),_t=w('<div class="text-sm text-red-500 mb-2"> </div>'),yt=w('<div class="w-full h-[260px]"></div>'),xt=w('<div class="flex items-center justify-center h-full text-sm text-gray-500">No permeability data to display. Compute permeability to see the plot.</div>'),Pt=w("<div><strong>Calculated Perm:</strong> </div>"),wt=w("<div><strong>Calculated Perm:</strong> No data</div>"),Nt=w('<div><strong>Core Perm (CPERM):</strong> <span class="inline-block w-2 h-2 bg-red-600 rounded-full"></span> </div>'),Mt=w('<div class="text-gray-500">No core permeability data (CPERM) found</div>'),Ct=w('<div class="bg-panel rounded p-3"><div class="grid grid-cols-2 gap-2 mb-3"><div><label class="text-xs" for="perm-method">Permeability method</label> <select id="perm-method" class="input"></select></div> <!></div> <!> <div class="space-y-3"><div><div class="font-medium text-sm mb-1">Permeability</div> <div class="bg-surface rounded p-2"><!> <!> <div class="flex items-center ml-2"><input type="checkbox" id="depth-matching" class="mr-2"/> <label for="depth-matching">Depth Matching</label></div> <div class="h-[260px] w-full overflow-hidden"><!></div></div></div> <div class="text-xs text-muted-foreground space-y-1"><!> <!></div></div></div>'),Et=w('<div class="text-sm">Select a well to view permeability tools.</div>'),Rt=w('<div class="ws-permeability"><div class="mb-2"><div class="font-semibold">Permeability</div> <div class="text-sm text-muted-foreground">Permeability estimation tools.</div></div> <!> <!></div>');function Dt(se,U){Ce(U,!1);const k=v(),$=v();let S=we(U,"projectId",8),_=we(U,"wellName",8);const Z="http://localhost:6312";let F=v({enabled:!1,minDepth:null,maxDepth:null}),Y=v({enabled:!1,zones:[]}),A=v([]),E=v(!1),j=v(null),G=v(!1),Q=new Map,X=v(null),B=v(!1),le=null,I=v("choo"),ee=v(.05),H=v(!1),te=v([]),ae=v([]),y=v([]),R=v([]),oe=null,L=v(null);const ne=[{value:"choo",label:"Choo",requires:["vclay","vsilt","phit"]},{value:"timur",label:"Timur",requires:["phit","swirr"]},{value:"tixier",label:"Tixier",requires:["phit","swirr"]},{value:"coates",label:"Coates",requires:["phit","swirr"]},{value:"kozeny_carman",label:"Kozeny-Carman",requires:["phit","swirr"]}];async function $e(){if(!S()||!_())return;const t=`${S()}_${_()}`;if(Q.has(t)){l(te,Q.get(t)),l(G,!0);return}l(E,!0),l(j,null);try{const i=await fetch(`${Z}/quick_pp/database/projects/${S()}/wells/${encodeURIComponent(String(_()))}/merged`);if(!i.ok)throw new Error(await i.text());const n=await i.json(),a=n&&n.data?n.data:n;if(!Array.isArray(a))throw new Error("Unexpected data format from backend");l(te,a),Q.set(t,a),l(G,!0)}catch(i){console.warn("Failed to load well data",i),l(j,String(i?.message??i))}finally{l(E,!1)}}function Se(){const t=ne.find(a=>a.value===e(I));if(!t)return[];const i=e(A),n=[];for(const a of i){const c={};let x=!0;for(const p of t.requires){let o;if(p==="swirr"?o=e(ee):p==="vclay"?o=Number(a.vclay??a.VCLAY??a.Vclay??NaN):p==="vsilt"?o=Number(a.vsilt??a.VSILT??a.Vsilt??NaN):p==="phit"?o=Number(a.phit??a.PHIT??a.Phit??NaN):o=Number(a[p]??a[p.toUpperCase()]??NaN),isNaN(o)){x=!1;break}c[p]=o}x&&n.push(c)}return n}function je(){const t=e(A),i=[];for(const n of t){const a=Number(n.depth??n.DEPTH??NaN),c=Number(n.cperm??n.CPERM??n.Cperm??n.KPERM??n.kperm??NaN);!isNaN(a)&&!isNaN(c)&&c>0&&i.push({depth:a,CPERM:c})}return i.sort((n,a)=>n.depth-a.depth)}async function Te(){const t=Se();if(!t.length){l(j,`No valid data available for ${e(I)} permeability calculation`);return}l(E,!0),l(j,null);try{const i=await fetch(`${Z}/quick_pp/permeability/${e(I)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:t})});if(!i.ok)throw new Error(await i.text());l(ae,await i.json()),ue()}catch(i){console.warn(`${e(I)} permeability error`,i),l(j,String(i?.message??i))}finally{l(E,!1)}}async function Fe(){if(!S()||!_()){l(j,"Project and well must be selected before saving");return}if(!e(y)||e(y).length===0){l(j,"No permeability results to save");return}l(B,!0),le=null,l(j,null);try{const t=e(y).map(x=>({DEPTH:x.depth,PERM:Number(x.PERM)}));if(!t.length)throw new Error("No rows prepared for save");const i={data:t},n=`${Z}/quick_pp/database/projects/${S()}/wells/${encodeURIComponent(String(_()))}/data`,a=await fetch(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!a.ok)throw new Error(await a.text());const c=await a.json().catch(()=>null);le=c&&c.message?String(c.message):"Permeability saved";try{window.dispatchEvent(new CustomEvent("qpp:data-updated",{detail:{projectId:S(),wellName:_(),kind:"permeability"}}))}catch{}}catch(t){console.warn("Save permeability error",t),le=null,l(j,String(t?.message??t))}finally{l(B,!1)}}function Ie(){const t=[];if(e(y).forEach(q=>{q.PERM&&q.PERM>0&&t.push(q.PERM)}),e(R).forEach(q=>{q.CPERM&&q.CPERM>0&&t.push(q.CPERM)}),t.length===0)return[.001,1e3];const i=Math.min(...t),n=Math.max(...t),a=Math.log10(i),c=Math.log10(n),x=c-a,p=Math.max(.1,x*.1),o=Math.pow(10,a-p),N=Math.pow(10,c+p);return[o,N]}async function qe(){if(!oe){const t=await dt(()=>import("../chunks/BJMC0GYJ.js").then(i=>i.p),[],import.meta.url);oe=t?.default??t}return oe}function ue(){const t=e(A),i=[];let n=0;for(const a of t){const c=Number(a.depth??a.DEPTH??NaN);if(isNaN(c))continue;const x=ne.find(o=>o.value===e(I));if(!x)continue;let p=!0;for(const o of x.requires){let N;if(o==="swirr"?N=e(ee):o==="vclay"?N=Number(a.vclay??a.VCLAY??a.Vclay??NaN):o==="vsilt"?N=Number(a.vsilt??a.VSILT??a.Vsilt??NaN):o==="phit"?N=Number(a.phit??a.PHIT??a.Phit??NaN):N=Number(a[o]??a[o.toUpperCase()]??NaN),isNaN(N)){p=!1;break}}if(p){const o=e(ae)[n++]??{PERM:null},N=Math.max(Number(o.PERM??.001),.001);i.push({depth:c,PERM:N})}}i.sort((a,c)=>a.depth-c.depth),l(y,i),l(R,je())}async function Ve(){if(!e(L))return;const t=await qe();if((!e(k)||e(k).length===0)&&(!e($)||e($).length===0)){try{t.purge(e(L))}catch{}return}const i=[];e(k)&&e(k).length>0&&i.push({x:e(k).map(o=>o.x),y:e(k).map(o=>o.y),name:"PERM (Log)",mode:"lines",line:{color:"#2563eb",width:2},xaxis:"x",yaxis:"y"}),e($)&&e($).length>0&&i.push({x:e($).map(o=>o.x),y:e($).map(o=>o.y),name:"CPERM (Core)",mode:"markers",marker:{color:"#dc2626",size:8,line:{color:"white",width:1}},xaxis:e(H)?"x2":"x",yaxis:"y"});const[n,a]=Ie(),c=Math.max(n,1e-12),x=Math.max(a,c*10),p={height:260,margin:{l:60,r:20,t:50,b:80},dragmode:"zoom",xaxis:{title:"Log Depth",titlefont:{color:"#2563eb"},tickfont:{color:"#2563eb"},tickformat:",.0f",side:"bottom"},xaxis2:{title:"Core Depth",titlefont:{color:"#dc2626"},tickfont:{color:"#dc2626"},tickformat:",.0f",overlaying:"x",side:"top",fixedrange:e(H)},yaxis:{title:"Permeability (mD)",type:"log",range:[Math.log10(c),Math.log10(x)]},showlegend:!0,legend:{x:0,y:1,bgcolor:"rgba(255,255,255,0.8)",bordercolor:"rgba(0,0,0,0.2)",borderwidth:1}};try{t.react(e(L),i,p,{responsive:!0})}catch{t.newPlot(e(L),i,p,{responsive:!0})}}const Ae=ke.subscribe(t=>{t?.depthFilter&&l(F,{...t.depthFilter}),t?.zoneFilter&&l(Y,{...t.zoneFilter})});Ee(()=>{Ae()});let ce=v("");O(()=>e(y),()=>{l(k,e(y).map(t=>({x:t.depth,y:t.PERM})))}),O(()=>e(R),()=>{l($,e(R).map(t=>({x:t.depth,y:t.CPERM})))}),O(()=>(e(te),e(F),e(Y)),()=>{l(A,(()=>{let t=e(te)||[];return t=mt(t,e(F)),t=vt(t,e(Y)),t})())}),O(()=>(e(ae),e(A)),()=>{e(ae)&&e(A)&&ue()}),O(()=>(h(S()),h(_()),e(ce),e(G)),()=>{const t=`${S()}_${_()}`;S()&&_()&&t!==e(ce)&&(l(ce,t),(!e(G)||!Q.has(t))&&$e())}),O(()=>(e(L),e(y),e(R),e(F),e(H),e(X)),()=>{e(L)&&(e(y)||e(R)||e(F)||e(H)!==void 0)&&(e(X)&&clearTimeout(e(X)),l(X,setTimeout(()=>Ve(),150)))}),Qe(),Re();var de=Rt(),fe=b(g(de),2);pt(fe,{});var Le=b(fe,2);{var ze=t=>{var i=Ct(),n=g(i),a=g(n),c=b(g(a),2);K(()=>{e(I),Xe(()=>{})}),et(c,5,()=>ne,tt,(s,r)=>{var m=ht(),D=g(m,!0);f(m);var T={};K(()=>{ie(D,(e(r),d(()=>e(r).label))),T!==(T=(e(r),d(()=>e(r).value)))&&(m.value=(m.__value=(e(r),d(()=>e(r).value)))??"")}),u(s,m)}),f(c),f(a);var x=b(a,2);{var p=s=>{var r=bt(),m=b(g(r),2);Ne(m),f(r),nt(m,()=>e(ee),D=>l(ee,D)),u(s,r)},o=s=>{var r=gt();u(s,r)};W(x,s=>{e(I)!=="choo"?s(p):s(o,!1)})}f(n);var N=b(n,2);{var q=s=>{var r=_t(),m=g(r);f(r),K(()=>ie(m,`Error: ${e(j)??""}`)),u(s,r)};W(N,s=>{e(j)&&s(q)})}var he=b(N,2),me=g(he),be=b(g(me),2),ge=g(be);{let s=C(()=>e(E)?"opacity:0.5; pointer-events:none;":"");Me(ge,{class:"btn btn-primary",onclick:Te,get disabled(){return e(E)},get style(){return e(s)},children:(r,m)=>{at();var D=pe("Estimate Permeability");u(r,D)},$$slots:{default:!0}})}var _e=b(ge,2);{let s=C(()=>e(E)||e(B)),r=C(()=>e(E)||e(B)?"opacity:0.5; pointer-events:none;":"");Me(_e,{class:"btn ml-2 bg-emerald-700",onclick:Fe,get disabled(){return e(s)},get style(){return e(r)},children:(m,D)=>{var T=rt(),V=it(T);{var J=P=>{var z=pe("Saving...");u(P,z)},M=P=>{var z=pe("Save Permeability");u(P,z)};W(V,P=>{e(B)?P(J):P(M,!1)})}u(m,T)},$$slots:{default:!0}})}var ve=b(_e,2),re=g(ve);Ne(re);var He=b(re,2);f(ve);var ye=b(ve,2),Oe=g(ye);{var Ke=s=>{var r=yt();ct(r,m=>l(L,m),()=>e(L)),u(s,r)},Ue=s=>{var r=xt();u(s,r)};W(Oe,s=>{e(y),e(R),d(()=>e(y).length>0||e(R).length>0)?s(Ke):s(Ue,!1)})}f(ye),f(be),f(me);var xe=b(me,2),Pe=g(xe);{var Ye=s=>{const r=C(()=>(e(y),d(()=>e(y).map(M=>M.PERM)))),m=C(()=>(h(e(r)),d(()=>e(r).reduce((M,P)=>M+P,0)/e(r).length))),D=C(()=>(h(e(r)),d(()=>Math.min(...e(r))))),T=C(()=>(h(e(r)),d(()=>Math.max(...e(r)))));var V=Pt(),J=b(g(V));f(V),K((M,P,z)=>ie(J,` Avg: ${M??""} mD | Min: ${P??""} mD | Max: ${z??""} mD | Count: ${h(e(r)),d(()=>e(r).length)??""}`),[()=>(h(e(m)),d(()=>e(m).toFixed(2))),()=>(h(e(D)),d(()=>e(D).toFixed(3))),()=>(h(e(T)),d(()=>e(T).toFixed(1)))]),u(s,V)},Be=s=>{var r=wt();u(s,r)};W(Pe,s=>{e(y),d(()=>e(y).length>0)?s(Ye):s(Be,!1)})}var Je=b(Pe,2);{var Ze=s=>{const r=C(()=>(e(R),d(()=>e(R).map(M=>M.CPERM)))),m=C(()=>(h(e(r)),d(()=>e(r).reduce((M,P)=>M+P,0)/e(r).length))),D=C(()=>(h(e(r)),d(()=>Math.min(...e(r))))),T=C(()=>(h(e(r)),d(()=>Math.max(...e(r)))));var V=Nt(),J=b(g(V),3);f(V),K((M,P,z)=>ie(J,` Avg: ${M??""} mD | Min: ${P??""} mD | Max: ${z??""} mD | Count: ${h(e(r)),d(()=>e(r).length)??""}`),[()=>(h(e(m)),d(()=>e(m).toFixed(2))),()=>(h(e(D)),d(()=>e(D).toFixed(3))),()=>(h(e(T)),d(()=>e(T).toFixed(1)))]),u(s,V)},Ge=s=>{var r=Mt();u(s,r)};W(Je,s=>{e(R),d(()=>e(R).length>0)?s(Ze):s(Ge,!1)})}f(xe),f(he),f(i),K(()=>{re.disabled=e(E),st(He,1,`text-sm cursor-pointer ${e(E)?"opacity-50":""}`)}),lt(c,()=>e(I),s=>l(I,s)),ot(re,()=>e(H),s=>l(H,s)),u(t,i)},We=t=>{var i=Et();u(t,i)};W(Le,t=>{_()?t(ze):t(We,!1)})}f(de),u(se,de),De()}var kt=w('<div slot="left"><!></div>');function Vt(se,U){Ce(U,!1);let k=v(null),$=v(null);const S=ke.subscribe(_=>{l(k,_?.project??null),l($,_?.selectedWell??null)});Ee(()=>S()),Re(),ut(se,{get selectedWell(){return e($)},get project(){return e(k)},$$slots:{left:(_,Z)=>{var F=kt(),Y=g(F);{let A=C(()=>e(k)?.project_id??""),E=C(()=>e($)?.name??"");Dt(Y,{get projectId(){return e(A)},get wellName(){return e(E)}})}f(F),u(_,F)}}}),De()}export{Vt as component,qt as universal};
