import{p as Pe,C as _e,e as o,v as we,l as W,g as e,G as h,b as Je,i as Ne,f as P,k as b,w as H,t as p,c as Me,m as u,n as g,r as f,I as U,J as Ke,K as Ze,M as ee,H as d,N as Ge,z as Qe,Z as ce,F as C,D as Xe,h as et,P as xe,Y as tt,O as at,S as rt,X as it,Q as st}from"../chunks/BA6D4iam.js";import{_ as lt}from"../chunks/PPVm8Dsz.js";import{B as ye}from"../chunks/DwWu_tO9.js";import{w as Ce,f as ot,e as nt}from"../chunks/NApQS6X6.js";import{D as ct}from"../chunks/C4A3Hpap.js";import{P as dt}from"../chunks/CerN-z7d.js";const vt=()=>({title:"Permeability",subtitle:"Permeability estimations for the selected well"}),jt=Object.freeze(Object.defineProperty({__proto__:null,load:vt},Symbol.toStringTag,{value:"Module"}));var mt=P("<option> </option>"),pt=P('<div><label class="text-xs" for="swirr-input">Swirr (irreducible water saturation)</label> <input id="swirr-input" class="input" type="number" step="0.01" min="0" max="1"/></div>'),ut=P('<div class="flex items-end"><div class="text-xs text-muted-foreground">Requires: VCLAY, VSILT, PHIT</div></div>'),ft=P('<div class="text-sm text-red-500 mb-2"> </div>'),ht=P('<div class="w-full h-[260px]"></div>'),bt=P('<div class="flex items-center justify-center h-full text-sm text-gray-500">No permeability data to display. Compute permeability to see the plot.</div>'),gt=P("<div><strong>Calculated Perm:</strong> </div>"),_t=P("<div><strong>Calculated Perm:</strong> No data</div>"),xt=P('<div><strong>Core Perm (CPERM):</strong> <span class="inline-block w-2 h-2 bg-red-600 rounded-full"></span> </div>'),yt=P('<div class="text-gray-500">No core permeability data (CPERM) found</div>'),Pt=P('<div class="bg-panel rounded p-3"><div class="grid grid-cols-2 gap-2 mb-3"><div><label class="text-xs" for="perm-method">Permeability method</label> <select id="perm-method" class="input"></select></div> <!></div> <!> <div class="space-y-3"><div><div class="font-medium text-sm mb-1">Permeability</div> <div class="bg-surface rounded p-2"><!> <!> <div class="flex items-center ml-2"><input type="checkbox" id="depth-matching" class="mr-2"/> <label for="depth-matching">Depth Matching</label></div> <div class="h-[260px] w-full overflow-hidden"><!></div></div></div> <div class="text-xs text-muted-foreground space-y-1"><!> <!></div></div></div>'),wt=P('<div class="text-sm">Select a well to view permeability tools.</div>'),Nt=P('<div class="ws-permeability"><div class="mb-2"><div class="font-semibold">Permeability</div> <div class="text-sm text-muted-foreground">Permeability estimation tools.</div></div> <!> <!></div>');function Mt(te,Y){Pe(Y,!1);const k=u(),$=u();let F=_e(Y,"projectId",8),w=_e(Y,"wellName",8);const Z="http://localhost:6312";let T=u({enabled:!1,minDepth:null,maxDepth:null}),B=u({enabled:!1,zones:[]}),A=u([]),E=u(!1),S=u(null),J=u(!1),ae=null,I=u("choo"),G=u(.05),O=u(!1),re=u([]),Q=u([]),_=u([]),R=u([]),ie=null,z=u(null);const se=[{value:"choo",label:"Choo",requires:["vclay","vsilt","phit"]},{value:"timur",label:"Timur",requires:["phit","swirr"]},{value:"tixier",label:"Tixier",requires:["phit","swirr"]},{value:"coates",label:"Coates",requires:["phit","swirr"]},{value:"kozeny_carman",label:"Kozeny-Carman",requires:["phit","swirr"]}];async function Ee(){if(!(!F()||!w())){o(E,!0),o(S,null);try{const t=await fetch(`${Z}/quick_pp/database/projects/${F()}/wells/${encodeURIComponent(String(w()))}/merged`);if(!t.ok)throw new Error(await t.text());const s=await t.json(),n=s&&s.data?s.data:s;if(!Array.isArray(n))throw new Error("Unexpected data format from backend");o(re,n)}catch(t){console.warn("Failed to load well data",t),o(S,String(t?.message??t))}finally{o(E,!1)}}}function Re(){const t=se.find(r=>r.value===e(I));if(!t)return[];const s=e(A),n=[];for(const r of s){const c={};let x=!0;for(const m of t.requires){let l;if(m==="swirr"?l=e(G):m==="vclay"?l=Number(r.vclay??r.VCLAY??r.Vclay??NaN):m==="vsilt"?l=Number(r.vsilt??r.VSILT??r.Vsilt??NaN):m==="phit"?l=Number(r.phit??r.PHIT??r.Phit??NaN):l=Number(r[m]??r[m.toUpperCase()]??NaN),isNaN(l)){x=!1;break}c[m]=l}x&&n.push(c)}return n}function De(){const t=e(A),s=[];for(const n of t){const r=Number(n.depth??n.DEPTH??NaN),c=Number(n.cperm??n.CPERM??n.Cperm??n.KPERM??n.kperm??NaN);!isNaN(r)&&!isNaN(c)&&c>0&&s.push({depth:r,CPERM:c})}return s.sort((n,r)=>n.depth-r.depth)}async function ke(){const t=Re();if(!t.length){o(S,`No valid data available for ${e(I)} permeability calculation`);return}o(E,!0),o(S,null);try{const s=await fetch(`${Z}/quick_pp/permeability/${e(I)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:t})});if(!s.ok)throw new Error(await s.text());o(Q,await s.json()),de()}catch(s){console.warn(`${e(I)} permeability error`,s),o(S,String(s?.message??s))}finally{o(E,!1)}}async function $e(){if(!F()||!w()){o(S,"Project and well must be selected before saving");return}if(!e(_)||e(_).length===0){o(S,"No permeability results to save");return}o(J,!0),ae=null,o(S,null);try{const t=e(_).map(x=>({DEPTH:x.depth,PERM:Number(x.PERM)}));if(!t.length)throw new Error("No rows prepared for save");const s={data:t},n=`${Z}/quick_pp/database/projects/${F()}/wells/${encodeURIComponent(String(w()))}/data`,r=await fetch(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error(await r.text());const c=await r.json().catch(()=>null);ae=c&&c.message?String(c.message):"Permeability saved";try{window.dispatchEvent(new CustomEvent("qpp:data-updated",{detail:{projectId:F(),wellName:w(),kind:"permeability"}}))}catch{}}catch(t){console.warn("Save permeability error",t),ae=null,o(S,String(t?.message??t))}finally{o(J,!1)}}function Se(){const t=[];if(e(_).forEach(q=>{q.PERM&&q.PERM>0&&t.push(q.PERM)}),e(R).forEach(q=>{q.CPERM&&q.CPERM>0&&t.push(q.CPERM)}),t.length===0)return[.001,1e3];const s=Math.min(...t),n=Math.max(...t),r=Math.log10(s),c=Math.log10(n),x=c-r,m=Math.max(.1,x*.1),l=Math.pow(10,r-m),N=Math.pow(10,c+m);return[l,N]}async function je(){if(!ie){const t=await lt(()=>import("../chunks/BJMC0GYJ.js").then(s=>s.p),[],import.meta.url);ie=t?.default??t}return ie}function de(){const t=e(A),s=[];let n=0;for(const r of t){const c=Number(r.depth??r.DEPTH??NaN);if(isNaN(c))continue;const x=se.find(l=>l.value===e(I));if(!x)continue;let m=!0;for(const l of x.requires){let N;if(l==="swirr"?N=e(G):l==="vclay"?N=Number(r.vclay??r.VCLAY??r.Vclay??NaN):l==="vsilt"?N=Number(r.vsilt??r.VSILT??r.Vsilt??NaN):l==="phit"?N=Number(r.phit??r.PHIT??r.Phit??NaN):N=Number(r[l]??r[l.toUpperCase()]??NaN),isNaN(N)){m=!1;break}}if(m){const l=e(Q)[n++]??{PERM:null},N=Math.max(Number(l.PERM??.001),.001);s.push({depth:c,PERM:N})}}s.sort((r,c)=>r.depth-c.depth),o(_,s),o(R,De())}async function Fe(){if(!e(z))return;const t=await je();if((!e(k)||e(k).length===0)&&(!e($)||e($).length===0)){try{t.purge(e(z))}catch{}return}const s=[];e(k)&&e(k).length>0&&s.push({x:e(k).map(l=>l.x),y:e(k).map(l=>l.y),name:"PERM (Log)",mode:"lines",line:{color:"#2563eb",width:2},xaxis:"x",yaxis:"y"}),e($)&&e($).length>0&&s.push({x:e($).map(l=>l.x),y:e($).map(l=>l.y),name:"CPERM (Core)",mode:"markers",marker:{color:"#dc2626",size:8,line:{color:"white",width:1}},xaxis:e(O)?"x2":"x",yaxis:"y"});const[n,r]=Se(),c=Math.max(n,1e-12),x=Math.max(r,c*10),m={height:260,margin:{l:60,r:20,t:50,b:80},dragmode:"zoom",xaxis:{title:"Log Depth",titlefont:{color:"#2563eb"},tickfont:{color:"#2563eb"},tickformat:",.0f",side:"bottom"},xaxis2:{title:"Core Depth",titlefont:{color:"#dc2626"},tickfont:{color:"#dc2626"},tickformat:",.0f",overlaying:"x",side:"top",fixedrange:e(O)},yaxis:{title:"Permeability (mD)",type:"log",range:[Math.log10(c),Math.log10(x)]},showlegend:!0,legend:{x:0,y:1,bgcolor:"rgba(255,255,255,0.8)",bordercolor:"rgba(0,0,0,0.2)",borderwidth:1}};try{t.react(e(z),s,m,{responsive:!0})}catch{t.newPlot(e(z),s,m,{responsive:!0})}}const Te=Ce.subscribe(t=>{t?.depthFilter&&o(T,{...t.depthFilter}),t?.zoneFilter&&o(B,{...t.zoneFilter})});we(()=>{Te()}),W(()=>e(_),()=>{o(k,e(_).map(t=>({x:t.depth,y:t.PERM})))}),W(()=>e(R),()=>{o($,e(R).map(t=>({x:t.depth,y:t.CPERM})))}),W(()=>(e(re),e(T),e(B)),()=>{o(A,(()=>{let t=e(re)||[];return t=ot(t,e(T)),t=nt(t,e(B)),t})())}),W(()=>(e(Q),e(A)),()=>{e(Q)&&e(A)&&de()}),W(()=>(h(F()),h(w())),()=>{F()&&w()&&Ee()}),W(()=>(e(z),e(_),e(R),e(T),e(O)),()=>{e(z)&&(e(_)||e(R)||e(T)||e(O)!==void 0)&&Fe()}),Je(),Ne();var le=Nt(),ve=b(g(le),2);ct(ve,{});var Ie=b(ve,2);{var qe=t=>{var s=Pt(),n=g(s),r=g(n),c=b(g(r),2);U(()=>{e(I),Ke(()=>{})}),Ze(c,5,()=>se,Ge,(i,a)=>{var v=mt(),D=g(v,!0);f(v);var j={};U(()=>{ee(D,(e(a),d(()=>e(a).label))),j!==(j=(e(a),d(()=>e(a).value)))&&(v.value=(v.__value=(e(a),d(()=>e(a).value)))??"")}),p(i,v)}),f(c),f(r);var x=b(r,2);{var m=i=>{var a=pt(),v=b(g(a),2);xe(v),f(a),it(v,()=>e(G),D=>o(G,D)),p(i,a)},l=i=>{var a=ut();p(i,a)};H(x,i=>{e(I)!=="choo"?i(m):i(l,!1)})}f(n);var N=b(n,2);{var q=i=>{var a=ft(),v=g(a);f(a),U(()=>ee(v,`Error: ${e(S)??""}`)),p(i,a)};H(N,i=>{e(S)&&i(q)})}var me=b(N,2),oe=g(me),pe=b(g(oe),2),ue=g(pe);{let i=C(()=>e(E)?"opacity:0.5; pointer-events:none;":"");ye(ue,{class:"btn btn-primary",onclick:ke,get disabled(){return e(E)},get style(){return e(i)},children:(a,v)=>{Qe();var D=ce("Estimate Permeability");p(a,D)},$$slots:{default:!0}})}var fe=b(ue,2);{let i=C(()=>e(E)||e(J)),a=C(()=>e(E)||e(J)?"opacity:0.5; pointer-events:none;":"");ye(fe,{class:"btn ml-2 bg-emerald-700",onclick:$e,get disabled(){return e(i)},get style(){return e(a)},children:(v,D)=>{var j=Xe(),V=et(j);{var K=y=>{var L=ce("Saving...");p(y,L)},M=y=>{var L=ce("Save Permeability");p(y,L)};H(V,y=>{e(J)?y(K):y(M,!1)})}p(v,j)},$$slots:{default:!0}})}var ne=b(fe,2),X=g(ne);xe(X);var Ae=b(X,2);f(ne);var he=b(ne,2),ze=g(he);{var Le=i=>{var a=ht();st(a,v=>o(z,v),()=>e(z)),p(i,a)},He=i=>{var a=bt();p(i,a)};H(ze,i=>{e(_),e(R),d(()=>e(_).length>0||e(R).length>0)?i(Le):i(He,!1)})}f(he),f(pe),f(oe);var be=b(oe,2),ge=g(be);{var Oe=i=>{const a=C(()=>(e(_),d(()=>e(_).map(M=>M.PERM)))),v=C(()=>(h(e(a)),d(()=>e(a).reduce((M,y)=>M+y,0)/e(a).length))),D=C(()=>(h(e(a)),d(()=>Math.min(...e(a))))),j=C(()=>(h(e(a)),d(()=>Math.max(...e(a)))));var V=gt(),K=b(g(V));f(V),U((M,y,L)=>ee(K,` Avg: ${M??""} mD | Min: ${y??""} mD | Max: ${L??""} mD | Count: ${h(e(a)),d(()=>e(a).length)??""}`),[()=>(h(e(v)),d(()=>e(v).toFixed(2))),()=>(h(e(D)),d(()=>e(D).toFixed(3))),()=>(h(e(j)),d(()=>e(j).toFixed(1)))]),p(i,V)},We=i=>{var a=_t();p(i,a)};H(ge,i=>{e(_),d(()=>e(_).length>0)?i(Oe):i(We,!1)})}var Ue=b(ge,2);{var Ye=i=>{const a=C(()=>(e(R),d(()=>e(R).map(M=>M.CPERM)))),v=C(()=>(h(e(a)),d(()=>e(a).reduce((M,y)=>M+y,0)/e(a).length))),D=C(()=>(h(e(a)),d(()=>Math.min(...e(a))))),j=C(()=>(h(e(a)),d(()=>Math.max(...e(a)))));var V=xt(),K=b(g(V),3);f(V),U((M,y,L)=>ee(K,` Avg: ${M??""} mD | Min: ${y??""} mD | Max: ${L??""} mD | Count: ${h(e(a)),d(()=>e(a).length)??""}`),[()=>(h(e(v)),d(()=>e(v).toFixed(2))),()=>(h(e(D)),d(()=>e(D).toFixed(3))),()=>(h(e(j)),d(()=>e(j).toFixed(1)))]),p(i,V)},Be=i=>{var a=yt();p(i,a)};H(Ue,i=>{e(R),d(()=>e(R).length>0)?i(Ye):i(Be,!1)})}f(be),f(me),f(s),U(()=>{X.disabled=e(E),tt(Ae,1,`text-sm cursor-pointer ${e(E)?"opacity-50":""}`)}),at(c,()=>e(I),i=>o(I,i)),rt(X,()=>e(O),i=>o(O,i)),p(t,s)},Ve=t=>{var s=wt();p(t,s)};H(Ie,t=>{w()?t(qe):t(Ve,!1)})}f(le),p(te,le),Me()}var Ct=P('<div slot="left"><!></div>');function Ft(te,Y){Pe(Y,!1);let k=u(null),$=u(null);const F=Ce.subscribe(w=>{o(k,w?.project??null),o($,w?.selectedWell??null)});we(()=>F()),Ne(),dt(te,{get selectedWell(){return e($)},get project(){return e(k)},$$slots:{left:(w,Z)=>{var T=Ct(),B=g(T);{let A=C(()=>e(k)?.project_id??""),E=C(()=>e($)?.name??"");Mt(B,{get projectId(){return e(A)},get wellName(){return e(E)}})}f(T),p(w,T)}}}),Me()}export{Ft as component,jt as universal};
