import{p as it,C as Pt,e as d,v as nt,l as et,g as e,G as Ft,b as It,i as ct,f as $,k as j,D as st,h as at,w as S,t as w,Q as rt,X as Zt,c as pt,m as y,n as P,F as dt,P as jt,r as F,I as ot,H as Nt,Y as $t,M as lt}from"../chunks/BA6D4iam.js";import{_ as Tt}from"../chunks/PPVm8Dsz.js";import{B as Et}from"../chunks/DwWu_tO9.js";import{D as qt}from"../chunks/C4A3Hpap.js";import{w as ut,e as Rt}from"../chunks/NApQS6X6.js";import{P as zt}from"../chunks/CerN-z7d.js";var Mt=$("<span>Saving...</span>"),Dt=$("<span>Save Rock Types</span>"),Ct=$("<div> </div>"),St=$('<div class="text-sm text-blue-600 mb-3">Loading FZI data...</div>'),Lt=$('<div class="text-sm text-red-600 mb-3"> </div>'),At=$('<div class="ws-rock-typing"><div class="mb-2"><div class="font-semibold">Rock Typing (Multi-Well)</div> <div class="text-sm text-muted-foreground">Cluster wells into rock types across the project.</div></div> <!> <div class="bg-panel rounded p-3 mb-3"><div class="flex-1"><label for="cutoffs" class="block text-sm font-medium mb-1">FZI Cutoffs (comma-separated)</label> <div class="flex gap-2 items-end"><input id="cutoffs" type="text" class="flex-1 px-3 py-2 border border-border rounded-md bg-background text-foreground" placeholder="e.g., 0.5,1.0,2.0"/> <!></div></div> <!> <div class="font-semibold mb-2">FZI Log-Log Plot</div> <div class="text-sm text-muted-foreground mb-3">Plot Flow Zone Indicator (FZI) from porosity and permeability data across all wells.</div> <!> <div class="bg-surface rounded p-3 min-h-[400px]"><div class="w-full max-w-[600px] h-[500px] mx-auto"></div></div> <div class="font-semibold mb-2">Pore-Perm Crossplot</div> <div class="text-sm text-muted-foreground mb-3">Plot porosity vs permeability with FZI cutoff lines and rock type coloring.</div> <div class="bg-surface rounded p-3 min-h-[400px]"><div class="w-full max-w-[600px] h-[500px] mx-auto"></div></div></div></div>');function Ot(L,q){it(q,!1);let v=Pt(q,"projectId",8,null),T=y(!1),g=y(null),R=y(!1),I=y(null),n=y(null),E=y({enabled:!1,zones:[]}),A=y(null);const ft=ut.subscribe(s=>{s?.zoneFilter&&d(E,{...s.zoneFilter})});nt(()=>ft());function G(){if(!e(n))return null;const s=e(n).phit.map((o,c)=>({phit:o,perm:e(n).perm[c],zone:e(n).zones[c],well_name:e(n).well_names[c],depth:e(n).depths[c]})),r=Rt(s,e(E));return{phit:r.map(o=>o.phit),perm:r.map(o=>o.perm),zones:r.map(o=>o.zone),well_names:r.map(o=>o.well_name),depths:r.map(o=>o.depth)}}let Z=y("0.1, 1.0, 3.0, 6.0"),z=null,M=y(null),D=y(null);const Q="http://localhost:6312";async function H(){if(z)return z;const s=await Tt(()=>import("../chunks/BJMC0GYJ.js").then(r=>r.p),[],import.meta.url);return z=s.default||s,z}async function mt(){if(v()){d(R,!0),d(I,null);try{const s=`${Q}/quick_pp/database/projects/${v()}/fzi_data`,r=await fetch(s);if(!r.ok)throw new Error(await r.text());d(n,await r.json())}catch(s){d(I,s.message||"Failed to load FZI data"),d(n,null)}finally{d(R,!1)}}}function ht(){const s=G();if(!s||!e(M))return;const{phit:r,perm:o}=s,c=r.map((t,a)=>.0314*Math.sqrt(o[a]/t)),h=r.map(t=>t<=0||!isFinite(t)?NaN:t/(1-t)),_=c.map((t,a)=>t/h[a]),p=e(Z).split(",").map(t=>parseFloat(t.trim())).filter(t=>!isNaN(t)&&t>0),u=_.map(t=>{if(isNaN(t)||!isFinite(t))return null;let a=p.length+1;for(let l=p.length-1;l>=0;l--)if(t>=p[l]){a=p.length-1-l+1;break}return a}),m=new Array,f={};u.forEach((t,a)=>{t!==null&&(f[t]||(f[t]={phiZ:[],rqi:[]}),f[t].phiZ.push(h[a]),f[t].rqi.push(c[a]))});const x=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];Object.keys(f).sort((t,a)=>parseInt(t)-parseInt(a)).forEach(t=>{const a=f[parseInt(t)];m.push({x:a.phiZ,y:a.rqi,mode:"markers",type:"scatter",name:`Rock Type ${t}`,marker:{color:x[(parseInt(t)-1)%x.length],size:4,symbol:"circle"}})});const b=h.filter(t=>t>0&&isFinite(t));if(b.length>0){const t=Math.min(...b),a=Math.max(...b),l=[];for(let k=0;k<20;k++)l.push(t*Math.pow(a/t,k/19));p.forEach(k=>{const C=l.map(N=>k*N);m.push({x:l,y:C,mode:"lines",type:"scatter",name:`FZI=${k.toFixed(1)}`,line:{dash:"dash",color:"red"}})})}const i={title:"FZI Log-Log Plot",xaxis:{title:"Pore to Solid Volume Ratio (phi_z)",type:"log",autorange:!0},yaxis:{title:"Rock Quality Index (RQI)",type:"log",autorange:!0},showlegend:!0,margin:{l:60,r:60,t:60,b:60}};H().then(t=>{t.newPlot(e(M),m,i,{responsive:!0})})}function vt(){const s=G();if(!s||!e(D))return;const{phit:r,perm:o}=s,c=r.map((t,a)=>.0314*Math.sqrt(o[a]/t)),h=r.map(t=>t/(1-t)),_=c.map((t,a)=>t/h[a]),p=e(Z).split(",").map(t=>parseFloat(t.trim())).filter(t=>!isNaN(t)&&t>0),u=_.map(t=>{if(isNaN(t)||!isFinite(t))return null;let a=p.length+1;for(let l=p.length-1;l>=0;l--)if(t>=p[l]){a=p.length-1-l+1;break}return a}),m=new Array,f={};u.forEach((t,a)=>{t!==null&&(f[t]||(f[t]={phit:[],perm:[]}),f[t].phit.push(r[a]),f[t].perm.push(o[a]))});const x=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];Object.keys(f).sort((t,a)=>parseInt(t)-parseInt(a)).forEach(t=>{const a=f[parseInt(t)];m.push({x:a.phit,y:a.perm,mode:"markers",type:"scatter",name:`Rock Type ${t}`,marker:{color:x[(parseInt(t)-1)%x.length],size:4,symbol:"circle"}})});const b=new Array;for(let t=0;t<=50;t++)b.push(t*.01);p.forEach((t,a)=>{const l=b.map(N=>N<=0||N>=1?null:N*Math.pow(N*t/(.0314*(1-N)),2));m.push({x:b,y:l,mode:"lines",type:"scatter",name:`FZI=${t.toFixed(1)}`,line:{dash:"dash",color:"red"}});const k=p.length-a,C=Math.floor(b.length*.7);m.push({x:[b[C]],y:[l[C]],mode:"text",type:"scatter",name:`PRT ${k}`,text:[`PRT ${k}`],textposition:"middle right",showlegend:!1,textfont:{size:10,color:"red"}})});const i={title:"Pore-Perm Crossplot",xaxis:{title:"Porosity (fraction)",range:[-.05,.5],autorange:!1},yaxis:{title:"Permeability (mD)",type:"log",autorange:!0},showlegend:!0,margin:{l:60,r:60,t:60,b:60}};H().then(t=>{t.newPlot(e(D),m,i,{responsive:!0})})}async function gt(){if(!(!e(n)||!v())){d(T,!0),d(g,null);try{const s=e(n).phit,r=e(n).perm,o=e(n).well_names,c=e(n).depths,h=s.map((i,t)=>.0314*Math.sqrt(r[t]/i)),_=s.map(i=>i/(1-i)),p=h.map((i,t)=>i/_[t]),u=e(Z).split(",").map(i=>parseFloat(i.trim())).filter(i=>!isNaN(i)&&i>0),m=p.map((i,t)=>{let a=null;if(!isNaN(i)&&isFinite(i)){a=u.length+1;for(let l=u.length-1;l>=0;l--)if(i>=u[l]){a=u.length-1-l+1;break}}return{well_name:o[t],depth:c[t],rock_flag:a}}),f=`${Q}/quick_pp/database/projects/${v()}/save_rock_flags`,x=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rock_flag_pairs:m,cutoffs:e(Z)})});if(!x.ok)throw new Error(await x.text());const b=await x.json();d(g,`Success: ${b.message}`)}catch(s){d(g,`Error: ${s.message}`)}finally{d(T,!1)}}}et(()=>(Ft(v()),e(A)),()=>{v()&&v()!==e(A)&&(d(A,v()),mt())}),et(()=>(e(n),e(Z),e(E)),()=>{e(n)&&e(Z)&&e(E)&&(ht(),vt())}),It(),ct();var O=At(),J=j(P(O),2);qt(J,{});var X=j(J,2),V=P(X),Y=j(P(V),2),W=P(Y);jt(W);var _t=j(W,2);{let s=dt(()=>e(T)||!e(n));Et(_t,{onclick:gt,get disabled(){return e(s)},children:(r,o)=>{var c=st(),h=at(c);{var _=u=>{var m=Mt();w(u,m)},p=u=>{var m=Dt();w(u,m)};S(h,u=>{e(T)?u(_):u(p,!1)})}w(r,c)},$$slots:{default:!0}})}F(Y),F(V);var K=j(V,2);{var bt=s=>{var r=Ct(),o=P(r,!0);F(r),ot(c=>{$t(r,1,`text-sm ${c??""}`),lt(o,e(g))},[()=>(e(g),Nt(()=>e(g).startsWith("Error")?"text-red-600":"text-green-600"))]),w(s,r)};S(K,s=>{e(g)&&s(bt)})}var U=j(K,6);{var yt=s=>{var r=St();w(s,r)},xt=s=>{var r=st(),o=at(r);{var c=h=>{var _=Lt(),p=P(_,!0);F(_),ot(()=>lt(p,e(I))),w(h,_)};S(o,h=>{e(I)&&h(c)},!0)}w(s,r)};S(U,s=>{e(R)?s(yt):s(xt,!1)})}var B=j(U,2),kt=P(B);rt(kt,s=>d(M,s),()=>e(M)),F(B);var tt=j(B,6),wt=P(tt);rt(wt,s=>d(D,s),()=>e(D)),F(tt),F(X),F(O),Zt(W,()=>e(Z),s=>d(Z,s)),w(L,O),pt()}var Vt=$('<div slot="left"><!></div>');function Xt(L,q){it(q,!1);let v=y(null);const T=ut.subscribe(g=>{d(v,g?.project??null)});nt(()=>T()),ct(),zt(L,{get project(){return e(v)},$$slots:{left:(g,R)=>{var I=Vt(),n=P(I);{let E=dt(()=>e(v)?.project_id??null);Ot(n,{get projectId(){return e(E)}})}F(I),w(g,I)}}}),pt()}export{Xt as component};
