import{p as Dt,C as Et,e as r,v as qt,l as bt,g as t,G as m,b as he,i as Ot,f as M,k as p,w as J,t as b,c as It,m as g,n as h,r as _,I as X,J as _e,P as lt,z as we,Z as xt,F as A,D as St,h as Tt,H as c,Q as ge,O as ye,X as ct,M as tt}from"../chunks/BA6D4iam.js";import{_ as Ne}from"../chunks/PPVm8Dsz.js";import{B as Ft}from"../chunks/DwWu_tO9.js";import{w as Ht,f as be,e as xe}from"../chunks/NApQS6X6.js";import{D as Se}from"../chunks/C4A3Hpap.js";import{P as Te}from"../chunks/CerN-z7d.js";const Pe=()=>({title:"Water Saturation",subtitle:"Saturation estimations for the selected well"}),Ue=Object.freeze(Object.defineProperty({__proto__:null,load:Pe},Symbol.toStringTag,{value:"Module"}));var We=M('<div class="text-xs text-green-600 ml-3"> </div>'),Ae=M('<div class="text-sm text-red-500 mb-2"> </div>'),$e=M('<div class="text-sm"> </div>'),Re=M('<div class="text-sm text-gray-500">No temp gradient computed</div>'),Me=M('<div class="text-sm"> </div>'),ke=M('<div class="text-sm text-gray-500">No Rw computed</div>'),je=M("<div><strong>Archie SWT:</strong> </div>"),Ce=M("<div><strong>Archie SWT:</strong> No data</div>"),Ee=M("<div><strong>Waxman-Smits SWT:</strong> </div>"),Fe=M("<div><strong>Waxman-Smits SWT:</strong> No data</div>"),De=M('<div class="bg-panel rounded p-3"><div class="grid grid-cols-2 gap-2 mb-3"><div><label class="text-sm" for="meas-system">Measurement system</label> <select id="meas-system" class="input"><option>Metric</option><option>Imperial</option></select></div> <div><label class="text-sm" for="water-salinity">Water salinity</label> <input id="water-salinity" type="number" class="input"/></div> <div><label class="text-sm" for="rho-clay">Clay density (rho_clay)</label> <input id="rho-clay" type="number" class="input"/></div> <div><label class="text-sm" for="cec-clay">Clay CEC (cec_clay)</label> <input id="cec-clay" type="number" class="input"/></div> <div><label class="text-sm" for="m-param">Archie/Waxman m parameter</label> <input id="m-param" type="number" class="input"/></div></div> <div class="mb-3 flex gap-2 items-center"><!> <!> <!></div> <!> <div class="space-y-3"><div><div class="font-medium text-sm mb-1">Temp Gradient</div> <!></div> <div><div class="font-medium text-sm mb-1">Estimated Rw</div> <!></div> <div><div class="font-medium text-sm mb-1">Saturation Plot (Archie vs Waxman-Smits)</div> <div class="bg-surface rounded p-2"><div class="h-[220px] w-full overflow-hidden"><div class="w-full h-[220px]"></div></div></div> <div class="text-xs text-muted-foreground-foreground space-y-1 mt-3"><!> <!></div></div></div></div>'),qe=M('<div class="text-sm">Select a well to view water saturation tools.</div>'),Oe=M('<div class="ws-saturation"><div class="mb-2"><div class="font-semibold">Water Saturation</div> <div class="text-sm text-muted-foreground">Water saturation calculations and displays.</div></div> <!> <!></div>');function Ie(dt,et){Dt(et,!1);let D=Et(et,"projectId",8),C=Et(et,"wellName",8);const I="http://localhost:6312";let H=g({enabled:!1,minDepth:null,maxDepth:null}),nt=g({enabled:!1,zones:[]}),z=g([]),Y=g("metric"),at=g(35e3),rt=g(2.58),ut=g(.9),mt=g(2),$=g(!1),w=g(null),vt=g([]),q=g([]),R=g([]),U=g([]),Q=g([]),V=g([]),G=g([]),pt=null,L=g(null),st=g(!1),it=g(null);async function Vt(){if(!(!D()||!C())){r($,!0),r(w,null);try{const s=await fetch(`${I}/quick_pp/database/projects/${D()}/wells/${encodeURIComponent(String(C()))}/merged`);if(!s.ok)throw new Error(await s.text());const o=await s.json(),l=o&&o.data?o.data:o;if(!Array.isArray(l))throw new Error("Unexpected data format from backend");r(vt,l)}catch(s){console.warn("Failed to load well data",s),r(w,String(s?.message??s))}finally{r($,!1)}}}function Jt(){const s=t(z),o=[];for(const l of s){const x=l.tvdss??l.TVDSS??l.tvd??l.TVD??l.depth??l.DEPTH??NaN,a=Number(x);isNaN(a)||o.push({tvdss:a})}return o}async function zt(){const s=Jt();if(!s.length){r(w,"No TVD/DEPTH values found in well data");return}r($,!0),r(w,null),r(q,[]),r(R,[]);try{const o={meas_system:t(Y),data:s},l=await fetch(`${I}/quick_pp/saturation/temp_grad`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!l.ok)throw new Error(await l.text());const x=await l.json(),a=Array.isArray(x)?x.map(y=>Number(y.TEMP_GRAD??y.temp_grad??y.value??NaN)):[];r(q,a);const u={water_salinity:Number(t(at)),data:a.map(y=>({temp_grad:y}))},N=await fetch(`${I}/quick_pp/saturation/rw`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!N.ok)throw new Error(await N.text());const f=await N.json();r(R,Array.isArray(f)?f.map(y=>Number(y.RW??y.rw??NaN)):[])}catch(o){console.warn("TempGrad/Rw error",o),r(w,String(o?.message??o))}finally{r($,!1)}}async function Gt(){r(q,[]),r(R,[]),r(U,[]),r(Q,[]),r(w,null),r($,!0);try{if(await zt(),t(w)||(await Lt(),t(w)))return;await Bt()}catch(s){console.warn("Estimate Water Saturation error",s),r(w,String(s?.message??s))}finally{r($,!1)}}async function Lt(){if(!t(R)||t(R).length===0){r(w,"Please compute Rw first");return}const s=t(z),o=[],l=[];let x=0;for(const a of s){const u=Number(a.depth??a.DEPTH??NaN),N=Number(a.rt??a.RT??a.Rt??a.res??a.RES??NaN),f=Number(a.phit??a.PHIT??a.Phit??NaN);if(isNaN(N)||isNaN(f))continue;const y=t(R)[x++]??NaN;isNaN(y)||(o.push({rt:N,rw:y,phit:f}),l.push(u))}if(!o.length){r(w,"No RT/PHIT rows available for Archie");return}r($,!0),r(w,null),r(U,[]);try{const a={data:o},u=await fetch(`${I}/quick_pp/saturation/archie`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!u.ok)throw new Error(await u.text());const N=await u.json();r(U,Array.isArray(N)?N.map(f=>Number(f.SWT??f.swt??NaN)):[]),r(V,t(U).map((f,y)=>({depth:l[y],SWT:f})).filter(f=>!isNaN(Number(f.depth))))}catch(a){console.warn("Archie error",a),r(w,String(a?.message??a))}finally{r($,!1)}}async function Bt(){if(!t(R)||t(R).length===0||!t(q)||t(q).length===0){r(w,"Please compute Temp Grad and Rw first");return}const s=[],o=[],l=[],x=t(z);for(const n of x){const d=Number(n.vcld??n.VCLD??n.vclay??n.VCLAY??NaN),v=Number(n.phit??n.PHIT??n.Phit??NaN);!isNaN(d)&&!isNaN(v)&&s.push({vcld:d,phit:v})}for(let n=0;n<t(q).length;n++){const d=t(q)[n],v=t(R)[n];!isNaN(Number(d))&&!isNaN(Number(v))&&o.push({temp_grad:d,rw:v})}let a=[];if(s.length)try{const n={rho_clay:Number(t(rt)),cec_clay:Number(t(ut)),data:s},d=await fetch(`${I}/quick_pp/saturation/estimate_qv`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!d.ok)throw new Error(await d.text());const v=await d.json();a=Array.isArray(v)?v.map(S=>Number(S.QV??S.qv??NaN)):[]}catch(n){console.warn("Qv error",n)}let u=[];if(o.length)try{const n={data:o},d=await fetch(`${I}/quick_pp/saturation/b_waxman_smits`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!d.ok)throw new Error(await d.text());const v=await d.json();u=Array.isArray(v)?v.map(S=>Number(S.B??S.b??NaN)):[]}catch(n){console.warn("B estimation error",n)}let N=0,f=0,y=0;const B=[];for(const n of x){const d=Number(n.depth??n.DEPTH??NaN),v=Number(n.rt??n.RT??n.res??n.RES??NaN),S=Number(n.phit??n.PHIT??n.Phit??NaN);if(isNaN(v)||isNaN(S))continue;const Z=t(R)[y++]??NaN,K=a[N++]??NaN,ot=u[f++]??NaN;isNaN(Z)||isNaN(K)||isNaN(ot)||(l.push({rt:v,rw:Z,phit:S,qv:K,b:ot,m:Number(t(mt))}),B.push(d))}if(!l.length){r(w,"Insufficient data to run Waxman-Smits (need rt, phit, rw, qv, b)");return}r($,!0),r(w,null),r(Q,[]);try{const n={data:l},d=await fetch(`${I}/quick_pp/saturation/waxman_smits`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!d.ok)throw new Error(await d.text());const v=await d.json();r(Q,Array.isArray(v)?v.map(S=>Number(S.SWT??S.swt??NaN)):[]),r(G,t(Q).map((S,Z)=>({depth:B[Z],SWT:S})).filter(S=>!isNaN(Number(S.depth))))}catch(n){console.warn("Waxman-Smits error",n),r(w,String(n?.message??n))}finally{r($,!1)}}async function Ut(){if(!pt){const s=await Ne(()=>import("../chunks/BJMC0GYJ.js").then(o=>o.p),[],import.meta.url);pt=s?.default??s}return pt}async function Qt(){if(!t(L))return;const s=await Ut(),o=[];if(t(V)&&t(V).length>0&&(o.push({x:t(V).map(a=>Number(a.depth)),y:t(V).map(a=>a.SWT),name:"Archie SWT",mode:"lines",line:{color:"#2563eb"}}),o.push({x:[Math.min(...t(V).map(a=>Number(a.depth))),Math.max(...t(V).map(a=>Number(a.depth)))],y:[1,1],mode:"lines",line:{color:"black",width:1,dash:"dash"},showlegend:!1})),t(G)&&t(G).length>0&&o.push({x:t(G).map(a=>Number(a.depth)),y:t(G).map(a=>a.SWT),name:"Waxman-Smits SWT",mode:"lines",line:{color:"#dc2626"}}),o.length===0){try{s.purge(t(L))}catch{}return}const x={height:220,margin:{l:60,r:20,t:20,b:40},dragmode:"zoom",xaxis:{title:"Depth"},yaxis:{title:"SWT (fraction)",range:[0,1.5],tickformat:".2f",fixedrange:!0},showlegend:!0,legend:{...{x:1,y:1,xanchor:"right",yanchor:"top"},bgcolor:"rgba(255,255,255,0.75)",borderwidth:1}};try{s.react(t(L),o,x,{responsive:!0})}catch{s.newPlot(t(L),o,x,{responsive:!0})}}async function Zt(){if(!D()||!C()){r(w,"Project and well must be selected before saving");return}const s=new Map;for(const a of t(V)){const u=Number(a.depth);isNaN(u)||s.set(u,Number(a.SWT))}const o=new Map;for(const a of t(G)){const u=Number(a.depth);isNaN(u)||o.set(u,Number(a.SWT))}const l=Array.from(new Set([...s.keys(),...o.keys()])).sort((a,u)=>a-u);if(!l.length){r(w,"No saturation results to save");return}const x=l.map(a=>{const u={DEPTH:a};return s.has(a)&&(u.SWT_ARCHIE=s.get(a)),o.has(a)&&(u.SWT=o.get(a)),u});r(st,!0),r(it,null),r(w,null);try{const a={data:x},u=`${I}/quick_pp/database/projects/${D()}/wells/${encodeURIComponent(String(C()))}/data`,N=await fetch(u,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!N.ok)throw new Error(await N.text());const f=await N.json().catch(()=>null);r(it,f&&f.message?String(f.message):"Saturation results saved");try{window.dispatchEvent(new CustomEvent("qpp:data-updated",{detail:{projectId:D(),wellName:C(),kind:"saturation"}}))}catch{}}catch(a){console.warn("Save saturation error",a),r(it,null),r(w,String(a?.message??a))}finally{r(st,!1)}}function Pt(s){const o=s.filter(d=>!isNaN(d)),l=o.length;if(l===0)return null;const a=o.reduce((d,v)=>d+v,0)/l,u=Math.min(...o),N=Math.max(...o),f=o.slice().sort((d,v)=>d-v),y=(f[Math.floor((l-1)/2)]+f[Math.ceil((l-1)/2)])/2,B=o.reduce((d,v)=>d+Math.pow(v-a,2),0)/l,n=Math.sqrt(B);return{count:l,mean:a,min:u,max:N,median:y,std:n}}const Xt=Ht.subscribe(s=>{s?.depthFilter&&r(H,{...s.depthFilter}),s?.zoneFilter&&r(nt,{...s.zoneFilter})});qt(()=>{Xt()}),bt(()=>(t(L),t(V),t(G),t(H)),()=>{t(L)&&(t(V)?.length>0||t(G)?.length>0||t(H))&&Qt()}),bt(()=>(t(vt),t(H),t(nt)),()=>{r(z,(()=>{let s=t(vt)||[];return s=be(s,t(H)),s=xe(s,t(nt)),s})())}),bt(()=>(m(D()),m(C())),()=>{D()&&C()&&Vt()}),he(),Ot();var ft=Oe(),Wt=p(h(ft),2);Se(Wt,{});var Yt=p(Wt,2);{var Kt=s=>{var o=De(),l=h(o),x=h(l),a=p(h(x),2);X(()=>{t(Y),_e(()=>{})});var u=h(a);u.value=u.__value="metric";var N=p(u);N.value=N.__value="imperial",_(a),_(x);var f=p(x,2),y=p(h(f),2);lt(y),_(f);var B=p(f,2),n=p(h(B),2);lt(n),_(B);var d=p(B,2),v=p(h(d),2);lt(v),_(d);var S=p(d,2),Z=p(h(S),2);lt(Z),_(S),_(l);var K=p(l,2),ot=h(K);{let i=A(()=>t($)?"opacity:0.5; pointer-events:none;":"");Ft(ot,{class:"btn btn-primary",onclick:Gt,get disabled(){return t($)},get style(){return t(i)},children:(e,T)=>{we();var E=xt("Estimate Water Saturation");b(e,E)},$$slots:{default:!0}})}var At=p(ot,2);{let i=A(()=>t($)||t(st)),e=A(()=>t($)||t(st)?"opacity:0.5; pointer-events:none;":"");Ft(At,{class:"btn ml-2 bg-emerald-700",onclick:Zt,get disabled(){return t(i)},get style(){return t(e)},children:(T,E)=>{var F=St(),W=Tt(F);{var k=P=>{var O=xt("Saving...");b(P,O)},j=P=>{var O=xt("Save Saturation");b(P,O)};J(W,P=>{t(st)?P(k):P(j,!1)})}b(T,F)},$$slots:{default:!0}})}var ee=p(At,2);{var ae=i=>{var e=We(),T=h(e,!0);_(e),X(()=>tt(T,t(it))),b(i,e)};J(ee,i=>{t(it)&&i(ae)})}_(K);var $t=p(K,2);{var re=i=>{var e=Ae(),T=h(e);_(e),X(()=>tt(T,`Error: ${t(w)??""}`)),b(i,e)};J($t,i=>{t(w)&&i(re)})}var Rt=p($t,2),ht=h(Rt),se=p(h(ht),2);{var ie=i=>{const e=A(()=>(t(q),c(()=>Pt(t(q)))));var T=St(),E=Tt(T);{var F=W=>{var k=$e(),j=h(k);_(k),X((P,O,gt,yt,Nt)=>tt(j,`Avg: ${P??""} | Min: ${O??""} | Max: ${gt??""} | Median: ${yt??""} | Std: ${Nt??""} | Count: ${m(t(e)),c(()=>t(e).count)??""}`),[()=>(m(t(e)),c(()=>t(e).mean.toFixed(2))),()=>(m(t(e)),c(()=>t(e).min.toFixed(2))),()=>(m(t(e)),c(()=>t(e).max.toFixed(2))),()=>(m(t(e)),c(()=>t(e).median.toFixed(2))),()=>(m(t(e)),c(()=>t(e).std.toFixed(2)))]),b(W,k)};J(E,W=>{t(e)&&W(F)})}b(i,T)},oe=i=>{var e=Re();b(i,e)};J(se,i=>{t(q),c(()=>t(q).length)?i(ie):i(oe,!1)})}_(ht);var _t=p(ht,2),ne=p(h(_t),2);{var le=i=>{const e=A(()=>(t(R),c(()=>Pt(t(R)))));var T=St(),E=Tt(T);{var F=W=>{var k=Me(),j=h(k);_(k),X((P,O,gt,yt,Nt)=>tt(j,`Avg: ${P??""} | Min: ${O??""} | Max: ${gt??""} | Median: ${yt??""} | Std: ${Nt??""} | Count: ${m(t(e)),c(()=>t(e).count)??""}`),[()=>(m(t(e)),c(()=>t(e).mean.toFixed(3))),()=>(m(t(e)),c(()=>t(e).min.toFixed(3))),()=>(m(t(e)),c(()=>t(e).max.toFixed(3))),()=>(m(t(e)),c(()=>t(e).median.toFixed(3))),()=>(m(t(e)),c(()=>t(e).std.toFixed(3)))]),b(W,k)};J(E,W=>{t(e)&&W(F)})}b(i,T)},ce=i=>{var e=ke();b(i,e)};J(ne,i=>{t(R),c(()=>t(R).length)?i(le):i(ce,!1)})}_(_t);var Mt=p(_t,2),wt=p(h(Mt),2),kt=h(wt),de=h(kt);ge(de,i=>r(L,i),()=>t(L)),_(kt),_(wt);var jt=p(wt,2),Ct=h(jt);{var ue=i=>{const e=A(()=>t(U)),T=A(()=>(m(t(e)),c(()=>t(e).reduce((j,P)=>j+P,0)/t(e).length))),E=A(()=>(m(t(e)),c(()=>Math.min(...t(e))))),F=A(()=>(m(t(e)),c(()=>Math.max(...t(e)))));var W=je(),k=p(h(W));_(W),X((j,P,O)=>tt(k,` Avg: ${j??""} | Min: ${P??""} | Max: ${O??""} | Count: ${m(t(e)),c(()=>t(e).length)??""}`),[()=>(m(t(T)),c(()=>t(T).toFixed(2))),()=>(m(t(E)),c(()=>t(E).toFixed(2))),()=>(m(t(F)),c(()=>t(F).toFixed(2)))]),b(i,W)},me=i=>{var e=Ce();b(i,e)};J(Ct,i=>{t(U),c(()=>t(U).length>0)?i(ue):i(me,!1)})}var ve=p(Ct,2);{var pe=i=>{const e=A(()=>t(Q)),T=A(()=>(m(t(e)),c(()=>t(e).reduce((j,P)=>j+P,0)/t(e).length))),E=A(()=>(m(t(e)),c(()=>Math.min(...t(e))))),F=A(()=>(m(t(e)),c(()=>Math.max(...t(e)))));var W=Ee(),k=p(h(W));_(W),X((j,P,O)=>tt(k,` Avg: ${j??""} | Min: ${P??""} | Max: ${O??""} | Count: ${m(t(e)),c(()=>t(e).length)??""}`),[()=>(m(t(T)),c(()=>t(T).toFixed(2))),()=>(m(t(E)),c(()=>t(E).toFixed(2))),()=>(m(t(F)),c(()=>t(F).toFixed(2)))]),b(i,W)},fe=i=>{var e=Fe();b(i,e)};J(ve,i=>{t(Q),c(()=>t(Q).length>0)?i(pe):i(fe,!1)})}_(jt),_(Mt),_(Rt),_(o),ye(a,()=>t(Y),i=>r(Y,i)),ct(y,()=>t(at),i=>r(at,i)),ct(n,()=>t(rt),i=>r(rt,i)),ct(v,()=>t(ut),i=>r(ut,i)),ct(Z,()=>t(mt),i=>r(mt,i)),b(s,o)},te=s=>{var o=qe();b(s,o)};J(Yt,s=>{C()?s(Kt):s(te,!1)})}_(ft),b(dt,ft),It()}var He=M('<div slot="left"><!></div>');function Qe(dt,et){Dt(et,!1);let D=g(null),C=g(null);const I=Ht.subscribe(H=>{r(D,H?.project??null),r(C,H?.selectedWell??null)});qt(()=>I()),Ot(),Te(dt,{get selectedWell(){return t(C)},get project(){return t(D)},$$slots:{left:(H,nt)=>{var z=He(),Y=h(z);{let at=A(()=>t(D)?.project_id??""),rt=A(()=>t(C)?.name??"");Ie(Y,{get projectId(){return t(at)},get wellName(){return t(rt)}})}_(z),b(H,z)}}}),It()}export{Qe as component,Ue as universal};
