import{a4 as d,a5 as c,a6 as j}from"./BA6D4iam.js";const y="http://localhost:6312",o=d([]);async function _(){try{const t=await fetch(`${y}/quick_pp/database/projects`);if(!t.ok){o.set([]);return}const e=await t.json();o.set(Array.isArray(e)?e:[])}catch(t){console.error("loadProjects error",t),o.set([])}}function b(t){o.update(e=>{const n=e.findIndex(i=>String(i.project_id)===String(t.project_id));if(n===-1)return[t,...e];const r=[...e];return r[n]={...r[n],...t},r})}const a=d({title:"QPP - Petrophysical Analysis",subtitle:void 0,project:null,depthFilter:{enabled:!1,minDepth:null,maxDepth:null},zoneFilter:{enabled:!1,zones:[]}}),D=c(a,t=>t.depthFilter),P=c(a,t=>t.zoneFilter);c(a,t=>t.project);c(a,t=>({title:t.title,subtitle:t.subtitle}));function N(t,e){a.update(n=>({...n,title:t,subtitle:e}))}function A(t,e){a.update(n=>{const r=n.subtitle??"",i=e??"";return n.title===t&&r===i?n:{...n,title:t,subtitle:e}})}function p(t){a.update(e=>{const n=e.project&&e.project.project_id!=null?String(e.project.project_id):null,r=t&&t.project_id!=null?String(t.project_id):null,i=e.project&&e.project.name?e.project.name:null;let l=null;if(t&&t.name)l=t.name;else if(t&&t.project_id)try{const f=(j(o)||[]).find(h=>String(h.project_id)===String(t.project_id));f&&f.name&&(l=f.name)}catch{}const s=l;if(n===r&&i===s)return e;const u=t?{...t,...s?{name:s}:{}}:null;return{...e,project:u,title:u?u.name??"QPP - Petrophysical Analysis":"QPP - Petrophysical Analysis"}})}async function F(t){if(!t||!t.project_id){p(null);return}p(t);const e="http://localhost:6312";try{const n=await fetch(`${e}/quick_pp/database/projects/${t.project_id}/wells`);if(n.ok){const i=(await n.json()).wells||[];a.update(l=>l.project&&String(l.project.project_id)===String(t.project_id)?{...l,project:{...l.project,wells:i}}:l)}}catch(n){console.error("Failed to load wells for project",t.project_id,n)}}function x(t){a.update(e=>({...e,selectedWell:t}))}function z(t,e,n){a.update(r=>{const i={enabled:t,minDepth:e??null,maxDepth:n??null};return JSON.stringify(r.depthFilter)===JSON.stringify(i)?r:{...r,depthFilter:i}})}function k(){a.update(t=>({...t,depthFilter:{enabled:!1,minDepth:null,maxDepth:null}}))}function O(t,e){a.update(n=>{const r={enabled:t,zones:e&&Array.isArray(e)?e.map(i=>String(i)):[]};return JSON.stringify(n.zoneFilter)===JSON.stringify(r)?n:{...n,zoneFilter:r}})}function I(){a.update(t=>({...t,zoneFilter:{enabled:!1,zones:[]}}))}function T(t,e){return!e?.enabled||!e.minDepth&&!e.maxDepth?t:t.filter(n=>{const r=Number(n.depth??n.DEPTH??n.Depth??NaN);return!(isNaN(r)||e.minDepth!==null&&r<e.minDepth||e.maxDepth!==null&&r>e.maxDepth)})}function S(t){if(!t||typeof t!="object")return null;const e=["name","zone","Zone","ZONE","formation","formation_name","formationName","FORMATION","formation_top","formationTop"];for(const n of e)if(n in t&&t[n]!==null&&t[n]!==void 0&&String(t[n]).trim()!=="")return String(t[n]);for(const n of Object.keys(t))if(/zone|formation/i.test(n)&&t[n]!==null&&t[n]!==void 0&&String(t[n]).trim()!=="")return String(t[n]);return null}function Z(t,e){if(!e?.enabled||!e.zones||e.zones.length===0)return t;const n=new Set(e.zones.map(r=>String(r)));return t.filter(r=>{const i=S(r);return i===null?!1:n.has(i)})}export{N as a,x as b,A as c,D as d,Z as e,T as f,z as g,k as h,O as i,I as j,_ as l,o as p,F as s,b as u,a as w,P as z};
