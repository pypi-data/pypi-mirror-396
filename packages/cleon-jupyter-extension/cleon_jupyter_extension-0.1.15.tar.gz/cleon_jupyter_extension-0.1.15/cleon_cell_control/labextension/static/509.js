"use strict";(self.webpackChunkcleon_cell_control=self.webpackChunkcleon_cell_control||[]).push([[509],{509:(e,o,n)=>{n.r(o),n.d(o,{default:()=>l});var t=n(766);const c=new WeakMap,l={id:"cleon-cell-control:plugin",description:"JupyterLab extension for cell manipulation from kernel",autoStart:!0,requires:[t.INotebookTracker],activate:(e,o)=>{console.log("cleon-cell-control: activated"),window.cleonInsertAndRun=e=>{const n=o.currentWidget;if(!n)return void console.error("cleon-cell-control: No active notebook");const l=n.content.model;if(!l)return void console.error("cleon-cell-control: No notebook model");const s=l.sharedModel,r=c.get(n),a=n.content.activeCellIndex+1,d="number"==typeof r?r+1:a,i=Math.min(d,l.cells.length);s.insertCell(i,{cell_type:"code",source:e}),n.content.activeCellIndex=i,c.set(n,i),setTimeout(async()=>{try{await t.NotebookActions.run(n.content,n.sessionContext),console.log("cleon-cell-control: cell executed via button")}catch(e){console.error("cleon-cell-control: execution error",e)}},150)},console.log("cleon-cell-control: window.cleonInsertAndRun registered");const n=e=>{e.registerCommTarget("cleon_cell_control",(e,n)=>{console.log("cleon-cell-control: comm opened"),e.onMsg=n=>{const c=n.content.data;console.log("cleon-cell-control: received",c);const l=o.currentWidget;if(!l)return void e.send({status:"error",message:"No active notebook"});const s=l.content.model;if(!s)return void e.send({status:"error",message:"No notebook model"});const r=l.content.activeCell,a=l.content.activeCellIndex;try{switch(c.action){case"insert_below":{const o=c.cell_type||"code",n=s.sharedModel.insertCell(a+1,{cell_type:o,source:c.code||""});l.content.activeCellIndex=a+1,e.send({status:"ok",action:"insert_below",cell_id:n.id});break}case"insert_above":{const o=c.cell_type||"code",n=s.sharedModel.insertCell(a,{cell_type:o,source:c.code||""});e.send({status:"ok",action:"insert_above",cell_id:n.id});break}case"replace":r&&r.model.sharedModel?(r.model.sharedModel.source=c.code||"",e.send({status:"ok",action:"replace"})):e.send({status:"error",message:"No active cell"});break;case"execute":l.sessionContext.session?.kernel?(l.content.widgets[a]?.ready.then(()=>{l.sessionContext.session?.kernel?.requestExecute({code:r?.model.sharedModel.source||""})}),e.send({status:"ok",action:"execute"})):e.send({status:"error",message:"No kernel"});break;case"insert_and_run":{const o=c.cell_type||"code",n=s.sharedModel,r=a+1;n.insertCell(r,{cell_type:o,source:c.code||""}),l.content.activeCellIndex=r,setTimeout(async()=>{try{await t.NotebookActions.run(l.content,l.sessionContext),console.log("cleon-cell-control: cell executed")}catch(e){console.error("cleon-cell-control: execution error",e)}},150),e.send({status:"ok",action:"insert_and_run"});break}default:e.send({status:"error",message:`Unknown action: ${c.action}`})}}catch(o){console.error("cleon-cell-control: error",o),e.send({status:"error",message:String(o)})}},e.onClose=()=>{console.log("cleon-cell-control: comm closed")}})};o.forEach(e=>{const o=e.sessionContext.session;o?.kernel&&n(o.kernel)}),o.widgetAdded.connect((e,o)=>{o.sessionContext.kernelChanged.connect((e,o)=>{o.newValue&&n(o.newValue)});const t=o.sessionContext.session?.kernel;t&&n(t)})}}}}]);