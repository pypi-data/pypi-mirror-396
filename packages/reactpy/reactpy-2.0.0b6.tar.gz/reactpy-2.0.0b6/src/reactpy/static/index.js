import{a as R,c as V,e as N,i as O}from"./index-h31022cd.js";import{P as H}from"./index-sbddj6ms.js";import{$ as U,T as W0,U as j,W as P,Y as I,ca as i}from"./index-y71bxs88.js";var b=j((R0,y)=>{var r=Object.prototype.hasOwnProperty,t=Object.prototype.toString;y.exports=function(K,Q,X){if(t.call(Q)!=="[object Function]")throw TypeError("iterator must be a function");var Y=K.length;if(Y===+Y)for(var Z=0;Z<Y;Z++)Q.call(X,K[Z],Z,K);else for(var W in K)if(r.call(K,W))Q.call(X,K[W],W,K)}});var x=j((M0,v)=>{var o=b();v.exports=z;function z(G,K,Q){if(arguments.length===3)return z.set(G,K,Q);if(arguments.length===2)return z.get(G,K);var X=z.bind(z,G);for(var Y in z)if(z.hasOwnProperty(Y))X[Y]=z[Y].bind(X,G);return X}z.get=function(K,Q){var X=Array.isArray(Q)?Q:z.parse(Q);for(var Y=0;Y<X.length;++Y){var Z=X[Y];if(!(typeof K=="object"&&(Z in K)))throw Error("Invalid reference token: "+Z);K=K[Z]}return K};z.set=function(K,Q,X){var Y=Array.isArray(Q)?Q:z.parse(Q),Z=Y[0];if(Y.length===0)throw Error("Can not set the root object");for(var W=0;W<Y.length-1;++W){var $=Y[W];if(typeof $!=="string"&&typeof $!=="number")$=String($);if($==="__proto__"||$==="constructor"||$==="prototype")continue;if($==="-"&&Array.isArray(K))$=K.length;if(Z=Y[W+1],!($ in K))if(Z.match(/^(\d+|-)$/))K[$]=[];else K[$]={};K=K[$]}if(Z==="-"&&Array.isArray(K))Z=K.length;return K[Z]=X,this};z.remove=function(G,K){var Q=Array.isArray(K)?K:z.parse(K),X=Q[Q.length-1];if(X===void 0)throw Error('Invalid JSON pointer for remove: "'+K+'"');var Y=z.get(G,Q.slice(0,-1));if(Array.isArray(Y)){var Z=+X;if(X===""&&isNaN(Z))throw Error('Invalid array index: "'+X+'"');Array.prototype.splice.call(Y,Z,1)}else delete Y[X]};z.dict=function(K,Q){var X={};return z.walk(K,function(Y,Z){X[Z]=Y},Q),X};z.walk=function(K,Q,X){var Y=[];X=X||function(Z){var W=Object.prototype.toString.call(Z);return W==="[object Object]"||W==="[object Array]"},function Z(W){o(W,function($,q){if(Y.push(String(q)),X($))Z($);else Q($,z.compile(Y));Y.pop()})}(K)};z.has=function(K,Q){try{z.get(K,Q)}catch(X){return!1}return!0};z.escape=function(K){return K.toString().replace(/~/g,"~0").replace(/\//g,"~1")};z.unescape=function(K){return K.replace(/~1/g,"/").replace(/~0/g,"~")};z.parse=function(K){if(K==="")return[];if(K.charAt(0)!=="/")throw Error("Invalid JSON pointer: "+K);return K.substring(1).split(/\//).map(z.unescape)};z.compile=function(K){if(K.length===0)return"";return"/"+K.map(z.escape).join("/")}});var J={log:(...G)=>console.log("[ReactPy]",...G),info:(...G)=>console.info("[ReactPy]",...G),warn:(...G)=>console.warn("[ReactPy]",...G),error:(...G)=>console.error("[ReactPy]",...G)};function h(G){let{interval:K,maxInterval:Q,maxRetries:X,backoffMultiplier:Y}=G,Z=0,W=K,$=!1,q=!1,B={},L=()=>{if(q)return;B.current=new WebSocket(G.url),B.current.onopen=()=>{if($=!0,J.info("Connected!"),W=K,Z=0,G.onOpen)G.onOpen()},B.current.onmessage=(n)=>{if(G.onMessage)G.onMessage(n)},B.current.onclose=()=>{if(G.onClose)G.onClose();if(!$){J.info("Failed to connect!");return}if(J.info("Disconnected!"),Z>=X){J.info("Connection max retries exhausted!");return}J.info(`Reconnecting in ${(W/1000).toPrecision(4)} seconds...`),setTimeout(L,W),W=p(W,Y,Q),Z++}};return G.readyPromise.then(()=>J.info("Starting client...")).then(L),B}function p(G,K,Q){return Math.min(G*K,Q)}class g{handlers={};ready;resolveReady;constructor(){this.resolveReady=()=>{},this.ready=new Promise((G)=>this.resolveReady=G)}onMessage(G,K){return(this.handlers[G]||(this.handlers[G]=[])).push(K),this.resolveReady(void 0),()=>{this.handlers[G]=this.handlers[G].filter((Q)=>Q!==K)}}handleIncoming(G){if(!G.type){J.warn("Received message without type",G);return}let K=this.handlers[G.type];if(!K){J.warn("Received message without handler",G);return}K.forEach((Q)=>Q(G))}}class D extends g{urls;socket;mountElement;constructor(G){super();this.urls=G.urls,this.mountElement=G.mountElement,this.socket=h({url:this.urls.componentUrl,readyPromise:this.ready,...G.reconnectOptions,onMessage:async({data:K})=>this.handleIncoming(JSON.parse(K))})}sendMessage(G){this.socket.current?.send(JSON.stringify(G))}loadModule(G){return import(`${this.urls.jsModulesPath}${G}`)}}var l=W0(x(),1);var w={__stop__:!0};function E(G,K=10){if(!G||typeof G!=="object")return console.warn("eventToObject: Expected an object input, received:",G),G;let Q=new WeakSet;Q.add(G);let X={};for(let Y in G)try{if(A(G[Y],Y))continue;else if(typeof G[Y]==="object"){let Z=F(G[Y],K,Q);if(Z!==w)X[Y]=Z}else X[Y]=G[Y]}catch{continue}if(typeof window<"u"&&window.Event&&G instanceof window.Event)X.selection=e(K,Q);return X}function e(G,K){if(typeof window>"u"||!window.getSelection)return null;let Q=window.getSelection();if(!Q)return null;return{type:Q.type,anchorNode:Q.anchorNode?F(Q.anchorNode,G,K):null,anchorOffset:Q.anchorOffset,focusNode:Q.focusNode?F(Q.focusNode,G,K):null,focusOffset:Q.focusOffset,isCollapsed:Q.isCollapsed,rangeCount:Q.rangeCount,selectedText:Q.toString()}}function F(G,K,Q){let X=K-1;if(X<=0&&typeof G==="object")return w;if(!G||typeof G!=="object")return G;if(Q.has(G))return w;Q.add(G);try{if(Array.isArray(G)||typeof G?.length==="number"&&typeof G[Symbol.iterator]==="function"&&!Object.prototype.toString.call(G).includes("Map")&&!(G instanceof CSSStyleDeclaration))return G0(G,X,Q);return K0(G,X,Q)}finally{Q.delete(G)}}function G0(G,K,Q){let X=[];for(let Y=0;Y<G.length;Y++)if(A(G[Y]))continue;else if(typeof G[Y]==="object"){let Z=F(G[Y],K,Q);if(Z!==w)X.push(Z)}else X.push(G[Y]);return X}function K0(G,K,Q){let X={};for(let $ in G)try{if(A(G[$],$,G))continue;else if(typeof G[$]==="object"){let q=F(G[$],K,Q);if(q!==w)X[$]=q}else X[$]=G[$]}catch{continue}if(G&&typeof G==="object"&&"dataset"in G&&!Object.prototype.hasOwnProperty.call(X,"dataset")){let $=G.dataset;if(!A($,"dataset",G)){let q=F($,K,Q);if(q!==w)X.dataset=q}}let Y=["value","checked","files","type","name"];for(let $ of Y)if(G&&typeof G==="object"&&$ in G&&!Object.prototype.hasOwnProperty.call(X,$)){let q=G[$];if(!A(q,$,G))if(typeof q==="object"){let B=$==="files"?Math.max(K,3):K,L=F(q,B,Q);if(L!==w)X[$]=L}else X[$]=q}let Z=typeof window<"u"?window:void 0,W=Z?Z.HTMLFormElement:typeof HTMLFormElement<"u"?HTMLFormElement:void 0;if(W&&G instanceof W&&G.elements)for(let $=0;$<G.elements.length;$++){let q=G.elements[$];if(q.name&&!Object.prototype.hasOwnProperty.call(X,q.name)&&!A(q,q.name,G))if(typeof q==="object"){let B=F(q,K,Q);if(B!==w)X[q.name]=B}else X[q.name]=q}return X}function A(G,K="",Q=void 0){return G===null||G===void 0||K.startsWith("__")||K.length>0&&/^[A-Z_]+$/.test(K)||typeof G==="function"||G instanceof CSSStyleSheet||G instanceof Window||G instanceof Document||K==="view"||K==="size"||K==="length"||Q instanceof CSSStyleDeclaration&&G===""||typeof Node<"u"&&Q instanceof Node&&(K==="parentNode"||K==="parentElement"||K==="ownerDocument"||K==="getRootNode"||K==="childNodes"||K==="children"||K==="firstChild"||K==="lastChild"||K==="previousSibling"||K==="nextSibling"||K==="previousElementSibling"||K==="nextElementSibling"||K==="innerHTML"||K==="outerHTML"||K==="offsetParent"||K==="offsetWidth"||K==="offsetHeight"||K==="offsetLeft"||K==="offsetTop"||K==="clientTop"||K==="clientLeft"||K==="clientWidth"||K==="clientHeight"||K==="scrollWidth"||K==="scrollHeight"||K==="scrollTop"||K==="scrollLeft")}async function f(G,K){let Q;if(G.sourceType==="URL")Q=await import(G.source);else Q=await K.loadModule(G.source);let{bind:X}=Q;if(typeof X!=="function")console.debug("Using generic ReactJS binding for components in module",Q),X=$0;return(Y)=>{let Z=X(Y,{sendMessage:K.sendMessage,onMessage:K.onMessage});if(!(typeof Z.create==="function"&&typeof Z.render==="function"&&typeof Z.unmount==="function"))return J.error(`${G.source} returned an impropper binding`),null;return{render:(W)=>Z.render(u({client:K,module:Q,binding:Z,model:W,currentImportSource:G})),unmount:Z.unmount}}}function u(G){let K;if(G.model.importSource){if(!d(G.currentImportSource,G.model.importSource))return G.binding.create("reactpy-child",{ref:(Q)=>{if(Q)Q.client=G.client,Q.model=G.model,Q.requestUpdate()}});else if(K=X0(G.module,G.model.tagName,G.model.importSource),!K)return null}else K=G.model.tagName;return G.binding.create(K,_(G.model,G.client),M(G.model,(Q)=>u({...G,model:Q})))}function X0(G,K,Q){let X=K.split("."),Y=null;for(let Z=0;Z<X.length;Z++){let W=X[Z];if(Y=Z==0?G[W]:Y[W],!Y){if(Z==0)J.error("Module from source "+k(Q)+` does not export ${W}`);else console.error(`Component ${X.slice(0,Z).join(".")} from source `+k(Q)+` does not have subcomponent ${W}`);break}}return Y}function d(G,K){return G.source===K.source&&G.sourceType===K.sourceType}function k(G){return JSON.stringify({source:G.source,sourceType:G.sourceType})}function M(G,K){if(!G.children)return[];else return G.children.map((Q)=>{switch(typeof Q){case"object":return K(Q);case"string":return Q}})}function _(G,K){return Object.fromEntries(Object.entries({...G.attributes,...Object.fromEntries(Object.entries(G.eventHandlers||{}).map(([Q,X])=>Y0(K,Q,X))),...Object.fromEntries(Object.entries(G.inlineJavaScript||{}).map(([Q,X])=>Z0(Q,X)))}))}function Y0(G,K,{target:Q,preventDefault:X,stopPropagation:Y}){let Z=function(...W){let $=Array.from(W).map((q)=>{let B=q;if(X)B.preventDefault();if(Y)B.stopPropagation();if(typeof B==="object")return E(B);else return B});G.sendMessage({type:"layout-event",data:$,target:Q})};return Z.isHandler=!0,[K,Z]}function Z0(name,inlineJavaScript){let wrappedExecutable=function(...args){function handleExecution(...args){let evalResult=eval(inlineJavaScript);if(typeof evalResult=="function")return evalResult(...args)}if(args.length>0&&args[0]instanceof Event)return handleExecution.call(args[0].currentTarget,...args);else return handleExecution(...args)};return wrappedExecutable.isHandler=!1,[name,wrappedExecutable]}function $0(G){return{create:(K,Q,X)=>P(K,Q,...X||[]),render:(K)=>{U(K,G)},unmount:()=>U(null,G)}}class c extends HTMLElement{mountPoint;binding=null;_client=null;_model=null;currentImportSource=null;constructor(){super();this.mountPoint=document.createElement("div"),this.mountPoint.style.display="contents"}connectedCallback(){this.appendChild(this.mountPoint)}set client(G){this._client=G}set model(G){this._model=G}requestUpdate(){this.update()}async update(){if(!this._client||!this._model||!this._model.importSource)return;let G=this._model.importSource;if(!this.binding||!this.currentImportSource||!d(this.currentImportSource,G)){if(this.binding)this.binding.unmount(),this.binding=null;this.currentImportSource=G;try{let K=await f(G,this._client);if(this.isConnected){if(this.binding=K(this.mountPoint),this.binding)this.binding.render(this._model)}}catch(K){console.error("Failed to load import source",K)}}else if(this.binding)this.binding.render(this._model)}disconnectedCallback(){if(this.binding)this.binding.unmount(),this.binding=null,this.currentImportSource=null}}if(typeof customElements<"u"&&!customElements.get("reactpy-child"))customElements.define("reactpy-child",c);var T=i(null);function s(G){let K=R({tagName:""})[0],Q=B0();return V(()=>G.client.onMessage("layout-update",({path:X,model:Y})=>{if(X==="")Object.assign(K,Y);else l.set(K,X,Y);Q()}),[K,G.client]),H(T.Provider,{value:G.client,children:H(S,{model:K})})}function S({model:G}){if(G.error!==void 0)if(G.error)return H("pre",{children:G.error});else return null;let K;if(G.tagName in m)K=m[G.tagName];else if(G.importSource)K=z0;else K=a;return H(K,{model:G})}function a({model:G}){let K=O(T);return P(G.tagName===""?I:G.tagName,_(G,K),...M(G,(Q)=>{return H(S,{model:Q},Q.attributes?.key)}))}function C({model:G}){let K=O(T),Q=_(G,K),[X,Y]=R(Q.value);V(()=>Y(Q.value),[Q.value]);let Z=Q.onChange;if(typeof Z==="function")Q.onChange=(W)=>{if(W.target)Y(W.target.value);Z(W)};return P(G.tagName,{...Q,value:X},...M(G,(W)=>H(S,{model:W},W.attributes?.key)))}function q0({model:G}){let K=N(null);return V(()=>{if(!K.current)return;let Q=document.createElement("script");for(let[Y,Z]of Object.entries(G.attributes||{}))Q.setAttribute(Y,Z);let X=G?.children?.filter((Y)=>typeof Y=="string")[0];if(X)Q.appendChild(document.createTextNode(X));return K.current.appendChild(Q),()=>{K.current?.removeChild(Q)}},[G.attributes?.key]),H("div",{ref:K})}function z0({model:G}){let K=G.importSource,Q=H0(G);if(!K)return null;let X=K.fallback;if(!K)if(!X)return null;else if(typeof X==="string")return H("span",{children:X});else return H(a,{model:X});else return H("span",{ref:Q})}function B0(){let[,G]=R(!1);return()=>G((K)=>!K)}function H0(G){let K=G.importSource,Q=JSON.stringify(K),X=N(null),Y=O(T),[Z,W]=R(null);return V(()=>{let $=!1;if(K)f(K,Y).then((q)=>{if(!$&&X.current)W(q(X.current))});return()=>{if($=!0,Z&&K&&!K.unmountBeforeUpdate)Z.unmount()}},[Y,Q,W,X.current]),V(()=>{if(!(Z&&K))return;if(Z.render(G),K.unmountBeforeUpdate)return Z.unmount}),X}var m={input:C,script:q0,select:C,textarea:C};function J0(G){let Q=`${`ws${window.location.protocol==="https:"?"s":""}:`}//${window.location.host}`,X=new URL(`${Q}${G.pathPrefix}${G.componentPath||""}`);if(X.searchParams.append("http_pathname",window.location.pathname),window.location.search)X.searchParams.append("http_query_string",window.location.search);let Y=new D({urls:{componentUrl:X,jsModulesPath:`${window.location.origin}${G.pathPrefix}modules/`},reconnectOptions:{interval:G.reconnectInterval||750,maxInterval:G.reconnectMaxInterval||60000,maxRetries:G.reconnectMaxRetries||150,backoffMultiplier:G.reconnectBackoffMultiplier||1.25},mountElement:G.mountElement});U(H(s,{client:Y}),G.mountElement)}export{J0 as mountReactPy};

//# debugId=44B55D48AAC192FC64756E2164756E21
//# sourceMappingURL=index.js.map
