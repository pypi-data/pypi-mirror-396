import{a as J}from"./index-64wy0fss.js";import{e as I,f as v,g as d,i as M,k as g,m as U,n as p,o as _,q as L,s as T,w as E}from"./index-beq660xy.js";var k=v((T0,x)=>{var G0=Object.prototype.hasOwnProperty,K0=Object.prototype.toString;x.exports=function(K,Q,X){if(K0.call(Q)!=="[object Function]")throw TypeError("iterator must be a function");var Y=K.length;if(Y===+Y)for(var Z=0;Z<Y;Z++)Q.call(X,K[Z],Z,K);else for(var W in K)if(G0.call(K,W))Q.call(X,K[W],W,K)}});var c=v((E0,u)=>{var Q0=k();u.exports=z;function z(G,K,Q){if(arguments.length===3)return z.set(G,K,Q);if(arguments.length===2)return z.get(G,K);var X=z.bind(z,G);for(var Y in z)if(z.hasOwnProperty(Y))X[Y]=z[Y].bind(X,G);return X}z.get=function(K,Q){var X=Array.isArray(Q)?Q:z.parse(Q);for(var Y=0;Y<X.length;++Y){var Z=X[Y];if(!(typeof K=="object"&&(Z in K)))throw Error("Invalid reference token: "+Z);K=K[Z]}return K};z.set=function(K,Q,X){var Y=Array.isArray(Q)?Q:z.parse(Q),Z=Y[0];if(Y.length===0)throw Error("Can not set the root object");for(var W=0;W<Y.length-1;++W){var $=Y[W];if(typeof $!=="string"&&typeof $!=="number")$=String($);if($==="__proto__"||$==="constructor"||$==="prototype")continue;if($==="-"&&Array.isArray(K))$=K.length;if(Z=Y[W+1],!($ in K))if(Z.match(/^(\d+|-)$/))K[$]=[];else K[$]={};K=K[$]}if(Z==="-"&&Array.isArray(K))Z=K.length;return K[Z]=X,this};z.remove=function(G,K){var Q=Array.isArray(K)?K:z.parse(K),X=Q[Q.length-1];if(X===void 0)throw Error('Invalid JSON pointer for remove: "'+K+'"');var Y=z.get(G,Q.slice(0,-1));if(Array.isArray(Y)){var Z=+X;if(X===""&&isNaN(Z))throw Error('Invalid array index: "'+X+'"');Array.prototype.splice.call(Y,Z,1)}else delete Y[X]};z.dict=function(K,Q){var X={};return z.walk(K,function(Y,Z){X[Z]=Y},Q),X};z.walk=function(K,Q,X){var Y=[];X=X||function(Z){var W=Object.prototype.toString.call(Z);return W==="[object Object]"||W==="[object Array]"},function Z(W){Q0(W,function($,q){if(Y.push(String(q)),X($))Z($);else Q($,z.compile(Y));Y.pop()})}(K)};z.has=function(K,Q){try{z.get(K,Q)}catch(X){return!1}return!0};z.escape=function(K){return K.toString().replace(/~/g,"~0").replace(/\//g,"~1")};z.unescape=function(K){return K.replace(/~1/g,"/").replace(/~0/g,"~")};z.parse=function(K){if(K==="")return[];if(K.charAt(0)!=="/")throw Error("Invalid JSON pointer: "+K);return K.substring(1).split(/\//).map(z.unescape)};z.compile=function(K){if(K.length===0)return"";return"/"+K.map(z.escape).join("/")}});var F={log:(...G)=>console.log("[ReactPy]",...G),info:(...G)=>console.info("[ReactPy]",...G),warn:(...G)=>console.warn("[ReactPy]",...G),error:(...G)=>console.error("[ReactPy]",...G)};function y(G){let{interval:K,maxInterval:Q,maxRetries:X,backoffMultiplier:Y}=G,Z=0,W=K,$=!1,q=!1,H={},B=()=>{if(q)return;H.current=new WebSocket(G.url),H.current.onopen=()=>{if($=!0,F.info("Connected!"),W=K,Z=0,G.onOpen)G.onOpen()},H.current.onmessage=(o)=>{if(G.onMessage)G.onMessage(o)},H.current.onclose=()=>{if(G.onClose)G.onClose();if(!$){F.info("Failed to connect!");return}if(F.info("Disconnected!"),Z>=X){F.info("Connection max retries exhausted!");return}F.info(`Reconnecting in ${(W/1000).toPrecision(4)} seconds...`),setTimeout(B,W),W=e(W,Y,Q),Z++}};return G.readyPromise.then(()=>F.info("Starting client...")).then(B),H}function e(G,K,Q){return Math.min(G*K,Q)}class b{handlers={};ready;resolveReady;constructor(){this.resolveReady=()=>{},this.ready=new Promise((G)=>this.resolveReady=G)}onMessage(G,K){return(this.handlers[G]||(this.handlers[G]=[])).push(K),this.resolveReady(void 0),()=>{this.handlers[G]=this.handlers[G].filter((Q)=>Q!==K)}}handleIncoming(G){if(!G.type){F.warn("Received message without type",G);return}let K=this.handlers[G.type];if(!K){F.warn("Received message without handler",G);return}K.forEach((Q)=>Q(G))}}class f extends b{urls;socket;mountElement;constructor(G){super();this.urls=G.urls,this.mountElement=G.mountElement,this.socket=y({url:this.urls.componentUrl,readyPromise:this.ready,...G.reconnectOptions,onMessage:async({data:K})=>this.handleIncoming(JSON.parse(K))})}sendMessage(G){this.socket.current?.send(JSON.stringify(G))}loadModule(G){return import(`${this.urls.jsModulesPath}${G}`)}}var n=I(c(),1);var w={__stop__:!0};function C(G,K=10){if(!G||typeof G!=="object")return console.warn("eventToObject: Expected an object input, received:",G),G;let Q=new WeakSet;Q.add(G);let X={};for(let Y in G)try{if(V(G[Y],Y))continue;else if(typeof G[Y]==="object"){let Z=A(G[Y],K,Q);if(Z!==w)X[Y]=Z}else X[Y]=G[Y]}catch{continue}if(typeof window<"u"&&window.Event&&G instanceof window.Event)X.selection=X0(K,Q);return X}function X0(G,K){if(typeof window>"u"||!window.getSelection)return null;let Q=window.getSelection();if(!Q)return null;return{type:Q.type,anchorNode:Q.anchorNode?A(Q.anchorNode,G,K):null,anchorOffset:Q.anchorOffset,focusNode:Q.focusNode?A(Q.focusNode,G,K):null,focusOffset:Q.focusOffset,isCollapsed:Q.isCollapsed,rangeCount:Q.rangeCount,selectedText:Q.toString()}}function A(G,K,Q){let X=K-1;if(X<=0&&typeof G==="object")return w;if(!G||typeof G!=="object")return G;if(Q.has(G))return w;Q.add(G);try{if(Array.isArray(G)||typeof G?.length==="number"&&typeof G[Symbol.iterator]==="function"&&!Object.prototype.toString.call(G).includes("Map")&&!(G instanceof CSSStyleDeclaration))return Y0(G,X,Q);return Z0(G,X,Q)}finally{Q.delete(G)}}function Y0(G,K,Q){let X=[];for(let Y=0;Y<G.length;Y++)if(V(G[Y]))continue;else if(typeof G[Y]==="object"){let Z=A(G[Y],K,Q);if(Z!==w)X.push(Z)}else X.push(G[Y]);return X}function Z0(G,K,Q){let X={};for(let $ in G)try{if(V(G[$],$,G))continue;else if(typeof G[$]==="object"){let q=A(G[$],K,Q);if(q!==w)X[$]=q}else X[$]=G[$]}catch{continue}if(G&&typeof G==="object"&&"dataset"in G&&!Object.prototype.hasOwnProperty.call(X,"dataset")){let $=G.dataset;if(!V($,"dataset",G)){let q=A($,K,Q);if(q!==w)X.dataset=q}}let Y=["value","checked","files","type","name"];for(let $ of Y)if(G&&typeof G==="object"&&$ in G&&!Object.prototype.hasOwnProperty.call(X,$)){let q=G[$];if(!V(q,$,G))if(typeof q==="object"){let H=$==="files"?Math.max(K,3):K,B=A(q,H,Q);if(B!==w)X[$]=B}else X[$]=q}let Z=typeof window<"u"?window:void 0,W=Z?Z.HTMLFormElement:typeof HTMLFormElement<"u"?HTMLFormElement:void 0;if(W&&G instanceof W&&G.elements)for(let $=0;$<G.elements.length;$++){let q=G.elements[$];if(q.name&&!Object.prototype.hasOwnProperty.call(X,q.name)&&!V(q,q.name,G))if(typeof q==="object"){let H=A(q,K,Q);if(H!==w)X[q.name]=H}else X[q.name]=q}return X}function V(G,K="",Q=void 0){return G===null||G===void 0||K.startsWith("__")||K.length>0&&/^[A-Z_]+$/.test(K)||typeof G==="function"||G instanceof CSSStyleSheet||G instanceof Window||G instanceof Document||K==="view"||K==="size"||K==="length"||Q instanceof CSSStyleDeclaration&&G===""||typeof Node<"u"&&Q instanceof Node&&(K==="parentNode"||K==="parentElement"||K==="ownerDocument"||K==="getRootNode"||K==="childNodes"||K==="children"||K==="firstChild"||K==="lastChild"||K==="previousSibling"||K==="nextSibling"||K==="previousElementSibling"||K==="nextElementSibling"||K==="innerHTML"||K==="outerHTML"||K==="offsetParent"||K==="offsetWidth"||K==="offsetHeight"||K==="offsetLeft"||K==="offsetTop"||K==="clientTop"||K==="clientLeft"||K==="clientWidth"||K==="clientHeight"||K==="scrollWidth"||K==="scrollHeight"||K==="scrollTop"||K==="scrollLeft")}async function m(){try{let G=await import("react"),K=await import("react-dom/client");return(Q)=>q0(Q,G,K)}catch{return console.error("Unknown error occurred: 'react' is missing within this ReactPy environment!       Your JavaScript components may not work as expected!"),(G)=>W0(G)}}function W0(G){return{create:(K,Q,X)=>M(K,Q,...X||[]),render:(K)=>{U(K,G)},unmount:()=>U(null,G)}}var P=new WeakMap;function q0(G,K,Q){let X=null;return{create:(Y,Z,W)=>K.createElement(Y,Z,...W||[]),render:(Y)=>{if(!X)if(!P.get(G))X=Q.createRoot(G),P.set(G,X);else X=P.get(G);X.render(Y)},unmount:()=>{if(X){if(X.unmount(),P.get(G)===X)P.delete(G);X=null}}}}async function h(G,K){let Q;if(G.sourceType==="URL")Q=await import(G.source);else Q=await K.loadModule(G.source);let{bind:X}=Q;if(typeof X!=="function")X=await m();return(Y)=>{let Z=X(Y,{sendMessage:K.sendMessage,onMessage:K.onMessage});if(!(typeof Z.create==="function"&&typeof Z.render==="function"&&typeof Z.unmount==="function"))return F.error(`${G.source} returned an impropper binding`),null;return{render:(W)=>Z.render(i({client:K,module:Q,binding:Z,model:W,currentImportSource:G})),unmount:Z.unmount}}}function i(G){let K;if(G.model.importSource){if(!N(G.currentImportSource,G.model.importSource))return G.binding.create("reactpy-child",{ref:(Q)=>{if(Q)Q.client=G.client,Q.model=G.model,Q.requestUpdate()}});else if(K=z0(G.module,G.model.tagName,G.model.importSource),!K)return null}else K=G.model.tagName;return G.binding.create(K,O(G.model,G.client),R(G.model,(Q)=>i({...G,model:Q})))}function z0(G,K,Q){let X=K.split("."),Y=null;for(let Z=0;Z<X.length;Z++){let W=X[Z];if(Y=Z==0?G[W]:Y[W],!Y){if(Z==0)F.error("Module from source "+l(Q)+` does not export ${W}`);else console.error(`Component ${X.slice(0,Z).join(".")} from source `+l(Q)+` does not have subcomponent ${W}`);break}}return Y}function N(G,K){return G.source===K.source&&G.sourceType===K.sourceType}function l(G){return JSON.stringify({source:G.source,sourceType:G.sourceType})}function R(G,K){if(!G.children)return[];else return G.children.map((Q)=>{switch(typeof Q){case"object":return K(Q);case"string":return Q}})}function O(G,K){return Object.fromEntries(Object.entries({...G.attributes,...Object.fromEntries(Object.entries(G.eventHandlers||{}).map(([Q,X])=>H0(K,Q,X))),...Object.fromEntries(Object.entries(G.inlineJavaScript||{}).map(([Q,X])=>J0(Q,X)))}))}function H0(G,K,{target:Q,preventDefault:X,stopPropagation:Y}){let Z=function(...W){let $=Array.from(W).map((q)=>{let H=q;if(X)H.preventDefault();if(Y)H.stopPropagation();if(typeof H==="object")return C(H);else return H});G.sendMessage({type:"layout-event",data:$,target:Q})};return Z.isHandler=!0,[K,Z]}function J0(name,inlineJavaScript){let wrappedExecutable=function(...args){function handleExecution(...args){let evalResult=eval(inlineJavaScript);if(typeof evalResult=="function")return evalResult(...args)}if(args.length>0&&args[0]instanceof Event)return handleExecution.call(args[0].currentTarget,...args);else return handleExecution(...args)};return wrappedExecutable.isHandler=!1,[name,wrappedExecutable]}class s extends HTMLElement{mountPoint;binding=null;_client=null;_model=null;currentImportSource=null;constructor(){super();this.mountPoint=document.createElement("div"),this.mountPoint.style.display="contents"}connectedCallback(){this.appendChild(this.mountPoint)}set client(G){this._client=G}set model(G){this._model=G}requestUpdate(){this.update()}async update(){if(!this._client||!this._model||!this._model.importSource)return;let G=this._model.importSource;if(!this.binding||!this.currentImportSource||!N(this.currentImportSource,G)){if(this.binding)this.binding.unmount(),this.binding=null;this.currentImportSource=G;try{let K=await h(G,this._client);if(this.isConnected&&this.currentImportSource&&N(this.currentImportSource,G)){let Q=this.binding;if(Q)Q.unmount();if(this.binding=K(this.mountPoint),this.binding)this.binding.render(this._model)}}catch(K){console.error("Failed to load import source",K)}}else if(this.binding)this.binding.render(this._model)}disconnectedCallback(){if(this.binding)this.binding.unmount(),this.binding=null,this.currentImportSource=null}}if(typeof customElements<"u"&&!customElements.get("reactpy-child"))customElements.define("reactpy-child",s);var D=p(null);function r(G){let K=_({tagName:""})[0],Q=A0();return L(()=>G.client.onMessage("layout-update",({path:X,model:Y})=>{if(X==="")Object.assign(K,Y);else n.set(K,X,Y);Q()}),[K,G.client]),J(D.Provider,{value:G.client,children:J(j,{model:K})})}function j({model:G}){if(G.error!==void 0)if(G.error)return J("pre",{children:G.error});else return null;let K;if(G.tagName in a)K=a[G.tagName];else if(G.importSource)K=w0;else K=t;return J(K,{model:G})}function t({model:G}){let K=E(D);return M(G.tagName===""?g:G.tagName,O(G,K),...R(G,(Q)=>{return J(j,{model:Q},Q.attributes?.key)}))}function S({model:G}){let K=E(D),Q=O(G,K),[X,Y]=_(Q.value);L(()=>Y(Q.value),[Q.value]);let Z=Q.onChange;if(typeof Z==="function")Q.onChange=(W)=>{if(W.target)Y(W.target.value);Z(W)};return M(G.tagName,{...Q,value:X},...R(G,(W)=>J(j,{model:W},W.attributes?.key)))}function F0({model:G}){let K=T(null);return L(()=>{if(!K.current)return;let Q=document.createElement("script");for(let[Y,Z]of Object.entries(G.attributes||{}))Q.setAttribute(Y,Z);let X=G?.children?.filter((Y)=>typeof Y=="string")[0];if(X)Q.appendChild(document.createTextNode(X));return K.current.appendChild(Q),()=>{K.current?.removeChild(Q)}},[G.attributes?.key]),J("div",{ref:K})}function w0({model:G}){let K=G.importSource,Q=B0(G);if(!K)return null;let X=K.fallback;if(!K)if(!X)return null;else if(typeof X==="string")return J("span",{children:X});else return J(t,{model:X});else return J("span",{ref:Q})}function A0(){let[,G]=_(!1);return()=>G((K)=>!K)}function B0(G){let K=G.importSource,Q=JSON.stringify(K),X=T(null),Y=E(D),[Z,W]=_(null),$=T(null);return L(()=>{let q=!1,H=null;if(K)h(K,Y).then((B)=>{if(!q&&X.current)H=B(X.current),$.current=Q,W(H)});return()=>{if(q=!0,H&&K&&!K.unmountBeforeUpdate)H.unmount()}},[Y,Q,W,X.current]),L(()=>{if(!(Z&&K))return;if($.current!==Q)return;if(Z.render(G),K.unmountBeforeUpdate)return Z.unmount}),X}var a={input:S,script:F0,select:S,textarea:S};function V0(G){let Q=`${`ws${window.location.protocol==="https:"?"s":""}:`}//${window.location.host}`,X=new URL(`${Q}${G.pathPrefix}${G.componentPath||""}`);if(X.searchParams.append("http_pathname",window.location.pathname),window.location.search)X.searchParams.append("http_query_string",window.location.search);let Y=new f({urls:{componentUrl:X,jsModulesPath:`${window.location.origin}${G.pathPrefix}modules/`},reconnectOptions:{interval:G.reconnectInterval||750,maxInterval:G.reconnectMaxInterval||60000,maxRetries:G.reconnectMaxRetries||150,backoffMultiplier:G.reconnectBackoffMultiplier||1.25},mountElement:G.mountElement});U(J(r,{client:Y}),G.mountElement)}export{V0 as mountReactPy};

//# debugId=963F8FEBB526BB7F64756E2164756E21
//# sourceMappingURL=index.js.map
