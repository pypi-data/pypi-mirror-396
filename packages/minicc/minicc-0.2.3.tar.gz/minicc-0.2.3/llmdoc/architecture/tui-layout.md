# TUI å¸ƒå±€æ¶æ„

## 1. Identity

- **What it is:** MiniCC ç»ˆç«¯ç”¨æˆ·ç•Œé¢çš„æ•´ä½“å¸ƒå±€å’Œç»„ä»¶ç»„ç»‡
- **Purpose:** ä¸ºç”¨æˆ·æä¾›æ¸…æ™°ã€é«˜æ•ˆçš„èŠå¤©äº¤äº’ç•Œé¢

## 2. æ•´ä½“å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Header (MiniCC æ—¶é’Ÿ)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     chat_container (VerticalScroll)  â”‚
â”‚  â”œâ”€ MessagePanel (ç”¨æˆ·/åŠ©æ‰‹æ¶ˆæ¯)    â”‚
â”‚  â”œâ”€ ToolCallLine (å·¥å…·è°ƒç”¨å•è¡Œ)     â”‚
â”‚  â”œâ”€ SubAgentLine (SubAgent å•è¡Œ)   â”‚
â”‚  â””â”€ DiffView (æ–‡ä»¶å˜æ›´é¢„è§ˆ)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Input (ç”¨æˆ·è¾“å…¥æ¡†ï¼Œç„¦ç‚¹)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“¦ Model â”‚ ğŸ“ CWD â”‚ ğŸŒ¿ Branch â”‚ Tokenâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Footer (å¿«æ·é”®: Ctrl+Cé€€å‡º, Ctrl+Læ¸…å±)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. æ ¸å¿ƒç»„ä»¶

### Header
æ˜¾ç¤ºåº”ç”¨æ ‡é¢˜å’Œå®æ—¶æ—¶é’Ÿã€‚Textual å†…ç½®ç»„ä»¶ï¼Œæ— éœ€è‡ªå®šä¹‰ã€‚

### chat_container (VerticalScroll)
**æ–‡ä»¶:** `minicc/app.py:85` (`VerticalScroll`)

ä¸»æ¶ˆæ¯åŒºåŸŸï¼ŒåŒ…å«ï¼š
- `MessagePanel`: ç”¨æˆ·/åŠ©æ‰‹æ¶ˆæ¯ï¼ˆæ”¯æŒ Markdownï¼‰
- `ToolCallLine`: å·¥å…·è°ƒç”¨å•è¡Œæ˜¾ç¤ºï¼ˆ`ğŸ”§ name (param) âœ…/âŒ`ï¼‰
- `SubAgentLine`: SubAgent ä»»åŠ¡å•è¡Œæ˜¾ç¤ºï¼ˆ`ğŸ¤– prompt â³/ğŸ”„/âœ…/âŒ`ï¼‰
- `DiffView`: æ–‡ä»¶å˜æ›´é¢„è§ˆï¼ˆé¢œè‰²åŒºåˆ† +/-/contextï¼‰

æ¶ˆæ¯è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°ã€‚å®¹å™¨ç”± `_on_tool_call()` ç®¡ç†ç»„ä»¶æŒ‚è½½ã€‚

### Input
ç”¨æˆ·è¾“å…¥æ¡†ï¼Œæäº¤æ—¶è§¦å‘ `on_input_submitted` äº‹ä»¶ã€‚

### BottomBar
**æ–‡ä»¶:** `minicc/app.py:87-92` (BottomBar ç»„ä»¶)

åˆ†åŒºå—æ˜¾ç¤ºï¼š
- `ğŸ“¦ æ¨¡å‹`: provider:model
- `ğŸ“ ç›®å½•`: å½“å‰ cwd
- `ğŸŒ¿ åˆ†æ”¯`: git åˆ†æ”¯å
- `â¬†ï¸â¬‡ï¸ Token`: è¾“å…¥/è¾“å‡º token æ•°

å®æ—¶æ›´æ–°ï¼Œä¸å¯æŠ˜å ã€‚

### Footer
æ˜¾ç¤ºå¿«æ·é”®åˆ—è¡¨ã€‚Textual å†…ç½®ç»„ä»¶ã€‚

## 4. æ¶ˆæ¯æµå¤„ç†

æ¶ˆæ¯å¤„ç†é“¾ï¼š
```
Input.Submitted
  â†’ _process_message(user_input)
    â†’ agent.run_stream_events() [å¼‚æ­¥æµå¤„ç†]
      â†’ PartStartEvent â†’ å¼€å§‹æµå¼è¾“å‡º
      â†’ PartDeltaEvent â†’ ç´¯ç§¯ text delta
      â†’ å·¥å…·è°ƒç”¨äº‹ä»¶ â†’ _on_tool_call()
         â”œâ”€ spawn_agent â†’ mount SubAgentLine
         â””â”€ å…¶ä»–å·¥å…· â†’ mount ToolCallLine
      â†’ æœ€ç»ˆäº‹ä»¶ (AgentRunResultEvent)
         â†’ _update_tokens() [æ›´æ–° BottomBar token]
         â†’ _append_message() [mount MessagePanel]
  â†’ è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
```

å…³é”®æ–¹æ³•ï¼š
- `_process_message()` (app.py:140-170): æ¶ˆæ¯å¤„ç†å…¥å£
- `_on_tool_call()` (app.py:175-202): å·¥å…·è°ƒç”¨å›è°ƒ
- `_update_tokens()` (app.py:207-215): token æ›´æ–°

## 5. å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| Ctrl+C | é€€å‡ºåº”ç”¨ |
| Ctrl+L | æ¸…å±å¹¶é‡ç½® |
| Escape | å–æ¶ˆå½“å‰æ“ä½œ |

## 6. è®¾è®¡æ¼”è¿›

### v0.x (åˆç‰ˆ)
- æ°´å¹³å¸ƒå±€: chat_container + side_panel
- ä¾§è¾¹æ æ˜¾ç¤º: StatusBar + info_card + TabbedContent
- å¯æŠ˜å é¢æ¿: CollapsibleToolPanel / SubAgentPanel

### v1.0 (å½“å‰)
- çºµå‘å¸ƒå±€: Header â†’ chat_container â†’ Input â†’ BottomBar â†’ Footer
- ç§»é™¤ä¾§è¾¹æ ï¼Œé‡Šæ”¾æ°´å¹³ç©ºé—´
- **å•è¡Œç®€æ´è®¾è®¡:** ToolCallLine / SubAgentLine (ä¸å†å¯æŠ˜å )
  - `ğŸ”§ name (param) âœ…` ä¸€è¡Œæ˜¾ç¤ºå®Œæ•´å·¥å…·è°ƒç”¨
  - `ğŸ¤– prompt â³` ä¸€è¡Œæ˜¾ç¤º SubAgent çŠ¶æ€
- **BottomBar:** æ’å®šæ˜¾ç¤ºå…³é”®ä¸Šä¸‹æ–‡ (æ¨¡å‹/ç›®å½•/åˆ†æ”¯/Token)

### è®¾è®¡ä¼˜åŠ¿
- **è§†è§‰æ¸…æ´:** ç§»é™¤å†—ä½™ä¿¡æ¯å’Œå¯æŠ˜å äº¤äº’
- **ä¿¡æ¯å¯†åº¦é«˜:** BottomBar åœ¨ä¸€è¡Œå†…æ˜¾ç¤º 4 é¡¹å…³é”®ä¿¡æ¯
- **ç©ºé—´åˆ©ç”¨ç‡:** èŠå¤©åŒºåŸŸå®½åº¦å¢åŠ  ~30-40%
- **äº¤äº’ç®€åŒ–:** æ¶ˆæ¯ä¸å·¥å…·è°ƒç”¨å†…è”ï¼Œæ— éœ€åˆ‡æ¢ Tab
