"""
Random number utilities for CausalIQ Core.

This module provides stable, repeatable random number sequences for
cross-platform reproducibility in experiments and testing.
"""

from enum import Enum
from typing import List, Optional

from numpy.random import Generator, default_rng


class Randomise(Enum):
    """Supported experiment randomisations."""

    ORDER = "order"  # randomise order of variables in dataset
    NAMES = "names"  # randomise variable names
    KNOWLEDGE = "knowledge"  # randomise knowledge
    ROWS = "rows"  # randomise row order in dataset
    SAMPLE = "sample"  # randomise the sample of rows in dataset


# Generated from legacy stable_random.dat for cross-platform repeatability
STABLE_RANDOM_SEQUENCE = [
    0.5118216247002567,
    0.9504636963259353,
    0.14415961271963373,
    0.9486494471372439,
    0.31183145201048545,
    0.42332644897257565,
    0.8277025938204418,
    0.4091991363691613,
    0.5495936876730595,
    0.027559113243068367,
    0.7535131086748066,
    0.5381433132192782,
    0.32973171649909216,
    0.7884287034284043,
    0.303194829291645,
    0.4534978894806515,
    0.13404169724716475,
    0.40311298644712923,
    0.20345524067614962,
    0.2623133404418495,
    0.7503646726300526,
    0.2804087579860399,
    0.48519097443163506,
    0.9807371998012386,
    0.9616571936637868,
    0.7247899407735336,
    0.5412268555474342,
    0.2768912040453708,
    0.16065200877512686,
    0.9699254132161326,
    0.5160685855478787,
    0.11586561247077032,
    0.6234897555375004,
    0.776683114342298,
    0.6130033010530405,
    0.9172977047909027,
    0.03959287666420286,
    0.5285892632600216,
    0.4593358828854037,
    0.0623495791498756,
    0.641328169139375,
    0.8526328384806567,
    0.592941018104284,
    0.2600974477372232,
    0.8398815210314088,
    0.5094958815215094,
    0.510888884466533,
    0.7530302077021779,
    0.14792203578495655,
    0.819626719119277,
    0.6832869060032571,
    0.787096941554801,
    0.19161625902013524,
    0.80236416113453,
    0.19132392605720028,
    0.08155261736351271,
    0.8552269742870702,
    0.8612834961776684,
    0.8765370964165805,
    0.4719097193587902,
    0.2740483886137183,
    0.007091828603166261,
    0.6457208955749478,
    0.719909383508693,
    0.8355692165002742,
    0.28187782736454214,
    0.2152181671629736,
    0.6393313800665879,
    0.8050548331450097,
    0.9636708728449709,
    0.15052483042117748,
    0.48221238819933654,
    0.8947158621961735,
    0.4227169069454373,
    0.5895020620840481,
    0.0244906774933632,
    0.6734598871529389,
    0.9190886196338225,
    0.8268253295567211,
    0.8855202667099468,
    0.6603553805205233,
    0.24555226724317758,
    0.7685169988962544,
    0.2116747426075105,
    0.8312748346644612,
    0.06271792257076825,
    0.8254878133935558,
    0.1645072664741013,
    0.37514699649664185,
    0.3167381665569643,
    0.6913370352777413,
    0.17857187817437192,
    0.39625616221698645,
    0.0058245951079809455,
    0.2624947127501015,
    0.42118881422895527,
    0.10592123670732445,
    0.6331599460365578,
    0.38042426988653233,
    0.7252939380762389,
    0.6538660110683944,
    0.4312267487774062,
    0.8673205056421992,
    0.632135117500167,
    0.8102743521062991,
    0.341794723940113,
    0.5436692896684556,
    0.1962968851147534,
    0.9961411901186279,
    0.24321546430632712,
    0.25686746722710274,
    0.07319007239096598,
    0.2578031189967366,
    0.7631285325440532,
    0.6978935706830813,
    0.12867321231716944,
    0.37623850142809423,
    0.4209213946174629,
    0.6649842463619607,
    0.45592896304374886,
    0.5865183268255314,
    0.8396846036089424,
    0.7264736103123705,
    0.36500726350855894,
    0.44839630934448427,
    0.3676995696900066,
    0.10973466400669674,
    0.2032415440873966,
    0.2838064889441311,
    0.3141338956023022,
    0.3130478588199377,
    0.576699716252952,
    0.9716899756197547,
    0.774664134923732,
    0.7911339481728052,
    0.75926850053958,
    0.5969877305237564,
    0.9176922571709127,
    0.689630155447081,
    0.500356430736871,
    0.07708380850053875,
    0.48844922708552385,
    0.21283099534033434,
    0.13269629754678725,
    0.506064922529373,
    0.785085292596959,
    0.29500644280551946,
    0.7687717599091665,
    0.5256295231622541,
    0.14904802337071255,
    0.9649677439797357,
    0.4016362238885175,
    0.2952342556626958,
    0.8469983706337296,
    0.12446033251547983,
    0.7335904610737034,
    0.18782474256546833,
    0.39249177601258245,
    0.23189987846213844,
    0.8412279926923869,
    0.39007455193986174,
    0.9746928128822893,
    0.6252614844151068,
    0.6936228347029152,
    0.5215251221324175,
    0.30896819907559114,
    0.3955564210524287,
    0.9409341876619017,
    0.20120320072466447,
    0.9882189012202123,
    0.7583058620038184,
    0.35978692649261024,
    0.6415135895056033,
    0.38098153929308753,
    0.38149293263992,
    0.5038029501945296,
    0.016722821635377083,
    0.4935715599433962,
    0.971598413446888,
    0.28546522878557845,
    0.7482179590766121,
    0.44278889007049504,
    0.20928104261778546,
    0.9050025708181295,
    0.016827284680212995,
    0.3035089265995107,
    0.9990258823239375,
    0.2621467961899895,
    0.849044521859272,
    0.6056831486557043,
    0.8060357075271236,
    0.6303177554434782,
    0.3626968570578484,
    0.7607887845834825,
    0.026484548903972338,
    0.4468129517344519,
    0.371854569870106,
    0.4770740056373495,
    0.1276206864960696,
    0.22250686594627245,
    0.5620515900997094,
    0.38776911565595396,
    0.7916562055903406,
    0.6051365892775145,
    0.8612666847869941,
    0.7323608373256045,
    0.601823447758565,
    0.2876156021959957,
    0.7827604679261685,
    0.2512675781710818,
    0.07521111181440443,
    0.9628645784432278,
    0.5400112050964692,
    0.7738942975498113,
    0.5292228076303601,
    0.6115797303718215,
    0.03389225051650624,
    0.18679367935380853,
    0.6746893954347775,
    0.5705645979524983,
    0.15855503398671267,
    0.9520292687261848,
    0.1543536325474043,
    0.5103032497386853,
    0.14400287501925768,
    0.7173717261062347,
    0.27631301409515274,
    0.13413397512178327,
    0.04598718067051566,
    0.17483553789762363,
    0.1917987167235664,
    0.5369720795717926,
    0.4510388861713912,
    0.9572943672535373,
    0.9541513368666424,
    0.7965461104684304,
    0.6715876339807033,
    0.8450230915683464,
    0.9387518284798846,
    0.022617728887002753,
    0.1181052271508587,
    0.3602638846836431,
    0.09358685304259973,
    0.5995244730532772,
    0.26036422234810863,
    0.2643397291323255,
    0.2883279886478656,
    0.09771565758439005,
    0.7409444532381589,
    0.6506724295996501,
    0.6065080906412624,
    0.03404558227777543,
    0.4294641446388775,
    0.6852035898998426,
    0.15634664990358638,
    0.3856578446575508,
    0.019834145469936892,
    0.08185799707724206,
    0.2164535799990539,
    0.41465016114124864,
    0.46324003628737986,
    0.884521531618113,
    0.3166584421740133,
    0.021463876277191374,
    0.8262233467711652,
    0.061846935373572776,
    0.09299199266222835,
    0.963181716739735,
    0.7533654181283584,
    0.33785420277925504,
    0.13217884161919569,
    0.38673057317186155,
    0.33919489278017356,
    0.8744412014424732,
    0.41875301731404,
    0.08204500601562204,
    0.9268052023585862,
    0.6223133637152601,
    0.11670985678100221,
    0.11317416004642233,
    0.46593324116426427,
    0.09208896568911618,
    0.6317521922027585,
    0.6163837910949103,
    0.032081348618153704,
    0.8074227810412945,
    0.7867947609394985,
    0.9153082686153085,
    0.6703066467384771,
    0.6928622323352233,
    0.1637416544531679,
    0.023888813978811707,
    0.06556315241841992,
    0.9644613401603573,
    0.6457213655596336,
    0.9469066664934074,
    0.3493843588720956,
    0.755221576661414,
    0.06539896536166678,
    0.16620516559297116,
    0.27713333487199,
    0.5503182517007417,
    0.55740888009091,
    0.4989864523070149,
    0.42446358463207756,
    0.5757051603390986,
    0.9666623953878383,
    0.4580795604861192,
    0.8374714217984048,
    0.055871965031871196,
    0.3855872572300576,
    0.5604964436423991,
    0.6203205556549372,
    0.2500183399320113,
    0.39929101348659524,
    0.9470061687356901,
    0.648850754011949,
    0.5849662484122946,
    0.06529871051984093,
    0.052176257643147705,
    0.21139844783206463,
    0.137822775848633,
    0.9837499292732876,
    0.002747147602664146,
    0.3658435291805171,
    0.05842244962380161,
    0.6400105583176766,
    0.046533202074859115,
    0.0684096355417223,
    0.07994250560811889,
    0.2717851313028795,
    0.5763580679966506,
    0.8054486176308537,
    0.2671915845012608,
    0.2831710565694664,
    0.824482143951937,
    0.7459483801763226,
    0.12681474835733464,
    0.8063489347063569,
    0.8312511086352812,
    0.17782578356710588,
    0.6269479985725536,
    0.19674362182123795,
    0.24349271202808254,
    0.494005755328642,
    0.5222200279508085,
    0.4790335153981873,
    0.5411410533042087,
    0.21316467642545245,
    0.7785803681279121,
    0.2778484120286083,
    0.9126832897191103,
    0.5151553035895896,
    0.3036840529445848,
    0.17438390250830016,
    0.48520396241603025,
    0.3762973001513523,
    0.6230937907219327,
    0.49845958262294987,
    0.03695969800069676,
    0.8330947688085336,
    0.051673939119395995,
    0.8275951638592104,
    0.8127496434167762,
    0.9239831252875618,
    0.6644010411515328,
    0.16062363410535052,
    0.44192941145403775,
    0.43943266017047056,
    0.6323329864819148,
    0.3811375324040436,
    0.6756780879691183,
    0.2039073800978377,
    0.3533507781465587,
    0.5433134112873544,
    0.427651051214449,
    0.12252565076900024,
    0.9658281207625043,
    0.6912954021364714,
    0.8330350777910258,
    0.3574607462891465,
    0.9448959101690874,
    0.8124471005528425,
    0.9795062455878859,
    0.19739425238980546,
    0.4771694766007426,
    0.3858489940723694,
    0.613894995603037,
    0.25021973366796013,
    0.10047228975068634,
    0.4766165868289146,
    0.6394719365196334,
    0.3840154184913098,
    0.9874393427162872,
    0.40598877214889817,
    0.29981554243781305,
    0.8138978250995115,
    0.46668980303279606,
    0.27321678269920713,
    0.28649102447160646,
    0.9471557892442384,
    0.961736748159922,
    0.6462368962429871,
    0.2787679766747637,
    0.7113690437189849,
    0.2167694819361088,
    0.3220846874139359,
    0.5417363597027655,
    0.40114416116454565,
    0.35102386263458685,
    0.9741344294864881,
    0.17020617447974906,
    0.6137785589494178,
    0.03854138948384955,
    0.09171473713390443,
    0.20999600501172455,
    0.9916861960144647,
    0.7264246392278,
    0.8680380956291989,
    0.049483784636716543,
    0.6814384526526729,
    0.4399364794360058,
    0.41641994855534936,
    0.7082547942479717,
    0.30831895053558056,
    0.5134678232710247,
    0.2607247218237164,
    0.39140407059240856,
    0.5333261752047522,
    0.15788100282626316,
    0.27618712190520356,
    0.4204059052215403,
    0.4727479785281554,
    0.8000039680110183,
    0.6429501138675994,
    0.5624900665221173,
    0.8698673937003966,
    0.19734886477676372,
    0.10408303517803497,
    0.39372521336773547,
    0.1371899555572782,
    0.5559810381008665,
    0.5736433320658848,
    0.13159354974969018,
    0.7160539946963933,
    0.5565394834256112,
    0.4231819942696411,
    0.9174817732993081,
    0.8559122943833432,
    0.22096916376486697,
    0.166583176525819,
    0.9155364039147175,
    0.1572518885137706,
    0.7572063264186215,
    0.31251701581211366,
    0.3611853466325139,
    0.5537246459677773,
    0.9259641674233373,
    0.00205684306461984,
    0.1622873344023199,
    0.7202117786599489,
    0.3944665294244958,
    0.2878104198967977,
    0.9628956581275414,
    0.26402842332427967,
    0.7141669578683888,
    0.964225669092555,
    0.7627660562464376,
    0.7094140359205118,
    0.7232067127676901,
    0.8052261068309458,
    0.27121364891992294,
    0.6266867251784247,
    0.802885894043567,
    0.8882296412968325,
    0.9058341532080582,
    0.903896393587496,
    0.09763379946487272,
    0.3764060873778814,
    0.45639208349041915,
    0.8916854039669163,
    0.4192536193798634,
    0.2649121033591305,
    0.019858773159258325,
    0.28875427776216545,
    0.7807241847334279,
    0.020170938059851595,
    0.16499392794848766,
    0.3109684208465644,
    0.5320110718845206,
    0.3630433181948137,
    0.8826396945897659,
    0.20747762885186438,
    0.5616344004190236,
    0.7778175051376995,
    0.9296082290939864,
    0.8734802733413756,
    0.13552100374068055,
    0.7918000796455894,
    0.6753462694980112,
    0.4216035573870036,
    0.02556709896246312,
    0.16798147095798632,
    0.7494608262320578,
    0.08400476777677468,
    0.3126499249880641,
    0.25521243827660445,
    0.7461008968986407,
    0.3590598291763175,
    0.08718824098875189,
    0.3704421018161166,
    0.3268298767186818,
    0.7170213673193974,
    0.32012222019868797,
    0.6936156490920399,
    0.538594453433759,
    0.8877328287244716,
    0.7333651729435877,
    0.4079187425363865,
    0.4849095181984443,
    0.4713857598653367,
    0.871702397518525,
    0.1380361717125459,
    0.4242300124285143,
    0.5349120574812903,
    0.43622283223869607,
    0.5980284679987804,
    0.49884309541984917,
    0.4136957426619674,
    0.6868129726159958,
    0.329322465708467,
    0.6069010136690235,
    0.7285583473338744,
    0.13064663579388291,
    0.326452101504932,
    0.9447045555986052,
    0.9660212875626245,
    0.9923887631356604,
    0.042525833888270914,
    0.8265087689118491,
    0.9352758069942098,
    0.9019444400552439,
    0.7149413034806142,
    0.6756193428878896,
    0.7196066164883864,
    0.5748858181470116,
    0.7884200798433164,
    0.5019296038006482,
    0.22593749989122835,
    0.09434902497816688,
    0.9082557233023724,
    0.7548789814030864,
    0.17724193576034308,
    0.8224582773234224,
    0.30034675292417745,
    0.6356549721085979,
    0.35615285774869865,
    0.21416308633064296,
    0.17560876378281154,
    0.07095031074440761,
    0.07443855639465857,
    0.06909021073258215,
    0.08991876663737164,
    0.8340292890000545,
    0.5178083255163458,
    0.12858401479946935,
    0.5249946488828098,
    0.5426298015540887,
    0.4965920349441739,
    0.20648636461693026,
    0.43439788722453043,
    0.8708564535693805,
    0.3837354777850742,
    0.5039852429121634,
    0.9302423990750158,
    0.23280139794441634,
    0.7255076868062386,
    0.4838413345039069,
    0.7873679132996416,
    0.3596735148257848,
    0.5423586148739377,
    0.36828594365148837,
    0.8661492404529617,
    0.9148178896585872,
    0.6318212838540919,
    0.9810202364628207,
    0.7320556819078485,
    0.8304239319682308,
    0.8947206498619251,
    0.27190576176612025,
    0.986677930317109,
    0.39041402334281483,
    0.49721254381585167,
    0.18032373166299687,
    0.8214787850033072,
    0.3368976266911904,
    0.6893444454848344,
    0.21835559486831246,
    0.35136306055512956,
    0.38424448628290675,
    0.23662399393571287,
    0.035063442069188544,
    0.7702089160972269,
    0.9503546630566793,
    0.22624785755627508,
    0.16265136497070776,
    0.34760417535557775,
    0.0827660016297126,
    0.6497328757632396,
    0.36855251919960996,
    0.5624785542668137,
    0.9058499863649655,
    0.8615793288939493,
    0.9216768590469784,
    0.9350577167713908,
    0.5898193600864983,
    0.5023002858629506,
    0.03761516563706968,
    0.10244131138007828,
    0.5239233948745965,
    0.8560083046111611,
    0.4326345607117319,
    0.0037293622863878717,
    0.2123031061951699,
    0.7599704182197689,
    0.15841798852977795,
    0.1995763351554023,
    0.28553606420344835,
    0.6092833765614685,
    0.8364055547707432,
    0.2188948374279186,
    0.5994678737814576,
    0.5299406131466844,
    0.4448642064761482,
    0.5804205236557797,
    0.8141185235724825,
    0.2174880566784605,
    0.49723415087942624,
    0.09792056114612835,
    0.5132375550687044,
    0.7910078573202679,
    0.9985588906517041,
    0.4756930540857839,
    0.29660340069975666,
    0.5795035819171939,
    0.37175205481064844,
    0.11700238911955996,
    0.5244985720304953,
    0.7991356910058783,
    0.8911272873731255,
    0.9781111877004136,
    0.367724622858563,
    0.2516651775815243,
    0.11082077354630926,
    0.43623191729940924,
    0.8070271602470545,
    0.23464478762451768,
    0.8495664980662655,
    0.7117370178186778,
    0.2009428205260435,
    0.6317515391392956,
    0.8196921827935082,
    0.9328703661209736,
    0.1622147636965876,
    0.8220151936558258,
    0.775849087831725,
    0.24372164064158708,
    0.29458141066814314,
    0.9570840322522522,
    0.3620160579603561,
    0.28897610525044326,
    0.7200111192047169,
    0.13290601045995287,
    0.4831693166218948,
    0.3581331262376146,
    0.5439863429623552,
    0.6032501438505057,
    0.6401074539004775,
    0.4323990581888032,
    0.8869324087540136,
    0.8356760923639591,
    0.9333577853920362,
    0.4459056416232484,
    0.7300859144743024,
    0.43069578678627296,
    0.27878275453064916,
    0.6518864471172541,
    0.9459871575106307,
    0.8043078809051966,
    0.28520177437201744,
    0.22810575636153718,
    0.771645461188267,
    0.70512847943679,
    0.8636017462548002,
    0.14636161095889433,
    0.8616792361529133,
    0.4326254526587491,
    0.2733454783925543,
    0.34324466249262875,
    0.993503904012744,
    0.9560321250196621,
    0.08374603548012094,
    0.3151884677170894,
    0.7195790246564682,
    0.035325131608288984,
    0.035923654437162944,
    0.04489029342183237,
    0.8684448332578513,
    0.333732439660985,
    0.31873983277151186,
    0.7933438210501507,
    0.3185662914766022,
    0.7384308555952237,
    0.3693407284032201,
    0.29751931337916526,
    0.3872265142953374,
    0.16803724260680775,
    0.07501114630738015,
    0.8712014465037485,
    0.8683831797645515,
    0.46082134286350085,
    0.6883762257244914,
    0.862649616262373,
    0.39072337589762884,
    0.7118103284257594,
    0.7547914201079906,
    0.0780746100305868,
    0.1381620728272963,
    0.7503299824856386,
    0.7056489373809989,
    0.18526748198019183,
    0.8267319229556759,
    0.8009011709823957,
    0.332743528625158,
    0.3402819990903042,
    0.11057199333425483,
    0.4454831559739022,
    0.10976126007862752,
    0.5434071419217806,
    0.6245833168710772,
    0.5819411427086918,
    0.07164854385164288,
    0.6216704469983908,
    0.7522149311552978,
    0.1418532078034277,
    0.5950767958664359,
    0.8190554752387017,
    0.1936194413797031,
    0.9134149207965668,
    0.9719140814140141,
    0.7116445561732289,
    0.8720357680246629,
    0.2717827135360652,
    0.6649683870363727,
    0.9261442544579103,
    0.044729020745856274,
    0.8208245363224256,
    0.2369231670586005,
    0.8011131119296838,
    0.6424195402459892,
    0.8015446039715485,
    0.4009949802868912,
    0.4502160475125643,
    0.9242973251731486,
    0.07123370061253664,
    0.15620072680258767,
    0.9728324105112391,
    0.9132513066775165,
    0.14686805427228156,
    0.9734592170118911,
    0.2654554315187777,
    0.892106866269302,
    0.9047752275802584,
    0.02374579364467,
    0.009711634968144423,
    0.32699486130282873,
    0.9311784773555225,
    0.7913436883497563,
    0.38685097846012906,
    0.8580108138212066,
    0.30756183029200757,
    0.3474174026041087,
    0.1904783218387498,
    0.9595511044269075,
    0.8036306332035066,
    0.4624248054107556,
    0.2642765705883787,
    0.9659796005287031,
    0.3968199655598801,
    0.21070556446684796,
    0.4246563813836979,
    0.7191217102511182,
    0.770684798983071,
    0.10898555213649419,
    0.9459307675537619,
    0.6745707526164916,
    0.06249576206556828,
    0.8374364376590171,
    0.9719037368942256,
    0.8377476422704673,
    0.009784879294458815,
    0.4730889081790549,
    0.5891737739594198,
    0.8879986937026283,
    0.5027604854148191,
    0.07732381538240052,
    0.933525505036036,
    0.9517357978163641,
    0.4861622150139764,
    0.053442736483329756,
    0.8388906791646739,
    0.7416726764410203,
    0.9712340798009209,
    0.0073136945373993845,
    0.43549444952009686,
    0.28380239863237033,
    0.1077050956833312,
    0.7351346026730965,
    0.34121491637706414,
    0.03896913912115796,
    0.13362680572640495,
    0.8060002972277002,
    0.60587101798938,
    0.21505062517361473,
    0.6960422280017734,
    0.13040479371277058,
    0.6731877575019788,
    0.6550402554226945,
    0.0055257315325957235,
    0.5115154737487803,
    0.7263154319326705,
    0.7585337396231457,
    0.7057083392270682,
    0.8850456138709182,
    0.7562078404723139,
    0.9219899000274794,
    0.414807003582114,
    0.03416098666515466,
    0.1810034150072165,
    0.28778228138605877,
    0.041791613803324745,
    0.10815954185604848,
    0.5187791211329045,
    0.25248938313188884,
    0.2855351348958012,
    0.7414695266286413,
    0.854679634313597,
    0.8620398082340321,
    0.3706215974025555,
    0.709630073307115,
    0.8523046329128582,
    0.1509575400611467,
    0.20055366747212444,
    0.6479602930950665,
    0.26555035992042053,
    0.1926771538050761,
    0.36752022732257306,
    0.015983247172232207,
    0.4383192764607815,
    0.04726994221033787,
    0.2447102483994975,
    0.21754220086133835,
    0.32944523387845637,
    0.12538995648273654,
    0.47119641642445664,
    0.6878566433246712,
    0.338928923504192,
    0.9271932187857495,
    0.8597668788883609,
    0.3060151354329368,
    0.03890040352214308,
    0.7681917007692237,
    0.24001231290508984,
    0.3321610405787516,
    0.5793352263468351,
    0.998879676887163,
    0.29967756661199185,
    0.4685230029239946,
    0.6274508828630837,
    0.6833723791568794,
    0.21216618344980043,
    0.595321747502258,
    0.5441064429064965,
    0.6585798628076089,
    0.11499697503324902,
    0.12629451593687702,
    0.9755274904159574,
    0.8213015645453736,
    0.8275573150954998,
    0.9341044081009071,
    0.9606477600179142,
    0.39348753209993237,
    0.7540671762368577,
    0.6416200925555191,
    0.5598502694613712,
    0.6793483833215337,
    0.3194334511245228,
    0.8621787179353753,
    0.4070223282075782,
    0.14817868771045173,
    0.010980851013860038,
    0.6391893320658769,
    0.23163168896492548,
    0.9560655599081945,
    0.19500445741210803,
    0.3161794080516598,
    0.9841316837334273,
    0.5198546202904285,
    0.9220245989560005,
    0.781437673828669,
    0.11896569346946495,
    0.2159834369804282,
    0.3871775574072005,
    0.8809562507227594,
    0.3339882823452316,
    0.46308203855432406,
    0.48076548201932423,
    0.3247552471025198,
    0.7864852844832143,
    0.05482672756618123,
    0.22591016124709584,
    0.8250852070925885,
    0.6163417034041984,
    0.51182482978383,
    0.36950796376287187,
    0.13013957679285992,
    0.45678430920336455,
    0.9870944758123702,
    0.5950884747622851,
    0.5765793507415918,
    0.9901185849563509,
    0.8854033802553948,
    0.9991993182784583,
    0.9536333395616265,
    0.6674968517385982,
    0.30531219366045614,
    0.6281431780271564,
    0.3482098358137734,
    0.810769530791913,
    0.13730046107575478,
    0.46254633347853047,
    0.8407760221468864,
    0.4545120864552048,
    0.6010178494198809,
    0.09828293798468302,
    0.28510498345644497,
    0.954485228687717,
    0.6569395453324917,
    0.36493916872495114,
    0.5168811759658247,
    0.7748685781334842,
    0.7874703499468639,
    0.8279679389790622,
    0.28964267879754757,
    0.2383059387980907,
    0.6385084824992602,
    0.5272006473755549,
    0.5648867514980614,
    0.21461491820405376,
    0.31862412816540064,
    0.7520531805662839,
    0.3583232572055379,
    0.7574855506164321,
    0.046644662826228145,
    0.9508661797045698,
    0.20807303868888805,
    0.4782076330508558,
    0.9208852532322118,
    0.2534796826385556,
    0.22738427258263005,
    0.9856407059323568,
    0.9044301672206757,
    0.5322461972191177,
    0.06102194505896941,
    0.6046687082088471,
    0.25157818757670636,
    0.21401047590498223,
    0.9321430366726655,
    0.6194232422172982,
    0.4440395249769181,
    0.06265885858566367,
    0.37162139860301047,
    0.863983149761172,
    0.30267628262469704,
    0.3227942730688419,
    0.6068560668114126,
    0.2521406786205266,
    0.5569347628095851,
    0.7686825338221793,
    0.28667377665442717,
    0.4727508707947953,
    0.5762673366342947,
    0.36333139144527404,
    0.2236183745546042,
    0.11440186701749833,
    0.5654837920917276,
    0.937429217870874,
    0.01876620250744898,
    0.8656634618701456,
    0.9624731102430444,
]

# Global variables for random number generation
_rng = default_rng(1)
_stable_random: Optional[List[float]] = None
_stable_random_offset: int = 0


def _ensure_stable_random_initialized() -> None:
    """
    Ensure stable random sequence is properly initialized.

    This helper function ensures consistent initialization across
    all usage contexts to prevent intermittent failures.
    """
    global _stable_random
    if _stable_random is None:
        _stable_random = STABLE_RANDOM_SEQUENCE.copy()


def random_generator() -> Generator:
    """
    Get the current random number generator instance.

    Returns:
        numpy.random.Generator: The current random number generator
    """
    return _rng


def set_random_seed(seed: Optional[int] = None) -> None:
    """
    Set the seed of the random number generator.

    Args:
        seed: Seed for pseudo-random number generation, or None for truly
            random

    Raises:
        TypeError: If seed is not an int or None
    """
    if seed is not None and not isinstance(seed, int):
        raise TypeError("set_random_seed called with bad arg type")

    global _rng
    _rng = default_rng(seed)


def generate_stable_random(N: int, path: Optional[str] = None) -> List[float]:
    """
    Generate a sequence of random numbers for repeatability.

    This function returns N random numbers from the embedded stable sequence,
    maintaining compatibility with legacy code that expects file-based
    generation. For compatibility, the path parameter is accepted but ignored.

    Args:
        N: Number of random numbers to generate
        path: Legacy compatibility parameter (ignored)

    Returns:
        List of N random numbers from the stable sequence

    Raises:
        ValueError: If N is greater than available sequence length
    """
    if N > len(STABLE_RANDOM_SEQUENCE):
        raise ValueError(
            f"Requested {N} numbers but only "
            f"{len(STABLE_RANDOM_SEQUENCE)} available"
        )

    return STABLE_RANDOM_SEQUENCE[:N]


def stable_random(path: Optional[str] = None) -> float:
    """
    Return next random number in stable sequence.

    Args:
        path: Legacy compatibility parameter (ignored)

    Returns:
        Next random number from stable sequence

    Raises:
        StopIteration: When no more numbers available
        FileNotFoundError: For legacy compatibility when sequence
            unavailable
    """
    global _stable_random, _stable_random_offset  # noqa: F824

    # Ensure consistent initialization
    _ensure_stable_random_initialized()

    # After initialization, _stable_random is guaranteed to be a List[float]
    assert _stable_random is not None  # For MyPy type checking

    if not len(_stable_random):
        raise StopIteration("No more stable random numbers")

    pop_idx = _stable_random_offset % len(_stable_random)
    rando = _stable_random.pop(pop_idx)
    if len(_stable_random) and _stable_random_offset != 0:
        shift = round(rando * len(_stable_random)) + _stable_random_offset
        shift = shift % len(_stable_random)
        _stable_random = _stable_random[shift:] + _stable_random[:shift]

    return rando


def init_stable_random(offset: int = 0) -> None:
    """
    Set the stable random offset and clear cache.

    Sets the stable random offset so that different stable sequences can
    be generated from the same embedded data. Also clears the cache.

    Args:
        offset: Offset which generates different sequences
    """
    global _stable_random, _stable_random_offset
    _stable_random_offset = offset
    _stable_random = None  # Force re-initialization with new offset


class RandomIntegers:
    """
    Iterable producing repeatable sequences of random integers.

    Produces repeatable sequences of random integers for all integers
    in a range from 0 to specified n.

    Args:
        n: Maximum integer in sequence (exclusive upper bound)
        subsample: Unique integer id for each sequence
        path: Legacy compatibility parameter (ignored)

    Raises:
        TypeError: If bad argument type
        ValueError: If bad argument value
        FileNotFoundError: If stable random sequence unavailable
    """

    def __init__(self, n: int, subsample: int = 0, path: Optional[str] = None):
        if (
            not isinstance(n, int)
            or not isinstance(subsample, int)
            or (path is not None and not isinstance(path, str))
        ):
            raise TypeError("RandomIntegers() bad arg type")

        if n < 1 or n > 1000 or subsample < 0 or subsample > 999:
            raise ValueError("RandomIntegers() bad arg value")

        self._n = n
        self._subsample = subsample
        self._path = path  # Kept for compatibility but not used
        self._available: List[int] = [i for i in range(self._n)]

    def __iter__(self) -> "RandomIntegers":
        """
        Initialize the iterator.

        Returns:
            The initialized iterator
        """
        init_stable_random(offset=self._subsample)
        return self

    def __next__(self) -> int:
        """
        Return next integer in random sequence.

        Returns:
            Next integer in random sequence

        Raises:
            StopIteration: When all values have been returned
        """
        if not len(self._available):
            raise StopIteration()

        pop_idx = round(
            (len(self._available) * stable_random(path=self._path)) - 0.5
        )
        return self._available.pop(pop_idx)
