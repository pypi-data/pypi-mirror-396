"""first commit

Revision ID: 9aa9c639c541
Revises:
Create Date: 2024-08-29 21:19:25.441333

"""

from typing import Sequence, Union

import sqlalchemy as sa
from alembic import op
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = "9aa9c639c541"
down_revision: Union[str, None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # NOTE: Create any new schemas
    from basejump.core.database.crud.crud_utils import gen_client_id_suffixes
    from basejump.core.database.db_connect import ConnectDB, conn_params_noasync
    from sqlalchemy import text

    conn_db = ConnectDB(conn_params=conn_params_noasync)
    basejump_engine_noasync = conn_db.connect_db()
    suffixes = gen_client_id_suffixes(engine=basejump_engine_noasync, reverse=False)
    print("running suffixes:", suffixes)
    for suffix in suffixes:
        for schema in ["ai_model", "transaction", "account", "connect", "migration"]:
            with basejump_engine_noasync.begin() as conn:
                conn.execute(text(f"CREATE SCHEMA IF NOT EXISTS {schema}{suffix}"))
        # ### commands auto generated by Alembic - please adjust! ###
        op.create_table(
            "client",
            sa.Column("client_id", sa.Integer(), autoincrement=True, nullable=False),
            sa.Column("client_uuid", sa.UUID(), server_default=sa.text("gen_random_uuid()"), nullable=False),
            sa.Column("client_name", sa.String(), nullable=False),
            sa.Column("hashed_client_secret", sa.String(), nullable=False),
            sa.Column("timestamp", sa.TIMESTAMP(timezone=True), server_default=sa.text("now()"), nullable=False),
            sa.PrimaryKeyConstraint("client_id"),
            sa.UniqueConstraint("client_uuid"),
            schema=f"account{suffix}",
        )
        op.create_table(
            "subscription_plan",
            sa.Column("sub_plan_id", sa.Integer(), autoincrement=True, nullable=False),
            sa.Column("sub_plan_uuid", sa.UUID(), server_default=sa.text("gen_random_uuid()"), nullable=False),
            sa.Column("sub_plan_name", sa.String(), nullable=False),
            sa.Column("sub_plan_type", sa.String(), nullable=False),
            sa.Column("active", sa.Boolean(), nullable=False),
            sa.Column("time_interval", sa.String(), nullable=False),
            sa.Column("users", sa.Integer(), nullable=False),
            sa.Column("basejump_credits", sa.Integer(), nullable=False),
            sa.Column("credit_price", sa.Numeric(), nullable=False),
            sa.Column("credit_block_price", sa.Integer(), nullable=False),
            sa.Column("sub_price", sa.Integer(), nullable=False),
            sa.Column("plan_start", sa.TIMESTAMP(timezone=True), nullable=False),
            sa.Column("plan_end", sa.TIMESTAMP(timezone=True), nullable=True),
            sa.Column(
                "timestamp", sa.TIMESTAMP(timezone=True), server_default=sa.text("CURRENT_TIMESTAMP"), nullable=False
            ),
            sa.PrimaryKeyConstraint("sub_plan_id"),
            sa.UniqueConstraint("sub_plan_uuid"),
            schema=f"account{suffix}",
        )
        op.create_table(
            "prompt_history",
            sa.Column("prompt_id", sa.BIGINT(), autoincrement=True, nullable=False),
            sa.Column("prompt_uuid", sa.UUID(), server_default=sa.text("gen_random_uuid()"), nullable=False),
            sa.PrimaryKeyConstraint("prompt_id"),
            sa.UniqueConstraint("prompt_uuid"),
            schema=f"ai_model{suffix}",
        )
        op.create_table(
            "subscription",
            sa.Column("sub_id", sa.Integer(), autoincrement=True, nullable=False),
            sa.Column("sub_uuid", sa.UUID(), server_default=sa.text("gen_random_uuid()"), nullable=False),
            sa.Column("client_id", sa.Integer(), nullable=False),
            sa.Column("client_uuid", sa.UUID(), nullable=False),
            sa.Column("vendor_sub_id", sa.String(), nullable=False),
            sa.Column("vendor_sub_name", sa.String(), nullable=False),
            sa.Column("subbed", sa.Boolean(), server_default=sa.text("false"), nullable=True),
            sa.Column("sub_start_date", sa.TIMESTAMP(timezone=True), nullable=False),
            sa.Column("sub_cancel_date", sa.TIMESTAMP(timezone=True), nullable=True),
            sa.Column("sub_lockin_expiry", sa.TIMESTAMP(timezone=True), nullable=True),
            sa.Column("sub_plan_uuid", sa.UUID(), nullable=False),
            sa.Column("default_credit_overflow_block_ct", sa.Integer(), server_default="1", nullable=False),
            sa.Column("default_credit_overflow_threshold", sa.Integer(), server_default="0", nullable=False),
            sa.Column(
                "timestamp", sa.TIMESTAMP(timezone=True), server_default=sa.text("CURRENT_TIMESTAMP"), nullable=False
            ),
            sa.ForeignKeyConstraint(["client_id"], ["account.client.client_id"], ondelete="CASCADE"),
            sa.ForeignKeyConstraint(["client_uuid"], ["account.client.client_uuid"], ondelete="CASCADE"),
            sa.ForeignKeyConstraint(
                ["sub_plan_uuid"],
                ["account.subscription_plan.sub_plan_uuid"],
            ),
            sa.PrimaryKeyConstraint("sub_id"),
            schema=f"account{suffix}",
        )
        op.create_table(
            "team",
            sa.Column("team_id", sa.Integer(), autoincrement=True, nullable=False),
            sa.Column("team_uuid", sa.UUID(), server_default=sa.text("gen_random_uuid()"), nullable=False),
            sa.Column("team_name", sa.String(), nullable=False),
            sa.Column("client_id", sa.Integer(), nullable=False),
            sa.Column("timestamp", sa.TIMESTAMP(timezone=True), server_default=sa.text("now()"), nullable=False),
            sa.ForeignKeyConstraint(["client_id"], ["account.client.client_id"], ondelete="CASCADE"),
            sa.PrimaryKeyConstraint("team_id"),
            schema=f"account{suffix}",
        )
        op.create_table(
            "user",
            sa.Column("user_id", sa.Integer(), autoincrement=True, nullable=False),
            sa.Column("user_uuid", sa.UUID(), server_default=sa.text("gen_random_uuid()"), nullable=False),
            sa.Column("client_id", sa.Integer(), nullable=True),
            sa.Column("username", sa.String(), nullable=False),
            sa.Column("hashed_refresh_token", sa.String(), nullable=True),
            sa.Column("timestamp", sa.TIMESTAMP(timezone=True), server_default=sa.text("now()"), nullable=False),
            sa.ForeignKeyConstraint(["client_id"], ["account.client.client_id"], ondelete="CASCADE"),
            sa.PrimaryKeyConstraint("user_id"),
            schema=f"account{suffix}",
        )
        op.create_table(
            "connection",
            sa.Column("conn_id", sa.Integer(), autoincrement=True, nullable=False),
            sa.Column("conn_uuid", sa.UUID(), server_default=sa.text("gen_random_uuid()"), nullable=False),
            sa.Column("client_id", sa.Integer(), nullable=False),
            sa.Column("conn_type", sa.String(), nullable=False),
            sa.Column("data_source_desc", sa.String(), nullable=False),
            sa.ForeignKeyConstraint(["client_id"], ["account.client.client_id"], ondelete="CASCADE"),
            sa.PrimaryKeyConstraint("conn_id"),
            schema=f"connect{suffix}",
        )
        op.create_table(
            "deposit_history",
            sa.Column("deposit_id", sa.Integer(), autoincrement=True, nullable=False),
            sa.Column("deposit_uuid", sa.UUID(), server_default=sa.text("gen_random_uuid()"), nullable=False),
            sa.Column("client_id", sa.Integer(), nullable=False),
            sa.Column("sub_plan_id", sa.Integer(), nullable=True),
            sa.Column("transaction_item_description", sa.String(), nullable=False),
            sa.Column("transaction_item_cost", sa.Numeric(), nullable=False),
            sa.Column("transaction_description", sa.String(), nullable=False),
            sa.Column("transaction_type", sa.String(), nullable=False),
            sa.Column("transaction_total_cost", sa.Numeric(), nullable=False),
            sa.Column("deposited_credits", sa.Integer(), nullable=False),
            sa.Column(
                "timestamp", sa.TIMESTAMP(timezone=True), server_default=sa.text("CURRENT_TIMESTAMP"), nullable=False
            ),
            sa.ForeignKeyConstraint(["client_id"], ["account.client.client_id"], ondelete="CASCADE"),
            sa.ForeignKeyConstraint(
                ["sub_plan_id"],
                ["account.subscription_plan.sub_plan_id"],
            ),
            sa.PrimaryKeyConstraint("deposit_id"),
            sa.UniqueConstraint("deposit_uuid"),
            schema=f"transaction{suffix}",
        )
        op.create_table(
            "withdraw_history",
            sa.Column("withdrawal_id", sa.BIGINT(), autoincrement=True, nullable=False),
            sa.Column("withdrawal_uuid", sa.UUID(), server_default=sa.text("gen_random_uuid()"), nullable=False),
            sa.Column("prompt_id", sa.BIGINT(), nullable=False),
            sa.Column("client_id", sa.Integer(), nullable=False),
            sa.Column("sub_plan_id", sa.Integer(), nullable=True),
            sa.Column("transaction_amt", sa.Numeric(), nullable=False),
            sa.Column("transaction_description", sa.String(), nullable=False),
            sa.Column("withdrawn_credits", sa.Numeric(), nullable=False),
            sa.Column(
                "timestamp", sa.TIMESTAMP(timezone=True), server_default=sa.text("CURRENT_TIMESTAMP"), nullable=False
            ),
            sa.ForeignKeyConstraint(["client_id"], ["account.client.client_id"], ondelete="CASCADE"),
            sa.ForeignKeyConstraint(
                ["prompt_id"],
                [f"ai_model{suffix}.prompt_history.prompt_id"],
            ),
            sa.ForeignKeyConstraint(
                ["sub_plan_id"],
                ["account.subscription_plan.sub_plan_id"],
            ),
            sa.PrimaryKeyConstraint("withdrawal_id"),
            sa.UniqueConstraint("withdrawal_uuid"),
            schema=f"transaction{suffix}",
        )
        op.create_table(
            "user_team",
            sa.Column("user_id", sa.Integer(), nullable=False),
            sa.Column("team_id", sa.Integer(), nullable=False),
            sa.ForeignKeyConstraint(["team_id"], ["account.team.team_id"], ondelete="CASCADE"),
            sa.ForeignKeyConstraint(["user_id"], ["account.user.user_id"], ondelete="CASCADE"),
            sa.PrimaryKeyConstraint("user_id", "team_id"),
            schema=f"account{suffix}",
        )
        op.create_table(
            "result_history",
            sa.Column("result_id", sa.BIGINT(), autoincrement=True, nullable=False),
            sa.Column("result_uuid", sa.UUID(), server_default=sa.text("gen_random_uuid()"), nullable=False),
            sa.Column("result_conn_id", sa.Integer(), nullable=False),
            sa.Column("result_exp_time", sa.TIMESTAMP(timezone=True), nullable=False),
            sa.Column("result_deleted", sa.Boolean(), server_default=sa.text("false"), nullable=False),
            sa.Column("result_file_path", sa.String(), nullable=False),
            sa.Column("row_num_total", sa.Integer(), nullable=False),
            sa.Column("preview_file_path", sa.String(), nullable=False),
            sa.Column("row_num_preview", sa.Integer(), nullable=False),
            sa.Column("result_type", sa.String(), nullable=False),
            sa.Column("title", sa.String(), nullable=False),
            sa.Column("description", sa.String(), nullable=False),
            sa.Column("author_user_uuid", sa.UUID(), nullable=False),
            sa.Column("author_team_uuid", sa.UUID(), nullable=True),
            sa.Column("share_w_team", sa.Boolean(), server_default=sa.text("false"), nullable=False),
            sa.Column("saved_result", sa.Boolean(), server_default=sa.text("false"), nullable=False),
            sa.Column("refresh_result", sa.Boolean(), server_default=sa.text("false"), nullable=True),
            sa.Column("sql_query", sa.String(), nullable=False),
            sa.Column(
                "timestamp", sa.TIMESTAMP(timezone=True), server_default=sa.text("CURRENT_TIMESTAMP"), nullable=False
            ),
            sa.ForeignKeyConstraint(["result_conn_id"], [f"connect{suffix}.connection.conn_id"], ondelete="CASCADE"),
            sa.PrimaryKeyConstraint("result_id"),
            schema=f"ai_model{suffix}",
        )
        op.create_table(
            "token_count",
            sa.Column("token_id", sa.BIGINT(), autoincrement=True, nullable=False),
            sa.Column("token_uuid", sa.UUID(), server_default=sa.text("gen_random_uuid()"), nullable=False),
            sa.Column("prompt_id", sa.BIGINT(), nullable=False),
            sa.Column("prompt", sa.String(), nullable=False),
            sa.Column("user_id", sa.Integer(), nullable=False),
            sa.Column("team_id", sa.Integer(), nullable=False),
            sa.Column("client_id", sa.Integer(), nullable=False),
            sa.Column("ai_model_provider", sa.String(), nullable=False),
            sa.Column("ai_model_nm", sa.String(), nullable=False),
            sa.Column("cost_per_1k_tokens_input", sa.Numeric(), nullable=False),
            sa.Column("cost_per_1k_tokens_output", sa.Numeric(), nullable=False),
            sa.Column("total_embedding_token_count", sa.Numeric(), nullable=False),
            sa.Column("prompt_llm_token_count", sa.Numeric(), nullable=False),
            sa.Column("completion_llm_token_count", sa.Numeric(), nullable=False),
            sa.Column("total_llm_token_count", sa.Numeric(), nullable=False),
            sa.Column(
                "timestamp", sa.TIMESTAMP(timezone=True), server_default=sa.text("CURRENT_TIMESTAMP"), nullable=False
            ),
            sa.ForeignKeyConstraint(["client_id"], ["account.client.client_id"], ondelete="CASCADE"),
            sa.ForeignKeyConstraint(
                ["prompt_id"],
                [f"ai_model{suffix}.prompt_history.prompt_id"],
            ),
            sa.ForeignKeyConstraint(
                ["team_id"],
                ["account.team.team_id"],
            ),
            sa.ForeignKeyConstraint(
                ["user_id"],
                ["account.user.user_id"],
            ),
            sa.PrimaryKeyConstraint("token_id"),
            schema=f"ai_model{suffix}",
        )
        op.create_table(
            "user_chat_id",
            sa.Column("chat_id", sa.Integer(), autoincrement=True, nullable=False),
            sa.Column("chat_uuid", sa.UUID(), server_default=sa.text("gen_random_uuid()"), nullable=False),
            sa.Column("user_id", sa.Integer(), nullable=False),
            sa.Column("team_id", sa.Integer(), nullable=False),
            sa.Column("client_id", sa.Integer(), nullable=False),
            sa.Column("chat_name", sa.String(), nullable=True),
            sa.Column("chat_description", sa.String(), nullable=True),
            sa.Column(
                "timestamp", sa.TIMESTAMP(timezone=True), server_default=sa.text("CURRENT_TIMESTAMP"), nullable=False
            ),
            sa.Column("last_updt_date", sa.TIMESTAMP(timezone=True), nullable=True),
            sa.ForeignKeyConstraint(["client_id"], ["account.client.client_id"], ondelete="CASCADE"),
            sa.ForeignKeyConstraint(["team_id"], ["account.team.team_id"], ondelete="CASCADE"),
            sa.ForeignKeyConstraint(["user_id"], ["account.user.user_id"], ondelete="CASCADE"),
            sa.PrimaryKeyConstraint("chat_id"),
            schema=f"ai_model{suffix}",
        )
        op.create_table(
            "team_connection",
            sa.Column("conn_id", sa.Integer(), nullable=False),
            sa.Column("team_id", sa.Integer(), nullable=False),
            sa.ForeignKeyConstraint(["conn_id"], [f"connect{suffix}.connection.conn_id"], ondelete="CASCADE"),
            sa.ForeignKeyConstraint(["team_id"], ["account.team.team_id"], ondelete="CASCADE"),
            sa.PrimaryKeyConstraint("conn_id", "team_id"),
            schema=f"connect{suffix}",
        )
        op.create_table(
            "vector_db",
            sa.Column("vector_conn_id", sa.Integer(), nullable=False),
            sa.Column("vector_database_vendor", sa.String(), nullable=False),
            sa.Column("vector_datasource_type", sa.String(), nullable=False),
            sa.Column("api_key", sa.String(), nullable=True),
            sa.Column("environment", sa.String(), nullable=True),
            sa.Column("index_name", sa.String(), nullable=False),
            sa.Column("vector_metadata", postgresql.JSONB(astext_type=sa.Text()), nullable=True),
            sa.Column("timestamp", sa.TIMESTAMP(timezone=True), server_default=sa.text("now()"), nullable=False),
            sa.ForeignKeyConstraint(["vector_conn_id"], [f"connect{suffix}.connection.conn_id"], ondelete="CASCADE"),
            sa.PrimaryKeyConstraint("vector_conn_id"),
            schema=f"connect{suffix}",
        )
        op.create_table(
            "basejump_credit_ledger",
            sa.Column("credit_id", sa.BIGINT(), autoincrement=True, nullable=False),
            sa.Column("credit_uuid", sa.UUID(), server_default=sa.text("gen_random_uuid()"), nullable=False),
            sa.Column("client_id", sa.Integer(), nullable=False),
            sa.Column("sub_id", sa.Integer(), nullable=False),
            sa.Column("withdrawal_id", sa.BIGINT(), nullable=True),
            sa.Column("deposit_id", sa.Integer(), nullable=True),
            sa.Column("allotted_credit_bal", sa.Numeric(), nullable=False),
            sa.Column("purchased_credit_bal", sa.Numeric(), server_default="0", nullable=False),
            sa.Column(
                "timestamp", sa.TIMESTAMP(timezone=True), server_default=sa.text("CURRENT_TIMESTAMP"), nullable=False
            ),
            sa.ForeignKeyConstraint(["client_id"], ["account.client.client_id"], ondelete="CASCADE"),
            sa.ForeignKeyConstraint(
                ["deposit_id"], [f"transaction{suffix}.deposit_history.deposit_id"], ondelete="CASCADE"
            ),
            sa.ForeignKeyConstraint(["sub_id"], ["account.subscription.sub_id"], ondelete="CASCADE"),
            sa.ForeignKeyConstraint(
                ["withdrawal_id"],
                [f"transaction{suffix}.withdraw_history.withdrawal_id"],
            ),
            sa.PrimaryKeyConstraint("credit_id"),
            schema=f"transaction{suffix}",
        )
        op.create_table(
            "chat_history",
            sa.Column("msg_id", sa.BIGINT(), autoincrement=True, nullable=False),
            sa.Column("msg_uuid", sa.UUID(), server_default=sa.text("gen_random_uuid()"), nullable=False),
            sa.Column("parent_msg_uuid", sa.UUID(), nullable=False),
            sa.Column("result_uuid", sa.UUID(), nullable=True),
            sa.Column("chat_id", sa.Integer(), nullable=False),
            sa.Column("prompt_uuid", sa.UUID(), nullable=False),
            sa.Column("initial_prompt", sa.String(), nullable=False),
            sa.Column(
                "prompt_time", sa.TIMESTAMP(timezone=True), server_default=sa.text("CURRENT_TIMESTAMP"), nullable=False
            ),
            sa.Column("content", sa.String(), nullable=True),
            sa.Column("internal_content", sa.String(), nullable=True),
            sa.Column("role", sa.String(), nullable=True),
            sa.Column("msg_type", sa.String(), nullable=True),
            sa.Column("sql_query", sa.String(), nullable=True),
            sa.Column("result_type", sa.String(), nullable=True),
            sa.Column(
                "timestamp", sa.TIMESTAMP(timezone=True), server_default=sa.text("CURRENT_TIMESTAMP"), nullable=False
            ),
            sa.ForeignKeyConstraint(["chat_id"], [f"ai_model{suffix}.user_chat_id.chat_id"], ondelete="CASCADE"),
            sa.ForeignKeyConstraint(
                ["prompt_uuid"], [f"ai_model{suffix}.prompt_history.prompt_uuid"], ondelete="CASCADE"
            ),
            sa.PrimaryKeyConstraint("msg_id"),
            sa.UniqueConstraint("msg_uuid"),
            schema=f"ai_model{suffix}",
        )
        op.create_table(
            "database",
            sa.Column("db_id", sa.Integer(), autoincrement=True, nullable=False),
            sa.Column("db_uuid", sa.UUID(), server_default=sa.text("gen_random_uuid()"), nullable=False),
            sa.Column("vector_conn_id", sa.Integer(), nullable=False),
            sa.Column("database_type", sa.LargeBinary(), nullable=False),
            sa.Column("drivername", sa.LargeBinary(), nullable=False),
            sa.Column("host", sa.LargeBinary(), nullable=False),
            sa.Column("database_name", sa.LargeBinary(), nullable=False),
            sa.Column("port", sa.LargeBinary(), nullable=False),
            sa.Column("database_desc", sa.LargeBinary(), nullable=False),
            sa.Column("query", sa.LargeBinary(), nullable=True),
            sa.Column("schemas", sa.LargeBinary(), nullable=True),
            sa.Column("include_non_schemas", sa.LargeBinary(), nullable=True),
            sa.Column("timestamp", sa.TIMESTAMP(timezone=True), server_default=sa.text("now()"), nullable=False),
            sa.ForeignKeyConstraint(
                ["vector_conn_id"], [f"connect{suffix}.vector_db.vector_conn_id"], ondelete="CASCADE"
            ),
            sa.PrimaryKeyConstraint("db_id"),
            schema=f"connect{suffix}",
        )
        op.create_table(
            "database_tables",
            sa.Column("sql_tbl_id", sa.Integer(), autoincrement=True, nullable=False),
            sa.Column("sql_tbl_uuid", sa.UUID(), server_default=sa.text("gen_random_uuid()"), nullable=False),
            sa.Column("db_id", sa.Integer(), nullable=False),
            sa.Column("table_name", sa.String(), nullable=False),
            sa.Column("context", sa.String(), nullable=True),
            sa.Column("timestamp", sa.TIMESTAMP(timezone=True), server_default=sa.text("now()"), nullable=False),
            sa.ForeignKeyConstraint(["db_id"], [f"connect{suffix}.database.db_id"], ondelete="CASCADE"),
            sa.PrimaryKeyConstraint("sql_tbl_id"),
            schema=f"connect{suffix}",
        )
        op.create_table(
            "db_conn",
            sa.Column("conn_id", sa.Integer(), nullable=False),
            sa.Column("db_id", sa.Integer(), nullable=False),
            sa.Column("username", sa.LargeBinary(), nullable=False),
            sa.Column("password", sa.LargeBinary(), nullable=False),
            sa.Column("timestamp", sa.TIMESTAMP(timezone=True), server_default=sa.text("now()"), nullable=False),
            sa.ForeignKeyConstraint(["conn_id"], [f"connect{suffix}.connection.conn_id"], ondelete="CASCADE"),
            sa.ForeignKeyConstraint(["db_id"], [f"connect{suffix}.database.db_id"], ondelete="CASCADE"),
            sa.PrimaryKeyConstraint("conn_id"),
            schema=f"connect{suffix}",
        )
        # ### end Alembic commands ###


def downgrade() -> None:
    # NOTE: Create any new schemas
    from basejump.core.database.setup_db.db_connect import (
        ConnectDB,
        conn_params_noasync,
    )
    from sqlalchemy import text

    conn_db = ConnectDB(conn_params=conn_params_noasync)
    basejump_engine_noasync = conn_db.connect_db()
    for suffix in ["0", ""]:
        for schema in ["ai_model", "transaction", "account", "connect", "migration"]:
            with basejump_engine_noasync.begin() as conn:
                conn.execute(text(f"CREATE SCHEMA IF NOT EXISTS {schema}{suffix}"))
        # ### commands auto generated by Alembic - please adjust! ###
        op.drop_table("db_conn", schema=f"connect{suffix}")
        op.drop_table("database_tables", schema=f"connect{suffix}")
        op.drop_table("database", schema=f"connect{suffix}")
        op.drop_table("chat_history", schema=f"ai_model{suffix}")
        op.drop_table("basejump_credit_ledger", schema=f"transaction{suffix}")
        op.drop_table("vector_db", schema=f"connect{suffix}")
        op.drop_table("team_connection", schema=f"connect{suffix}")
        op.drop_table("user_chat_id", schema=f"ai_model{suffix}")
        op.drop_table("token_count", schema=f"ai_model{suffix}")
        op.drop_table("result_history", schema=f"ai_model{suffix}")
        op.drop_table("user_team", schema=f"account{suffix}")
        op.drop_table("withdraw_history", schema=f"transaction{suffix}")
        op.drop_table("deposit_history", schema=f"transaction{suffix}")
        op.drop_table("connection", schema=f"connect{suffix}")
        op.drop_table("user", schema=f"account{suffix}")
        op.drop_table("team", schema=f"account{suffix}")
        op.drop_table("subscription", schema=f"account{suffix}")
        op.drop_table("prompt_history", schema=f"ai_model{suffix}")
        op.drop_table("subscription_plan", schema=f"account{suffix}")
        op.drop_table("client", schema=f"account{suffix}")
        # ### end Alembic commands ###
