"""Updating user roles

Revision ID: 26976d90c6b2
Revises: e4fd53818826
Create Date: 2025-01-13 15:23:05.797751

"""

from typing import Sequence, Union

import sqlalchemy as sa
from alembic import op

# revision identifiers, used by Alembic.
revision: str = "26976d90c6b2"
down_revision: Union[str, None] = "e4fd53818826"
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.execute("ALTER TYPE userroles ADD VALUE 'OWNER';")
    op.execute("CREATE TYPE alluserroles AS ENUM ('INTERNAL', 'OWNER', 'ADMIN', 'MEMBER');")
    op.add_column(
        "client_secret_assoc",
        sa.Column("role", sa.Enum("OWNER", "ADMIN", "MEMBER", "INTERNAL", name="alluserroles"), nullable=True),
        schema="account",
    )
    # NOTE: READ THIS - Make sure to go back and update client secrets to INTERNAL if you are just using the secrets
    # internally, but be extremely careful you aren't accidentally promoting the wrong accounts
    op.execute("UPDATE account.client_secret_assoc SET role = 'MEMBER'")

    op.alter_column("client_secret_assoc", "role", nullable=False, schema="account")

    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_column("client_secret_assoc", "role", schema="account")
    # ### end Alembic commands ###
