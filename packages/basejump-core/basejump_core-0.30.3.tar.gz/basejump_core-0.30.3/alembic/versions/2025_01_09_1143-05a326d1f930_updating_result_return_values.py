"""updating result return values

Revision ID: 05a326d1f930
Revises: 30e8f6df426d
Create Date: 2025-01-09 11:43:10.473286

"""

from typing import Sequence, Union

import sqlalchemy as sa
from alembic import op

# revision identifiers, used by Alembic.
revision: str = "05a326d1f930"
down_revision: Union[str, None] = "30e8f6df426d"
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column("result_history", sa.Column("subtitle", sa.String(), nullable=True), schema="ai_model")
    op.execute("UPDATE ai_model.result_history SET subtitle = description")
    op.alter_column("result_history", "subtitle", nullable=False, schema="ai_model")
    op.add_column("result_history", sa.Column("metric_value", sa.String(), nullable=True), schema="ai_model")
    op.add_column("result_history", sa.Column("metric_value_formatted", sa.String(), nullable=True), schema="ai_model")
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_foreign_key(
        "user_tokens_client_id_token_id_fkey",
        "user_tokens",
        "token_count_pclient0",
        ["client_id", "token_id"],
        ["client_id", "token_id"],
        source_schema="ai_model",
        referent_schema="ai_model",
        ondelete="CASCADE",
    )
    op.drop_column("token_count", "cost_per_1k_tokens_output", schema="ai_model")
    op.drop_column("token_count", "cost_per_1k_tokens_input", schema="ai_model")
    op.drop_column("result_history", "metric_value_formatted", schema="ai_model")
    op.drop_column("result_history", "metric_value", schema="ai_model")
    op.drop_column("result_history", "subtitle", schema="ai_model")
    # ### end Alembic commands ###
