"""changing visual fields to required

Revision ID: c82a88214e00
Revises: 624182466702
Create Date: 2025-01-31 17:50:34.046149

"""

from typing import Sequence, Union

import sqlalchemy as sa
from alembic import op
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = "c82a88214e00"
down_revision: Union[str, None] = "624182466702"
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column(
        "visual_result_history",
        "visual_json",
        existing_type=postgresql.JSONB(astext_type=sa.Text()),
        nullable=False,
        schema="ai_model",
    )
    op.alter_column(
        "visual_result_history", "visual_explanation", existing_type=sa.VARCHAR(), nullable=False, schema="ai_model"
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column(
        "visual_result_history", "visual_explanation", existing_type=sa.VARCHAR(), nullable=True, schema="ai_model"
    )
    op.alter_column(
        "visual_result_history",
        "visual_json",
        existing_type=postgresql.JSONB(astext_type=sa.Text()),
        nullable=True,
        schema="ai_model",
    )
    op.create_foreign_key(
        "user_tokens_client_id_token_id_fkey",
        "user_tokens",
        "token_count_pclient0",
        ["client_id", "token_id"],
        ["client_id", "token_id"],
        source_schema="ai_model",
        referent_schema="ai_model",
        ondelete="CASCADE",
    )
    op.drop_column("token_count", "cost_per_1k_tokens_output", schema="ai_model")
    op.drop_column("token_count", "cost_per_1k_tokens_input", schema="ai_model")
    op.drop_constraint(None, "saved_result_history", schema="ai_model", type_="foreignkey")
    op.create_foreign_key(
        "saved_result_history_client_id_visual_result_id_fkey",
        "saved_result_history",
        "visual_result_history",
        ["client_id", "visual_result_id"],
        ["client_id", "visual_result_id"],
        source_schema="ai_model",
        referent_schema="ai_model",
        ondelete="CASCADE",
    )
    # ### end Alembic commands ###
