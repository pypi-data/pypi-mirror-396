version: "1.0"
description: "Quality gates for SQLSpec development"

implementation_gates:
  - name: tests_pass
    command: "make test"
    fallback: "uv run pytest -n 2 --dist=loadgroup tests"
    required: true
    description: "All tests must pass"

  - name: lint_clean
    command: "make lint"
    fallback: "uv run ruff check ."
    required: true
    description: "Zero linting errors"

  - name: type_check
    command: "make mypy"
    fallback: "uv run dmypy run sqlspec"
    required: true
    description: "Type checking must pass"

code_standards:
  - pattern: "from __future__ import annotations"
    severity: error
    message: "Use stringified type hints instead"
    reference: "AGENTS.md#type-annotations"

  - pattern: "Optional\\["
    severity: error
    message: "Use T | None (PEP 604)"
    reference: "AGENTS.md#type-annotations"

  - pattern: "class Test"
    scope: "tests/"
    severity: warning
    message: "Use function-based tests"
    reference: "AGENTS.md#testing"

  - pattern: "hasattr\\("
    severity: error
    message: "Use type guards from sqlspec.utils.type_guards"
    reference: "AGENTS.md#code-style"

  - pattern: "getattr\\("
    severity: warning
    message: "Consider using type guards or explicit attribute access"
    reference: "AGENTS.md#code-style"

coverage_targets:
  adapters: 80
  core: 90
  overall: 85

documentation_gates:
  - name: sphinx_build
    command: "make docs"
    required: true
    description: "Documentation must build without errors"

  - name: docstring_coverage
    required: false
    description: "Public APIs should have docstrings"
