"use strict";(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[422],{630422:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ue});var r=n(273517),i=n.n(r),a=n(811668),o=n(269843),l=n.n(o),u=n(185015),s=n.n(u),c=n(858156),m=n.n(c),p=n(668414),g=n(548975),d=n(995531),f=n(132672),y=n(267767),v=n(8117),b=n(836970),h=n(8571),E=n(890559),w=n(883832),S=n(327229);function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function j(e,t,n){return(t=function(e){var t=function(e){if("object"!=A(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=A(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==A(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var I={Point:"Point",LineString:"LineString",Polygon:"Polygon",String:"string",Integer:"integer",Float:"float",Date:"date"},P={None:"none",Range:"range",Options:"options"},R={id:"geom",name:"geom",restrictionsType:P.None,nillable:!1},M={title:"",geometry_type:I.Point,attributes:[]},N=function(e){return""===e?null:parseFloat(e)},T=function(e,t){var n;return"attribute-".concat(null!==(n=null==e?void 0:e.id)&&void 0!==n?n:"","-").concat(t)},x={type:"object",properties:{title:{type:"string",minLength:1},geometry_type:{type:"string",enum:[I.Point,I.LineString,I.Polygon]},attributes:{type:"array",items:{type:"object",properties:{name:{type:"string",minLength:1},type:{type:"string",enum:[I.String,I.Integer,I.Float,I.Date]},nillable:{type:"boolean"}},required:["name","type"],allOf:[{if:{properties:{type:{const:I.Integer}}},then:{properties:{restrictionsType:{type:"string",enum:[P.None,P.Range,P.Options]},restrictionsOptions:{type:"array",items:{type:"object",properties:{id:{type:"string"},value:{type:"integer"}}}}},if:{properties:{restrictionsType:{const:P.Range}}},then:{properties:{restrictionsRangeMin:{type:["integer","null"]},restrictionsRangeMax:{type:["integer","null"]}},anyOf:[{properties:{restrictionsRangeMin:{type:"integer"}}},{properties:{restrictionsRangeMax:{type:"integer"}}}]}}},{if:{properties:{type:{const:I.Float}}},then:{properties:{restrictionsType:{type:"string",enum:[P.None,P.Range,P.Options]},restrictionsOptions:{type:"array",items:{type:"object",properties:{id:{type:"string"},value:{type:"number"}}}}},if:{properties:{restrictionsType:{const:P.Range}}},then:{properties:{restrictionsRangeMin:{type:["number","null"]},restrictionsRangeMax:{type:["number","null"]}},anyOf:[{properties:{restrictionsRangeMin:{type:"number"}}},{properties:{restrictionsRangeMax:{type:"number"}}}]}}},{if:{properties:{type:{const:I.String}}},then:{properties:{restrictionsType:{type:"string",enum:[P.None,P.Options]},restrictionsOptions:{type:"array",items:{type:"object",properties:{id:{type:"string"},value:{type:"string",minLength:1}}}}}}},{if:{properties:{type:{const:I.Date}}},then:{properties:{restrictionsType:{type:"string",enum:[P.None]}}}}]}}},required:["title","geometry_type"]},C=function(e,t){var n=null==t?void 0:t.find(function(t){return t.instancePath===e});if(null!=n&&n.message){if(n.message.includes("must NOT have fewer than 1 characters"))return"gnviewer.minValueRequired";if(n.message.includes("must be string"))return"gnviewer.stringValueRequired";if(n.message.includes("must be integer"))return"gnviewer.integerValueRequired";if(n.message.includes("must be number"))return"gnviewer.numberValueRequired"}return null==n?void 0:n.message},k=j(j(j({},I.String,I.String),I.Integer,I.Integer),"number",I.Float),D=n(605556),_=n.n(D),F=n(628017);const q=function(e){var t=e.errors,n=void 0===t?{}:t,r=e.data,a=void 0===r?{}:r,o=e.handleOnChange,l=void 0===o?function(){}:o,u=e.disabled;return i().createElement(f.A,{centerChildrenVertically:!0,wrap:!0,gap:"sm"},i().createElement(f.A.Fill,{flexBox:!0,component:v.gE,validationState:null!=n&&n.restrictionsRangeMin?"error":void 0,controlId:T(a,"restrictions-min"),centerChildrenVertically:!0,gap:"sm"},i().createElement(v.mq,null,i().createElement(h.A,{msgId:"gnviewer.min"})),i().createElement(v.MJ,{type:"number",value:null==a?void 0:a.restrictionsRangeMin,disabled:u,onChange:function(e){return l({restrictionsRangeMin:N(e.target.value)})}}),null!=n&&n.restrictionsRangeMin?i().createElement(v.f0,null,i().createElement(h.A,{msgId:n.restrictionsRangeMin})):null),i().createElement(f.A.Fill,{flexBox:!0,component:v.gE,validationState:null!=n&&n.restrictionsRangeMax?"error":void 0,controlId:T(a,"restrictions-max"),gap:"sm",centerChildrenVertically:!0},i().createElement(v.mq,null,i().createElement(h.A,{msgId:"gnviewer.max"})),i().createElement(v.MJ,{type:"number",value:null==a?void 0:a.restrictionsRangeMax,disabled:u,onChange:function(e){return l({restrictionsRangeMax:N(e.target.value)})}}),null!=n&&n.restrictionsRangeMax?i().createElement(v.f0,null,i().createElement(h.A,{msgId:n.restrictionsRangeMax})):null))};function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach(function(t){z(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function z(e,t,n){return(t=function(e){var t=function(e){if("object"!=B(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=B(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==B(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const U=function(e){var t=e.index,n=e.data,r=void 0===n?{}:n,a=e.handleOnChange,o=void 0===a?function(){}:a,l=e.getErrorByPath,u=void 0===l?function(){}:l,s=e.disabled;return i().createElement(f.A,{column:!0,wrap:!0,gap:"sm"},i().createElement(f.A,{gap:"sm",column:!0,component:"ul"},((null==r?void 0:r.restrictionsOptions)||[]).map(function(e,n){var a={value:u("/attributes/".concat(t,"/restrictionsOptions/").concat(n,"/value"))};return i().createElement(f.A,{component:"li",gap:"sm",key:e.id},i().createElement(y.A,{style:{paddingTop:6}},"â—"),i().createElement(f.A.Fill,{component:v.gE,key:e.id,validationState:null!=a&&a.value?"error":void 0,controlId:T(r,"option-".concat(e.id))},i().createElement(v.MJ,{type:(null==r?void 0:r.type)===I.String?"text":"number",value:e.value,disabled:s,onChange:function(t){return o({restrictionsOptions:((null==r?void 0:r.restrictionsOptions)||[]).map(function(n){return n.id!==e.id?n:L(L({},e),{},{value:(null==r?void 0:r.type)===I.String?t.target.value:N(t.target.value)})})})}}),null!=a&&a.value?i().createElement(v.f0,null,i().createElement(h.A,{msgId:a.value})):null),i().createElement(b.A,{square:!0,onClick:function(){return o({restrictionsOptions:((null==r?void 0:r.restrictionsOptions)||[]).filter(function(t){return t.id!==e.id})})},disabled:s},i().createElement(v.e6,{glyph:"trash"})))}),i().createElement("div",null,i().createElement(b.A,{size:"sm",onClick:function(){return o({restrictionsOptions:[].concat((e=(null==r?void 0:r.restrictionsOptions)||[],function(e){if(Array.isArray(e))return J(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[{id:(0,p.v4)(),value:""}])});var e},disabled:s},i().createElement(v.e6,{glyph:"plus"})," ",i().createElement(h.A,{msgId:"gnviewer.addOption"})))))};function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach(function(t){W(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function W(e,t,n){return(t=function(e){var t=function(e){if("object"!=$(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=$(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==$(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var K=function(e,t){var n,r=e.data,a=e.geometryAttribute,o=e.disabled,l=e.tools,u=e.onChange,s=e.getErrorByPath,c=void 0===s?function(){}:s,m=e.index,p={name:c("/attributes/".concat(m,"/name")),restrictionsType:c("/attributes/".concat(m,"/restrictionsType")),restrictionsRangeMin:c("/attributes/".concat(m,"/restrictionsRangeMin")),restrictionsRangeMax:c("/attributes/".concat(m,"/restrictionsRangeMax"))},g=a?[{value:I.Point,labelId:"gnviewer.points"},{value:I.LineString,labelId:"gnviewer.lines"},{value:I.Polygon,labelId:"gnviewer.polygons"}]:[{value:I.String,labelId:"gnviewer.string"},{value:I.Integer,labelId:"gnviewer.integer"},{value:I.Float,labelId:"gnviewer.float"},{value:I.Date,labelId:"gnviewer.date"}],d=[I.Integer,I.Float,I.String].includes(null==r?void 0:r.type)?[{value:P.None,labelId:"gnviewer.none"}].concat(function(e){if(Array.isArray(e))return X(e)}(n=(null==r?void 0:r.type)!==I.String?[{value:P.Range,labelId:"gnviewer.range"}]:[])||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return X(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(e,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[{value:P.Options,labelId:"gnviewer.options"}]):[{value:P.None,labelId:"gnviewer.none"}];function y(e){u(H(H({},r),e))}return i().createElement("tr",{className:"gn-dataset-attribute"},i().createElement("td",{className:"gn-attribute-name"},i().createElement(v.gE,{controlId:T(r,"name"),validationState:null!=p&&p.name?"error":void 0},i().createElement(v.MJ,{type:"text",value:(null==r?void 0:r.name)||"",disabled:!!a||o,onChange:function(e){return y({name:e.target.value})}}),null!=p&&p.name?i().createElement(v.f0,null,i().createElement(h.A,{msgId:p.name})):null)),i().createElement("td",{className:"gn-attribute-type"},i().createElement(v.gE,{controlId:T(r,"type")},i().createElement(v.MJ,{value:(null==r?void 0:r.type)||"",componentClass:"select",placeholder:"select",onChange:function(e){var t=e.target.value;t!==(null==r?void 0:r.type)?u(H(H({},r),{},{type:t,restrictionsType:P.None,restrictionsRangeMin:null,restrictionsRangeMax:null,restrictionsOptions:[]})):y({type:t})},disabled:o},g.map(function(e){var n=e.labelId,r=e.value;return i().createElement("option",{key:r,value:r},(0,F.kA)(t.messages,n))})))),i().createElement("td",{className:"gn-attribute-nillable"},i().createElement(v.gE,{controlId:T(r,"nillable")},i().createElement(v.Sc,{style:{paddingTop:6},checked:!(null==r||!r.nillable),disabled:!!a||o,onChange:function(e){return y({nillable:e.target.checked})}}))),i().createElement("td",null,i().createElement(f.A,{column:!0,gap:"sm"},i().createElement(v.gE,{controlId:T(r,"restrictions"),validationState:null!=p&&p.restrictionsType?"error":void 0},i().createElement(v.MJ,{value:null==r?void 0:r.restrictionsType,componentClass:"select",placeholder:"select",disabled:!!a||o,onChange:function(e){return y({restrictionsType:e.target.value})}},d.map(function(e){var n=e.labelId,r=e.value;return i().createElement("option",{key:r,value:r},(0,F.kA)(t.messages,n))})),null!=p&&p.restrictionsType?i().createElement(v.f0,null,p.restrictionsType):null),(null==r?void 0:r.restrictionsType)===P.Range?i().createElement(q,{errors:p,data:r,handleOnChange:y,disabled:o}):null,(null==r?void 0:r.restrictionsType)===P.Options?i().createElement(U,{index:m,data:r,handleOnChange:y,getErrorByPath:c,disabled:o}):null)),i().createElement("td",{className:"gn-attribute-tools"},l))};K.contextTypes={messages:_().object};const Q=K;var Y=n(794689),Z=n(82106);function ee(e){return ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ee(e)}function te(e){return function(e){if(Array.isArray(e))return le(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||oe(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(n),!0).forEach(function(t){ie(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ie(e,t,n){return(t=function(e){var t=function(e){if("object"!=ee(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ee(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ee(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ae(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,l=[],u=!0,s=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){s=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(s)throw i}}return l}}(e,t)||oe(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oe(e,t){if(e){if("string"==typeof e)return le(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?le(e,t):void 0}}function le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const ue=(0,a.connect)(null,{onError:w.z3})(function(e){var t=e.onError,n=void 0===t?function(){}:t,a=e.refreshTime,o=void 0===a?3e3:a,u=(0,r.useRef)(),c=ae((0,r.useState)(re({},M)),2),w=c[0],j=c[1],T=ae((0,r.useState)(!1),2),D=T[0],_=T[1],F=ae((0,r.useState)([]),2),q=F[0],B=F[1],J=ae((0,r.useState)([]),2),V=J[0],L=J[1],z=ae((0,r.useState)(null),2),U=z[0],$=z[1],G=(0,r.useRef)(null),H=(g.Ay.rawValidation(x,w)||{}).errors,W=void 0===H?[]:H,X=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[];if(!Array.isArray(e.attributes))return t;var n=e.attributes.reduce(function(e,t){var n,r=null==t||null===(n=t.name)||void 0===n?void 0:n.trim();return r&&(e[r]=(e[r]||0)+1),e},{});return e.attributes.forEach(function(e,r){var i,a=null==e||null===(i=e.name)||void 0===i?void 0:i.trim();if(a&&n[a]>1&&t.push({instancePath:"/attributes/".concat(r,"/name"),message:"gnviewer.duplicateAttributeNameError"}),(null==e?void 0:e.restrictionsType)===P.Range){var o=e.restrictionsRangeMin,l=e.restrictionsRangeMax;null!==o&&null!==l&&o>l&&(t.push({instancePath:"/attributes/".concat(r,"/restrictionsRangeMin"),message:"gnviewer.minError"}),t.push({instancePath:"/attributes/".concat(r,"/restrictionsRangeMax"),message:"gnviewer.maxError"}))}}),t}(w),K=[].concat(te(W),te(X)),ee=C("/title",K);function ne(e){j(function(t){return re(re({},t),{},{attributes:t.attributes.map(function(t){return t.id!==e.id?t:e})})})}var ie=(0,r.useCallback)(function(e){n({title:"gnviewer.createDatasetErrorTitle",message:e||"gnviewer.createDatasetErrorDefault"})},[n]),oe=(0,r.useCallback)(function(){G.current&&(clearInterval(G.current),G.current=null)},[]),le=(0,r.useCallback)(function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];oe(),e&&_(!1),$(null)},[oe]);return(0,r.useEffect)(function(){if(U){var e=function(){d.A.get((0,Z.tX)(Z.pp,"/".concat(U))).then(function(e){var t=e.data,n=null==t?void 0:t.request,r=null==n?void 0:n.status;if("finished"===r){var i=m()(n,"output_params.resources[0].detail_url");le(!1),i&&(_(!1),window.location.href=i)}else"failed"===r&&(ie(m()(n,"log")),le())}).catch(function(e){ie(m()(e,"data.detail",m()(e,"originalError.message"))),le()})};e(),G.current=setInterval(e,o)}return oe},[U,o,ie,le,oe]),i().createElement(f.A,{classNames:["gn-create-dataset","ms-main-colors","_fill","_absolute","_padding-lr-md"]},i().createElement(f.A,{column:!0,classNames:["gn-create-dataset-container","_fill","_relative","_padding-tb-sm"],gap:"sm"},i().createElement(y.A,{fontSize:"xl"},i().createElement(h.A,{msgId:"gnviewer.createAnEmptyDataset"})),i().createElement(v.gE,{controlId:"datasetTitle",validationState:ee?"error":void 0},i().createElement(v.mq,null,i().createElement(h.A,{msgId:"gnviewer.datasetTitle"})),i().createElement(v.MJ,{type:"text",autoComplete:"off",value:null==w?void 0:w.title,disabled:D,onChange:function(e){return j(re(re({},w),{},{title:e.target.value}))}}),ee?i().createElement(v.f0,null,i().createElement(h.A,{msgId:ee})):null),i().createElement(f.A,{column:!0,gap:"sm",classNames:["_padding-t-lg","_padding-r-sm","_overflow-auto"]},i().createElement(f.A.Fill,{flexBox:!0,className:"gn-attributes-header"},i().createElement(f.A,{component:"div"},i().createElement(y.A,{fontSize:"lg"},i().createElement(h.A,{msgId:"gnviewer.attributes"}))),i().createElement(f.A,{gap:"sm"},(q.length>0||V.length>0)&&i().createElement(b.A,{variant:"default",disabled:D,onClick:function(){B([]),L([])}},i().createElement(h.A,{msgId:"gnviewer.clearWarnings"})),i().createElement("div",null,i().createElement("input",{type:"file",accept:".json",onChange:function(e){var t=m()(e,"target.files[0]");t&&((0,S.Vh)(t).then(function(e){var t=function(e){var t=[],n=[],r=function(e){return{dataset:null,errors:[].concat(t,[e]),warnings:n}},i=function(e,t){return n.push({msgId:e,msgParams:t})};try{if(!e||"object"!==A(e))return r("gnviewer.invalidSchemaStructure");if("object"!==e.type)return r("gnviewer.schemaMustBeObject");if(!e.properties||"object"!==A(e.properties))return r("gnviewer.schemaMustHaveProperties");var a=e.title,o=void 0===a?"Untitled Dataset":a,u=e.properties,s=e.required,c=new Set(void 0===s?[]:s),m=u.geom,g=I.Point;m?m.const&&[I.Point,I.LineString,I.Polygon].includes(m.const)?g=m.const:i("gnviewer.invalidGeometryType"):i("gnviewer.noGeometryProperty");for(var d=[],f=function(){var e,t,n=(e=v[y],t=2,function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,l=[],u=!0,s=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){s=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(s)throw i}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return O(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=n[0],a=n[1];if("geom"===r)return 0;var o,u=k[a.type];if(!u)return i("gnviewer.unsupportedPropertyType",{propName:r,propType:null!==(o=a.type)&&void 0!==o?o:"unknown"}),0;var s={id:(0,p.v4)(),name:r,type:"date"===a.format?I.Date:u,restrictionsType:P.None,nillable:!c.has(r)};if(Array.isArray(a.enum))if("date"===a.format)i("gnviewer.enumNotSupportedForDate",{propName:r});else{var m=s.type===I.String,g=s.type===I.Integer;m&&a.enum.some(function(e){return"string"!=typeof e})&&i("gnviewer.enumMustBeString",{propName:r}),s.restrictionsType=P.Options,s.restrictionsOptions=a.enum.map(function(e){return{id:(0,p.v4)(),value:l()(e)?null:m?String(e):g?Number(e):N(e)}})}else if(void 0!==a.minimum||void 0!==a.maximum)if(s.type===I.String)i("gnviewer.rangeNotSupportedForString",{propName:r});else if("date"===a.format)i("gnviewer.rangeNotSupportedForDate",{propName:r});else{var f=a.minimum,b=a.maximum;if(l()(f)&&l()(b))i("gnviewer.rangeCannotBeEmpty",{propName:r});else{"string"!=typeof f&&"string"!=typeof b||i("gnviewer.rangeMustBeNumeric",{propName:r});var h=s.type===I.Integer;s.restrictionsType=P.Range,s.restrictionsRangeMin=l()(f)?null:h?Number(f):N(f),s.restrictionsRangeMax=l()(b)?null:h?Number(b):N(b)}}d.push(s)},y=0,v=Object.entries(u);y<v.length;y++)f();return{dataset:{title:o,geometry_type:g,attributes:d},errors:t,warnings:n}}catch(e){return t.push("gnviewer.schemaParseError"),{dataset:null,errors:t,warnings:n}}}(e);B(t.errors),L(t.warnings),t.dataset&&0===m()(t,"errors.length",0)?j(t.dataset):j(re({},M))}).catch(function(){B(["gnviewer.invalidJSONFile"]),L([])}),e.target.value="")},ref:u,disabled:D,style:{display:"none"}}),i().createElement(b.A,{variant:"primary",disabled:D,onClick:function(){var e;return null==u||null===(e=u.current)||void 0===e?void 0:e.click()}},i().createElement(h.A,{msgId:"gnviewer.loadAttributesFromJSONSchema"}))))),(q.length>0||V.length>0)&&i().createElement(f.A,{column:!0,classNames:["gn-attributes-warnings","_padding-t-sm"]},q.map(function(e,t){return i().createElement(v.Fc,{bsStyle:"danger",key:t},i().createElement(h.A,{msgId:e}))}),V.map(function(e,t){return i().createElement(v.Fc,{bsStyle:"warning",key:t},i().createElement(h.A,{msgId:s()(e)?e:e.msgId,msgParams:e.msgParams}))})),i().createElement("table",{className:"table"},i().createElement("thead",null,i().createElement("tr",null,i().createElement("th",null,i().createElement(h.A,{msgId:"gnviewer.name"})),i().createElement("th",null,i().createElement(h.A,{msgId:"gnviewer.type"})),i().createElement("th",null,i().createElement(h.A,{msgId:"gnviewer.nillable"})),i().createElement("th",null,i().createElement(h.A,{msgId:"gnviewer.restrictions"})),i().createElement("th",null)," ")),i().createElement("tbody",null,i().createElement(Q,{data:re(re({},R),{},{type:w.geometry_type}),onChange:function(e){j(re(re({},w),{},{geometry_type:e.type}))},geometryAttribute:!0,disabled:D}),w.attributes.map(function(e,t){return i().createElement(Q,{key:e.id,index:t,data:e,getErrorByPath:function(e){return C(e,K)},tools:i().createElement(b.A,{className:"square-button-md",disabled:D,onClick:function(){return t=e.id,void j(function(e){return re(re({},e),{},{attributes:e.attributes.filter(function(e){return e.id!==t})})});var t}},i().createElement(v.e6,{glyph:"trash"})),onChange:ne,disabled:D})}),i().createElement("tr",null,i().createElement("td",{colSpan:4},i().createElement(b.A,{className:"gn-attribute-button",size:"sm",disabled:D,onClick:function(){j(function(e){return re(re({},e),{},{attributes:[].concat(te(e.attributes),[{id:(0,p.v4)(),name:"",type:I.String,restrictionsType:P.None,nillable:!0}])})})}},i().createElement(v.e6,{glyph:"plus"}),i().createElement(h.A,{msgId:"gnviewer.addAttribute"}))))))),i().createElement("div",null,i().createElement(b.A,{className:"gn-attribute-button",variant:"success",disabled:!!K.length||D,onClick:function(){var e=w.attributes.reduce(function(e,t){var n=t.restrictionsType||P.None;return e[t.name]=re(re({type:t.type,nillable:!!t.nillable},n===P.Range&&{range:re(re({},!l()(t.restrictionsRangeMin)&&{min:t.restrictionsRangeMin}),!l()(t.restrictionsRangeMax)&&{max:t.restrictionsRangeMax})}),n===P.Options&&{options:(t.restrictionsOptions||[]).map(function(e){return e.value})}),e},{});_(!0),(0,Y.z8)({action:"create",title:w.title,geom:w.geometry_type,attributes:e}).then(function(e){if(null!=e&&e.error)return ie(e.error),void _(!1);null!=e&&e.execution_id&&$(e.execution_id)}).catch(function(e){var t=m()(e,"data.detail")||m()(e,"data.message")||m()(e,"originalError.message");ie(t),_(!1)})}},i().createElement(h.A,{msgId:"gnviewer.createNewDataset"}),D?i().createElement(E.A,null):null))))})}}]);