
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/data_management_and_configuration/plot_bids_conversion.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_data_management_and_configuration_plot_bids_conversion.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_data_management_and_configuration_plot_bids_conversion.py:


===============================
Convert a MOABB dataset to BIDS
===============================

The Brain Imaging Data Structure (BIDS) format
is standard for storing neuroimaging data.
It follows fixed principles to facilitate the
sharing of neuroimaging data between researchers.

The MOABB library allows to convert any MOABB dataset to
BIDS [1]_ and [2]_.

In this example, we will convert the AlexMI dataset to BIDS using the
option ``cache_config=dict(path=temp_dir, save_raw=True)`` of the ``get_data``
method from the dataset object.

This will automatically save the raw data in the BIDS format and allow to use
a cache for the next time the dataset is used.

We will use the AlexMI dataset [3]_, one of the smallest in
people and one that can be downloaded quickly.

.. GENERATED FROM PYTHON SOURCE LINES 24-41

.. code-block:: Python


    # Authors: Pierre Guetschel <pierre.guetschel@gmail.com>
    #
    # License: BSD (3-clause)

    import shutil
    import tempfile
    from pathlib import Path

    import mne

    from moabb import set_log_level
    from moabb.datasets import AlexMI


    set_log_level("info")


.. GENERATED FROM PYTHON SOURCE LINES 42-46

Basic usage
-----------

Here, we will save the BIDS version of the dataset in a temporary folder

.. GENERATED FROM PYTHON SOURCE LINES 46-57

.. code-block:: Python

    temp_dir = Path(tempfile.mkdtemp())
    # The conversion of any MOABB dataset to a BIDS-compliant structure can be done
    # by simply calling its ``get_data`` method and using the ``cache_config``
    # parameter. This parameter is a dictionary.
    dataset = AlexMI()
    # Reducing the number of subjects to speed up the example

    dataset.subject_list = dataset.subject_list[:1]
    _ = dataset.get_data(cache_config=dict(path=temp_dir, save_raw=True))



.. GENERATED FROM PYTHON SOURCE LINES 58-63

Before / after folder structure
-------------------------------

To investigate what was saved, we will first define a function to print
the folder structure of a given path:

.. GENERATED FROM PYTHON SOURCE LINES 63-77

.. code-block:: Python

    def print_tree(p: Path, last=True, header=""):
        elbow = "└──"
        pipe = "│  "
        tee = "├──"
        blank = "   "
        print(header + (elbow if last else tee) + p.name)
        if p.is_dir():
            children = list(p.iterdir())
            for i, c in enumerate(children):
                print_tree(
                    c, header=header + (blank if last else pipe), last=i == len(children) - 1
                )



.. GENERATED FROM PYTHON SOURCE LINES 78-80

Now, we will retrieve the location of the original dataset. It is stored
in the MNE data directory, which can be found with the ``"MNE_DATA"`` key:

.. GENERATED FROM PYTHON SOURCE LINES 80-83

.. code-block:: Python

    mne_data = Path(mne.get_config("MNE_DATA"))
    print(f"MNE data directory: {mne_data}")


.. GENERATED FROM PYTHON SOURCE LINES 84-85

Now, we can print the folder structure of the original dataset:

.. GENERATED FROM PYTHON SOURCE LINES 85-88

.. code-block:: Python

    print("Before conversion:")
    print_tree(mne_data / "MNE-alexeeg-data")


.. GENERATED FROM PYTHON SOURCE LINES 89-94

As we can see, before conversion, all the data (i.e. from all subjects,
sessions and runs) is stored in a single folder. This follows no particular
standard and can vary from one dataset to another.

After conversion, the data is stored in a BIDS-compliant way:

.. GENERATED FROM PYTHON SOURCE LINES 94-97

.. code-block:: Python

    print("After conversion:")
    print_tree(temp_dir / "MNE-BIDS-alexandre-motor-imagery")


.. GENERATED FROM PYTHON SOURCE LINES 98-118

In the BIDS version of our dataset, the raw files are saved in EDF.
The data is organized in a hierarchy of folders,
starting with the subjects, then the sessions, and then the runs. Metadata
files are stored to describe the data. For more details on the BIDS
structure, please refer to the `BIDS website <https://bids.neuroimaging.io>`_
and the `BIDS spec <https://bids-specification.readthedocs.io/en/stable/>`_.

Under the hood, saving datasets to BIDS is done through the caching system
of MOABB. Only raw EEG files are officially supported by the BIDS
specification.
However, MOABB's caching mechanism also offers the possibility to save
the data in a pseudo-BIDS after different preprocessing steps.
In particular, we can save :class:`mne.Epochs` and ``np.ndarray`` objects.
For more details on the caching system,
please refer to the tutorial :doc:`./plot_disk_cache`.

Cleanup
-------

Finally, we can delete the temporary folder:

.. GENERATED FROM PYTHON SOURCE LINES 118-120

.. code-block:: Python

    shutil.rmtree(temp_dir)


.. GENERATED FROM PYTHON SOURCE LINES 121-138

References
-----------

.. [1] Pernet, C.R., Appelhoff, S., Gorgolewski, K.J. et al. EEG-BIDS,
       An extension to the brain imaging data structure for
       electroencephalography. Sci Data 6, 103 (2019).
       https://doi.org/10.1038/s41597-019-0104-8

.. [2] Appelhoff et al., (2019). MNE-BIDS: Organizing electrophysiological
       data into the BIDS format and facilitating their analysis.
       Journal of Open Source Software, 4(44), 1896,
       https://doi.org/10.21105/joss.01896

.. [3] Barachant, A., 2012. Commande robuste d'un effecteur par une
       interface cerveau machine EEG asynchrone (Doctoral dissertation,
       Université de Grenoble).
       https://tel.archives-ouvertes.fr/tel-01196752

**Estimated memory usage:**  0 MB


.. _sphx_glr_download_auto_examples_data_management_and_configuration_plot_bids_conversion.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_bids_conversion.ipynb <plot_bids_conversion.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_bids_conversion.py <plot_bids_conversion.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_bids_conversion.zip <plot_bids_conversion.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
