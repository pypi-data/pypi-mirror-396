# pyproject.toml
[build-system]
build-backend = "setuptools.build_meta"
requires = ["setuptools>=77", "setuptools-scm>=8"]

[project]
name = "civic-data-identity-us-il" # Package name
dynamic = ["version"]  # Using setuptools_scm
description = "Chicago open data used to validate CEP SNFEI." # Short description
readme = "README.md"
requires-python = ">=3.12"
license = "MIT"
authors = [
    { name="Civic Interconnect", email="info@civic-interconnect.org" }
]
classifiers = [
  "Development Status :: 4 - Beta",
  "Intended Audience :: Developers",
  "Intended Audience :: Science/Research",
  "Intended Audience :: Education",
  "Natural Language :: English",
  "Operating System :: OS Independent",
  "Programming Language :: Python :: 3",
  "Programming Language :: Python :: 3 :: Only",
  "Programming Language :: Python :: 3.12",
  "Programming Language :: Python :: 3.13",
  "Topic :: Scientific/Engineering :: Information Analysis",
  "Typing :: Typed",
]
keywords = [
  "civic", "US", "Illinois"
]
dependencies = [
  "pandas"
]

[project.optional-dependencies]
dev = [ # Add all to deptry ignores
  "build",
  "pre-commit",
  "pyright",
  "pytest",
  "pytest-cov",
  "pytest-env",
  "twine",
  "validate-pyproject",
]
docs = [ # Add all to deptry ignores
  "mike",
  "mkdocs",
  "mkdocs-gen-files",
  "mkdocs-git-revision-date-localized-plugin",
  "mkdocs-include-markdown-plugin",
  "mkdocs-literate-nav",
  "mkdocs-material",
  "mkdocs-static-i18n",
  "mkdocstrings[python]>=0.18",
  "ruff", # required for mkdocstrings
]

[project.urls]
"Data (index.json)" = "https://raw.githubusercontent.com/civic-interconnect/civic-data-identity-us-il/refs/heads/main/data-out/index.json"
"Data (manifest.json)" = "https://raw.githubusercontent.com/civic-interconnect/civic-data-identity-us-il/refs/heads/main/data-out/manifest.json"
"Documentation" = "https://civic-interconnect.github.io/civic-data-identity-us-il/latest"
"Homepage" = "https://github.com/civic-interconnect/civic-data-identity-us-il"
"Issues" = "https://github.com/civic-interconnect/civic-data-identity-us-il/issues"
"Source" = "https://github.com/civic-interconnect/civic-data-identity-us-il"


[tool.bandit]
exclude_dirs = ["tests", ".venv"]
skips = ["B101"] # B101: assert statements

[tool.coverage.html]
directory = "htmlcov"

[tool.coverage.paths]
source = [
  "src/",
  "*/site-packages/",
]

[tool.coverage.report]
exclude_lines = [
  "pragma: no cover",
  "def __repr__",
  "if self.debug:",
  "if settings.DEBUG",
  "raise AssertionError",
  "raise NotImplementedError",
  "if 0:",
  "if __name__ == .__main__.:",
  "class .*\\bProtocol\\):",
  "@(abc\\.)?abstractmethod",
  "# pragma: no cover",
]
fail_under = 25
precision = 1
show_missing = true
skip_covered = false

[tool.coverage.run]
branch = true
omit = [
  "*/tests/*",
  "*/test_*",
  "*/__pycache__/*",
]
source = ["src"]

[tool.coverage.xml]
output = "coverage.xml"

[tool.deptry]
known_first_party = ["civic_data_identity_us_il"]
package_module_name_map = {PyYAML = "yaml"  }

[tool.deptry.per_rule_ignores]
DEP002 = [
  # Dev dependencies
  "build",
  "pre-commit",
  "pyright",
  "pytest",
  "pytest-cov",
  "pytest-env",
  "twine",
  "validate-pyproject",
  # Docs dependencies
  "mike",
  "mkdocs",
  "mkdocs-gen-files",
  "mkdocs-git-revision-date-localized-plugin",
  "mkdocs-include-markdown-plugin",
  "mkdocs-literate-nav",
  "mkdocs-material",
  "mkdocs-static-i18n",
  "mkdocstrings",
  "ruff",
]

[tool.pyright]
extraPaths = ["./src/python/src"]
ignore = ["**/__pycache__", "build", "dist", ".venv"]
include = ["src/python/src/", "src/python/tests"]
pythonVersion = "3.12"
reportMissingTypeStubs = "warning"
typeCheckingMode = "basic" # or "strict"
# reportReturnType = "none"

[tool.pytest]
addopts = [
  "-ra",  # show extra test summary info for skipped, failed, etc.
  "--strict-markers",  # enforce marker usage
  "--cov=src",  # measure coverage for files in src
  "--cov-report=term-missing",  # term-missing:skip-covered is typical
  "--cov-report=xml:coverage.xml",  # output coverage in XML format
  "--cov-report=html:htmlcov",  # output coverage in HTML format
  "-v",  # verbose output
  "--tb=short",  # short traceback format
]
minversion = "9.0"
pythonpath = ["./src/python/src","./typings"]
testpaths = ["src/python/tests"]

[tool.ruff]
exclude = [".venv", ".ruff_cache", "build", "dist", "*.egg-info", ".eggs", "__pycache__", "tests"]
fix = true
line-length = 100
preview = false
target-version = "py312"
unsafe-fixes = false

[tool.ruff.format]
docstring-code-format = true
line-ending = "lf"
quote-style = "preserve"

[tool.setuptools]
include-package-data = true
package-dir = {"" = "src"}

[tool.setuptools.package-data]
"civic_data_identity_us_il" = ["py.typed"]

[tool.setuptools.packages.find]
namespaces = true
where = ["src"]

[tool.setuptools_scm]
fallback_version = "0.0.1"
local_scheme = "no-local-version"
version_file = "src/civic_data_identity_us_il/_version.py"
version_scheme = "guess-next-dev"
