[tool.poetry]
name = "rfmix-reader"
version = "0.3.1"  # This will be overridden if dynamic versioning is enabled
description = "RFMix-reader is a Python package designed to efficiently read and process output files generated by RFMix, a popular tool for estimating local ancestry in admixed populations. The package employs a lazy loading approach, which minimizes memory consumption by reading only the loci that are accessed by the user, rather than loading the entire dataset into memory at once."
authors = ["Kynon J.M. Benjamin <kj.benjamin90@gmail.com>"]
maintainers = ["Kynon J.M. Benjamin <kj.benjamin90@gmail.com>"]
readme = "README.md"
license = "GPL-3.0-or-later"
keywords = ["file parser", "rfmix", "gpu acceleration", "local ancestry"]
packages = [{ include = "rfmix_reader" }]
classifiers = [
  "Programming Language :: Python :: 3",
  "License :: OSI Approved :: GNU General Public License v3 or later (GPLv3+)",
  "Operating System :: OS Independent"
]

[tool.poetry.dependencies]
python = ">=3.11,<3.15"
numpy = ">=1.23,<3"
pandas = ">=2.0"
tqdm = ">=4.66"
psutil = "^7"
cyvcf2 = ">=0.31"
dask = "^2025.1"
# Plotting
matplotlib = { version = "^3.10", optional = true }
seaborn = { version = "^0.13", optional = true }
cairosvg = { version = "^2.7", optional = true }
# GPU
torch = { version = ">=2.8", optional = true }
cupy-cuda12x = { version = "*", optional = true }
cudf-cu12 = { version = "*", optional = true }
dask-cudf-cu12 = { version = "*", optional = true }
pyarrow = { version = "*", optional = true }
# Docs
sphinx                    = { version = ">=7,<9", optional = true }
sphinx-rtd-theme          = { version = "^2", optional = true }
sphinx-autodoc-typehints  = { version = "^2", optional = true }
sphinx-copybutton         = { version = "^0.5", optional = true }
fonttools = "^4.61.0"

[tool.poetry.extras]
viz = ["matplotlib", "seaborn", "cairosvg"]
gpu = ["cupy", "cudf", "dask-cudf", "torch"]
io  = ["pyarrow"]  # parquet export
all = ["matplotlib", "seaborn", "cairosvg", "torch", "cupy-cuda12x", "cudf-cu12", "dask-cudf-cu12", "pyarrow"]
docs = ["sphinx", "sphinx-rtd-theme", "sphinx-autodoc-typehints", "sphinx-copybutton"]
tests = ["pytest"]

[tool.poetry.urls]
homepage = "https://rfmix-reader.readthedocs.io/en/latest/"
repository = "https://github.com/heart-gen/rfmix_reader.git"
"Bug Tracker" = "https://github.com/heart-gen/rfmix_reader/issues"

[tool.poetry.scripts]
create-binaries = "rfmix_reader.cli.create_binaries:main"
prepare-reference = "rfmix_reader.cli.prepare_reference:main"
merge-phased-zarrs = "rfmix_reader.cli.merge_phased_zarrs:main"

[tool.poetry.group.test.dependencies]
pytest = "^8"
pytest-cov = "^7"

[tool.poetry.group.docs.dependencies]
sphinx = ">=7,<9"
sphinx-rtd-theme = "^2"
sphinx-autodoc-typehints = "^2"
sphinx-copybutton = "^0.5"

[[tool.poetry.source]]
name = "pytorch_cpu"
url = "https://download.pytorch.org/whl/cpu"
priority = "explicit"

[tool.poetry-dynamic-versioning]
enable = false

[tool.poetry-dynamic-versioning.metadata]
file = "rfmix_reader/_version.py"

[build-system]
requires = ["poetry-core>=2.0.0", "poetry-dynamic-versioning"]
build-backend = "poetry_dynamic_versioning.backend"
