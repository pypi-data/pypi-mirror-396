import{au as b,av as q,ac as v,a7 as g,aw as y,K as _,ax as w,ay as f,a1 as j}from"./index-Bzcp6Isa.js";function R(e){return typeof e=="number"&&e==b(e)}const x={m_request:{directive:"plain",include_definition:"both",depth:1},m_def:q},u={m_request:{directive:"plain",include_definition:"both",exclude:["*"]},m_def:q};function A(e={},t){if(typeof e!="object"||e===null)throw new TypeError("conditions must be a plain object");return Object.entries(e).every(([i,r])=>{const s=i.lastIndexOf(":");if(s===-1)throw new Error(`Condition key "${i}" must contain a ':' separating the JMESPath and operator`);const o=i.slice(0,s),a=i.slice(s+1).trim().toLowerCase(),c=y.search(t,o),n=Array.isArray(r)?r:[r],d=Array.isArray(c)?c:[c],l=n.map(p=>d.includes(p));switch(a){case"any":return l.some(Boolean);case"all":return l.every(Boolean);case"none":return l.every(p=>!p);default:throw new Error(`Unsupported operator "${a}" in condition key "${i}" (use any | all | none)`)}})}function E(e,t){if(!(!e||!t)){if(e.type!=="condition")return e;if(A(e.query,t))return e.children}}function z(e){e.type==="brillouin_zone_electronic"?e.request={results:{properties:{electronic:{band_structure_electronic:{segment:{m_request:{directive:"resolved",exclude:["occupations"]}},reciprocal_cell:{m_request:{directive:"resolved"}}}}}}}:e.type=="brillouin_zone_vibrational"?e.request={results:{properties:{vibrational:{band_structure_phonon:{segment:{m_request:{directive:"resolved",exclude:["occupations"]}},reciprocal_cell:{m_request:{directive:"resolved"}}}}}}}:e.type==="band_structure_electronic"?e.request={results:{properties:{electronic:{band_structure_electronic:{segment:{m_request:{directive:"resolved",exclude:["occupations"]}},reciprocal_cell:{m_request:{directive:"resolved"}}}}}}}:e.type==="band_structure_vibrational"?e.request={results:{properties:{vibrational:{band_structure_phonon:{segment:{m_request:{directive:"resolved",exclude:["occupations"]}},reciprocal_cell:{m_request:{directive:"resolved"}}}}}}}:e.type==="material"?e.request={results:{material:"*"}}:e.type==="dos_electronic"?e.request={results:{properties:{electronic:{dos_electronic:{m_request:{directive:"resolved"}},dos_electronic_new:{data:{energies:{m_request:{directive:"resolved"}},total:{m_request:{directive:"resolved"}},energy_fermi:"*",energy_ref:"*",spin_channel:"*",band_gap:{m_request:{directive:"resolved"}}}}}}}}:e.type=="dos_vibrational"?e.request={results:{properties:{vibrational:{dos_phonon:{m_request:{directive:"resolved"}}}}}}:e.type=="heat_capacity"?e.request={results:{properties:{vibrational:{heat_capacity_constant_volume:{heat_capacities:{m_request:{directive:"resolved"}},temperatures:{m_request:{directive:"resolved"}}}}}}}:e.type==="helmholtz_free_energy"?e.request={results:{properties:{vibrational:{energy_free_helmholtz:{energies:{m_request:{directive:"resolved"}},temperatures:{m_request:{directive:"resolved"}}}}}}}:e.type==="geometry_optimization"?e.request={results:{properties:{geometry_optimization:{energies:{m_request:{directive:"resolved"}}}}}}:e.type==="trajectories"?e.request={results:{properties:{thermodynamic:{trajectory:{temperature:{m_request:{directive:"resolved"}},pressure:{m_request:{directive:"resolved"}},energy_potential:{m_request:{directive:"resolved"}},available_properties:{m_request:{directive:"resolved"}}}}}}}:e.type=="workflow"?e.request={workflow2:{inputs:{m_request:{directive:"resolved",depth:5}},outputs:{m_request:{directive:"resolved",depth:5}},tasks:{m_request:{directive:"resolved",depth:5}}}}:e.type==="energy_volume_curve"&&(e.request={results:{properties:{mechanical:{energy_volume_curve:{m_request:{directive:"resolved"}}}}}})}function m(e,t,i){const r=E(e,t);if(!r)return;if(Array.isArray(r))return r.map(o=>m(o,t,i)).filter(o=>o!==void 0).flat();e=r,z(e);const s=_(e.editable)?i:e.editable;return"children"in e&&Array.isArray(e.children)&&(e.children=e.children.map(o=>m(o,t,s)).filter(o=>o!==void 0).flat()),_(s)||(e.editable=s),e}function O(){return{exclude:["files","text_search_contents"]}}function h(e,t){const i=(r,s,o=[])=>{for(const[a,c]of Object.entries(s)){const n=[...o,a];if(w(r,a)){const d=r[a];if(f(d)&&f(c))i(d,c,n);else if(!j(d,c))throw new Error(`Conflicting layout data requests for the same property. Conflict detected at path: ${n.join(".")}`)}}};i(e,t),g(e,t)}function C(e,t){Object.assign(t,u);function i(r,s,o){const a={};let c=a;v(s!==void 0,'Property layout without "property" key.'),s.split("/").forEach((n,d,l)=>{R(Number(n))||(d===l.length-1?c[n]=r:(c[n]===void 0&&(c[n]={...u}),c=c[n]))}),h(o,a)}if(e.children)for(const r of e.children)C(r,t);if(e.type==="quantity"||e.type==="richText"||e.type==="imagePreview"||e.type==="plot"||e.type=="hdf5")v(!!e.property,"Property layout items must define a property"),i("*",e.property,t);else if(e.type==="sub_section"){const r={...x};i(r,e.property,t)}else if(e.type==="table"){const r={...u};e.columns.forEach(s=>{i("*",s.property,r)}),i(r,e.property,t)}else e.request!==void 0&&h(t,e.request)}export{C as a,m as c,A as e,O as g};
