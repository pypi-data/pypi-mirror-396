import{r as o,j as x}from"./material-react-table-B5vcPysv.js";import{d as D,K as A,B as T,F as y,ag as E,ah as M,R as m,b as O,ai as z,aj as b}from"./index-Ch6wx3XL.js";import{u as L,b as k}from"./useLocalState-DdvWN1Wu.js";function v(s){function f(n,r){const t=n.split("/"),e={};return t.reduce((u,l,d)=>{const h=d===t.length-1?r:{};return u[l]=h,h},e),e}const a={};return Object.keys(s).forEach(n=>{const r=s[n];let t;Array.isArray(r)?t=r.map(e=>m.isObject(e)?v(e):e):m.isObject(r)?t=v(r):t=r,Object.assign(a,f(n,t))}),a}function w({request:s,noImplicitFetch:f=!1,onFetch:a,onError:n}){const{user:r}=D(),t=o.useRef(),e=o.useRef(),[u,l]=o.useState(),d=A();s!==L(s)&&s&&!f&&(t.current=s);const c=o.useCallback(()=>s?(t.current=s,(async()=>{e.current=v(s);try{const i=await E(e.current,r||void 0);M(i),t.current===s&&(t.current=void 0,l(i),a?.(i,i))}catch(i){n?.(i)}})(),()=>{t.current=void 0}):void 0,[t,l,e,s,a,n,r]);o.useEffect(()=>{if(!f)return c()},[c,f]);const h=o.useCallback(()=>{c(),d()},[c,d]),R=T();return o.useEffect(()=>(R.registerTool("data",x.jsx(y,{value:{request:e.current,response:u}})),()=>R.unregisterTool("routes-data")),[u,t,R,e]),{data:u,loading:t.current!==void 0,fetch:h}}function V({request:s,route:f,onFetch:a,onError:n,reloadCount:r,...t}){const{match:e}=O(),u=k(e),l=o.useMemo(()=>{if(s)return z(e,p=>{if(p===e[e.length-1])return s})},[s]),d=o.useMemo(()=>{if(a)return(p,i)=>{const g=u.current,j=b(g,p)[g.length-1];a(j,i)}},[a,u,r]),{data:c,...h}=w({request:l,onFetch:d,onError:n,...t}),R=c&&l?b(e,c)[e.length-1]:void 0;return{...h,data:R}}export{V as u};
