import{b as S,j as e,r as a,u as K,B as C,am as N,ab as v,o as H,G as q,l as E,p as Q,M as X,q as x,ad as Y,an as Z,t as f,s as j,D as L,e as ee,H as I,a6 as te,ao as ne}from"./material-react-table-B5vcPysv.js";import{d as oe,J as se,M as re,f as M,e as ie,b as P,c as D,p as ae,L as T,D as O,k as z,E as le,a as ce,l as de}from"./index-Ch6wx3XL.js";import{p as he,D as ue,P as pe}from"./react-pdf-CcAKyqe7.js";import{a as B,P as b}from"./PlaceholderAction-pLqkJ47d.js";import{R as xe}from"./RoutingTable-BBWeRvTz.js";import{D as me}from"./UploadFilesNav-YU8Nfw6-.js";import{S as fe}from"./Select-jE9XnvPH.js";const je=S(e.jsx("path",{d:"m7 10 5 5 5-5z"}),"ArrowDropDown"),we=S(e.jsx("path",{d:"m4 12 1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8z"}),"ArrowUpwardOutlined"),V=S(e.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M17 13l-5 5-5-5h3V9h4v4z"}),"CloudDownload"),ye=S(e.jsx("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download");function _(t){const{user:n}=oe(),[s,r]=a.useState(null);return a.useEffect(()=>{const o=new AbortController,{signal:i}=o,c=n?.access_token?{Authorization:`Bearer ${n.access_token}`}:void 0;return(async()=>{try{const p=await(await fetch(t,{signal:i,headers:c})).text();r(p)}catch(h){h.name!=="AbortError"&&console.error(h)}})(),()=>{o.abort()}},[t,n]),s}function ge({file:t,...n}){const s=_(t),r=s&&JSON.parse(s);return e.jsx(se,{...n,value:r})}function be({file:t}){const n=_(t);return e.jsx(re,{content:n||""})}he.GlobalWorkerOptions.workerSrc=new URL("/assets/pdf.worker.min-DKQKFyKK.js",import.meta.url).toString();function Ce({file:t}){const[n,s]=a.useState(null),[r,o]=a.useState(),[i,c]=a.useState(),h=K().breakpoints.values.md;a.useLayoutEffect(()=>{n&&c(n.clientWidth)},[n]);function p({numPages:m}){o(m)}return e.jsx("div",{ref:s,children:e.jsx(ue,{file:t,onLoadSuccess:p,children:r&&i&&Array.from(new Array(r),(m,u)=>e.jsx(pe,{pageNumber:u+1,width:i?Math.min(i,h):h},`page_${u+1}`))})})}function ke({text:t}){return e.jsx(C,{sx:{width:"100%",overflowX:"auto"},children:e.jsx(C,{sx:{width:0},children:e.jsx("pre",{children:t})})})}function ve({file:t}){const n=_(t);return e.jsx(ke,{text:n??""})}function De({file:t,size:n}){const s=t.split(".").pop();return s==="pdf"&&n<$.maxSizeAutoPreview?e.jsx(Ce,{file:t,...$}):s==="json"&&n<U.maxSizeAutoPreview?e.jsx(ge,{file:t,...U}):s==="md"?e.jsx(be,{file:t}):e.jsx(ve,{file:t})}const U={maxSizeAutoPreview:1e7,width:"fit-content"},$={maxSizeAutoPreview:1e7,maxWidths:400};function A({buttons:t,...n}){const[s,r]=a.useState(!1),o=a.useRef(null),[i,c]=a.useState(0),d=()=>{t[i].onClick?.()},h=(u,y)=>{c(y),r(!1),d()},p=()=>{r(u=>!u)},m=u=>{o.current&&o.current.contains(u.target)||r(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(N,{...n,ref:o,children:[e.jsx(v,{onClick:d,...t[i]}),e.jsx(v,{size:"small",onClick:p,children:e.jsx(je,{})})]}),e.jsx(H,{sx:{zIndex:10},open:s,anchorEl:o.current,placement:"bottom-end",transition:!0,disablePortal:!0,children:({TransitionProps:u,placement:y})=>e.jsx(q,{...u,style:{transformOrigin:y==="bottom"?"center top":"center bottom"},children:e.jsx(E,{children:e.jsx(Q,{onClickAway:m,children:e.jsx(X,{autoFocusItem:!0,children:t.map((k,g)=>e.jsx(x,{selected:g===i,onClick:F=>h(F,g),disabled:k.disabled,children:k.children},g))})})})})})]})}function Se({sx:t,children:n}){const{isPage:s}=M(),[r,o]=a.useState(),i=a.useCallback(()=>{o(`
      This will provide several options to create a new entry. It starts
      with a dialog to choose basic metadata, like a file name. By default
      it will create a very basic ELN entry from a simple generic schema
      (title, description, authors, tags, timestamp, etc.). Or, users can
      choose to create an entry from a plugin schema, uploaded schema, or
      existing entry (template).`)},[o]),c=a.useCallback(()=>{o(`
      This will either open the browser file upload or explain how to
      upload and create files through the API.`)},[o]),d=a.useCallback(()=>{o(`
      This opens the current directory in the selected tool. By default
      this will be the basic JupyterLab.`)},[o]),h=a.useCallback(()=>{o(null)},[o]);return e.jsx(ie,{sx:t,leftActions:s&&e.jsxs(e.Fragment,{children:[e.jsx(A,{variant:"contained",color:"primary",buttons:[{children:"Create entry",onClick:i},{children:"Create entry from template",onClick:i},{children:"Create entry from schema",onClick:i}]}),e.jsx(A,{variant:"contained",color:"primary",buttons:[{children:"Upload files",onClick:c},{children:"Upload via API",onClick:c},{children:"Create empty text file",onClick:c}]}),e.jsx(A,{variant:"outlined",color:"primary",buttons:[{children:"Open in Jupyterlab",onClick:d},{children:"Open in VS Code",onClick:d},{children:"Open in another tool",disabled:!0}]})]}),rightActions:e.jsxs(e.Fragment,{children:[e.jsx(C,{sx:{flexGrow:1}}),e.jsx(Y,{sx:{width:400},size:"small",label:"Go to file",variant:"outlined"}),s&&e.jsxs(e.Fragment,{children:[n,r&&e.jsx(B,{description:r,open:!0,onClose:h})]})]})})}function Pe(){return e.jsx(b,{component:v,description:e.jsx("div",{children:"This will open a browser download dialog to let you download the file (or directory as a zip)."}),startIcon:e.jsx(ye,{}),variant:"contained",children:"Download"})}function Fe(t){const{title:n="move",description:s="Select the directory where you want to move the file(s).",...r}=t,{url:o,match:i,index:c}=P(),d=i[c].path===""?o({path:"files"}):o();return e.jsx(fe,{...r,title:n,description:s,selectOptions:{entity:"directory"},initialPath:d})}function Ie(){const[t,n]=a.useState(!1),s=a.useCallback(()=>n(!0),[n]),r=a.useCallback(()=>n(!1),[n]);return e.jsxs(e.Fragment,{children:[e.jsx(B,{open:t,onClose:r,description:e.jsx("div",{children:"This will move the file or directory to the selected destination. The action will only be performed after confirmation and checking if the files can be safely renamed without breaking references."})}),e.jsxs(Fe,{component:x,title:"Move",description:"Select the directory where you want to move the file(s).",selectButtonLabel:"Move",onSelect:s,children:[e.jsx(f,{}),e.jsx(j,{children:"Move"})]},"move")]})}function Ae({data:t,navigatePath:n=r=>r,...s}){const{index:r,fullMatch:o,url:i,navigate:c}=P(),{upload_id:d}=D(z),h=o[r].route.path===ae.path,{isPage:p,entity:m,navigateToEntry:u}=M(),y=a.useMemo(()=>{const l=[];for(const[w,R]of Object.entries(t))if(typeof R=="object"&&w!=="m_response"){const J={...R,name:w};l.push(J)}return l},[t]),k=a.useMemo(()=>[{enableSorting:!1,accessorKey:"name",header:"Name",grow:1,Cell:({cell:l})=>e.jsxs(C,{sx:{display:"flex",flexDirection:"row",gap:1,flexWrap:"nowrap","& .MuiSvgIcon-root":{color:w=>w.palette.action.active}},children:[e.jsx(me,{type:l.row.original.m_is}),l.row.original.name,l.row.original.entry&&e.jsx(Z,{color:"primary",label:"entry",size:"small"})]})},{enableSorting:!1,accessorKey:"size",header:"Size",size:100}],[]),g=a.useCallback(l=>[e.jsxs(x,{component:T,disabled:!l.entry,to:l.entry?i({path:`/uploads/${d}/entries/${l.entry.entry_id}`}):"#",children:[e.jsx(f,{}),e.jsx(j,{children:"Open entry"})]},"open entry"),e.jsxs(x,{component:T,to:i({path:n(l.name)}),children:[e.jsx(f,{}),e.jsx(j,{children:"Open file"})]},"open file"),e.jsx(L,{},"devider-1"),e.jsxs(b,{component:x,description:e.jsx("div",{children:"This will open a dialog to rename the file or directory. The action will only be performed after confirmation and checking if the files can be safely renamed without breaking references."}),children:[e.jsx(f,{children:e.jsx(ee,{fontSize:"small"})}),e.jsx(j,{children:"Rename"})]},"rename"),e.jsx(Ie,{},"move"),e.jsxs(b,{component:x,description:e.jsx("div",{children:"This will delete the file or directory and all its contents, after confirmation and checking if the files can be safely deleted without breaking references."}),children:[e.jsx(f,{children:e.jsx(O,{fontSize:"small"})}),e.jsx(j,{children:"Delete"})]},"delete"),e.jsx(L,{},"divider-2"),e.jsxs(b,{component:x,description:e.jsx("div",{children:"This will open a browser download dialog to let you download the file (or directory as a zip)."}),children:[e.jsx(f,{children:e.jsx(V,{fontSize:"small"})}),e.jsx(j,{children:"Download"})]},"download"),...l.m_is==="File"?[e.jsxs(b,{component:x,description:"This will open the raw file contents in a new tab.",children:[e.jsx(f,{}),e.jsx(j,{children:"View raw"})]},"raw")]:[]],[i,n,d]),F=a.useCallback(()=>e.jsxs(e.Fragment,{children:[e.jsx(I,{onClick:()=>confirm("Delete"),color:"inherit",children:e.jsx(V,{})}),e.jsx(I,{onClick:()=>confirm("Delete"),color:"inherit",children:e.jsx(O,{})})]}),[]),W=a.useCallback(l=>m==="directory"?l.m_is==="File":!1,[m]);return e.jsx(xe,{paginationType:"page",onRowClick:l=>{if(l.entry&&u){const w=p?`/uploads/${d}/entries/${l.entry.entry_id}`:`/uploads/${d}/entries/${l.entry.entry_id}/archive`;c({path:w})}else typeof l.name=="string"&&c({path:n(l.name)})},rowContextMenuItems:p?g:void 0,toolbarCustomActions:()=>h&&e.jsx(te,{title:"Go to parent directory",children:e.jsx(I,{onClick:()=>c({path:n("..")}),children:e.jsx(we,{})})}),toolbarSelectActions:p?F:void 0,isDisabledRow:W,...s,columns:k,data:y})}function G({file:t,sx:n={}}){const{fullMatch:s,index:r}=P(de),{upload_id:o}=D(z),i=[...s,...t?[{path:t}]:[]].slice(r+1).map(c=>c.path).map(encodeURIComponent).join("/");return e.jsx(E,{sx:{padding:2,...n},children:e.jsx(De,{file:`${le.API_URL}/uploads/${o}/raw/${i}`,size:-1})})}function Te(){const t=D(),{path:n,url:s}=P(),{upload_id:r}=D(z),{isPage:o}=M(),i=e.jsxs(C,{sx:{display:"flex",flexDirection:"row",gap:1},children:[t.entry&&e.jsx(v,{variant:"contained",component:T,to:s({path:`/uploads/${r}/entries/${t.entry?.entry_id}`}),endIcon:e.jsx(ne,{}),children:"Go to Entry"}),e.jsx(Pe,{})]});return t.m_is==="File"?e.jsxs(e.Fragment,{children:[e.jsx(ce,{title:n,actions:o&&i}),e.jsx(G,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{children:i}),e.jsx(Ae,{data:t})]})}const Ue=Object.freeze(Object.defineProperty({__proto__:null,UploadFilePreview:G,default:Te},Symbol.toStringTag,{value:"Module"}));export{Pe as U,Se as a,Ae as b,G as c,Ue as d};
