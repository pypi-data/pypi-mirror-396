import{r as t,j as c,T as de}from"./material-react-table-CoLKVKmx.js";import{u as K,bp as fe,d0 as me,d1 as ne,d2 as ge,d3 as W,d4 as se,bZ as he,N as pe,d5 as w,d6 as xe,d7 as ve}from"./index-Bzcp6Isa.js";function be(){var e=t.useRef(!0);return e.current?(e.current=!1,!0):e.current}function De({request:e,route:o,onBeforeFetch:i,onFetch:r,onError:l,reloadCount:D,...m}){const{match:n}=K(),s=fe(n),u=t.useMemo(()=>{if(e)return me(n,p=>{if(p===n[n.length-1])return e})},[e]),d=t.useMemo(()=>{if(i)return(p,g)=>i(e,g)},[i,e]),R=t.useMemo(()=>{if(r)return(p,g)=>{const M=s.current,x=ne(M,p)[M.length-1];r(x,g)}},[r,s,D]),{data:h,...j}=ge({request:u,onBeforeFetch:d,onFetch:R,onError:l,...m}),T=h&&u?ne(n,h)[n.length-1]:void 0;return{...j,data:T}}function G({path:e,request:o,response:i=g=>g,useDataForRouteParams:r={},dataIsSufficient:l=()=>!0,filterChildKeys:D=()=>!0,getChildProps:m=()=>({}),orderCompareFn:n,depth:s=0,children:u,expanded:d,onToggle:R,defaultExpanded:h,expandable:j=!1,selectable:T=!0,...p}){const g=d!==void 0,M=W(o);M!==o&&M&&console.warn("Request must not change. Might happen on hot update, otherwise: did you forget to memoize it?");const x=t.useMemo(()=>e.split("/"),[e]),U=t.useMemo(()=>x.at(-1)||"no path",[x]),oe=t.useMemo(()=>({request:typeof o=="function"?o(e):{[e]:{...o}},noImplicitFetch:!0,...r}),[o,e,r]),{fetch:S,loading:z,data:Y}=De(oe),E=Y&&se(e,Y),Z=!!E,{index:N,fullMatch:L,navigate:H}=K(),J=t.useMemo(()=>L.slice(N+1).map(a=>a.path).join("/"),[L,N]),y=t.useMemo(()=>L[N+x.length+1]?.path,[L,N,x]),k=J.substring(0,e.length)===e,_=e===J,$=W(k)!==k&&k,Q=W(_)!==_&&_,A=he(),v=t.useMemo(()=>A&&se(e,A,!1),[A,e]),B=v&&l(v,U),F=t.useRef();E&&!z?F.current=E:v&&B&&(F.current=v);const f=typeof j=="function"?j(F.current):j,[re,V]=t.useState(!1),[ae,ie]=t.useState(!!h&&f),I=g?d:ae,ce=t.useCallback(a=>{R&&a!==d&&R()},[d,R]),b=g?ce:ie,ue=t.useCallback(()=>H({path:e,search:{}}),[H,e]),P=t.useCallback(()=>{if(f)return b(!0),S()},[b,S,f]),X=t.useCallback(()=>{b(!1),V(!1)},[b]),q=t.useCallback(()=>{I?X():(P(),V(!0))},[I,P,X]),ee=be();t.useEffect(()=>{if(ee&&h)return P();if(!(!$||!f)&&(b(!0),!B&&(!Z||Q&&!I)))return S()},[$,B,S,Q,I,f,Z,b,h,P,ee]);const C=F.current&&i(F.current,e),O=I||$&&f,le=_||k&&(!O||z);return c.jsx(pe,{expanded:O,selected:le,highlighted:_,onToggle:q,onSelect:T?ue:q,expandable:f,label:U,sx:{"&>.NavItem-button":{paddingLeft:s===0?void 0:(s-1)*2},"&.NavItem-root":{position:"relative"},...s>0&&{"&>.NavItem-content::before":{content:'""',position:"absolute",top:42,bottom:-4,left:16+s*16,borderLeftWidth:1,borderLeftStyle:"solid",borderLeftColor:"divider"}}},...p,children:O&&c.jsxs(c.Fragment,{children:[u,z?c.jsxs(c.Fragment,{children:[c.jsx(de,{sx:{marginLeft:s*2+4,marginY:1},children:"loading..."}),y&&!re&&v?.[y]&&c.jsx(G,{path:`${e}/${y}`,expandable:f,request:o,response:i,useDataForRouteParams:r,dataIsSufficient:l,getChildProps:m,orderCompareFn:n,...m(v,y,e),depth:s+1},y)]}):C&&Object.keys(C).filter(a=>!a.startsWith("m_")).filter(a=>D(C,a)).toSorted((a,te)=>n?n(C,a,te):a.localeCompare(te)).map(a=>c.jsx(G,{path:`${e}/${a}`,expandable:f,request:o,response:i,useDataForRouteParams:r,dataIsSufficient:l,getChildProps:m,orderCompareFn:n,...m(C,a,e),depth:s+1},a))]})})}function Re(e,o,i){const r=e[o],l=e[i];return r.m_is==="Directory"&&l.m_is==="File"?-1:r.m_is==="File"&&l.m_is==="Directory"?1:o.localeCompare(i)}function je({type:e}){return e==="Directory"?c.jsx(xe,{}):c.jsx(ve,{})}function _e({getChildProps:e,...o}){const{fullMatch:i,index:r}=K(),l=i.length===r+2&&i[r+1]?.path==="files",D=t.useMemo(()=>({m_request:{pagination:w},"*":"*"}),[]),m=t.useCallback(n=>{const s=n.m_response;if(!s)return!1;const u=s?.pagination;return u.page===w.page&&(u.total<=u.page_size||u.page_size>=w.page_size)},[]);return c.jsx(G,{highlighted:o.selected&&l,path:"files",variant:"menuItem",icon:void 0,request:D,dataIsSufficient:m,expandable:!0,getChildProps:(n,s,u)=>{const d=n[s];return{variant:"treeNode",icon:d.m_is&&c.jsx(je,{type:d.m_is}),alignWithExpandIcons:!0,...e?.(n,s,u)||{},expandable:d.m_is==="Directory"}},orderCompareFn:Re,...o})}export{je as D,_e as P};
