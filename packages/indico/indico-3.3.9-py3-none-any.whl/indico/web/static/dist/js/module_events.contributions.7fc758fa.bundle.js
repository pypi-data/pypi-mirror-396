"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[4702],{42884:(t,e,n)=>{var i=n(29079),a=n(637),s=n.n(a),o=n(14867),r=n.n(o),l=n(86326),c=n(35623),d=(n(64622),n(42383),n(89995)),u=n(24406),m=n(96478),b=n(49528),p=n(24372),h=n(25584),f=n(97598),g=n.n(f),y=n(92117),D=n(45423),v=n(53225),k=n(56237);function E({open:t,setModalOpen:e,trigger:n,published:i,onClick:a}){return l.createElement(y.A,{open:t,onClose:()=>e(!1),size:"tiny",trigger:n,closeIcon:!0},l.createElement(D.A,{content:i?m.Translate.string("Set contribution list in draft mode"):m.Translate.string("Publish contributions")}),l.createElement(y.A.Content,null,i?l.createElement(l.Fragment,null,l.createElement("p",null,l.createElement(m.Translate,null,"Are you sure you want to change the contribution list back to draft mode?")),l.createElement("p",null,l.createElement(m.Translate,null,"By doing so the following menu items won't be accessible:"))):l.createElement(l.Fragment,null,l.createElement("p",null,l.createElement(m.Translate,null,"Are you sure you want to publish the contribution list?")),l.createElement("p",null,l.createElement(m.Translate,null,"By doing so the following menu items will be accessible:"))),l.createElement(v.A,{bulleted:!0},l.createElement(v.A.Item,null,l.createElement(m.Translate,null,"Contribution List")),l.createElement(v.A.Item,null,l.createElement(m.Translate,null,"My Contributions")),l.createElement(v.A.Item,null,l.createElement(m.Translate,null,"Author List")),l.createElement(v.A.Item,null,l.createElement(m.Translate,null,"Speaker List")),l.createElement(v.A.Item,null,l.createElement(m.Translate,null,"Timetable")),l.createElement(v.A.Item,null,l.createElement(m.Translate,null,"Book of Abstracts")))),l.createElement(y.A.Actions,null,l.createElement(k.A,{onClick:()=>e(!1)},l.createElement(m.Translate,null,"No")),l.createElement(k.A,{primary:!0,onClick:a},l.createElement(m.Translate,null,"Yes"))))}E.propTypes={open:g().bool.isRequired,setModalOpen:g().func.isRequired,trigger:g().node.isRequired,published:g().bool.isRequired,onClick:g().func.isRequired};const I=i.default.bind(null,{endpoint:"contributions.manage_publication",rules:[{args:["event_id"],converters:{event_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"manage",isDynamic:!1},{data:"/",isDynamic:!1},{data:"contributions",isDynamic:!1},{data:"/",isDynamic:!1},{data:"published",isDynamic:!1}]}]},"/");function T({eventId:t,onSuccess:e}){const n=I({event_id:t}),[i,a]=(0,l.useState)(!1),s=l.createElement(u.IButton,{onClick:()=>a(!0)},l.createElement(m.Translate,null,"Publish contributions"));return l.createElement(E,{open:i,setModalOpen:a,trigger:s,published:!1,onClick:async()=>{try{await b.indicoAxios.put(n)}catch(t){return(0,b.handleAxiosError)(t)}e(),a(!1)}})}T.propTypes={eventId:g().string.isRequired,onSuccess:g().func.isRequired};var C=n(29481);const x=i.default.bind(null,{endpoint:"contributions.manage_publication",rules:[{args:["event_id"],converters:{event_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"manage",isDynamic:!1},{data:"/",isDynamic:!1},{data:"contributions",isDynamic:!1},{data:"/",isDynamic:!1},{data:"published",isDynamic:!1}]}]},"/");function _({eventId:t}){const[e,n]=(0,l.useState)(!1),[i,a,s,o]=(0,C.ib)(x({event_id:t}));if(s)return null;const r=l.createElement(u.Checkbox,{label:i?m.Translate.string("Published"):m.Translate.string("Draft"),showAsToggle:!0,onChange:()=>n(!0),checked:i,disabled:o});return l.createElement(E,{open:e,setModalOpen:n,trigger:r,published:i,onClick:()=>{a(),n(!1)}})}_.propTypes={eventId:g().string.isRequired};const A=i.default.bind(null,{endpoint:"event_editing.api_file_types",rules:[{args:["event_id","type"],converters:{event_id:"IntegerConverter",type:"AnyConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"editing",isDynamic:!1},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"type",isDynamic:!0},{data:"/",isDynamic:!1},{data:"file-types",isDynamic:!1}]}]},"/"),w=i.default.bind(null,{endpoint:"papers.api_paper_details",rules:[{args:["contrib_id","event_id"],converters:{contrib_id:"IntegerConverter",event_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"papers",isDynamic:!1},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"contrib_id",isDynamic:!0}]}]},"/");document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelector("#contribution-calendar-link");if(!t)return;const{contributionId:e,eventId:n}=t.dataset;c.render(l.createElement(u.ICSCalendarLink,{endpoint:"contributions.export_ics",params:{event_id:n,contrib_id:e},renderButton:t=>l.createElement(u.IButton,{icon:"calendar",classes:t,title:m.Translate.string("Export")}),options:[{key:"contribution",text:m.Translate.string("Contribution"),extraParams:{}}]}),t)})),function(t){function e(t){$(t).tablesorter({cssAsc:"header-sort-asc",cssDesc:"header-sort-desc",cssInfoBlock:"avoid-sort",headerTemplate:"",sortList:[[1,0]]})}function n(t,e,n){return $.ajax({url:t,method:e,data:JSON.stringify(n),dataType:"json",contentType:"application/json",error:handleAjaxError,complete:IndicoUI.Dialogs.Util.progress()})}function i(){$(".js-contrib-start-date").each((function(){const t=$(this);t.ajaxqbubble({url:t.data("href"),qBubbleOptions:{style:{classes:"qbubble-contrib-start-date qtip-allow-overflow"}}})}))}function a(){$(".js-contrib-duration").each((function(){const t=$(this);t.ajaxqbubble({url:t.data("href"),qBubbleOptions:{style:{classes:"qbubble-contrib-duration"}}})}))}t.setupEditableSubmissionButton=async function(){const t=document.querySelector("#editable-submission-button");if(!t)return;const e=JSON.parse(t.dataset.availableTypes),{eventId:n,contributionId:i,contributionCode:a}=t.dataset;let o,r,u=[];try{[o,r]=await Promise.all([Promise.all(e.map((t=>b.indicoAxios.get(A({event_id:n,type:t}))))),b.indicoAxios.get(w({event_id:n,contrib_id:i}),{validateStatus:t=>t>=200&&t<300||404===t,headers:{"X-Indico-No-Report-Error":"404"}})])}catch(t){return void(0,b.handleAxiosError)(t)}const m=s().fromPairs(o.map(((t,n)=>[e[n],(0,p.camelizeKeys)(t.data)])));if(r){const{isInFinalState:t,lastRevision:e}=(0,p.camelizeKeys)(r.data);t&&e&&(u=e.files)}c.render(l.createElement(d.A,{fileTypes:m,eventId:+n,contributionId:+i,contributionCode:a,uploadableFiles:u.map((({id:t,...e})=>({...e,paperId:t})))}),t)},t.setupContributionConfig=function(){!function(){const t=document.querySelector("#pub-switch");c.render(l.createElement(_,{eventId:t.dataset.eventId}),t)}()},t.setupContributionList=function(t){t=$.extend({createSessionURL:null,createTrackURL:null,timetableRESTURL:null},t);$(".list [data-toggle=dropdown]").closest(".toolbar").dropdown(),e("#contribution-list .tablesorter"),function(t,e){const i=$("#contribution-list");i.on("click",".session-item-picker",(function(){$(this).itempicker({filterPlaceholder:h.$T.gettext("Filter sessions"),containerClasses:"session-item-container",items:i.find("table").data("session-items"),footerElements:[{title:h.$T.gettext("Assign new session"),onClick(e){ajaxDialog({title:h.$T.gettext("Add new session"),url:t,onClose(t){t&&($(".session-item-picker").each((function(){const e=$(this);e.data("indicoItempicker")?e.itempicker("updateItemList",t.sessions):i.find("table").data("session-items",t.sessions)})),e.itempicker("selectItem",t.new_session_id))}})}}],onSelect(t,i){const a=$(this),s=a[0].style,o={session_id:t?t.id:null};return n(a.data("href"),a.data("method"),o).then((o=>{const l=t?t.title:h.$T.gettext("No session");if(a.find(".label").text(l),t?(s.setProperty("color",`#${t.colors.text}`,"important"),s.setProperty("background",`#${t.colors.background}`,"important")):(s.removeProperty("color"),s.removeProperty("background")),o.unscheduled){const t=a.closest("tr"),s=t.find("td.start-date > .vertical-aligner"),l=s.children().detach();s.html($("<em>",{text:h.$T.gettext("Not scheduled")})),showUndoWarning(h.$T.gettext("'{0}' has been unscheduled due to the session change.").format(t.data("title")),h.$T.gettext("Undo successful! Timetable entry and session have been restored."),(()=>n(e,"POST",o.undo_unschedule).then((t=>{l.filter(".label").text(" "+r().utc(t.start_dt).format("DD/MM/YYYY HH:mm")),s.html(l),a.itempicker("selectItem",i?i.id:null)}))))}}))}})}))}(t.createSessionURL,t.timetableRESTURL),function(t){const e=$("#contribution-list");e.on("click",".track-item-picker",(function(){$(this).itempicker({filterPlaceholder:h.$T.gettext("Filter tracks"),containerClasses:"track-item-container",uncheckedItemIcon:"",items:e.find("table").data("track-items"),footerElements:[{title:h.$T.gettext("Add new track"),onClick(n){ajaxDialog({title:h.$T.gettext("Add new track"),url:t,onClose(t){t&&($(".track-item-picker").each((function(){const n=$(this);n.data("indicoItempicker")?n.itempicker("updateItemList",t.tracks):e.find("table").data("track-items",t.tracks)})),n.itempicker("selectItem",t.new_track_id))}})}}],onSelect(t){const e=$(this),i={track_id:t?t.id:null};return n(e.data("href"),e.data("method"),i).then((()=>{const n=t?t.title:h.$T.gettext("No track");e.find(".label").text(n)}))}})}))}(t.createTrackURL),i(),a(),enableIfChecked("#contribution-list","input[name=contribution_id]",".js-enable-if-checked");const o=setupListGenerator({itemHandle:"tr",listItems:"#contribution-list tbody tr",term:"#search-input",state:"#filtering-state",placeholder:"#filter-placeholder"});$("#contribution-list").on("indico:htmlUpdated",(()=>{e("#contribution-list .tablesorter"),i(),a(),s().defer(o)})).on("attachments:updated",(t=>{const e=$(t.target);reloadManagementAttachmentInfoColumn(e.data("locator"),e.closest("td"))})),$(".js-submit-form").on("click",(function(t){t.preventDefault();const e=$(this);e.hasClass("disabled")||$("#contribution-list form").attr("action",e.data("href")).submit()}))},t.setupSubContributionList=function(){$("#subcontribution-list [data-toggle=dropdown]").closest(".toolbar").dropdown(),e("#subcontribution-list .tablesorter"),enableIfChecked("#subcontribution-list","input[name=subcontribution_id]","#subcontribution-list .js-enable-if-checked"),$("#subcontribution-list td.subcontribution-title").on("mouseenter",(function(){const t=$(this);this.offsetWidth<this.scrollWidth&&!t.attr("title")&&t.attr("title",t.text())})),$("#subcontribution-list").on("attachments:updated",(function(t){const e=$(t.target);reloadManagementAttachmentInfoColumn(e.data("locator"),e.closest("td")),$(this).trigger("ajaxDialog:setData",[!0])})),$("#subcontribution-list").on("indico:htmlUpdated",(function(){$(this).trigger("ajaxDialog:setData",[!0])})),$("#subcontribution-list table").sortable({items:".js-sortable-subcontribution-row",handle:".js-sort-handle",placeholder:"sortable-placeholder",tolerance:"pointer",distance:10,axis:"y",containment:"#subcontribution-list table",start(t,e){e.placeholder.height(e.helper.outerHeight())},update(t,e){const n=$(this);$.ajax({url:e.item.data("sort-url"),method:"POST",data:{subcontrib_ids:n.sortable("toArray")},error:handleAjaxError}),n.trigger("ajaxDialog:setData",[!0])}})},t.setupEventDisplayContributionList=function(){setupListGenerator({itemHandle:"div.contribution-row",listItems:"#display-contribution-list div.contribution-row",term:"#search-input",state:"#filtering-state",placeholder:"#filter-placeholder"})()},t.setupEventDisplayAuthorList=function(){setupSearchBox({itemHandle:".author-list > li",listItems:".author-list > li",term:"#search-input",state:"#filtering-state",placeholder:"#filter-placeholder"})()},t.setupDraftModeWarning=function(){const t=document.querySelector("#draft-mode-warning"),e=document.querySelector("#draft-mode-warning-button-container");t&&e&&c.render(l.createElement(T,{eventId:e.dataset.eventId,onSuccess:()=>t.classList.add("hidden")}),e)}}(window)}},t=>{t.O(0,[4644,4394,2076],(()=>{return e=42884,t(t.s=e);var e}));t.O()}]);
//# sourceMappingURL=module_events.contributions.7fc758fa.bundle.js.map