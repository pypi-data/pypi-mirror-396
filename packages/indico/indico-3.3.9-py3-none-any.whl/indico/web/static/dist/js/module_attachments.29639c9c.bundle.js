"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[9328],{31157:(t,e,a)=>{var n=a(637),i=a.n(n),o=a(25584);!function(t){const e=!!history.pushState;function a(t){$(t.target).closest(".actions").length||$(this).toggleClass("collapsed").next(".sub-tree").find("td > div").slideToggle(150)}$(document).ready((()=>{$(".attachments > .i-dropdown").parent().dropdown(),$("html").data("static-site")||function(){const t=$(".js-preview-dialog"),a=location.href.replace(/#.*$/,"");if($.mobileBrowser)return;function n(){e?history.back():location.hash=""}function s(t){const e=$('.attachment[data-previewable][data-attachment-id="{0}"]'.format(t));e.length?ajaxDialog({url:build_url(e.attr("href"),{preview:"1"}),title:e.data("title"),dialogClasses:"attachment-preview-dialog",onClose(t){$("body").off("keydown.attachmentPreview"),$("html, body").removeClass("prevent-scrolling"),t||n()},onOpen(t){const e=t.canvas.closest(".ui-dialog");e.prev(".ui-widget-overlay").addClass("attachment-preview-overlay"),t.canvas.find(".attachment-preview-content-wrapper, .js-close-preview").on("click",(()=>{t.canvas.trigger("ajaxDialog:close")})),t.canvas.find(".attachment-download").on("click",(function(){const t=$(this),e=t.attr("href");t.attr("href",build_url(e,{from_preview:"1",download:"1"})),i().defer((()=>{t.attr("href",e)}))})),t.canvas.find(".attachment-preview-content, .attachment-preview-top-bar").on("click",(t=>{t.stopPropagation()})),$("body").add(e).on("keydown.attachmentPreview",(e=>{e.which===$.ui.keyCode.ESCAPE&&t.canvas.trigger("ajaxDialog:close")})),$("html, body").addClass("prevent-scrolling"),i().defer((()=>{e.show()}))},onLoadError(t){const e=location.hash;if(n(),404===t.status)return alertPopup(o.$T.gettext("This file no longer exists. Please reload the page.")),!1;if(403===t.status){if(Indico.User&&void 0!==Indico.User.id)alertPopup((0,o.$T)("You are not authorized to access this file."),(0,o.$T)("Access Denied"));else{const t=(0,o.$T)("This file is protected. You will be redirected to the login page.");confirmPrompt(t,(0,o.$T)("Access Denied")).then((()=>{location.href=build_url(Indico.Urls.Login,{next:location.href+e})}))}return!1}}}):n()}$(window).on("hashchange",((t,n)=>{if(0!==location.hash.indexOf("#preview:"))$(".attachment-preview-dialog").trigger("ajaxDialog:close",[!0]);else{if(n&&e){const t=location.hash;history.replaceState({},document.title,a),history.pushState({},document.title,location.href+t)}s(parseInt(location.hash.split("#preview:")[1],10))}})).triggerHandler("hashchange",[!0]),t.on("click",(function(t){1!==t.which||t.shiftKey||t.metaKey||t.ctrlKey||t.altKey||(t.preventDefault(),location.hash="#preview:{0}".format($(this).data("attachmentId")))}))}(),$(document).on("click","[data-attachment-editor]",(function(t){t.preventDefault();const e=$(this);if(this.disabled||e.hasClass("disabled"))return;!function(t,e,a,n){a=void 0===a||a,ajaxDialog({trigger:n,url:build_url(Indico.Urls.AttachmentManager,t),title:e||o.$T.gettext("Manage material"),confirmCloseUnsaved:!1,hidePageHeader:!0,onClose(t,e){e&&a?location.reload():e&&n&&n.trigger("attachments:updated")}})}($(this).data("locator"),$(this).data("title"),void 0!==e.data("reload-on-change"),e)}))})),t.setupAttachmentTreeView=function(){$(".attachments-box").on("click",".tree .expandable",a)},t.setupAttachmentEditor=function(){const t=$(".attachment-editor");function e(){t.trigger("ajaxDialog:setData",[!0])}t.on("click",".tree .expandable",a).on("click",".js-dialog-action",(function(t){t.preventDefault();const a=$(this);let n=a.data("title");n||void 0===n||(n=a.attr("title")||a.data("qtip-oldtitle")),ajaxDialog({trigger:this,url:a.data("href"),title:n,hidePageHeader:!0,onClose(t){t&&($("#attachments-container").html(t.attachment_list),e())}})})).on("indico:confirmed",".js-delete",(function(a){a.preventDefault();const n=$(this);$.ajax({url:n.data("href"),method:n.data("method"),complete:IndicoUI.Dialogs.Util.progress(),error:handleAjaxError,success(a){$("#attachments-container").html(a.attachment_list),handleFlashes(a,!0,t),e()}})}))},t.reloadManagementAttachmentInfoColumn=function(t,e){$.ajax({url:build_url(Indico.Urls.ManagementAttachmentInfoColumn,t),method:"GET",error:handleAjaxError,success(t){e.replaceWith(t.html)}})},t.messageIfFolderProtected=function(t,e,a,n,o,s){e.on("change",(function(){const e=$(this);a[e.val()]&&!t.prop("checked")?(n.hide(),o.hide(),s.find(".folder-name").html(e.children("option:selected").text()),s.show()):(s.hide(),n.toggle(t.prop("checked")),o.toggle(!t.prop("checked")))})),i().defer((()=>{e.triggerHandler("change")}))},t.setupAttachmentTooltipButtons=function(){$(".attachments-tooltip-button").each((function(){const t=$(this);t.qtip({content:{text:t.next(".material_list")},show:{event:"click"},hide:{event:"unfocus"},position:{my:"top right",at:"bottom left"},events:{show(){t.addClass("open")},hide(){t.removeClass("open")}},style:{classes:"material_tip"}})}))}}(window);var s=a(29079),r=a(49528);const c=s.default.bind(null,{endpoint:"attachments.package_status",rules:[{args:["event_id","task_id"],converters:{event_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"attachments",isDynamic:!1},{data:"/",isDynamic:!1},{data:"package",isDynamic:!1},{data:"/",isDynamic:!1},{data:"status",isDynamic:!1},{data:"/",isDynamic:!1},{data:"task_id",isDynamic:!0}]}]},"/");window.setupGeneratePackage=function(t){$("#filter_type input:radio").on("change",(function(){$("#form-group-sessions").toggle("sessions"===this.value),$("#form-group-contributions").toggle("contributions"===this.value),$("#form-group-dates").toggle("dates"===this.value)})),$("#filter_type input:radio:checked").trigger("change");const e=$("#download-package-form");let a;async function n(e){let i;try{i=await r.indicoAxios.get(c({event_id:t,task_id:e}))}catch(t){return(0,r.handleAxiosError)(t),void a()}i.data.download_url?(window.location.href=i.data.download_url,a()):n(e)}e.ajaxForm({error(...t){a(),handleAjaxError(...t)},beforeSubmit(){a=IndicoUI.Dialogs.Util.progress(o.$T.gettext("Building package"))},success(t){t.success?n(t.task_id):(handleFlashes(t,!0,e.find(".flashed-messages")),a())}})}}},t=>{t.O(0,[4644,4394,2076],(()=>{return e=31157,t(t.s=e);var e}));t.O()}]);
//# sourceMappingURL=module_attachments.29639c9c.bundle.js.map