"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[3717],{44494:(e,t,a)=>{var n=a(86326),i=a(94900),r=a(29079),l=a(97598),s=a.n(l),c=a(42430),m=a(87597),d=a(47279),o=a(52379),u=a(6423),g=a(49138),p=a(56237),y=a(57427),v=a(45423),f=a(46145),h=a(63173),E=a(29481),D=a(96478),b=a(49528);var _=a(24372),A=a(50081),T=a(92117),w=a(6841),C=a(54219),I=a(25838);const S=r.default.bind(null,{endpoint:"receipts.generate_receipts",rules:[{args:["event_id","template_id"],converters:{event_id:"IntegerConverter",template_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"manage",isDynamic:!1},{data:"/",isDynamic:!1},{data:"receipts",isDynamic:!1},{data:"/",isDynamic:!1},{data:"template_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"generate",isDynamic:!1}]}]},"/");function k({onRetry:e,onClose:t,errors:a}){const[i,r]=(0,n.useState)(!0);return n.createElement(T.A,{open:i,onClose:t,closeIcon:!0},n.createElement(T.A.Header,null,n.createElement(D.Translate,null,"Templating Errors")),n.createElement(T.A.Content,null,n.createElement(m.A,{error:!0},n.createElement(D.Translate,null,"There were some errors while trying to generate your documents.")),n.createElement(w.A,{celled:!0,fixed:!0},n.createElement(w.A.Header,null,n.createElement(w.A.Row,null,n.createElement(w.A.HeaderCell,null,n.createElement(D.Translate,null,"Registrant's name")),n.createElement(w.A.HeaderCell,null,n.createElement(D.Translate,null,"Missing fields")))),n.createElement(w.A.Body,null,a.map((({registration:e,undefineds:t})=>n.createElement(w.A.Row,{key:e.id},n.createElement(w.A.Cell,null,e.fullName),n.createElement(w.A.Cell,null,t.map((t=>n.createElement(C.A,{key:`${e.id}-${t}`,color:"red"},t)))))))))),n.createElement(T.A.Actions,null,n.createElement(I.A,null,n.createElement(p.A,{onClick:async()=>{await e(),r(!1),t()},primary:!0},n.createElement(d.A,{name:"sync"}),n.createElement(D.Translate,null,"Generate anyway")),n.createElement(p.A,{onClick:()=>{r(!1),t()}},n.createElement(D.Translate,null,"Cancel")))))}k.propTypes={onRetry:s().func.isRequired,onClose:s().func.isRequired,errors:s().arrayOf(s().shape({registration:s().shape({firstName:s().string,lastName:s().string}),undefineds:s().arrayOf(s().string)})).isRequired};var P=a(41834);const F=r.default.bind(null,{endpoint:"receipts.all_templates",rules:[{args:["event_id"],converters:{event_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"manage",isDynamic:!1},{data:"/",isDynamic:!1},{data:"receipts",isDynamic:!1},{data:"/",isDynamic:!1},{data:"templates",isDynamic:!1}]}]},"/"),R=r.default.bind(null,{endpoint:"receipts.images",rules:[{args:["event_id"],converters:{event_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"manage",isDynamic:!1},{data:"/",isDynamic:!1},{data:"receipts",isDynamic:!1},{data:"/",isDynamic:!1},{data:"images",isDynamic:!1}]}]},"/"),O=r.default.bind(null,{endpoint:"receipts.receipts_export",rules:[{args:["event_id","format"],converters:{event_id:"IntegerConverter",format:"AnyConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"manage",isDynamic:!1},{data:"/",isDynamic:!1},{data:"receipts",isDynamic:!1},{data:"/",isDynamic:!1},{data:"export",isDynamic:!1},{data:"/",isDynamic:!1},{data:"receipts.",isDynamic:!1},{data:"format",isDynamic:!0}]}]},"/"),x=r.default.bind(null,{endpoint:"receipts.receipts_preview",rules:[{args:["event_id","template_id"],converters:{event_id:"IntegerConverter",template_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"manage",isDynamic:!1},{data:"/",isDynamic:!1},{data:"receipts",isDynamic:!1},{data:"/",isDynamic:!1},{data:"template_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"preview",isDynamic:!1}]}]},"/"),z=({publish:e,notify_users:t},a)=>e?t?D.PluralTranslate.string("Publish and send to registrant","Publish and send to registrants",a):D.PluralTranslate.string("Save and publish to registration","Save and publish to registrations",a):t?D.PluralTranslate.string("Save and send to registrant","Save and send to registrants",a):D.PluralTranslate.string("Save to registration","Save to registrations",a),q=[{key:"pdf",value:"pdf",text:D.Translate.string("as a single PDF document")},{key:"zip",value:"zip",text:D.Translate.string("as a ZIP archive")}],K={pdf:"documents.pdf",zip:"documents.zip"};function L({onClose:e,registrationIds:t,eventId:a}){const[r,l]=(0,n.useState)([]),[s,T]=(0,n.useState)(!1),{data:w,loading:C}=(0,E.Ku)(F({event_id:a}),{trigger:a,camelize:!0,skipCamelize:"placeholders"}),I=!C&&!!w,L=async e=>{T(!0);try{const{data:t}=await b.indicoAxios.post(O((0,_.snakifyKeys)({eventId:a,format:e})),(0,_.snakifyKeys)({receiptIds:r}),{responseType:"blob"});!function(e,t){const a=new Blob([t]),n=document.createElement("a"),i=URL.createObjectURL(a);n.href=i,n.download=e,document.body.append(n),n.click(),n.remove(),URL.revokeObjectURL(i)}(K[e],t)}catch(e){(0,b.handleAxiosError)(e)}T(!1)};return n.createElement(h.Sz,{id:"print-receipts",size:"large",onSubmit:async e=>{const{receiptIds:r,error:s}=await async function(e,t,a){const r=async(t,n)=>{const{template:i,...r}=a;return r.registration_ids=t,r.force=n,(await b.indicoAxios.post(S((0,_.snakifyKeys)({eventId:e,templateId:i})),r)).data};try{const e=await r(t,!1);let a=e.receipt_ids;return e.errors.length&&await new Promise((t=>{(0,i.injectModal)((i=>n.createElement(k,{onRetry:async()=>{const t=await r([...new Set(e.errors.map((e=>e.registration.id)))],!0);a=[...a,...t.receipt_ids]},onClose:()=>{t(),i()},errors:(0,_.camelizeKeys)(e.errors)})))})),{receiptIds:a,error:null}}catch(e){return{receiptIds:null,error:(0,f.handleSubmitError)(e)}}}(a,t,e);if(s)return s;r.length>0&&l(r)},initialValues:{custom_fields:{},document_type:"none",filename:"document",save_config:!0},onClose:()=>e(r.length>0),header:D.Translate.string("Generate Documents"),keepDirtyOnReinitialize:!0,noSubmitButton:!0,disabledAfterSubmit:!0},(e=>{return n.createElement(n.Fragment,null,n.createElement(m.A,{color:0===r.length?"teal":"green"},n.createElement(d.A,{name:"print",size:"big"}),0===r.length?n.createElement(D.PluralTranslate,{count:t.length},n.createElement(D.Singular,null,"Generating document for a single registrant"),n.createElement(D.Plural,null,"Generating documents for"," ",n.createElement(D.Param,{name:"numberOfRegistrants",value:t.length,wrapper:n.createElement("strong",null)})," ","registrants")):n.createElement(D.PluralTranslate,{count:r.length},n.createElement(D.Singular,null,"Successfully generated document for a single registrant"),n.createElement(D.Plural,null,"Successfully generated"," ",n.createElement(D.Param,{name:"numberOfReceipts",value:r.length,wrapper:n.createElement("strong",null)})," ","documents"))),n.createElement(o.A,{columns:2,divided:!0},n.createElement(o.A.Column,null,n.createElement(f.FinalDropdown,{name:"template",loading:!I,label:D.Translate.string("Document Template"),placeholder:D.Translate.string("Select a document template"),options:I?w.map((({id:e,title:t})=>({key:e,text:t,value:e}))):[],onChange:(i=e.form,e=>{const{customFields:t,defaultFilename:a,title:n}=w.find((t=>t.id===e));i.change("custom_fields",t?Object.assign({},...t.map((e=>({[e.name]:(0,P.D)(e)})))):{}),i.change("filename",a||f.formatters.slugify(n))}),disabled:r.length>0,required:!0,selection:!0}),n.createElement(c.Field,{name:"template",subscription:{value:!0}},(({input:{value:e}})=>{return n.createElement(f.FinalField,{name:"custom_fields",component:P.A,customFields:e?(t=e,I&&w.find((e=>e.id===t))?.customFields):[],title:D.Translate.string("Template Parameters"),disabled:r.length>0,fetchImagesURL:R({event_id:a}),defaultOpen:!0});var t})),n.createElement(c.Field,{name:"template",subscription:{value:!0}},(({input:{value:e}})=>n.createElement(f.FinalInput,{name:"filename",label:D.Translate.string("Filename"),type:"text",componentLabel:"-{n}.pdf",labelPosition:"right",disabled:!e||r.length>0,format:e=>f.formatters.slugify(e).replace(/\.pdf$/,""),formatOnBlur:!0,required:!0,fluid:!0}))),n.createElement(f.FinalCheckbox,{name:"save_config",label:D.Translate.string("Remember settings"),description:D.Translate.string("Prefill template parameters (if present) and filename when generating more documents for the same template in this event."),disabled:r.length>0}),n.createElement(f.FinalCheckbox,{name:"publish",label:D.Translate.string("Publish document"),description:D.PluralTranslate.string("Make the resulting document available on the registration page.","Make the resulting documents available on the registration pages.",t.length),disabled:r.length>0}),n.createElement(c.Field,{name:"publish",subscription:{value:!0}},(({input:{value:e}})=>n.createElement(f.FinalCheckbox,{name:"notify_users",label:D.PluralTranslate.string("Notify registrants via e-mail","Notify registrants via e-mail",t.length),description:e?D.PluralTranslate.string("Send an e-mail to the registrant informing them that the document is available.","Send an e-mail to the registrants informing them that the document is available.",t.length):D.PluralTranslate.string("Send an e-mail to the registrant with the document attached.","Send an e-mail to the registrants with the document attached.",t.length),disabled:r.length>0}))),n.createElement(u.A.Group,{style:{alignItems:"center"}},n.createElement(c.FormSpy,{subscription:{values:!0}},(({values:e})=>n.createElement(f.FinalSubmitButton,{label:z(e,t.length),icon:e.notify_users?"send":"save",style:{width:"100%"},disabledAfterSubmit:!0,fluid:!0}))),r.length>0&&n.createElement(n.Fragment,null,n.createElement(d.A,{name:"check",color:"green",size:"large"}),n.createElement(g.A,{options:q,scrolling:!0,icon:null,value:null,selectOnBlur:!1,selectOnNavigation:!1,onChange:(e,{value:t})=>L(t),trigger:n.createElement(p.A,{icon:!0,style:{whiteSpace:"nowrap",marginLeft:"1em"},type:"button",loading:s},n.createElement(d.A,{name:"download"})," ",n.createElement(D.Translate,null,"Download")," ",n.createElement(d.A,{name:"caret down"}))})))),n.createElement(o.A.Column,null,n.createElement(c.Field,{name:"template",subscription:{value:!0}},(({input:{value:e}})=>n.createElement(c.Field,{name:"custom_fields",subscription:{value:!0}},(({input:{value:i}})=>e?n.createElement(A.A,{url:x((0,_.snakifyKeys)({eventId:a,templateId:e})),data:(0,_.snakifyKeys)({customFields:i,registrationIds:t})}):n.createElement(y.A,{placeholder:!0},n.createElement(v.A,{icon:!0},n.createElement(d.A,{name:"eye"}),n.createElement(D.Translate,null,"Please select a template to preview it..."))))))))));var i}))}L.propTypes={onClose:s().func.isRequired,registrationIds:s().arrayOf(s().string).isRequired,eventId:s().number.isRequired},window.printReceipts=function({registration_id:e,event_id:t,reload_after:a}){(0,i.injectModal)((i=>n.createElement(L,{onClose:e=>{e&&a?location.reload():i()},registrationIds:e,eventId:t})))}}},e=>{e.O(0,[4644,4394,2076],(()=>{return t=44494,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=module_receipts.cabe62b2.bundle.js.map