(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9609,9676],{74833:function(e,t,n){var a=n(56127),i=/^\s+/;e.exports=function(e){return e?e.slice(0,a(e)+1).replace(i,""):e}},56127:function(e){var t=/\s/;e.exports=function(e){for(var n=e.length;n--&&t.test(e.charAt(n)););return n}},66726:function(e,t,n){var a=n(11611),i=n(82846),s=n(91936),r=Math.max,l=Math.min;e.exports=function(e,t,n){var o,c,u,d,f,g,p=0,m=!1,h=!1,x=!0;if("function"!=typeof e)throw TypeError("Expected a function");function y(t){var n=o,a=c;return o=c=void 0,p=t,d=e.apply(a,n)}function v(e){var n=e-g,a=e-p;return void 0===g||n>=t||n<0||h&&a>=u}function j(){var e,n,a,s=i();if(v(s))return b(s);f=setTimeout(j,(e=s-g,n=s-p,a=t-e,h?l(a,u-n):a))}function b(e){return(f=void 0,x&&o)?y(e):(o=c=void 0,d)}function q(){var e,n=i(),a=v(n);if(o=arguments,c=this,g=n,a){if(void 0===f)return p=e=g,f=setTimeout(j,t),m?y(e):d;if(h)return clearTimeout(f),f=setTimeout(j,t),y(g)}return void 0===f&&(f=setTimeout(j,t)),d}return t=s(t)||0,a(n)&&(m=!!n.leading,u=(h="maxWait"in n)?r(s(n.maxWait)||0,t):u,x="trailing"in n?!!n.trailing:x),q.cancel=function(){void 0!==f&&clearTimeout(f),p=0,o=g=c=f=void 0},q.flush=function(){return void 0===f?d:b(i())},q}},82846:function(e,t,n){var a=n(77400);e.exports=function(){return a.Date.now()}},91936:function(e,t,n){var a=n(74833),i=n(11611),s=n(55193),r=0/0,l=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(s(e))return r;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=a(e);var n=o.test(e);return n||c.test(e)?u(e.slice(2),n?2:8):l.test(e)?r:+e}},89987:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/new-privacy-requests",function(){return n(20578)}])},30952:function(e,t,n){"use strict";n.d(t,{f:function(){return o}});var a=n(24246),i=n(66726),s=n.n(i),r=n(27378),l=n(26917);let o=e=>{let{value:t,onChange:n,placeholder:i,...o}=e,[c,u]=(0,r.useState)(t);(0,r.useEffect)(()=>{u(t||"")},[t]);let d=s()(n,500),f=(0,r.useCallback)(e=>{u(e),d(e)},[]);return(0,a.jsx)(l.Z,{value:c,onChange:f,onClear:()=>{u(""),n("")},placeholder:i,...o})}},58754:function(e,t,n){"use strict";var a=n(24246),i=n(39158),s=n(70788);t.Z=e=>{let{heading:t,breadcrumbItems:n,isSticky:r=!0,children:l,rightContent:o,style:c,...u}=e;return(0,a.jsxs)("div",{...u,style:r?{position:"sticky",top:"-24px",paddingTop:"24px",paddingBottom:"24px",paddingLeft:"40px",marginLeft:"-40px",paddingRight:"40px",marginRight:"-40px",marginTop:"-24px",left:0,zIndex:20,backgroundColor:"white",...c}:{paddingBottom:"24px",...c},children:[(0,a.jsxs)(i.jqI,{justify:"space-between",children:["string"==typeof t?(0,a.jsx)(i.lQT,{className:n||l?"pb-4":void 0,level:1,"data-testid":"page-heading",children:t}):t,o&&(0,a.jsx)("div",{"data-testid":"page-header-right-content",children:o})]}),!!n&&(0,a.jsx)(s.m,{className:l?"pb-4":void 0,items:n,"data-testid":"page-breadcrumb"}),l]})}},45259:function(e,t,n){"use strict";var a=n(24246),i=n(39158);let s={approved:{color:i.tAb.SUCCESS,label:"Approved"},complete:{color:i.tAb.SUCCESS,label:"Completed"},awaiting_email_send:{color:i.tAb.MARBLE,label:"Awaiting Email Send"},denied:{color:i.tAb.WARNING,label:"Denied"},canceled:{color:i.tAb.MARBLE,label:"Canceled"},error:{color:i.tAb.ERROR,label:"Error"},in_processing:{color:i.tAb.CAUTION,label:"In Progress"},paused:{color:i.tAb.MARBLE,label:"Paused"},pending:{color:i.tAb.INFO,label:"New"},identity_unverified:{color:i.tAb.MARBLE,label:"Unverified"},requires_input:{color:i.tAb.MINOS,label:"Requires Input"},requires_manual_finalization:{color:i.tAb.MINOS,label:"Requires Finalization"},duplicate:{color:i.tAb.DEFAULT,label:"Duplicate"}};t.Z=e=>{let{status:t}=e;return(0,a.jsx)(i.j8w,{color:s[t].color,className:"justify-center","data-testid":"request-status-badge",children:s[t].label})}},70788:function(e,t,n){"use strict";n.d(t,{m:function(){return c}});var a=n(24246),i=n(39158),s=n(79894),r=n.n(s),l=n(27378);let{Text:o}=i.AntTypography,c=e=>{let{items:t,...n}=e,s=(0,l.useMemo)(()=>null==t?void 0:t.map((e,n)=>{let s=n===t.length-1,l={...e},c=l.onClick&&!l.href;return("string"==typeof l.title&&(l.title=(0,a.jsx)(o,{style:{color:"inherit",maxWidth:s?void 0:400},ellipsis:!s,id:s?"breadcrumb-current-page":void 0,children:l.title})),c)?l.title=(0,a.jsx)(i.wpx,{type:"text",size:"small",icon:l.icon,onClick:l.onClick,className:"ant-breadcrumb-link -mt-px px-1 text-inherit",children:l.title}):(l.icon&&(l.title=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"anticon align-text-bottom",children:l.icon}),l.title]})),l.href&&l.title&&(l.title=(0,a.jsx)(r(),{href:l.href,className:"ant-breadcrumb-link",children:l.title}),delete l.href)),l}),[t]);return(0,a.jsx)(i.zrq,{items:s,...n})}},42478:function(e,t,n){"use strict";n.d(t,{FU:function(){return c},JE:function(){return i},Ki:function(){return d},SU:function(){return f},W:function(){return g},h9:function(){return s},jc:function(){return a},qt:function(){return o},sn:function(){return u}});let{useGetEmailInviteStatusQuery:a,useGetActiveMessagingProviderQuery:i,useCreateMessagingConfigurationMutation:s,useCreateMessagingConfigurationSecretsMutation:r,useGetMessagingConfigurationDetailsQuery:l,useGetMessagingConfigurationsQuery:o,useGetMessagingConfigurationByKeyQuery:c,useUpdateMessagingConfigurationByKeyMutation:u,useUpdateMessagingConfigurationSecretsByKeyMutation:d,useCreateTestConnectionMessageMutation:f,useDeleteMessagingConfigurationByKeyMutation:g}=n(78780).u.injectEndpoints({endpoints:e=>({getEmailInviteStatus:e.query({query:()=>({url:"/messaging/email-invite/status"}),providesTags:()=>["Email Invite Status"]}),createMessagingConfiguration:e.mutation({query:e=>({url:"messaging/config",method:"POST",body:e}),invalidatesTags:["Messaging Config","Configuration Settings"]}),getActiveMessagingProvider:e.query({queryFn:async(e,t,n,a)=>{let i=await a({url:"messaging/default/active"});return i.error&&404===i.error.status?{data:null}:i},providesTags:["Messaging Config"]}),createMessagingConfigurationSecrets:e.mutation({query:e=>({url:"messaging/default/".concat(e.service_type,"/secret"),method:"PUT",body:e.details}),invalidatesTags:["Messaging Config","Configuration Settings"]}),getMessagingConfigurationDetails:e.query({query:e=>({url:"messaging/default/".concat(e.type)}),providesTags:["Messaging Config"]}),getMessagingConfigurations:e.query({query:()=>({url:"messaging/config"}),providesTags:["Messaging Config"]}),getMessagingConfigurationByKey:e.query({query:e=>({url:"messaging/config/".concat(e.key)}),providesTags:["Messaging Config"]}),createTestConnectionMessage:e.mutation({query:e=>({url:"messaging/test/".concat(e.service_type),method:"POST",body:e.details}),invalidatesTags:["Messaging Config"]}),updateMessagingConfigurationByKey:e.mutation({query:e=>({url:"messaging/config/".concat(e.key),method:"PATCH",body:e.config}),invalidatesTags:["Messaging Config","Configuration Settings"]}),updateMessagingConfigurationSecretsByKey:e.mutation({query:e=>({url:"messaging/config/".concat(e.key,"/secret"),method:"PUT",body:e.secrets}),invalidatesTags:["Messaging Config","Configuration Settings"]}),deleteMessagingConfigurationByKey:e.mutation({query:e=>({url:"messaging/config/".concat(e.key),method:"DELETE"}),invalidatesTags:["Messaging Config","Configuration Settings"]})})})},59676:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return y}});var a=n(24246),i=n(39158),s=n(16134),r=n(27378),l=n(812),o=n(17245),c=n(90867);let u=(0,i.Gpc)((e,t)=>{let{handleBlur:n,subjectRequest:u}=e,d=(0,s.T)(),[f,g]=(0,r.useState)(!1),{errorAlert:p,successAlert:m}=(0,o.VY)(),{errorRequests:h}=(0,s.C)(c.fe),[x]=(0,c.JD)(),[y]=(0,c.Fq)(),v=async()=>{g(!0);let e=await x(h);(0,l.D4)(e)?(d((0,c.uT)({checkAll:!1,errorRequests:[]})),p((0,l.e$)(e.error),"DSR batch automation has failed due to the following:",{duration:null})):(e.data.failed.length>0&&p((0,a.jsxs)(i.xuv,{children:["DSR automation has failed for"," ",(0,a.jsx)(i.xvT,{as:"span",fontWeight:"semibold",children:e.data.failed.length})," ","privacy request(s). Please review the event log for further details."]}),void 0,{containerStyle:{maxWidth:"max-content"},duration:null}),e.data.succeeded.length>0&&m("Privacy request(s) are now being reprocessed.")),g(!1)},j=async()=>{if(!u)return;g(!0);let e=await y(u);(0,l.D4)(e)?p((0,l.e$)(e.error),"DSR automation has failed for this privacy request due to the following:",{duration:null}):m("Privacy request is now being reprocessed."),g(!1),n&&n(t)};return(0,a.jsx)(i.wpx,{disabled:f,loading:f,onClick:u?j:v,ref:t,size:"small",icon:(0,a.jsx)(i.AyE,{}),children:"Reprocess"})});var d=n(34090),f=n(55484);let g=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,p=e=>g.test(e),m=(0,i.Gpc)((e,t)=>{let{isRequired:n=!1,...s}=e,{emails:l}=s.form.values,[o,c]=(0,r.useState)(""),u=e=>l.includes(e),d=e=>{e.map(e=>e.trim()).filter(e=>p(e)&&!u(e)).forEach(e=>s.push(e)),c("")};return(0,a.jsxs)(i.NIc,{alignItems:"baseline",display:"inline-flex",isInvalid:!!s.form.errors[s.name],isRequired:n,children:[(0,a.jsx)(i.lXp,{fontSize:"md",htmlFor:"email",children:"Email"}),(0,a.jsxs)(i.gCW,{align:"flex-start",w:"inherit",children:[(0,a.jsx)(i.IIB,{autoComplete:"off",placeholder:"Type or paste email addresses separated by commas and press `Enter` or `Tab`...",onChange:e=>{c(e.target.value)},onKeyDown:e=>{["Enter","Tab",","].includes(e.key)&&(e.preventDefault(),d([o]))},onPaste:e=>{e.preventDefault(),d(e.clipboardData.getData("text").split(","))},ref:t,size:"sm",type:"email",value:o}),(0,a.jsx)(i.J1D,{children:s.form.errors[s.name]}),l.length>0&&(0,a.jsx)(i.Eq9,{spacing:1,mb:3,pt:"8px",children:l.map((e,t)=>(0,a.jsxs)(i.Vp9,{borderRadius:"full",backgroundColor:"primary.400",color:"white",size:"sm",variant:"solid",children:[(0,a.jsx)(i.Sn0,{children:e}),(0,a.jsx)(i.SD9,{onClick:()=>{s.remove(t)}})]},e))})]})]})}),h=f.Ry().shape({emails:f.IX(f.Z_()).when(["notify"],{is:!0,then:()=>f.IX(f.Z_()).min(1,"Must enter at least one valid email").label("Email")}),notify:f.O7(),minErrorCount:f.Rx().required()});var x=()=>{let{isOpen:e,onOpen:t,onClose:n}=(0,i.qY0)(),[s,u]=(0,r.useState)({emails:[],notify:!1,minErrorCount:1}),f=(0,r.useRef)(null),{errorAlert:g,successAlert:p}=(0,o.VY)(),[x,y]=(0,r.useState)(!0),{data:v}=(0,c.tE)(void 0,{skip:x}),[j]=(0,c.SC)(),b=async(e,t)=>{t.setSubmitting(!0);let a=await j({email_addresses:e.emails,notify_after_failures:e.notify?e.minErrorCount:0});(0,l.D4)(a)?g((0,l.e$)(a.error),"Configure alerts and notifications has failed to save due to the following:"):p("Configure alerts and notifications saved successfully."),t.setSubmitting(!1),n()};return(0,r.useEffect)(()=>{e&&y(!1),v&&u({emails:v.email_addresses,notify:0!==v.notify_after_failures,minErrorCount:v.notify_after_failures})},[v,e]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.wpx,{onClick:t,title:"Configure alerts","aria-label":"Configure alerts",icon:(0,a.jsx)(i.Dkj,{})}),(0,a.jsx)(d.J9,{enableReinitialize:!0,initialValues:s,onSubmit:b,validationSchema:h,children:t=>(0,a.jsxs)(i.dys,{isOpen:e,placement:"right",initialFocusRef:f,onClose:()=>{t.resetForm(),n()},size:"lg",children:[(0,a.jsx)(i.P1B,{}),(0,a.jsxs)(i.scA,{color:"gray.900",children:[(0,a.jsx)(i.cCv,{}),(0,a.jsxs)(i.OXI,{color:"gray.900",children:[(0,a.jsx)(i.xvT,{fontSize:"2xl",fontWeight:"normal",mb:4,children:"Configure alerts and notifications"}),(0,a.jsx)(i.xuv,{mt:"26px",children:(0,a.jsx)(i.xvT,{fontSize:"md",fontWeight:"normal",children:"Setup your alerts to send you a notification when there are any processing failures. You can also setup a threshold for connector failures for Fides to notify you after X amount of failures have occurred."})})]}),(0,a.jsx)(i.Ng0,{mt:"20px",children:(0,a.jsxs)(d.l0,{id:"configure-alerts-form",noValidate:!0,children:[(0,a.jsx)(i.xvT,{fontSize:"md",children:"Contact details"}),(0,a.jsxs)(i.gCW,{align:"stretch",gap:"29px",mt:"14px",children:[(0,a.jsx)(i.Ugi,{children:(0,a.jsx)(d.F2,{name:"emails",render:e=>(0,a.jsx)(m,{...e,isRequired:t.values.notify,ref:f})})}),(0,a.jsx)(i.Ugi,{children:(0,a.jsx)(d.gN,{id:"notify",name:"notify",children:e=>{let{field:n}=e;return(0,a.jsxs)(i.NIc,{alignItems:"center",display:"flex",mt:"45px",children:[(0,a.jsx)(i.lXp,{fontSize:"md",mb:"0",children:"Notify me immediately if there are any DSR processing errors"}),(0,a.jsx)(i.rAg,{checked:t.values.notify,onChange:(e,a)=>{n.onChange(a),t.setFieldValue(n.name,e),t.setFieldValue("minErrorCount",1),e||setTimeout(()=>{t.setFieldTouched("emails",!1)},0)}})]})}})})]}),(0,a.jsx)(i.xvT,{color:"#757575",fontSize:"sm",mt:"11px",children:"If selected, then Fides will notify you by your chosen method of communication every time the system encounters a data subject request processing error. You can turn this off anytime and setup a more suitable notification method below if you wish."}),t.values.notify&&(0,a.jsx)(i.Ugi,{mt:"34px",children:(0,a.jsx)(d.gN,{id:"minErrorCount",name:"minErrorCount",children:e=>{let{field:n,meta:s}=e;return(0,a.jsxs)(i.NIc,{alignItems:"center",display:"flex",isInvalid:!!(s.error&&s.touched),isRequired:!0,children:[(0,a.jsx)(i.xvT,{children:"Notify me after"}),(0,a.jsxs)(i.Y2U,{allowMouseWheel:!0,color:"gray.700",defaultValue:t.values.minErrorCount||1,min:1,ml:"8px",mr:"8px",onChange:(e,n)=>{t.setFieldValue("minErrorCount",n)},size:"sm",w:"80px",children:[(0,a.jsx)(i.zuI,{...n}),(0,a.jsxs)(i.FiK,{children:[(0,a.jsx)(i.WQu,{}),(0,a.jsx)(i.Y_d,{})]})]}),(0,a.jsx)(i.xvT,{children:"DSR processing errors "})]})}})})]})}),(0,a.jsx)(i.zeN,{justifyContent:"flex-start",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.wpx,{onClick:()=>{t.resetForm(),n()},children:"Cancel"}),(0,a.jsx)(i.wpx,{form:"configure-alerts-form",disabled:t.isSubmitting,loading:t.isSubmitting,htmlType:"submit",children:"Save"})]})})]})]})})]})},y=()=>{let{errorRequests:e}=(0,s.C)(c.fe);return(0,a.jsxs)(i.kCb,{gap:4,children:[(null==e?void 0:e.length)>0&&(0,a.jsx)(u,{}),(0,a.jsx)(x,{})]})}},20578:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eo}});var a,i,s=n(24246),r=n(39158),l=n(27378),o=n(25980),c=n(35287),u=n(58754),d=n(19904),f=n(28686),g=n(59676);let p=e=>{let{selectedIds:t,menuItems:n}=e,a=t.length>0;return(0,s.jsx)(r.S0p,{menu:{items:n},disabled:!a,children:(0,s.jsxs)(r.wpx,{"data-testid":"bulk-actions-btn",disabled:!a,children:["Actions",(0,s.jsx)(r.PJP._ME,{})]})})},m=e=>{let{currentPageKeys:t}=null!=e?e:{},[n,a]=(0,l.useState)([]),i=(0,l.useCallback)(()=>{a([])},[]),s=(0,l.useMemo)(()=>t&&0!==t.length?t.every(e=>n.includes(e))?"checked":n.length>0&&t.some(e=>n.includes(e))?"indeterminate":"unchecked":"unchecked",[t,n]),r=(0,l.useCallback)(e=>{if(t){if(e)a([...new Set([...n,...t])]);else{let e=new Set(t);a(n.filter(t=>!e.has(t)))}}},[n,t]);return{selectedIds:n,setSelectedIds:a,clearSelectedIds:i,checkboxSelectState:s,handleSelectAll:r}},{Text:h}=r.AntTypography,x=e=>{let{selectedIds:t,totalResults:n}=e,a=t.length>0;return(0,s.jsxs)(r.jqI,{gap:8,align:"center",children:[a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(h,{strong:!0,"data-testid":"selected-count",children:[t.length," selected"]}),void 0!==n&&(0,s.jsx)(h,{type:"secondary",children:" / "})]}),void 0!==n&&(0,s.jsxs)(h,{type:"secondary","data-testid":"total-results",children:[n," results"]})]})};var y=n(90867),v=n(9270),j=n(79894),b=n.n(j),q=n(86677),E=n(16394),C=n(60240);let _=e=>{var t;let{className:n,currentStatusFilter:a}=e,i=(0,q.useRouter)(),{data:l}=(0,y.R2)({status:[C.q2.DUPLICATE],page:1,size:1}),o=null!==(t=null==l?void 0:l.total)&&void 0!==t?t:0;return(null==a?void 0:a.length)===1&&a[0]===C.q2.DUPLICATE||0===o?null:(0,s.jsx)(b(),{href:{pathname:i.pathname,query:{status:C.q2.DUPLICATE}},passHref:!0,legacyBehavior:!0,children:(0,s.jsxs)(r.wpx,{type:"text","data-testid":"duplicate-requests-button",className:n,children:[o," duplicate"," ",(0,E._6)(o,"request","requests")]})})};(a=i||(i={})).APPROVE="approve",a.DENY="deny",a.DELETE="delete";let T={[C.q2.PENDING]:["approve","deny","delete"],[C.q2.DUPLICATE]:["approve","deny","delete"],[C.q2.IDENTITY_UNVERIFIED]:["delete"],[C.q2.REQUIRES_INPUT]:["delete"],[C.q2.APPROVED]:["delete"],[C.q2.DENIED]:["delete"],[C.q2.IN_PROCESSING]:["delete"],[C.q2.COMPLETE]:["delete"],[C.q2.PAUSED]:["delete"],[C.q2.AWAITING_EMAIL_SEND]:["delete"],[C.q2.REQUIRES_MANUAL_FINALIZATION]:["delete"],[C.q2.CANCELED]:["delete"],[C.q2.ERROR]:["delete"]},w=e=>T[e.status],I=(e,t)=>t.some(t=>w(t).includes(e)),P=e=>{let{form:t}=e;return(0,s.jsx)(r.PPS,{form:t,layout:"vertical",children:(0,s.jsx)(r.PPS.Item,{name:"denialReason",rules:[{required:!0,message:"Please enter a reason for denial"}],children:(0,s.jsx)(r.uFc.TextArea,{placeholder:"Enter reason for denial...",rows:4})})})},A=e=>{let{openFormModal:t}=(0,r.U8S)(e);return{openDenyPrivacyRequestModal:(0,l.useCallback)(async e=>{let n=await t({title:"Privacy request denial",content:t=>(0,s.jsxs)(r.jqI,{vertical:!0,gap:2,children:[e&&(0,s.jsx)(r.FUI,{children:e}),(0,s.jsx)(r.FUI,{children:"Please enter a reason for denying this privacy request. Please note: this can be seen by the user in their notification email."}),(0,s.jsx)(P,{form:t})]}),okText:"Confirm",cancelText:"Cancel",width:500,centered:!0});return n?null==n?void 0:n.denialReason:null},[t])}},S={[i.APPROVE]:"approved",[i.DENY]:"denied",[i.DELETE]:"deleted"},N={[i.APPROVE]:{title:"Approve privacy requests",verb:"approve"},[i.DENY]:{title:"Privacy request denial",verb:"deny"},[i.DELETE]:{title:"Delete privacy requests",verb:"delete",okType:"danger"}},D=(e,t,n)=>{let a=S[e];return n>0&&t>0?{type:"warning",message:"Successfully ".concat(a," ").concat(t," ").concat((0,E._6)(t,"request","requests"),". ").concat(n," ").concat((0,E._6)(n,"request","requests")," failed.")}:n>0?{type:"error",message:"Failed to ".concat(e," ").concat(n," ").concat((0,E._6)(n,"request","requests"),".")}:{type:"success",message:"Successfully ".concat(a," ").concat(t," privacy ").concat((0,E._6)(t,"request","requests"))}},k=e=>{let{requests:t,selectedIds:n,modalApi:a}=e,o=(0,l.useMemo)(()=>t.filter(e=>n.includes(e.id)),[t,n]),c=(0,r.UD8)(),[u]=(0,y.AG)(),[d]=(0,y.ZZ)(),[f]=(0,y.AL)(),{openDenyPrivacyRequestModal:g}=A(a),p=(0,l.useCallback)(async e=>{let t;let n=o.length,s=o.filter(t=>w(t).includes(e)),r=s.length;t=r===n?"You are about to ".concat(N[e].verb," ").concat(n," privacy ").concat((0,E._6)(n,"request","requests"),". Are you sure you want to continue?"):"You have selected ".concat(n," ").concat((0,E._6)(n,"request","requests"),", but only ").concat(r," ").concat((0,E._6)(r,"request","requests")," can perform this action. If you continue, the bulk action will only be applied to ").concat(r," ").concat((0,E._6)(r,"request","requests"),".");let l=s.map(e=>e.id);if(e===i.DENY){let n=await g(t);if(!n)return;let a=l.length,i=c.loading("Executing bulk action on ".concat(a," privacy ").concat((0,E._6)(a,"request","requests"),"..."),0),s=await d({request_ids:l,reason:n});if(i(),"error"in s)c.error("Failed to deny requests. Please try again.",5);else if("data"in s){var p,m;let{type:t,message:n}=D(e,(null===(p=s.data.succeeded)||void 0===p?void 0:p.length)||0,(null===(m=s.data.failed)||void 0===m?void 0:m.length)||0);c[t](n,5)}}else a.confirm({title:N[e].title,content:t,okText:"Continue",cancelText:"Cancel",okType:N[e].okType,onOk:async()=>{let t;if(0===l.length)return;let n=l.length,a=c.loading("Executing bulk action on ".concat(n," privacy ").concat((0,E._6)(n,"request","requests"),"..."),0);if(e===i.APPROVE?t=await u({request_ids:l}):e===i.DELETE&&(t=await f({request_ids:l})),a(),t){if("error"in t){let t=e===i.APPROVE?"approve":"delete";c.error("Failed to ".concat(t," requests. Please try again."),5)}else if("data"in t){var s,r;let{type:n,message:a}=D(e,(null===(s=t.data.succeeded)||void 0===s?void 0:s.length)||0,(null===(r=t.data.failed)||void 0===r?void 0:r.length)||0);c[n](a,5)}}}})},[o,g,d,u,f,c,a]);return{bulkActionMenuItems:(0,l.useMemo)(()=>{let e=I(i.APPROVE,o),t=I(i.DENY,o),n=I(i.DELETE,o);return[{key:i.APPROVE,label:"Approve",icon:(0,s.jsx)(r.PJP.MCw,{}),onClick:()=>p(i.APPROVE),disabled:!e},{key:i.DENY,label:"Deny",icon:(0,s.jsx)(r.PJP.x8P,{}),onClick:()=>p(i.DENY),disabled:!t},{type:"divider"},{key:i.DELETE,label:"Delete",icon:(0,s.jsx)(r.PJP.ZNm,{}),danger:!0,onClick:()=>p(i.DELETE),disabled:!n}]},[o,p])}};var R=n(40431),M=n(71784),O=n(90449),F=e=>{let{pagination:t}=e,n=[...M.MP.keys()],[a,i]=(0,R.XI)({search:R.Oi.withOptions({throttleMs:300}),from:R.Oi,to:R.Oi,status:(0,R.S$)((0,R.jx)(n)),action_type:(0,R.S$)((0,R.jx)(Object.values(C.Us))),custom_privacy_request_fields:O.Pp},{history:"push"}),[s,r]=(0,R.XI)({sort_field:R.Oi,sort_direction:(0,R.jx)(Object.values(C.AV))},{history:"push"}),o=(0,l.useMemo)(()=>({fuzzy_search_str:a.search,from:a.from,to:a.to,status:a.status,action_type:a.action_type,custom_privacy_request_fields:(0,O.$u)(a.custom_privacy_request_fields),sort_field:s.sort_field,sort_direction:s.sort_direction}),[a.search,a.from,a.to,a.status,a.action_type,a.custom_privacy_request_fields,s.sort_field,s.sort_direction]),{resetPagination:c}=t;return(0,l.useEffect)(()=>{c()},[o,c]),{filters:a,setFilters:i,sortState:s,setSortState:r,filterQueryParams:o}},U=n(19785),Y=n.n(U),L=n(65567),z=n.n(L),V=n(98855),Z=n(27693),W=n.n(Z);let K=[C.q2.COMPLETE,C.q2.CANCELED,C.q2.DENIED,C.q2.IDENTITY_UNVERIFIED],B=e=>{let{status:t,daysLeft:n,timeframe:a=45}=e;if(null!=n&&null!=a&&!K.includes(t)){let e=100*n/a<25?r.tAb.ERROR:r.tAb.DEFAULT;return(0,s.jsx)("div",{children:(0,s.jsx)(r.j8w,{color:e,bordered:!1,children:(0,s.jsx)(r.esZ,{title:(0,E.p6)(W()().add(n,"day").toDate()),children:(0,s.jsxs)(s.Fragment,{children:[n," days left"]})})})})}return null};var J=n(77830),X=n(45259);let $=e=>{var t;let{privacyRequest:n}=e,a=(0,q.useRouter)();return(0,s.jsxs)(r.jqI,{gap:12,wrap:!0,align:"center",children:[(0,s.jsx)("div",{className:"flex min-w-[100px] gap-2",children:(0,s.jsx)(r.AntTypography.Title,{level:3,children:(0,s.jsxs)(r.AntTypography.Link,{href:"/privacy-requests/".concat(n.id),variant:"primary",onClick:e=>{e.preventDefault(),a.push({pathname:J.ld,query:{id:n.id}})},children:[null===(t=n.policy.rules)||void 0===t?void 0:t.map(e=>M.rE.get(e.action_type)).join("/")," ","request"]})})}),(0,s.jsx)(X.Z,{status:n.status}),(0,s.jsx)(r.AntTypography.Text,{type:"secondary",copyable:{text:n.id,icon:(0,s.jsx)(r.PJP.CKM,{className:"size-4 text-[var(--ant-color-text-secondary)]"}),tooltips:["Copy request ID","Copied"]},children:n.id})]})},G=e=>{let{label:t,children:n}=e;return(0,s.jsxs)(r.jqI,{gap:"small",wrap:!0,children:[(0,s.jsxs)(r.lKn,{type:"secondary",children:[t,":"]}),(0,s.jsx)(r.lKn,{ellipsis:{tooltip:!0},className:"!max-w-60",children:n})]})};var Q=n(51980);let H=e=>{let{createdAt:t}=e;return t?(0,s.jsx)(G,{label:"Received",children:(0,s.jsx)(r.lKn,{type:"secondary",children:(0,s.jsx)(r.esZ,{title:(0,E.p6)(new Date(t)),children:(0,E.G8)((0,Q.B)(new Date(t),new Date,{addSuffix:!0}))})})}):null},ee=e=>{let{item:t,checkbox:n}=e,a=(0,O.o8)(t.identity),i=(0,O.Ub)(t.identity,a),l=(0,O.aP)(t.custom_privacy_request_fields),o=i.length>0||l.length>0||!!t.location,c=t.location?(()=>{try{return(0,r.QCN)(t.location)}catch(e){return}})():void 0;return(0,s.jsxs)(r.krs.Item,{children:[(0,s.jsx)("div",{className:"pr-4",children:n}),(0,s.jsxs)(r.jqI,{vertical:!0,gap:"small",className:"grow pr-8",children:[(0,s.jsx)($,{privacyRequest:t}),(0,s.jsxs)(r.jqI,{vertical:!0,gap:"small",wrap:!0,children:[(0,s.jsxs)(r.jqI,{gap:"small",wrap:!0,children:[a&&(0,s.jsx)(G,{label:a.label,children:a.value}),(0,s.jsx)(r.j8w,{children:t.policy.name}),(0,s.jsx)(r.j8w,{children:t.source})]}),o&&(0,s.jsxs)(r.jqI,{wrap:!0,className:"gap-x-3 gap-y-2",children:[t.location&&(0,s.jsx)(G,{label:"Location",children:c?(0,r.c1K)({isoEntry:c,showFlag:!0}):t.location},"location"),i.map(e=>(0,s.jsx)(G,{label:e.label,children:e.value},e.key)),l.map(e=>(0,s.jsx)(G,{label:e.label,children:Y()(e.value)?e.value.join(" - "):z()(e.value)},e.key))]})]})]}),(0,s.jsxs)("div",{className:"flex shrink-0 flex-col items-end gap-2 pr-2 2xl:flex-row 2xl:gap-4",children:[(0,s.jsx)(B,{daysLeft:t.days_left,status:t.status,timeframe:t.policy.execution_timeframe}),(0,s.jsx)(H,{createdAt:t.created_at})]}),(0,s.jsx)(r.jqI,{className:"min-w-[90px]",align:"center",justify:"end",gap:"small",children:(0,s.jsx)(V.q,{subjectRequest:t},"other-actions")})]})};var et=n(30952);let en=e=>{let{fieldName:t,fieldDefinition:n,value:a,onChange:i}=e,{label:l,field_type:o,options:c}=n;if("location"===o||"multiselect"===o)return null;if("select"===o){var u;let e=null!==(u=null==c?void 0:c.map(e=>({label:e,value:e})))&&void 0!==u?u:[];return(0,s.jsx)(r.WPr,{placeholder:l,options:e,value:a||void 0,onChange:e=>{i(e||null)},allowClear:!0,"data-testid":"custom-field-filter-".concat(t),"aria-label":l,className:"w-44"})}return(0,s.jsx)(r.uFc,{placeholder:l,value:a||"",onChange:e=>i(e.target.value||null),allowClear:!0,"data-testid":"custom-field-filter-".concat(t),"aria-label":l,className:"w-44"})},ea=e=>{let{filters:t,setFilters:n}=e,{data:a}=(0,y.xv)(),i=(0,l.useMemo)(()=>(0,O.V1)(null==a?void 0:a.actions),[null==a?void 0:a.actions]),o=(e,a)=>{let i=Object.fromEntries(Object.entries({...t.custom_privacy_request_fields||{},[e]:a}).filter(e=>{let[,t]=e;return null!==t}));n({custom_privacy_request_fields:Object.keys(i).length>0?i:null})},c=e=>(0,s.jsxs)("span",{children:["+ ",e.length]});return(0,s.jsxs)(r.jqI,{gap:"small",align:"center",justify:"flex-start",wrap:!0,children:[(0,s.jsx)(et.f,{placeholder:"Request ID or identity value",value:t.search||"",onChange:e=>n({search:e||null}),variant:"compact","data-testid":"privacy-request-search"}),(0,s.jsx)(r.cv2.RangePicker,{format:"YYYY-MM-DD",value:t.from&&t.to?[W()(t.from),W()(t.to)]:null,onChange:e=>{let[t,a]=e||[null,null];n({from:null==t?void 0:t.format("YYYY-MM-DD"),to:null==a?void 0:a.format("YYYY-MM-DD")})},placeholder:["From","To"],allowClear:!0,"data-testid":"date-range-filter","aria-label":"Date range",className:"w-60"}),(0,s.jsx)(r.WPr,{mode:"multiple",placeholder:"Status",options:M.I3,value:t.status||[],onChange:e=>{n({status:e.length>0?e:null})},allowClear:!0,maxTagCount:"responsive","data-testid":"request-status-filter","aria-label":"Status",className:"w-44",maxTagPlaceholder:c}),(0,s.jsx)(r.WPr,{mode:"multiple",placeholder:"Request type",options:M.kN,value:t.action_type||[],onChange:e=>{n({action_type:e.length>0?e:null})},allowClear:!0,maxTagCount:"responsive","data-testid":"request-action-type-filter","aria-label":"Request type",className:"w-44",maxTagPlaceholder:c}),Object.entries(i).map(e=>{var n,a;let[i,r]=e;return(0,s.jsx)(en,{fieldName:i,fieldDefinition:r,value:null!==(a=null===(n=t.custom_privacy_request_fields)||void 0===n?void 0:n[i])&&void 0!==a?a:null,onChange:e=>o(i,e)},i)})]})},ei=()=>{let e=(0,v.S)(),{filterQueryParams:t,filters:n,setFilters:a}=F({pagination:e}),i=(0,r.UD8)(),[o,c]=r.$zI.useModal(),{data:u,isLoading:d,isFetching:f,refetch:g}=(0,y.R2)({...t,page:e.pageIndex,size:e.pageSize}),{items:h,total:j}=(0,l.useMemo)(()=>{let e=u||{items:[],total:0,pages:0},t=e.items.map(e=>({...e,key:e.id}));return{...e,items:t}},[u]),{selectedIds:b,setSelectedIds:q,clearSelectedIds:E,checkboxSelectState:C,handleSelectAll:T}=m({currentPageKeys:h.map(e=>e.id)});(0,l.useEffect)(()=>{E()},[h,E]);let[w]=(0,y.YO)(),I=async()=>{let e;try{await w(t)}catch(t){e=t instanceof Error?t.message:"Unknown error occurred"}e&&i.error(e,5e3)},{bulkActionMenuItems:P}=k({requests:h,selectedIds:b,modalApi:o});return(0,s.jsxs)("div",{children:[(0,s.jsx)(r.jqI,{gap:"small",align:"center",className:"mb-4",children:(0,s.jsx)(ea,{filters:n,setFilters:a})}),(0,s.jsxs)(r.jqI,{gap:"small",align:"center",justify:"space-between",className:"mb-2",children:[(0,s.jsxs)(r.jqI,{align:"center",gap:"small",children:[(0,s.jsx)(r.E_O,{id:"select-all",checked:"checked"===C,indeterminate:"indeterminate"===C,onChange:e=>T(e.target.checked)}),(0,s.jsx)("label",{htmlFor:"select-all",className:"cursor-pointer",children:"Select all"}),(0,s.jsx)("div",{className:"ml-3",children:(0,s.jsx)(x,{selectedIds:b,totalResults:null!=j?j:0})})]}),(0,s.jsxs)(r.jqI,{align:"center",gap:"small",children:[(0,s.jsx)(_,{className:"ml-3",currentStatusFilter:n.status}),(0,s.jsx)(p,{selectedIds:b,menuItems:P}),(0,s.jsx)(r.wpx,{"aria-label":"Reload","data-testid":"reload-btn",icon:(0,s.jsx)(r.PJP.CQM,{}),onClick:()=>g()}),(0,s.jsx)(r.wpx,{"aria-label":"Export report","data-testid":"export-btn",icon:(0,s.jsx)(r.PJP.UWx,{}),onClick:I})]})]}),d?(0,s.jsx)("div",{className:"p-2",children:(0,s.jsx)(r.krs,{dataSource:Array(25).fill({}),renderItem:()=>(0,s.jsx)(r.krs.Item,{children:(0,s.jsx)(r.N_L,{})})})}):(0,s.jsxs)(r.jqI,{vertical:!0,gap:"middle",children:[(0,s.jsx)(r.ZJQ,{spinning:f,children:(0,s.jsx)(r.krs,{dataSource:h,rowSelection:{selectedRowKeys:b,onChange:q},renderItem:(e,t,n)=>(0,s.jsx)(ee,{item:e,checkbox:n})})}),(0,s.jsx)(r.B7X,{...e.paginationProps,showTotal:(e,t)=>"".concat(t[0],"-").concat(t[1]," of ").concat(e," items"),total:null!=j?j:0,align:"start"})]}),c]})};var es=n(88152),er=n(72281),el=n(86291),eo=()=>{let{processing:e}=(0,es.Y)(),{plus:t}=(0,o.hz)(),{activeTab:n,handleTabChange:a,availableTabs:i}=(0,er.d)();(0,l.useEffect)(()=>{e()},[e]);let p=(0,l.useMemo)(()=>{let e=[];return i.request&&e.push({key:er.G.REQUEST,label:"Request",children:(0,s.jsx)(ei,{})}),i.manualTask&&e.push({key:er.G.MANUAL_TASK,label:"Manual tasks",children:(0,s.jsx)(f.m,{})}),e},[i.manualTask,i.request]);return(0,s.jsxs)(c.Z,{title:"Privacy Requests",mainProps:{minWidth:"784px",overflowY:"scroll"},fullHeight:!0,children:[(0,s.jsx)(u.Z,{heading:"Privacy Requests",breadcrumbItems:[{title:"All requests"}],rightContent:(0,s.jsxs)(r.vyj,{children:[t&&(0,s.jsx)(d.ZP,{scopes:[C.Sh.PRIVACY_REQUEST_CREATE],children:(0,s.jsx)(el.Z,{})}),(0,s.jsx)(g.default,{})]}),"data-testid":"privacy-requests"}),(0,s.jsx)(r.A5g,{activeKey:n,onChange:a,items:p})]})}}},function(e){e.O(0,[431,7245,3655,7654,2888,9774,179],function(){return e(e.s=89987)}),_N_E=e.O()}]);