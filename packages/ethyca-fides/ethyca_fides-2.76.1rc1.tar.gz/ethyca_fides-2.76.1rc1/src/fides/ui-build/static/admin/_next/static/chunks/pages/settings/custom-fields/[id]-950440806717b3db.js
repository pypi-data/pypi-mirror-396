(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[845],{13910:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings/custom-fields/[id]",function(){return s(63730)}])},34435:function(e,t,s){"use strict";var i=s(24246),n=s(39158),l=s(86677),r=s(27378),a=s(812),o=s(77830),d=s(19904),u=s(8917),c=s(67522),p=s(66006),m=s(66236),P=s(32885),x=s(60240),_=s(31883);let h=()=>(0,i.jsxs)(n.N_L,{active:!0,children:[(0,i.jsx)(n.N_L.Input,{}),(0,i.jsx)(n.N_L.Input,{}),(0,i.jsx)(n.N_L.Input,{}),(0,i.jsx)(n.N_L.Input,{}),(0,i.jsx)(n.N_L.Button,{})]}),y=e=>u.uP.has(e)?u.uP.get(e):e.startsWith("taxonomy:")||e.startsWith("system:")?e:"taxonomy:".concat(e);t.Z=e=>{var t;let{initialField:s,isLoading:v}=e,[j]=n.PPS.useForm(),f=n.PPS.useWatch("value_type",j),E=n.PPS.useWatch("name",j),g=(0,l.useRouter)(),{resource_type:S}=g.query,L=(0,n.UD8)(),{createOrUpdate:C}=(0,c.Z)(),{data:T,isLoading:b}=(0,P.vA)(null==s?void 0:s.allow_list_id,{skip:!(null==s?void 0:s.allow_list_id)}),[I,{isLoading:w}]=(0,P.UF)(),{data:N,isLoading:U}=(0,P.Az)(),{valueTypeOptions:F}=(0,p.Z)(),A=(0,d.Tg)([x.Sh.CUSTOM_FIELD_DELETE])&&!!s,q=async()=>{let e=await I({id:null==s?void 0:s.id});if((0,_.D4)(e)){L.error((0,a.e$)(e.error));return}L.success("Custom field deleted successfully",void 0,()=>{g.push(o.WC)})},[W,k]=(0,r.useState)(!1),O=async e=>{let t=await C(e,s,T);if(!t){L.error("An unexpected error occurred");return}if((0,_.D4)(t)){L.error((0,a.e$)(t.error));return}L.success("Custom field ".concat(s?"updated":"created"," successfully")),g.push(o.WC)},D=(e=>{var t;if(e)return{...e,value_type:e.field_type,field_type:(0,m._)(e),resource_type:y(e.resource_type),options:null!==(t=null==T?void 0:T.allowed_values)&&void 0!==t?t:[]}})(s),R=S?{...D,resource_type:"taxonomy:".concat(S)}:D;if(v||b||U)return(0,i.jsx)(h,{});let Z=F.some(e=>e.value===f);return(0,i.jsxs)(n.PPS,{form:j,layout:"vertical",initialValues:R||{},validateTrigger:["onBlur","onChange"],onFinish:O,children:[(0,i.jsx)(n.PPS.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Please enter a name"}],children:(0,i.jsx)(n.I6N,{options:F,onSelect:(e,t)=>{j.setFieldsValue({name:t.label,value_type:t.value})},disabled:Z,"data-testid":"input-name-autocomplete",children:(0,i.jsx)(n.uFc,{"data-testid":"input-name",suffix:Z?(0,i.jsx)(n.wpx,{size:"small",type:"text",icon:(0,i.jsx)(n.PJP.x8P,{}),onClick:()=>{j.setFieldsValue({name:void 0,value_type:void 0})}}):void 0})})}),(0,i.jsx)(n.PPS.Item,{label:"Type",name:"value_type",hidden:!0,children:(0,i.jsx)(n.WPr,{options:F,getPopupContainer:e=>e.parentElement||document.body,"data-testid":"select-value-type"})}),!!E&&!Z&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.PPS.Item,{label:"Description",name:"description",children:(0,i.jsx)(n.uFc.TextArea,{rows:2,"data-testid":"input-description"})}),(0,i.jsx)(n.PPS.Item,{label:"Field type",name:"field_type",rules:[{required:!0,message:"Please select a field type"}],children:(0,i.jsx)(n.WPr,{options:u.TY,getPopupContainer:e=>e.parentElement||document.body,"data-testid":"select-field-type"})}),(0,i.jsx)(n.PPS.Item,{noStyle:!0,shouldUpdate:(e,t)=>e.field_type!==t.field_type,children:e=>{let{getFieldValue:t}=e,s=t("field_type");return(s===u.Uv.SINGLE_SELECT||s===u.Uv.MULTIPLE_SELECT)&&(0,i.jsx)(n.PPS.List,{name:"options",rules:[{validator:async(e,t)=>!t||t.length<1?Promise.reject(Error("At least one option is required for selects")):Promise.resolve()}],children:(e,s,l)=>{let{add:r,remove:a}=s,{errors:o}=l;return(0,i.jsxs)(i.Fragment,{children:[e.map((s,l)=>(0,i.jsx)(n.PPS.Item,{required:!1,label:0===l?"Options":"","data-testid":"options-form-item",children:(0,i.jsxs)(n.jqI,{gap:"middle",children:[(0,i.jsx)(n.PPS.Item,{...s,validateTrigger:["onChange","onBlur"],rules:[{required:!0,whitespace:!0,message:"Options cannot be empty"},()=>({validator:(e,s)=>t("options").filter(e=>e===s).length>1?Promise.reject(Error("Option values must be unique")):Promise.resolve()})],noStyle:!0,children:(0,i.jsx)(n.uFc,{placeholder:"Enter option value","data-testid":"input-option-".concat(l)})}),e.length>1&&(0,i.jsx)(n.wpx,{icon:(0,i.jsx)(n.PJP.ZNm,{}),onClick:()=>a(s.name),"aria-label":"Remove option"})]})},s.key)),(0,i.jsx)(n.PPS.Item,{children:(0,i.jsx)(n.wpx,{type:"dashed",onClick:()=>r(),icon:(0,i.jsx)(n.PJP.mm_,{}),"data-testid":"add-option-btn",children:"Add select option"})}),(0,i.jsx)(n.PPS.ErrorList,{errors:o,className:"-mt-4 mb-4"})]})}})}})]}),(0,i.jsx)(n.PPS.Item,{label:"Applies to",name:"resource_type",rules:[{required:!0,message:"Please select a location"}],tooltip:"Choose where this field applies, including taxonomies",children:(0,i.jsx)(n.WPr,{options:null!==(t=null==N?void 0:N.map(e=>({label:e,value:e})))&&void 0!==t?t:[],getPopupContainer:e=>e.parentElement||document.body,disabled:!!s,"data-testid":"select-resource-type"})}),(0,i.jsxs)(n.jqI,{justify:"space-between",children:[A&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.wpx,{danger:!0,onClick:()=>k(!0),loading:w,"data-testid":"delete-btn",children:"Delete"}),(0,i.jsx)(n.cVQ,{isOpen:W,onClose:()=>k(!1),onConfirm:q,title:"Delete custom field",message:(0,i.jsxs)(n.AntTypography.Paragraph,{children:["Are you sure you want to delete"," ",(0,i.jsx)("strong",{children:null==s?void 0:s.name}),"? This action cannot be undone."]}),isCentered:!0,"data-testid":"delete-modal"})]}),(0,i.jsx)(n.wpx,{type:"primary",htmlType:"submit","data-testid":"save-btn",children:"Save"})]})]})}},66236:function(e,t,s){"use strict";s.d(t,{S:function(){return r},_:function(){return l}});var i=s(20987),n=s(8917);let l=e=>e.field_type===i.H.STRING_ARRAY?n.Uv.MULTIPLE_SELECT:e.allow_list_id?n.Uv.SINGLE_SELECT:e.field_type===i.H.STRING?n.Uv.OPEN_TEXT:e.field_type,r=e=>{let t=l(e);return t===n.Uv.OPEN_TEXT||t===n.Uv.SINGLE_SELECT||t===n.Uv.MULTIPLE_SELECT?n.P3[t]:t}},63730:function(e,t,s){"use strict";s.r(t);var i=s(24246),n=s(86677),l=s(77213),r=s(77830),a=s(58754),o=s(34435),d=s(32885);t.default=()=>{var e;let{id:t}=(0,n.useRouter)().query,{data:s,isLoading:u}=(0,d.s0)({id:t});return(0,i.jsxs)(l.Z,{title:"Edit custom field",mainProps:{maxWidth:"720px"},children:[(0,i.jsx)(a.Z,{heading:"Custom fields",breadcrumbItems:[{title:"All custom fields",href:r.WC},{title:null!==(e=null==s?void 0:s.name)&&void 0!==e?e:t}]}),(0,i.jsx)(o.Z,{initialField:s,isLoading:u})]})}}},function(e){e.O(0,[590,2888,9774,179],function(){return e(e.s=13910)}),_N_E=e.O()}]);