{
  "$id": "observation.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "EyeON Observation",
  "type": "object",
  "required": ["bytecount", "filename", "filetype", "magic", "md5", "observation_ts", "sha1", "sha256", "uuid"],
  "properties": {
    "bytecount": {
      "type":"integer",
      "description": "Size of file in bytes"
    },
    "compiler": {
      "type": "string",
      "description": "Compiler Identifier"
    },
    "filename": {
      "type": "string",
      "description": "Basename of file"
    },
    "filetype": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["ELF", "Malformed PE", "DOS", "Linux Kernel Image", "PE", "OLE", "MSCAB", "ISCAB", "DOCKER_GZIP", "GZIP", "BZIP2", "XZ", "DOCKER_TAR", "TAR", "RAR", "ZIP", "JAR", "WAR", "EAR", "APK", "IPA", "MSIX", "MACHOFAT", "JAVACLASS", "MACHOFAT", "MACHOFAT64", "EFIFAT", "MACHO32", "MACHO64", "LLVM_BITCODE", "LLVM_IR", "A.OUT big", "A.OUT little", "COFF", "XCOFF32", "XCOFF64", "ECOFF", "AR_LIB", "OMF_LIB", "UIMAGE", "ZLIB", "CPIO_BIN big", "CPIO_BIN little", "CPIO_ASCII_OLD", "CPIO_ASCII_NEW", "CPIO_ASCII_NEW_CRC", "ZSTANDARD", "ZSTANDARD_DICTIONARY", "ISO_9660_CD", "MACOS_DMG", "RPM Package"]
      }
    },
    "imphash": {
      "type": "string",
      "description": "Import Hash calculated via pefile"
    },
    "telfhash": {
      "type": "string",
      "description": "Import hashing technique used on ELF files"
    },
    "magic": {
      "type": "string",
      "description": "`file` Magic output for given file"
    },
    "md5": {
      "type": "string",
      "description": "MD5 of file"
    },
    "modtime": {
      "type": "string",
      "description": "Last modified date"
    },
    "observation_ts": {
      "type": "string",
      "description": "Date and time file was scanned"
    },
    "parent": {
      "type": "string",
      "description": "Some yet-to-be-determined pointer to a parent file or something"
    },
    "permissions": {
      "type": "string",
      "description": "Permissions of file"
    },
    "sha1": {
      "type": "string",
      "description": "Sha1 of file"
    },
    "sha256": {
      "type": "string",
      "description": "Sha256 of file"
    },
    "ssdeep": {
      "type": "string",
      "description": "Ssdeep of file"
    },
    "target_os": {
      "type": "string",
      "description": "Operating system of target machine"
    },
    "uuid": {
      "type": "string",
      "description": "Universally Unique Identifier"
    },
    "authentihash": {
      "type": "string",
      "description": "Authentihash computed from signature hashing algorithm"
    },
    "authenticode_integrity": {
      "type": "string",
      "description": "Checks if signatures are OK and if digest matches hashed authenticode"
    },
    "metadata": {
      "a_out_file": {
        "type": "object",
        "$ref": "#/$defs/AOUTMetadata"
      },
      "coff_file": {
        "type": "object",
        "$ref": "#/$defs/CoffMetadata"
      },
      "docker_image": {
        "type": "object",
        "$ref": "#/$defs/DockerImageMetadata"
      },
      "elf_file": {
        "type": "object",
        "$ref": "#/$defs/ELFMetadata"
      },
      "java_file": {
        "type": "object",
        "$ref": "#/$defs/JavaMetadata"
      },
      "mach_o_file": {
        "type": "object",
        "$ref": "#/$defs/MachOMetadata"
      },
      "js_file": {
        "type": "object",
        "$ref": "#/$defs/JavascriptMetadata"
      },
      "pe_file": {
        "type": "object",
        "$ref": "#/$defs/PEMetadata"
      },
      "ole_file": {
        "type": "object",
        "$ref": "#/$defs/OleMetadata"
      },
      "uimage_file": {
        "type": "object",
        "$ref": "#/$defs/UbootImageMetadata"
      },
      "rpm_file": {
        "type": "object",
        "$ref": "#/$defs/RPMMetadata"
      },
      "native_lib_file": {
        "type": "object",
        "$ref": "#/$defs/NativeMetadata"
      },
      "file_decompression": {
        "type": "object",
        "$ref": "#/$defs/OtherMetadata"
      }
    },
    "signatures": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "certs": {
            "$ref": "#/$defs/certs"
          },
          "signers": { "type": "string" },
          "digest_algorithm": { "type": "string" },
          "verification": { "type": "string" },
          "sha1": { "type": "string" }
        },
        "required": ["signers", "digest_algorithm"]
      }
    },
    "checksum_verification": {
      "type": "object",
      "properties": {
          "algorithm": { "type": "string" },
          "expected": { "type": "string" },
          "actual": { "type": "string" },
          "verified": { "type": "boolean" }
      },
      "required": ["algorithm", "expected", "actual", "verified"]
    }
  },
  "additionalProperties": false,
  "$defs": {
    "certs": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "sha256": { "type": "string" }, 
          "issuer_sha256": { "type": "string" }, 
          "cert._version": { "type": "string" },
          "serial_number": { "type": "string" },
          "issuer_name": { "type": "string" },
          "subject_name": { "type": "string" },
          "issued_on": { "type": "string"},
          "expires_on": { "type": "string"},
          "signed_using": { "type": "string" },
          "RSA_key_size": { "type": "string" },
          "basic_constraints": { "type": "string" },
          "key_usage": { "type": "string" },
          "ext_key_usage": { "type": "string" },
          "certificate_policies": { "type": "string" }
       }
     }
    },
    "AOUTMetadata": {
      "type": "object",
      "required": [ "aoutMachineType" ],
      "properties": {
        "aoutMachineType": { "type": "string" }
      }
    },
    "CoffMetadata": {
      "type": "object",
      "required":  ["coffMachineType" ],
      "properties": {
        "coffMachineType": {"type": "string"}
      }
    },
    "DockerImageMetadata": {
      "type": "object",
      "required": ["dockerSPDX"],
      "properties": {
        "dockerSPDX": { 
          "type": "object",
          "properties": {
            "spdxVersion": {"type": "string"},
            "dataLicense": {"type": "string"},
            "SPDXID": {"type": "string"},
            "name": {"type": "string"},
            "documentNamespace": {"type": "string"},
            "creationInfo": {
              "type": "object",
              "properties": {
                "creators": {"type": "array"},
                "created": {"type": "string"}
              }
            },
            "packages": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {"type": "string"},
                  "SPDXID": {"type": "string"},
                  "supplier": {"type": "string"},
                  "downloadLocation": {"type": "string"},
                  "filesAnalyzed": {"type": "boolean"},
                  "licenseConcluded": {"type": "string"}
                }
              }
            },
            "files": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "fileName": {"type": "string"},
                  "SPDXID": {"type": "string"},
                  "checksums": {
                    "type": "array",
                    "algorithm": {"type": "string"},
                    "checksumValue": {"type": "string"}
                  },
                  "licenseConcluded": {"type": "string"},
                  "copyrightText": {"type": "string"},
                  "comment": {"type": "string"},
                  "annotations": {
                    "type": "array",
                    "annotator": {"type": "string"},
                    "annotationDate": {"type": "string"},
                    "annotationType": {"type": "string"},
                    "comment": {"type": "string"}
                  }
                }
              }
            },
            "relationships": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "spdxElementId": {"type": "string"},
                  "relatedSpdxElement": {"type": "string"},
                  "relationshipType": {"type": "string"}
                }
              }
            }
          }
        }
      }
    },
    "ELFMetadata": {
      "type": "object",
      "required": ["elfIdent", "elfDependencies"],
      "properties": {
        "OS": { "type": "string" },
        "elfIdent": {
          "type": "object",
          "properties": {
            "EI_CLASS": { "type": "integer" },
            "EI_DATA": { "type": "integer" },
            "EI_VERSION": { "type": "integer" },
            "EI_OSABI": { "type": "integer" },
            "EI_ABIVERSION": { "type": "integer" },
            "E_MACHINE": { "type": "integer" }
          }
        },
        "elfDependencies": { "type": "array" },
        "elfRpath": { "type": "array" },
        "elfRunpath": { "type": "array" },
        "elfSoname": { "type": "array" },
        "elfInterpreter": { "type": "array" },
        "elfDynamicFlags": { "type": "array" },
        "elfDynamicFlags1": { "type": "array" },
        "elfGnuRelro": { "type": "boolean" },
        "elfComment": { "type": "array" },
        "elfNote": { "type": "array" },
        "elfOsAbi": { "type": "string" },
        "elfHumanArch": { "type": "string" },
        "elfArchNumber": { "type": "integer" },
        "elfArchitecture": { "type": "string" },
        "elfIsExe": { "type": "boolean" },
        "elfIsLib": { "type": "boolean" },
        "elfIsRel": { "type": "boolean" },
        "elfIsCore": { "type": "boolean" }
      }
    },
    "JavaMetadata": {
      "type": "object",
      "required": ["javaClasses"],
      "javaClasses": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "className": { "type": "string" },
            "javaMinSEVersion": { "type": "string" },
            "javaExports": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          "javaImports": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      }
    },
    "JavascriptMetadata": {
      "type": "object",
      "required": ["jsLibraries"],
      "properties": {
        "jsLibraries": { "type": "array" }
      }
    },
    "MachOMetadata": {
      "type": "object",
      "required": ["numBinaries", "binaries"],
      "properties": {
        "OS": { "type": "string" },
        "numBinaries": { "type": "integer" },
        "binaries": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "format": { "type": "string" },
              "header": {
                "type": "object",
                "properties": {
                  "cpuType": { "type": "string" },
                  "cpuTypeValue": { "type": "integer" },
                  "cpuSubtype": { "type": "string" },
                  "cpuSubtypeValue": { "type": "integer" },
                  "fileType": { "type": "string" },
                  "fileTypeValue": { "type": "integer" },
                  "flags": { "type": "array" },
                  "numCommands": { "type": "integer" }
                }
              },
              "build": {
                "type": "object",
                "properties": {
                  "platform": { "type": "string" },
                  "platformValue": { "type": "integer" },
                  "minOSVersion": { "type": "string" },
                  "sdkVersion": { "type": "string" },
                  "tools": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "tool": { "type": "string" },
                        "version": { "type": "string" }
                      }
                    }
                  }
                }
              },
              "signature": {
                "type": "object",
                "properties": {
                  "offset": { "type":"integer" },
                  "size": { "type":"integer" },
                  "type": { "type":"string" }
                }
              },
              "dependencies": {
                "type": "array",
                "items": {
                  "name": { "type": "string" },
                  "currentVersion": { "type": "string" },
                  "compatibilityVersion": { "type": "string" }
                }
              },
              "rpaths": {
                "type": "array",
                "items": { "type": "string" }
              },
              "dyld": {
                "type": "object",
                "properties": {
                  "linker": { "type": "string" }
                }
              },
              "encryption": { "type": "object" }
            }
          }
        }
      }
    },
    "NativeMetadata": {
      "type": "object",
      "required": ["nativeLibraries"],
      "properties": {
        "nativeLibraries": { "type": "array" }
      }
    },
    "OleMetadata": {
      "type": "object",
      "required": ["ole"],
      "properties": {
          "ole": { 
            "type": "object",
            "properties": {
            "clsid": { "type": "string" },
            "clsid_type": { "type": "string" },
            "codepage": { "type": "string" },
            "title": { "type": "string" },
            "author": { "type": "string" },
            "template": { "type": "string" },
            "revision_number": { "type": "string" },
            "last_printed": { "type": "string" },
            "create_time": { "type": "string" },
            "last_saved_time": { "type": "string" },
            "num_pages": { "type": "string" },
            "num_words": { "type": "string" },
            "creating_application": { "type": "string" },
            "security": { "type": "string" }
          }
        }
      }
    },
    
    "PEMetadata": {
      "type": "object",
      "required": ["peMachine"],
      "properties": {
        "OS": { "type": "string" },
        "peMachine": { "type": "string" },
        "peOperatingSystemVersion": { "type": "string" },
        "peSubsystemVersion": { "type": "string" },
        "peSubsystem": { "type": "string" },
        "peLinkerVersion": { "type": "string" },
        "peImport": { "type": "array",
            "items": { "type": "string" }
        },
        "peIsExe": { "type": "boolean" }, 
        "peIsDll": { "type": "boolean" }, 
        "peIsClr": { "type": "boolean" }, 
        "FileInfo": { "type": "object" }, 
        "dllRedirectionLocal": { "type": "boolean" }
      }

    },
    "RPMMetadata": {
      "type": "object",
      "required": ["rpm"],
      "properties": {
        "rpm": { 
          "type": "object",
          "properties": {
            "name": { "type": "string" },
            "sourcerpm": { "type": "string" },
            "version": { "type": "string" },
            "release": { "type": "string" },
            "summary": { "type": "string" },
            "description": { "type": "string" },
            "rpmversion": { "type": "string"},
            "copyright": { "type": "string"},
            "os": { "type": "string"},
            "arch": { "type": "string"},
            "target": { "type": "string"},
            "archive_format": { "type": "string"},
            "archive_compression": { "type": "string"},
            "optflags": { "type": "string"},
            "sha256": { "type": "string"},
            "md5": { "type": "string"},
            "requirename": {
              "type": "object"
            },
            "provides": {
              "type": "object"
            },
            "buildtime": { "type": "integer"},
            "associated_files": {
              "type": "object"
            }
          }
        }
      }
    },
    "UbootImageMetadata": {
      "type": "object",
      "required": ["uimage_header"],
      "properties": {
        "uimage_header": { 
          "type": "object",
          "header_crc": { "type": "string" },
          "timestamp" : { "type": "integer" },
          "data_size" : { "type": "integer" },
          "load_addr" : { "type": "string" },
          "entry_point" : { "type": "string" },
          "data_crc" : { "type": "string" },
          "os" : { "type": "string" },
          "os_description" : { "type": "string" },
          "arch" : { "type": "string" },
          "arch_description" : { "type": "string" },
          "image_type" : { "type": "string" },
          "image_type_description" : { "type": "string" },
          "compression_type" : { "type": "string" },
          "name" : { "type": "string" }
        }
      }
    },
    "OtherMetadata": {
      "type": "object",
      "required": ["description"],
      "properties": {
        "description": { "type": "string" }
      }
    }
  }
}
