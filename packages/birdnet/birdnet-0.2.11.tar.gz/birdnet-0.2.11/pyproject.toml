[project]
name = "birdnet"
version = "0.2.11"
description = "A Python library for identifying bird species by their sounds."
readme = "README.md"
requires-python = ">=3.11, <3.14"
license = { text = "MIT" }
authors = [{ name = "Stefan Taubert" }]
maintainers = [{ name = "Stefan Taubert" }]
keywords = [
  "birds",
  "deep-learning",
  "birdsong",
  "acoustic-monitoring",
  "bioacoustics",
]
classifiers = [
  "Development Status :: 4 - Beta",
  "Operating System :: OS Independent",
  "Operating System :: MacOS",
  "Operating System :: POSIX",
  "Operating System :: POSIX :: BSD",
  "Operating System :: POSIX :: Linux",
  "Operating System :: Unix",
  "Operating System :: Microsoft :: Windows",
  "Programming Language :: Python",
  "Programming Language :: Python :: 3",
  "Programming Language :: Python :: 3.11",
  "Programming Language :: Python :: 3.12",
  "Programming Language :: Python :: 3.13",
  "License :: OSI Approved :: MIT License",
]
dependencies = [
  "soundfile >= 0.11.0", # 2022/09/27
  "scipy >= 1.8.0", # 2022/02/05
  "ordered-set >= 4.1.0", # 2022/01/26
  "tqdm >= 4.64.0", # 2022/04/04
  "numpy >= 1.22.0", # 2021/12/31
  "pandas >= 1.4.0", # 2022/02/22
  "psutil >= 5.9.0", # 2021/12/29
  "pyarrow >= 7.0.0", # 2022/02/03
  "kagglehub >= 0.3.13", # 2025/08/26; needed for downloading PERCH models
  "tensorflow >= 2.8.0 ; sys_platform != 'darwin' or platform_machine != 'x86_64'", # 2022/02/02
  "tensorflow >= 2.8.0, <2.17 ; sys_platform == 'darwin' and platform_machine == 'x86_64'",
  "ai-edge-litert >= 2.0.2 ; python_version < '3.13' and sys_platform == 'linux'", # 2025/09/17
]

[project.optional-dependencies]
and-cuda = [
  "tensorflow[and-cuda] >= 2.8.0" # 2022/02/02
]
repro = [
  # Reproducible results only with Python 3.12 and on CPU
  # Direct dependencies
  "soundfile == 0.12.1",
  "scipy == 1.16.3",
  "ordered-set == 4.1.0",
  "tqdm == 4.67.1",
  "numpy == 2.1.0",
  "pandas == 2.3.3",
  "psutil == 7.1.3",
  "pyarrow == 22.0.0",
  "kagglehub == 0.3.13",
  "tensorflow == 2.20.0 ; sys_platform == 'linux' or (sys_platform == 'darwin' and platform_machine == 'arm64') or (sys_platform == 'windows' and platform_machine == 'amd64')",
  "ai-edge-litert == 2.0.3 ; python_version < '3.13' and sys_platform == 'linux'",
  # Indirect dependencies
  "absl-py == 2.3.1",
  "astunparse == 1.6.3",
  "backports.strenum == 1.2.8",
  "certifi == 2025.11.12",
  "cffi == 2.0.0",
  "charset-normalizer == 3.4.4",
  "flatbuffers == 25.9.23",
  "gast == 0.6.0",
  "google-pasta == 0.2.0",
  "grpcio == 1.76.0",
  "h5py == 3.15.1",
  "idna == 3.11",
  "keras == 3.12.0",
  "libclang == 18.1.1",
  "Markdown == 3.10",
  "markdown-it-py == 4.0.0",
  "MarkupSafe == 3.0.3",
  "mdurl == 0.1.2",
  "ml_dtypes == 0.5.4",
  "namex == 0.1.0",
  "opt_einsum == 3.4.0",
  "optree == 0.18.0",
  "packaging == 25.0",
  "pillow == 12.0.0",
  "protobuf == 6.33.1",
  "pycparser == 2.23",
  "Pygments == 2.19.2",
  "python-dateutil == 2.9.0.post0",
  "pytz == 2025.2",
  "pyyaml == 6.0.3",
  "requests == 2.32.5",
  "rich == 14.2.0",
  "setuptools == 80.9.0",
  "six == 1.17.0",
  "tensorboard == 2.20.0",
  "tensorboard-data-server == 0.7.2",
  "termcolor == 3.2.0",
  "typing_extensions == 4.15.0",
  "tzdata == 2025.2",
  "urllib3 == 2.5.0",
  "Werkzeug == 3.1.3",
  "wheel == 0.45.1",
  "wrapt == 2.0.1",
]
tests = [
  "uv >= 0.9.7",
  "pytest >= 8.4.2",
  "pytest-cov >= 7.0.0",
  "pytest-xdist >= 3.8.0",
  "pytest-timeout >= 2.4.0",
  "mypy >= 1.18.2",
  "ruff >= 0.14.4"
]
dev = ["jupyter", "uv", "ruff", "mypy", "rope", "build", "twine", "scipy-stubs", "tuna", "pyarrow-stubs", "types-tqdm", "types-requests", "pandas-stubs", "types-tensorflow"]

[project.urls]
Homepage = "https://github.com/birdnet-team/birdnet"
Issues = "https://github.com/birdnet-team/birdnet/issues"
Repository = "https://github.com/birdnet-team/birdnet.git"
Changelog = "https://github.com/birdnet-team/birdnet/blob/master/CHANGELOG.md"

[project.scripts]
birdnet-benchmark = "birdnet.benchmark_script:run_benchmark"

[tool.mypy]
python_version = "3.12"
warn_return_any = true
warn_unused_configs = true
ignore_missing_imports = true
packages = ["birdnet"]

[tool.setuptools.packages.find]
where = ["src"]
include = ["birdnet", "birdnet.*"]
exclude = ["birdnet_tests", "birdnet_tests.*"]
namespaces = true

[tool.pytest.ini_options]
log_cli = true
log_level = "DEBUG"
timeout = 300
testpaths = ["src/birdnet_tests"]
norecursedirs = ["src/birdnet_v1_tests"]
markers = [
  "load_model: tests that download all models, should be run before other tests",
  "litert: tests requiring ai_edge_litert backend which can not be loaded after tf is imported (raises ImportError) which happens on parallel test runs",
  "gpu: tests requiring a GPU to run and to be runned sequentially",
  "repro: tests requiring exact package versions to reproduce results",
]

[tool.ruff]
src = ["src/birdnet"]
line-length = 88
indent-width = 2

[tool.ruff.format]
indent-style = "space"

[tool.ruff.lint]
select = [
    # pycodestyle
    "E",
    # Pyflakes
    "F",
    # pyupgrade
    "UP",
    # flake8-bugbear
    "B",
    # flake8-simplify
    "SIM",
    # isort
    "I",
    "C4",
    "T20",
    "PERF",
    "ANN",
    "TID",
    "EXE", 
    "W",
    # "D",
]

[tool.ruff.lint.isort]
known-first-party = ["birdnet*"]

[tool.tox]
legacy_tox_ini = """
[tox]
envlist = py{311,312,313}, py{312}-repro
isolated_build = True

[testenv]
setenv =
  COVERAGE_FILE = .coverage.{envname}
package = wheel
allowlist_externals = uv
install_command = uv pip install {opts} {packages}

deps = 
  .[tests,and-cuda]
commands = 
  # ruff check src/birdnet
  # ruff check src/birdnet_tests
  pytest -m "not repro and load_model" -n auto --max-worker-restart=0
  pytest -m "not repro and not load_model and (not litert and not gpu)" -n auto --max-worker-restart=0
  pytest -m "not repro and not load_model and litert" -n auto --max-worker-restart=0
  pytest -m "not repro and not load_model and gpu" -n 1 --max-worker-restart=0

[testenv:py312-repro]
deps =
  .[tests,repro]
commands = 
  pytest -m "load_model" -n auto --max-worker-restart=0
  # run normal tests including repro tests
  pytest -m "not load_model and (not litert and not gpu)" -n auto --max-worker-restart=0
  # run litert tests including repro tests
  pytest -m "not load_model and litert" -n auto --max-worker-restart=0
  # gpu tests are not supported to be run with repro environment
"""

[build-system]
requires = [
  "setuptools >= 80.9.0", # 2025/05/27
  "wheel >= 0.45.1" # 2024/11/23
]
build-backend = "setuptools.build_meta"
