# ============================================================================
# RT-HERMES Environment Configuration
# ============================================================================
# This file contains configuration for THREE different contexts:
# 1. Docker Compose (variable substitution in compose files)
# 2. Docker containers (passed to running containers)
# 3. Host CLI/applications (for hermes commands running on your machine)
#
# IMPORTANT: Not all variables are used in all contexts!

# Note: Docker containers use different values for internal communication:
# - POSTGRES_HOST=postgres (service name)
# - POSTGRES_PORT=5432 (internal container port)
# ============================================================================

# === Docker Compose Configuration ===
# These control Docker Compose behavior itself
DOCKER_WEB_PORT=8000
DOCKER_RESTART_POLICY=unless-stopped

# === Main PostgreSQL Database ===
# Used by HERMES application for storing forecast data
# These are passed to both Docker containers AND used by host CLI
POSTGRES_USER=postgres
POSTGRES_PASSWORD=mytopsecretpass  # CHANGE THIS in production!
POSTGRES_DB=postgres

# Connection pool settings (used by webservice container and host CLI)
POSTGRES_POOL_SIZE=5
POSTGRES_MAX_OVERFLOW=10

# --- For Host CLI Only ---
# When running hermes commands on your machine (not in Docker),
# use localhost and the mapped port:
POSTGRES_HOST=localhost
POSTGRES_PORT=5434

# External workers need the external IP/hostname to connect:
POSTGRES_HOST_EXTERNAL=127.0.0.1 # Change to actual value

# === Credential Source ===
# Where to load database credentials from:
# - 'env': Use POSTGRES_* variables above (default, for local/host machine)
# - 'prefect': Load from Prefect Block (for distributed workers)
# On the host, run 'hermes config set-credentials' to save credentials to Prefect.
# On workers, set CREDENTIAL_SOURCE=prefect to load from the block.
CREDENTIAL_SOURCE=env

# === Prefect Configuration ===
# Prefect uses a separate PostgreSQL database for workflow metadata

PREFECT_PASSWORD=prefect  # CHANGE THIS in production!
PREFECT_PORT=5433

# --- For Host CLI Only ---
# When connecting to Prefect from your machine (not in Docker):
PREFECT_API_DATABASE_CONNECTION_URL="postgresql+asyncpg://postgres:prefect@localhost:5433/prefect"
PREFECT_API_URL="http://127.0.0.1:4200/api"

# Note: Docker containers use different connection strings with:
# - Host: prefect-postgres (service name)
# - Port: 5432 (internal container port)