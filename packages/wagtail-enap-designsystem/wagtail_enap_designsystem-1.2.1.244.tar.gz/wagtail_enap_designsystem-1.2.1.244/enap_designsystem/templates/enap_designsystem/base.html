{% load static wagtailuserbar %}
{% load wagtailcore_tags %}
{% load static %}
{% load wagtailimages_tags %}

<html lang="pt-BR">
	<head>
		{# Meta descrição tradicional ANTES das tags Open Graph #}
		{% if page.legenda_home %}
		<meta name="description" content="{{ page.legenda_home|striptags|truncatewords:25 }}">
	{% elif page.subtitulo %}
		<meta name="description" content="{{ page.subtitulo|striptags|truncatewords:25 }}">
	{% elif page.search_description %}
		<meta name="description" content="{{ page.search_description }}">
	{% else %}
		<meta name="description" content="{{ page.title }}">
	{% endif %}

	{# Open Graph - ORDEM CORRETA #}
	<meta property="og:site_name" content="ENAP - Escola Nacional de Administração Pública">
	<meta property="og:type" content="article">
	<meta property="og:title" content="{{ page.title }}">
	<meta property="og:url" content="{{ request.build_absolute_uri }}">
	<meta property="og:locale" content="pt_BR">
	
	{# Descrição Open Graph #}
	{% if page.legenda_home %}
		<meta property="og:description" content="{{ page.legenda_home|striptags|truncatewords:25 }}">
	{% elif page.subtitulo %}
		<meta property="og:description" content="{{ page.subtitulo|striptags|truncatewords:25 }}">
	{% elif page.search_description %}
		<meta property="og:description" content="{{ page.search_description }}">
	{% else %}
		<meta property="og:description" content="{{ page.title }} - ENAP">
	{% endif %}
	
	{# IMAGEM OPEN GRAPH - ESPECÍFICO PARA ENAPNoticia #}
	{% if page.imagem_externa %}
		{# Prioridade 1: imagem_externa (para compartilhamento) #}
		{% image page.imagem_externa fill-1200x630 as og_image %}
		<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ og_image.url }}">
		<meta property="og:image:secure_url" content="https://{{ request.get_host }}{{ og_image.url }}">
		<meta property="og:image:width" content="1200">
		<meta property="og:image:height" content="630">
		<meta property="og:image:alt" content="{{ page.title }}">
		<meta property="og:image:type" content="image/jpeg">
	{% elif page.featured_image %}
		{# Prioridade 2: featured_image (StreamField) - usando primeira imagem #}
		{% with first_block=page.featured_image.0 %}
			{% if first_block.block_type == "image" and first_block.value.image %}
				{% image first_block.value.image fill-1200x630 as og_image %}
				<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ og_image.url }}">
				<meta property="og:image:secure_url" content="https://{{ request.get_host }}{{ og_image.url }}">
				<meta property="og:image:width" content="1200">
				<meta property="og:image:height" content="630">
				<meta property="og:image:alt" content="{{ first_block.value.caption|default:page.title }}">
				<meta property="og:image:type" content="image/jpeg">
			{% endif %}
		{% endwith %}
	{% elif page.image %}
		{# Prioridade 3: campo image genérico (se existir) #}
		{% with page.image.0.value as first_image %}
		{% image first_image fill-1200x630 as og_image %}
		<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ og_image.url }}">
		<meta property="og:image:secure_url" content="https://{{ request.get_host }}{{ og_image.url }}">
		<meta property="og:image:width" content="1200">
		<meta property="og:image:height" content="630">
		<meta property="og:image:alt" content="{{ page.title }}">
		<meta property="og:image:type" content="image/jpeg">
		{% endwith %}
	{% else %}
		{# Fallback: Imagem padrão ENAP #}
		<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{% static 'enap_designsystem/blocks/suap/default_1.png' %}">
		<meta property="og:image:secure_url" content="https://{{ request.get_host }}{% static 'enap_designsystem/blocks/suap/default_1.png' %}">
		<meta property="og:image:width" content="1200">
		<meta property="og:image:height" content="630">
		<meta property="og:image:alt" content="ENAP - {{ page.title }}">
		<meta property="og:image:type" content="image/png">
	{% endif %}
	
	{# Meta tags específicas para artigos #}
	{% if page.date_display %}
		<meta property="article:published_time" content="{{ page.date_display|date:'c' }}">
	{% elif page.first_published_at %}
		<meta property="article:published_time" content="{{ page.first_published_at|date:'c' }}">
	{% endif %}
	
	{% if page.author %}
		<meta property="article:author" content="{{ page.author.get_full_name|default:page.author.username }}">
	{% elif page.author_display %}
		<meta property="article:author" content="{{ page.author_display }}">
	{% endif %}
	
	{# Twitter Cards #}
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:site" content="@enapcomunica">
	<meta name="twitter:title" content="{{ page.title }}">
	
	{% if page.legenda_home %}
		<meta name="twitter:description" content="{{ page.legenda_home|striptags|truncatewords:25 }}">
	{% elif page.subtitulo %}
		<meta name="twitter:description" content="{{ page.subtitulo|striptags|truncatewords:25 }}">
	{% elif page.search_description %}
		<meta name="twitter:description" content="{{ page.search_description }}">
	{% else %}
		<meta name="twitter:description" content="{{ page.title }}">
	{% endif %}

		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="author" content="ENAP - Escola Nacional de Administração Pública">
		<meta name="theme-color" content="#0066cc">
		{% block metadata %}{% endblock %}

		<!-- Google Tag Manager -->
		<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
			})(window,document,'script','dataLayer','GTM-WR2M7N2F');</script>
		<!-- End Google Tag Manager -->
			
		{% block title %}
			<title>{{ page.title }}</title>
		{% endblock %}

		
		{% block styleinline %} {% endblock %}
		{% block stylecss %} {% endblock %}

		<style>
			/* Melhorias de acessibilidade para skip link */
			.visually-hidden-focusable {
				position: absolute;
				top: -40px;
				left: 6px;
				width: 1px;
				height: 1px;
				padding: 8px 16px;
				margin: -1px;
				overflow: hidden;
				clip: rect(0, 0, 0, 0);
				white-space: nowrap;
				border: 0;
				background: #000;
				color: #fff;
				text-decoration: none;
				border-radius: 4px;
				font-weight: bold;
				z-index: 100000;
			}
			
			.visually-hidden-focusable:focus {
				position: absolute;
				top: 6px;
				left: 6px;
				width: auto;
				height: auto;
				padding: 8px 16px;
				margin: 0;
				overflow: visible;
				clip: auto;
				white-space: normal;
			}
		</style>

		<!-- Favicons -->
		<link rel="icon" type="image/png" sizes="32x32" href="{% static 'enap_designsystem/icons/favicon-32x32.png' %}">
		<link rel="icon" type="image/png" sizes="16x16" href="{% static 'enap_designsystem/icons/images/favicon-16x16.png' %}">

		<!-- CSS Externos -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Georama:ital,wght@0,100..900;1,100..900&display=swap">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
		<link href="https://cdn.materialdesignicons.com/7.2.96/css/materialdesignicons.min.css" rel="stylesheet">
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		
		<!-- CSS Base -->
		<link rel="stylesheet" href="{% static 'enap_designsystem/base.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/semanadeinovacao.css' %}">
		
		<!-- CSS Componentes -->
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/lia.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/capsulas.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/carousel_images.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/apresentacao_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/cards_section.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/cards_titles.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/carousel_responsive.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/clientes_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/semana.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/accordions.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/accordionsv2.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/aviso_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/banner.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/btn.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/cards.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/dropdown.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/feature-img-texts.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/footer.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/tags.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/alerts.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/breadcrumbs.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/buttongroup.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/carousel.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/modal.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/wizard.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/navbar/navbar.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/course_intro_topics.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/why_choose.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/feature_course.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/feature_estrutura.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/feature_processo_seletivo.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/team_carousel.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/team_modern.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/testimonials_carousel.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/pagination.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/form_template.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/card_courses.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/area_aluno.css' %}">
		
		<!-- CSS Páginas -->
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/pages/template_homeI.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/pages/template_homeII.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/pages/template_cursos.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/pages/page_search.css' %}">
		
		<!-- CSS Blocos Específicos -->
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/suap/suap_courses_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/banner_search_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/card_curso_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/cartao_destacado.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/container_info_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/contato_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/cta_imagem_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/cta2.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/evento_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/form_contato.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/gallery_modern.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/hero_animada_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/herov3.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/navbar_component.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/navbar3.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/section_card_title_center.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/section_tabs_cards.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/sobre_linhas.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/texto_imagem.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/preview_courses.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/job.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/citizen_server_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/service_cards.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/feature_list_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/feature_with_links_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/template_holofote.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/quote_modern.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/pagelist_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/banner_topicos_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/cta_destaque_formacao_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/topic_links_block.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/cookies.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/blocks/carousel_bggreen.css' %}">
		<link rel="stylesheet" href="{% static 'enap_designsystem/pages/article/joomla/enap_noticia_importada.css' %}">
	</head>

	<body>
		<!-- Google Tag Manager (noscript) -->
		<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WR2M7N2F"
			height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
		<!-- End Google Tag Manager (noscript) -->
		<h1 class="visually-hidden-focusable">Portal ENAP</h1>
		<a class="visually-hidden-focusable" href="#main-content">Pular para o conteúdo principal</a>
		
		<main id="main-content" class="page-wrapper" role="main">
			{% block govnavbar %}{% endblock %}
			{% block navbar %}{% endblock %}
			
			<section tabindex="-1">
				{% block content %}{% endblock %}
			</section>
			
			{% block footer %}{% endblock %}
		</main>

		{% include 'enap_designsystem/includes/cookie_banner.html' %}
		
		<!-- Blocks para Script externo e inline -->
		{% block scriptinline %} {% endblock %}
		
		{% block scriptjs %}
		<script async src="//barra.brasil.gov.br/barra_2.0.js" type="text/javascript" lang="pt-BR"></script>
		
		<script>
		document.addEventListener('DOMContentLoaded', function() {
			// CORREÇÃO #6: Melhorar acessibilidade dos links dinâmicos
			const links = document.querySelectorAll('.content-richtext a');
			links.forEach(function(link) {
				// Verificar se o link não tem texto acessível
				if (!link.textContent.trim() && !link.getAttribute('aria-label')) {
					link.setAttribute('aria-label', 'Link sem texto - ' + (link.href || 'destino desconhecido'));
				}
				
			});
			
			// Estilizar parágrafos
			const paragraphs = document.querySelectorAll('.content-richtext p');
			paragraphs.forEach(function(p) {
				p.style.marginBottom = '1.2em';
				p.style.lineHeight = '1.6';
			});
			
			// Melhorar hierarquia de cabeçalhos
			const headings = document.querySelectorAll('.content-richtext h2, .content-richtext h3, .content-richtext h4');
			headings.forEach(function(heading) {
				heading.style.fontSize = heading.tagName === 'H2' ? '1.5em' : 
									   heading.tagName === 'H3' ? '1.3em' : '1.1em';
				heading.style.marginTop = '1em';
				heading.style.color = '#333';
				heading.style.fontWeight = 'bold';
			});
			
			// Estilizar listas
			const lists = document.querySelectorAll('.content-richtext ul, .content-richtext ol');
			lists.forEach(function(list) {
				list.style.marginLeft = '1.5em';
				list.style.marginBottom = '1em';
			});
		});
		
		</script>
		{% endblock %}

		<!-- Scripts Externos -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
		<script src="{% static 'static/simple-dashboard.js' %}"></script>
		<script src="https://kit.fontawesome.com/2e8803d931.js" crossorigin="anonymous"></script>
		<script src="{% static 'enap_designsystem/blocks/pages/page_search.js' %}" crossorigin="anonymous"></script>
		
		<!-- Analytics Scripts -->
		<script type="text/javascript">
			(function(c,l,a,r,i,t,y){
				c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
				t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
				y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
			})(window, document, "clarity", "script", "pvb1373fni");
		</script>
		
		<!-- Google tag (gtag.js) -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-M2T2PWGL5X"></script>
		<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());
		gtag('config', 'G-M2T2PWGL5X');
		</script>
		
		{% wagtailuserbar %}
	</body>
</html>