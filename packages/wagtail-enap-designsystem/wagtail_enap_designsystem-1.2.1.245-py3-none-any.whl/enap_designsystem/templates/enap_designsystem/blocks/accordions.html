{% load static %}
{% load wagtailcore_tags coderedcms_tags %}
{% block content %}
{% with a_id=self.accordion.id accordion=self.accordion %}

<section style="max-width: 1142px; margin: auto;" data-accordion-id="{{ a_id }}">
{% for panel in accordion.panels_content %}
    {% with panel_id=forloop.counter %}
    <button class="accordion" data-panel-target="panel{{ a_id }}_{{ panel_id }}">
        <div class="flex-accordion">
            <h2 class="h2-accordion">{{panel.value.title}}</h2>
            <div class="wrapper-icon">
                <i style="font-size: 18px;" class="fa-solid fa-chevron-down"></i>
            </div>
        </div>
        <div class="line-accordions"></div>
    </button>

    <div id="panel{{ a_id }}_{{ panel_id }}" class="panel" style="display: none;">
        <p class="p-accordion">
            {% include_block panel.value.content %}
        </p>
    </div>
    {% endwith %}
{% endfor %}
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Selecionar todos os botões de accordion na seção atual
    const accordionSection = document.querySelector('[data-accordion-id="{{ a_id }}"]');
    const accordionButtons = accordionSection.querySelectorAll('.accordion');
    
    accordionButtons.forEach(button => {
        button.addEventListener('click', function() {
            const panelId = this.getAttribute('data-panel-target');
            const panel = document.getElementById(panelId);
            const arrowIcon = this.querySelector('.fa-chevron-down');
            
            // Verificar o estado atual
            const isVisible = panel.style.display === "block";
            
            if (isVisible) {
                // Se estiver visível, feche apenas este
                panel.style.display = "none";
                this.classList.remove('accordion-open');
                arrowIcon.style.transform = 'rotate(0deg)';
            } else {
                // FECHAR TODOS os outros painéis primeiro
                accordionButtons.forEach(otherButton => {
                    const otherPanelId = otherButton.getAttribute('data-panel-target');
                    const otherPanel = document.getElementById(otherPanelId);
                    const otherArrowIcon = otherButton.querySelector('.fa-chevron-down');
                    
                    otherPanel.style.display = "none";
                    otherButton.classList.remove('accordion-open');
                    otherArrowIcon.style.transform = 'rotate(0deg)';
                });
                
                // Agora abrir apenas o clicado
                panel.style.display = "block";
                this.classList.add('accordion-open');
                arrowIcon.style.transform = 'rotate(180deg)';
            }
        });
    });
});
</script>

{% endwith %}
{% endblock %}