"""Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT."""

from __future__ import annotations
from cribl_control_plane import models, utils
from cribl_control_plane.types import BaseModel
from cribl_control_plane.utils import validate_open_enum
from enum import Enum
import pydantic
from pydantic import field_serializer
from pydantic.functional_validators import PlainValidator
from typing import Any, Dict, List, Optional
from typing_extensions import Annotated, NotRequired, TypedDict


class FunctionPublishMetricsID(str, Enum):
    PUBLISH_METRICS = "publish_metrics"


class FunctionPublishMetricsMetricType(str, Enum, metaclass=utils.OpenEnumMeta):
    # Counter
    COUNTER = "counter"
    # Timer
    TIMER = "timer"
    # Gauge
    GAUGE = "gauge"
    # Distribution
    DISTRIBUTION = "distribution"
    # Summary
    SUMMARY = "summary"
    # Histogram
    HISTOGRAM = "histogram"


class FunctionPublishMetricsFieldTypedDict(TypedDict):
    in_field_name: str
    r"""The name of the field in the event that contains the metric value"""
    out_field_expr: NotRequired[str]
    r"""JavaScript expression to evaluate the metric field name. Defaults to Event Field Name."""
    metric_type: NotRequired[FunctionPublishMetricsMetricType]


class FunctionPublishMetricsField(BaseModel):
    in_field_name: Annotated[str, pydantic.Field(alias="inFieldName")]
    r"""The name of the field in the event that contains the metric value"""

    out_field_expr: Annotated[Optional[str], pydantic.Field(alias="outFieldExpr")] = (
        None
    )
    r"""JavaScript expression to evaluate the metric field name. Defaults to Event Field Name."""

    metric_type: Annotated[
        Annotated[
            Optional[FunctionPublishMetricsMetricType],
            PlainValidator(validate_open_enum(False)),
        ],
        pydantic.Field(alias="metricType"),
    ] = FunctionPublishMetricsMetricType.GAUGE

    @field_serializer("metric_type")
    def serialize_metric_type(self, value):
        if isinstance(value, str):
            try:
                return models.FunctionPublishMetricsMetricType(value)
            except ValueError:
                return value
        return value


class FunctionPublishMetricsSchemaTypedDict(TypedDict):
    fields: NotRequired[List[FunctionPublishMetricsFieldTypedDict]]
    r"""List of metrics from event to extract and format. Formatted metrics can be used by a destination to pass metrics to a metrics aggregation platform."""
    overwrite: NotRequired[bool]
    r"""Overwrite previous metric specs. Leave disabled to append."""
    dimensions: NotRequired[List[str]]
    r"""Optional list of dimensions to include in events. Wildcards supported. If you don't specify metrics, values will be appended to every metric found in the event. When you add a new metric, dimensions will be present only in those new metrics."""
    remove_metrics: NotRequired[List[str]]
    r"""Optional list of metric field names to look for when removing metrics. When a metric's field name matches an element in this list, the metric will be removed from the event."""
    remove_dimensions: NotRequired[List[str]]
    r"""Optional list of dimensions to remove from every metric found in the event. Wildcards supported."""


class FunctionPublishMetricsSchema(BaseModel):
    fields: Optional[List[FunctionPublishMetricsField]] = None
    r"""List of metrics from event to extract and format. Formatted metrics can be used by a destination to pass metrics to a metrics aggregation platform."""

    overwrite: Optional[bool] = False
    r"""Overwrite previous metric specs. Leave disabled to append."""

    dimensions: Optional[List[str]] = None
    r"""Optional list of dimensions to include in events. Wildcards supported. If you don't specify metrics, values will be appended to every metric found in the event. When you add a new metric, dimensions will be present only in those new metrics."""

    remove_metrics: Annotated[
        Optional[List[str]], pydantic.Field(alias="removeMetrics")
    ] = None
    r"""Optional list of metric field names to look for when removing metrics. When a metric's field name matches an element in this list, the metric will be removed from the event."""

    remove_dimensions: Annotated[
        Optional[List[str]], pydantic.Field(alias="removeDimensions")
    ] = None
    r"""Optional list of dimensions to remove from every metric found in the event. Wildcards supported."""


class FunctionPublishMetricsTypedDict(TypedDict):
    filename: str
    group: str
    id: FunctionPublishMetricsID
    load_time: float
    mod_time: float
    name: str
    uischema: Dict[str, Any]
    version: str
    async_timeout: NotRequired[float]
    cribl_version: NotRequired[str]
    disabled: NotRequired[bool]
    handle_signals: NotRequired[bool]
    sync: NotRequired[bool]
    schema_: NotRequired[FunctionPublishMetricsSchemaTypedDict]


class FunctionPublishMetrics(BaseModel):
    filename: Annotated[str, pydantic.Field(alias="__filename")]

    group: str

    id: FunctionPublishMetricsID

    load_time: Annotated[float, pydantic.Field(alias="loadTime")]

    mod_time: Annotated[float, pydantic.Field(alias="modTime")]

    name: str

    uischema: Dict[str, Any]

    version: str

    async_timeout: Annotated[Optional[float], pydantic.Field(alias="asyncTimeout")] = (
        None
    )

    cribl_version: Optional[str] = None

    disabled: Optional[bool] = None

    handle_signals: Annotated[Optional[bool], pydantic.Field(alias="handleSignals")] = (
        None
    )

    sync: Optional[bool] = None

    schema_: Annotated[
        Optional[FunctionPublishMetricsSchema], pydantic.Field(alias="schema")
    ] = None
