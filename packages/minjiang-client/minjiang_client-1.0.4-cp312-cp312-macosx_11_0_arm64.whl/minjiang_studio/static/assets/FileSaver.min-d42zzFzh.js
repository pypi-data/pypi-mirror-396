import{P as ne,u as W,G as oe,d as Y,e as A,f as z,h as j,bB as ce,bC as He,i as p,aq as Pe,w,a9 as ke,af as Ne,a7 as Z,ay as Ee,s as D,a8 as J,t as ee,B as F,l as n,a2 as Ke,aM as Ge,A as we,b as fe,K as xe,C as me,r as I,Q as qe,I as o,N as Q,aI as _e,an as We,aO as Je,a3 as de,as as Xe,V as ae,W as ve,v as ye,bD as N,L as Oe,k as Qe,m as Ye,p as Ze,bE as be,n as $e,b7 as De,S as et,am as Be,F as Te,bF as Ue,bG as tt,o as nt,E as at,b3 as ot,b4 as st,aW as le}from"./index-BHd9xypC.js";import{m as rt}from"./exp-VCEEBlLK.js";import{u as Ce}from"./index-_045hRnh.js";import{c as pe}from"./index-Due476Fm.js";import{C as te}from"./Copy16Filled-Cfb9i9ZZ.js";import{H as Ve}from"./HandRight24Filled-D73iODma.js";import{_ as Me}from"./Popconfirm-2ujZaRoc.js";import{_ as Ie}from"./DataTable-08tqtwQR.js";import{i as it}from"./json-editor-vue-DXYCBDpP.js";import{_ as lt}from"./PaginationView.vue_vue_type_script_setup_true_lang-BxX_Je6t.js";import{N as ut}from"./Switch-t-7rbxnR.js";function ct(m){return ne(W.getParamsByTree,m)}function je(m){return ne(W.submitParams,m)}function Fe(m){return ne(W.removeParams,m)}function dt(m){return oe(W.getHistoryParams,m)}function pt(m){return oe(W.searchSpaceParameters,m)}function Ft(){return oe(W.getSpaceInitializerList)}function At(m){return oe(W.getSpaceInitializerSetup,m)}function Nt(m){return ne(W.spaceInitializerPreview,m)}function Kt(m){return ne(W.submitInitializerPreview,m)}function Gt(m){return ne(W.insertSpace,m)}function Wt(m){return oe(W.getSpaceAbstract,m)}const ft={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},he=Y({name:"RefreshCircle",render:function(E,_){return z(),A("svg",ft,_[0]||(_[0]=[j("path",{d:"M256 48C141.31 48 48 141.32 48 256c0 114.86 93.14 208 208 208c114.69 0 208-93.31 208-208c0-114.87-93.13-208-208-208zm0 313a94 94 0 0 1 0-188h4.21l-14.11-14.1a14 14 0 0 1 19.8-19.8l40 40a14 14 0 0 1 0 19.8l-40 40a14 14 0 0 1-19.8-19.8l18-18c-2.38-.1-5.1-.1-8.1-.1a66 66 0 1 0 66 66a14 14 0 0 1 28 0a94.11 94.11 0 0 1-94 94z",fill:"currentColor"},null,-1)]))}}),mt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},vt=Y({name:"Reload",render:function(E,_){return z(),A("svg",mt,_[0]||(_[0]=[j("path",{d:"M400 148l-21.12-24.57A191.43 191.43 0 0 0 240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 0 0 181.07-128",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"32"},null,-1),j("path",{d:"M464 97.42V208a16 16 0 0 1-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z",fill:"currentColor"},null,-1)]))}}),yt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 16 16"},ge=Y({name:"AddCircle16Filled",render:function(E,_){return z(),A("svg",yt,_[0]||(_[0]=[j("g",{fill:"none"},[j("path",{d:"M2 8a6 6 0 1 1 12 0A6 6 0 0 1 2 8zm6-3a.5.5 0 0 0-.5.5v2h-2a.5.5 0 0 0 0 1h2v2a.5.5 0 0 0 1 0v-2h2a.5.5 0 0 0 0-1h-2v-2A.5.5 0 0 0 8 5z",fill:"currentColor"})],-1)]))}}),_t={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Jt=Y({name:"ArrowDownload24Filled",render:function(E,_){return z(),A("svg",_t,_[0]||(_[0]=[j("g",{fill:"none"},[j("path",{d:"M5.25 20.5h13.498a.75.75 0 0 1 .101 1.494l-.101.006H5.25a.75.75 0 0 1-.102-1.493l.102-.007h13.498H5.25zm6.633-18.497L12 1.996a1 1 0 0 1 .993.883l.007.117v12.59l3.294-3.293a1 1 0 0 1 1.32-.083l.094.083a1 1 0 0 1 .083 1.32l-.083.095l-4.997 4.996a1 1 0 0 1-1.32.084l-.094-.083l-5.004-4.997a1 1 0 0 1 1.32-1.498l.094.083L11 15.58V2.996a1 1 0 0 1 .883-.993L12 1.996l-.117.007z",fill:"currentColor"})],-1)]))}}),ht={class:"flex justify-between items-center gap-2"},gt={key:0},kt={key:0,class:"flex justify-center w-full"},wt=Y({__name:"CategoryTabs",props:ce({readOnly:{type:Boolean},tabs:{}},{modelValue:{},modelModifiers:{}}),emits:ce(["insert","refresh"],["update:modelValue"]),setup(m,{emit:E}){const _=E,g=He(m,"modelValue"),b=(d="")=>{_("insert",{full_key:d})},T=()=>{_("refresh")};return(d,v)=>{const C=F,i=Ee,l=Pe;return z(),A("div",null,[p(l,{type:"card",placement:"left",value:g.value,"onUpdate:value":v[1]||(v[1]=a=>g.value=a),class:"tabs",style:{"max-height":"calc(100vh - 340px)"}},{suffix:w(()=>[d.readOnly?J("",!0):(z(),A("div",kt,[p(C,{type:"info",quaternary:"",onClick:v[0]||(v[0]=()=>b()),size:"small"},{icon:w(()=>[p(n(ge))]),_:1}),p(C,{type:"info",quaternary:"",onClick:T,size:"small"},{icon:w(()=>[p(n(he))]),_:1})]))]),default:w(()=>[(z(!0),A(ke,null,Ne(d.tabs,(a,u)=>(z(),Z(i,{name:a.node_name,class:"!flex-1 w-full",key:u},{default:w(()=>[j("div",ht,[D(ee(a.node_name)+" ",1),d.readOnly?J("",!0):(z(),A("div",gt,[p(C,{type:"info",quaternary:"",onClick:()=>b(a.full_key),size:"small"},{icon:w(()=>[p(n(ge))]),_:2},1032,["onClick"]),p(C,{type:"info",quaternary:"",onClick:T,size:"small"},{icon:w(()=>[p(n(he))]),_:1})]))])]),_:2},1032,["name"]))),128))]),_:1},8,["value"])])}}}),xt=Ke(wt,[["__scopeId","data-v-6fd4e427"]]),bt={class:"flex justify-end w-full"},Ct={class:"flex gap-2 items-center"},Se=Y({__name:"ParamsHistory",props:{spaceId:{},hkey:{},maxHeight:{},hideHistoryOption:{type:Boolean},hideRevertOption:{type:Boolean}},emits:["update:success","close:modal"],setup(m,{expose:E,emit:_}){const g=m,b=_,T=Ge(),d=we(),{t:v}=fe(),{copy:C,isSupported:i}=Ce({legacy:!0}),l=xe(),a=me(),u=I(!1),k=I("globalOverview"),P=I(),M=I({show:!1,info:{k_full:void 0}}),$=async t=>{C(t),l.success(v("common.copied"))},L=qe(async t=>{const[x,e]=await je({keys:[t.k_full],values:[t.v],types:[t.t],device_group_name:a.query.device_group_name,space_id:g.spaceId});if(!x&&(e==null?void 0:e.status)===0){l.success(v("groupDetail.parameterManager.revertSuccess"));const r=t.k_full.replace(/(.*)\/.*$/,"$1").split("/");b("update:success",pe(r),!1),H()}},300),K=qe(t=>{M.value={show:!0,info:t}},300),U=[{title:v("groupDetail.parameterManager.keyPath"),key:"k_full",width:280,render:t=>o("div",{class:"inline-flex gap-2"},[o("div",t.k_full),i.value?o(Q,{class:"cursor-pointer transition-transform hover:translate-y-[1px]",size:20,onClick:()=>{$(t.k_full)}},{default:()=>o(te)}):void 0])},{title:v("groupDetail.parameterManager.dataType"),key:"t",width:100},{title:v("groupDetail.parameterManager.value"),key:"v",render:t=>{if(t.v)return o("div",{class:"flex gap-2"},[o(_e,{tooltip:{show:!1}},{default:()=>t.v}),i.value?o(Q,{class:"cursor-pointer transition-transform hover:translate-y-[1px]",size:20,onClick:()=>{$(t.v)}},{default:()=>o(te)}):void 0])}},{title:v("groupDetail.parameterManager.time"),key:"timestamp",width:180},{title:v("createuser"),key:"user_name",width:140},{title:v("groupDetail.parameterManager.expId"),key:"experiment_id",width:100,render:t=>o("span",{onClick:()=>c(t),className:t.experiment_id?"cursor-pointer hover:underline":"",style:{color:t.experiment_id?d.value.infoColor:d.value.textColorBase}},t.experiment_id||"-")},{title:v("groupDetail.parameterManager.session"),key:"session_id",width:100,render:t=>o("div",{onClick:()=>s(t),className:"w-full h-full "+(t.session_id?"cursor-pointer hover:underline":""),style:{color:t.session_id?d.value.infoColor:d.value.textColorBase}},t.session_id||"-")},{title:v("groupDetail.parameterManager.nodeId"),key:"node_id",width:100,render:t=>o("span",{onClick:()=>R(t),className:t.node_id?"cursor-pointer hover:underline":"",style:{color:t.node_id?d.value.infoColor:d.value.textColorBase}},t.node_id||"-")},{title:v("groupDetail.parameterManager.options"),key:"options",width:!g.hideHistoryOption&&!g.hideRevertOption?140:90,align:"center",render:t=>o("div",{class:"flex justify-center"},pe([g.hideRevertOption?null:o(Me,{onPositiveClick:()=>L(t),placement:"left"},{default:()=>v("groupDetail.parameterManager.revertConfirm"),trigger:()=>o(F,{quaternary:!0,type:"info",size:"small"},{default:()=>v("groupDetail.parameterManager.optionRevert")})}),g.hideHistoryOption?void 0:o(F,{size:"small",type:"info",quaternary:!0,onClick:()=>K(t)},{default:()=>v("groupDetail.parameterManager.optionHistory")})]))}],X=t=>({class:t.deleted_flag?"removed":""}),O=We({page:1,per_page:Je,total:0}),H=async()=>{if(u.value)return;u.value=!0;const t=a.query.device_group_name;if(!g.spaceId||!t)return;const[x,e]=await dt({device_group_name:t,space_id:g.spaceId,key:g.hkey,page:O.page,per_page:O.per_page});u.value=!1,!x&&(e==null?void 0:e.status)===0&&(P.value=e.data.list,O.total=e.data.total)};de(()=>g.spaceId,t=>{t&&H()},{immediate:!0}),E({refresh:H});const f=t=>{t||(M.value={show:!1,info:{k_full:void 0}},b("close:modal"))},s=t=>{if(!t.session_id)return;const x=new URLSearchParams({session_id:t.session_id,device_group_name:String(a.query.device_group_name||"")});window.open(`/groupDetail/autoCaliDetail/config?${x.toString()}`,T.expOpenForm)},c=(t,x={})=>{if(!t.experiment_id||!a.query.task_id||!a.query.space_id)return;const e=new URLSearchParams({device_group_name:a.query.device_group_name,task_id:a.query.task_id,task_title:a.query.task_title,space_id:a.query.space_id,exp_id:String(t.experiment_id),...x});window.open(`/experiment/plotter?${e.toString()}`,T.expOpenForm)},R=(t,x={})=>{if(!t.session_id)return;const e=new URLSearchParams({device_group_name:a.query.device_group_name,space_id:a.query.space_id,session_id:String(t.session_id||""),node_id:t.node_id,...x});window.open(`/groupDetail/autoCaliDetail/process?${e.toString()}`,T.expOpenForm)};return(t,x)=>{const e=Ee,r=Pe,h=Ie,q=Xe("params-history",!0),B=ye,y=ve;return z(),A("div",null,[p(r,{value:n(k),"onUpdate:value":x[1]||(x[1]=S=>ae(k)?k.value=S:null),class:"!h-full",disabled:n(u)},{suffix:w(()=>[j("div",bt,[p(n(F),{type:"primary",onClick:x[0]||(x[0]=()=>H())},{icon:w(()=>[p(n(vt))]),default:w(()=>[D(" "+ee(n(v)("groupDetail.parameterManager.refresh")),1)]),_:1})])]),default:w(()=>[p(e,{name:"globalOverview"},{default:w(()=>[j("div",Ct,[D(ee(n(v)("groupDetail.parameterManager.globalHistory"))+" ",1),t.hkey?(z(),A(ke,{key:0},[D(" -  [  "+ee(t.hkey)+"  ] ",1)],64)):J("",!0)])]),_:1})]),_:1},8,["value","disabled"]),p(h,{columns:U,data:n(P),pagination:!1,"row-props":X,loading:n(u),"max-height":t.maxHeight||"calc(100vh - 420px)",class:"mt-5"},null,8,["data","loading","max-height"]),p(lt,{"page-info":n(O),"onUpdate:pageInfo":x[2]||(x[2]=S=>ae(O)?O.value=S:null),onUpdateList:H},null,8,["page-info"]),p(y,{show:n(M).show,"onUpdate:show":x[3]||(x[3]=S=>n(M).show=S),size:"huge",onUpdateShow:f},{default:w(()=>[p(B,{style:{"min-height":"400px",overflow:"auto",width:"1300px","min-width":"500px"}},{default:w(()=>{var S;return[p(q,{"max-height":t.maxHeight,"space-id":t.spaceId,hkey:(S=n(M).info)==null?void 0:S.k_full,"hide-history-option":!0,"hide-revert-option":t.hideRevertOption,"onUpdate:success":H},null,8,["max-height","space-id","hkey","hide-revert-option"])]}),_:1})]),_:1},8,["show"])])}}}),Mt={class:"flex gap-5"},It={class:"float-right"},Ae=Y({__name:"ParamsAction",props:{info:{},spaceId:{},actionTye:{},hideParentTree:{type:Boolean},showHistoryEntry:{type:Boolean}},emits:["update:success","ok","update:hisotry:success"],setup(m,{expose:E,emit:_}){const{t:g}=fe(),b=me(),T=we(),d=I(!1),v=I(!1),C=m,i=_,l=I(null),a=I({types:N.str,keys:void 0,values:void 0}),u=I({keys:{required:!0},values:{required:!0},types:{required:!0}}),k=[N.float,N.str,N.int,N.complex],P=[N.list,N.tuple,N.dict,N.ndarray],M=()=>{v.value=!1,a.value={types:N.str,keys:void 0,values:void 0}},$=s=>{s||(a.value={types:N.str,keys:void 0,values:void 0})},L=Oe(()=>{var s,c;if((s=a.value)!=null&&s.types)return(c=a.value)==null?void 0:c.types}),K=()=>{var s;d.value||(d.value=!0,(s=l.value)==null||s.validate(async c=>{var h;if(c){d.value=!1;return}if(C.actionTye==="custom"){i("ok",a.value),M(),d.value=!1;return}const{keys:R,values:t,types:x}=a.value,[e,r]=await je({keys:[`${X.value}/${R}`],values:[t||""],types:[x],device_group_name:b.query.device_group_name,space_id:C.spaceId});d.value=!1,!e&&(r==null?void 0:r.status)===0&&(M(),i("update:success",((h=X.value)==null?void 0:h.split("/"))||[]))}))},U=s=>{a.value=s},X=Oe(()=>{var s,c,R,t;return((s=C.info)==null?void 0:s.type)==="add"?(c=C.info)==null?void 0:c.full_key:(t=(R=C.info)==null?void 0:R.full_key)==null?void 0:t.replace(/(.*)\/.*$/,"$1")}),O=I(!1),H=()=>{O.value=!0},f=()=>{i("update:success")};return de(O,s=>{s&&M()}),E({open:()=>v.value=!0,close:M,setFormValue:U}),(s,c)=>{const R=Ze,t=Ye,x=$e,e=ut,r=F,h=Qe,q=ye,B=ve;return z(),A(ke,null,[p(B,{show:n(v),"onUpdate:show":c[5]||(c[5]=y=>ae(v)?v.value=y:null),size:"huge",onUpdateShow:$},{default:w(()=>[p(q,{style:{"min-height":"400px",overflow:"auto",width:"800px","min-width":"500px"}},{default:w(()=>[p(h,{model:n(a),rules:n(u),ref_key:"formRef",ref:l},{default:w(()=>[j("div",Mt,[p(t,{label:"Type",path:"types",class:"w-40"},{default:w(()=>[p(R,{options:n(be),value:n(a).types,"onUpdate:value":c[0]||(c[0]=y=>n(a).types=y)},null,8,["options","value"])]),_:1}),p(t,{label:"Key",path:"keys",class:"flex-1"},{default:w(()=>{var y;return[p(x,{value:n(a).keys,"onUpdate:value":c[1]||(c[1]=S=>n(a).keys=S),disabled:((y=s.info)==null?void 0:y.type)==="edit"},De({_:2},[s.hideParentTree?void 0:{name:"prefix",fn:w(()=>[D(ee(n(X))+"/ ",1)]),key:"0"}]),1032,["value","disabled"])]}),_:1})]),p(t,{label:"Value",path:"values"},{default:w(()=>[n(L)&&k.includes(n(L))?(z(),Z(x,{key:0,value:n(a).values,"onUpdate:value":c[2]||(c[2]=y=>n(a).values=y)},null,8,["value"])):J("",!0),n(L)&&n(L)===n(N).bool?(z(),Z(e,{key:1,value:n(a).values,"onUpdate:value":c[3]||(c[3]=y=>n(a).values=y)},null,8,["value"])):J("",!0),n(L)&&P.includes(n(L))?(z(),Z(n(it),{key:2,class:et(["w-full max-h-[65vh] overflow-auto",[n(T).baseColor==="#000"?"jse-theme-dark":""]]),modelValue:n(a).values,"onUpdate:modelValue":c[4]||(c[4]=y=>n(a).values=y),mode:"text"},null,8,["class","modelValue"])):J("",!0)]),_:1}),j("div",It,[s.showHistoryEntry?(z(),Z(r,{key:0,type:"info",class:"!mr-2",onClick:H},{default:w(()=>[D(ee(n(g)("groupDetail.parameterManager.history")),1)]),_:1})):J("",!0),p(r,{type:"primary",loading:n(d),onClick:K},{default:w(()=>[D(ee(n(g)("common.OK")),1)]),_:1},8,["loading"])])]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show"]),p(B,{show:n(O),"onUpdate:show":c[7]||(c[7]=y=>ae(O)?O.value=y:null),size:"huge"},{default:w(()=>[p(q,{style:{"min-height":"400px",overflow:"auto",width:"1300px","min-width":"500px"}},{default:w(()=>{var y;return[p(Se,{"max-height":"auto","space-id":s.spaceId?Number(s.spaceId):void 0,hkey:(y=s.info)==null?void 0:y.full_key,"hide-history-option":"","onClose:modal":c[6]||(c[6]=()=>O.value=!1),"onUpdate:success":f},null,8,["space-id","hkey"])]}),_:1})]),_:1},8,["show"])],64)}}}),St={class:"flex gap-5"},Xt=Y({__name:"ParamsLatest",props:{spaceId:{},maxHeight:{},readOnly:{type:Boolean},version:{}},setup(m,{expose:E}){const _=m,g=me(),{t:b}=fe(),{copy:T,isSupported:d}=Ce({legacy:!0}),v=xe(),C=I(),i=I(!1),l=I(),a=I(),u=I({show:!1,info:void 0}),k=I(),P=I(),M=I(),$=e=>{T(e),v.success(b("common.copied"))},L=e=>{var r;(r=k.value)==null||r.open(),P.value={...e,type:"add"}},K=e=>{var r,h;(r=k.value)==null||r.open(),(h=k.value)==null||h.setFormValue({types:e.t,keys:e.node_name,values:e.v}),P.value={...e,type:"edit"}},U=(e,r,h)=>{const q=JSON.parse(JSON.stringify(a.value));let B=!1;const y=(S,se)=>{Ue(S,(V,re)=>{var G;if(B)return!1;if(V.full_key===e){switch(r){case"rchildren":delete V.children;break;case"rself":(G=se.children)==null||G.splice(re,1);break;case"update":h&&(V.children=h);break;case"insert":V.children=h}return B=!0,!1}V.children&&y(V.children,V)})};y(q,{children:q}),a.value=q},X=async e=>{const[r,h]=await Fe({key:e.full_key,device_group_name:g.query.device_group_name,space_id:_.spaceId});!r&&(h==null?void 0:h.status)===0&&U(e.full_key,"rself")},O=(e,r)=>{var h;R(e,void 0,r!==void 0?r:((h=P.value)==null?void 0:h.type)==="add")},H=e=>{u.value={show:!0,info:e}},f=()=>{R([l.value])},s=e=>{R(e.full_key.split("/"));const r=(M.value||[]).concat(e.full_key);M.value=[...new Set(r)]},c=[{title:b("groupDetail.parameterManager.key"),key:"node_name",render:e=>e.expandable?o("div",{class:"inline-flex items-center gap-1"},pe([o("span",e.node_name),_.readOnly?null:o(F,{quaternary:!0,type:"info",size:"small",onClick:()=>L(e)},{icon:()=>o(ge)}),_.readOnly?null:o(F,{quaternary:!0,type:"info",size:"small",onClick:()=>s(e)},{icon:()=>o(he)})])):o("div",{class:"inline-flex gap-2"},[o("div",e.node_name),d.value?o(Q,{class:"cursor-pointer transition-transform hover:translate-y-[1px]",size:20,onClick:()=>$(e.full_key)},{default:()=>o(te)}):void 0])},{title:b("groupDetail.parameterManager.dataType"),key:"t",width:100,render:e=>{if(e.expandable)return;const r=be.find(h=>h.value===e.t);return o(Be,{size:"small",bordered:!1,color:{textColor:"#fff",color:(r==null?void 0:r.color)||"#2080f0"},class:"min-w-16 text-center inline-flex justify-center"},{default:()=>e.t})}},{title:b("groupDetail.parameterManager.value"),key:"v",render:e=>e.expandable?e.v:o("div",{class:"flex gap-2"},[o(_e,{tooltip:{show:!1}},{default:()=>e.v}),d.value?o(Q,{class:"cursor-pointer transition-transform hover:translate-y-[1px]",size:20,onClick:()=>$(e.v)},{default:()=>o(te)}):void 0])},{title:b("groupDetail.parameterManager.paramsDesc"),key:"desc",render:e=>e.expandable?e.v:o("div",{class:"flex gap-2"},[o(_e,{class:"opacity-80"},{default:()=>e.desc})])}];_.readOnly||c.push({title:b("groupDetail.parameterManager.options"),key:"options",width:260,align:"center",render:e=>{if(!(e!=null&&e.isLeaf))return;const r={quaternary:!0,type:"info",size:"small"},h=o(F,{...r,onClick:()=>{K(e)}},{default:()=>b("groupDetail.parameterManager.optionEdit")}),q=o(F,{...r,onClick:()=>H(e)},{default:()=>b("groupDetail.parameterManager.optionHistory")}),B=o(Me,{onPositiveClick:()=>X(e)},{default:()=>b("groupDetail.parameterManager.removeConfirm"),icon:()=>o(Q,{color:"#e88080",size:22},o(Ve)),trigger:()=>o(F,{...r,type:"error"},{default:()=>b("groupDetail.parameterManager.optionRemove")})});return o("div",{class:"flex justify-end"},[h,q,B])}});const R=async(e=[],r,h)=>{var B;if(!_.spaceId||i.value||!g.query.device_group_name)return;i.value=!0;const q=pe(e);try{const[y,S]=await ct({device_group_name:g.query.device_group_name,space_id:_.spaceId,parent_tree:q,version:_.version});if(i.value=!1,y||(S==null?void 0:S.status)!==0)return;if(q.length===0){C.value=S.data,S.data&&S.data.length>0&&R([S.data[0].node_name]),Te(S.data)&&(a.value=[]);return}const se="/"+q.join("/"),V=S.data.map(G=>({...G,isLeaf:!G.expandable})),re=(B=V.filter(G=>G.isLeaf))==null?void 0:B.map(G=>G.full_key);if(!Te(re)){const[G,ie]=await rt({full_key_list:re.join(","),language:localStorage.getItem("lang")||"en"});!G&&(ie==null?void 0:ie.status)===0&&Ue(V,Re=>{const ze=ie.data[Re.full_key];ze&&(Re.desc=ze)})}if(r)return r.resolve(),V;q.length===1?a.value=V:h?U(se,"insert",V):U(se,"update",V)}catch{r&&r.reject(),i.value=!1}},t=e=>new Promise(async(r,h)=>{const q=await R(e.full_key.split("/"),{resolve:r,reject:h});e.children=q}),x=e=>{const[r]=tt(M.value,e);r&&U(r,"rchildren"),M.value=e};return de(()=>_.spaceId,e=>{e&&R()},{immediate:!0}),de(l,e=>{e&&(M.value=[],a.value=[],R([e]))}),E({refresh:R}),(e,r)=>{const h=Ie,q=ye,B=ve;return z(),A("div",St,[n(C)?(z(),Z(xt,{key:0,tabs:n(C),modelValue:n(l),"onUpdate:modelValue":r[0]||(r[0]=y=>ae(l)?l.value=y:null),onInsert:L,onRefresh:f,"read-only":e.readOnly},null,8,["tabs","modelValue","read-only"])):J("",!0),p(h,{size:"small","max-height":e.maxHeight?e.maxHeight:"calc(100vh - 340px)",columns:c,data:n(a),loading:n(i),"row-key":y=>y.full_key,"expanded-row-keys":n(M),onLoad:t,onUpdateExpandedRowKeys:x},null,8,["max-height","data","loading","row-key","expanded-row-keys"]),e.spaceId?(z(),Z(Ae,{key:1,info:n(P),ref_key:"actionInfoRef",ref:k,"space-id":e.spaceId,"onUpdate:success":O},null,8,["info","space-id"])):J("",!0),p(B,{show:n(u).show,"onUpdate:show":r[1]||(r[1]=y=>n(u).show=y),size:"huge"},{default:w(()=>[p(q,{style:{"min-height":"400px",overflow:"auto",width:"1300px","min-width":"500px"}},{default:w(()=>{var y;return[p(Se,{"max-height":"auto","space-id":e.spaceId,hkey:(y=n(u).info)==null?void 0:y.full_key,"hide-history-option":"","onUpdate:success":O},null,8,["space-id","hkey"])]}),_:1})]),_:1},8,["show"])])}}}),Rt={class:"relative mb-2 w-[450px]"},Qt=Y({__name:"ParamsSearch",props:ce({spaceId:{}},{modelValue:{},modelModifiers:{}}),emits:ce(["refresh"],["update:modelValue"]),setup(m,{emit:E}){const _=E,g=m,b=me(),T=we(),{t:d}=fe(),{copy:v,isSupported:C}=Ce({legacy:!0}),i=xe(),l=I(!1),a=I(),u=He(m,"modelValue"),k=I({show:!1,info:void 0}),P=I(),M=I(),$=f=>{v(f),i.success(d("common.copied"))},L=f=>{var s,c;(s=P.value)==null||s.open(),(c=P.value)==null||c.setFormValue({types:f.t,keys:f.full_key.replace(/^.*\/([^\/]*)$/,"$1"),values:f.v}),M.value={...f,type:"edit"}},K=async f=>{const[s,c]=await Fe({key:f.full_key,device_group_name:b.query.device_group_name,space_id:g.spaceId});!s&&(c==null?void 0:c.status)===0&&(H(),_("refresh"))},U=()=>{H(),_("refresh")},X=f=>{k.value={show:!0,info:f}},O=[{title:d("groupDetail.parameterManager.key"),key:"full_key",render:f=>o("div",{class:"inline-flex gap-2"},[o("div",f.full_key),o(Q,{class:"cursor-pointer transition-transform hover:translate-y-[1px]",size:20,onClick:()=>$(f.full_key)},{default:()=>o(te)})])},{title:d("groupDetail.parameterManager.dataType"),key:"t",width:100,render:f=>{if(f.expandable)return;const s=be.find(c=>c.value===f.t);return o(Be,{size:"small",bordered:!1,color:{textColor:"#fff",color:(s==null?void 0:s.color)||"#2080f0"},class:"min-w-16 text-center inline-flex justify-center"},{default:()=>f.t})}},{title:d("groupDetail.parameterManager.value"),key:"v",ellipsis:{tooltip:!0},render:f=>f.expandable?f.v:o("div",{class:"flex gap-2"},[o("div",f.v),C.value?o(Q,{class:"cursor-pointer transition-transform hover:translate-y-[1px]",size:20,onClick:()=>$(f.v)},{default:()=>o(te)}):void 0])},{title:d("groupDetail.parameterManager.options"),key:"options",width:260,align:"center",render:f=>{const s={quaternary:!0,type:"info",size:"small"},c=o(F,{...s,onClick:()=>{L(f)}},{default:()=>d("groupDetail.parameterManager.optionEdit")}),R=o(F,{...s,onClick:()=>X(f)},{default:()=>d("groupDetail.parameterManager.optionHistory")}),t=o(Me,{onPositiveClick:()=>K(f),placement:"left-start"},{default:()=>d("groupDetail.parameterManager.removeConfirm"),icon:()=>o(Q,{color:"#e88080",size:22},o(Ve)),trigger:()=>o(F,{...s,type:"error"},{default:()=>d("groupDetail.parameterManager.optionRemove")})});return o("div",{class:"flex justify-end"},[c,R,t])}}],H=async()=>{var c;if(!((c=u.value)!=null&&c.trim())||!g.spaceId||l.value)return;l.value=!0;const[f,s]=await pt({device_group_name:b.query.device_group_name,space_id:g.spaceId,search_word:u.value});l.value=!1,(f||(s==null?void 0:s.status)==0)&&(a.value=s==null?void 0:s.data)};return nt(()=>{at(()=>{setTimeout(()=>{H()},200)})}),(f,s)=>{const c=$e,R=Ie,t=ye,x=ve;return z(),A("div",null,[j("div",Rt,[p(c,{style:{width:"450px","padding-right":"20px"},value:u.value,"onUpdate:value":s[0]||(s[0]=e=>u.value=e),valueModifiers:{trim:!0},placeholder:n(d)("groupDetail.parameterManager.searchPlaceholder"),onKeyup:ot(H,["enter"])},null,8,["value","placeholder"]),j("div",{class:"absolute -right-4 top-1/2 -translate-1/2 h-full w-8 flex items-center justify-center cursor-pointer",onClick:H},[p(n(Q),{color:n(T).primaryColor,component:n(st)},null,8,["color","component"])])]),p(R,{size:"small","max-height":"calc(100vh - 340px)",columns:O,data:n(a),loading:n(l),"row-key":e=>e.full_key},null,8,["data","loading","row-key"]),f.spaceId?(z(),Z(Ae,{key:0,info:n(M),ref_key:"actionInfoRef",ref:P,"space-id":f.spaceId,"onUpdate:success":U},null,8,["info","space-id"])):J("",!0),p(x,{show:n(k).show,"onUpdate:show":s[1]||(s[1]=e=>n(k).show=e),size:"huge"},{default:w(()=>[p(t,{style:{"min-height":"400px",overflow:"auto",width:"1300px","min-width":"500px"}},{default:w(()=>{var e;return[p(Se,{"max-height":"auto","space-id":f.spaceId,hkey:(e=n(k).info)==null?void 0:e.full_key,"hide-history-option":"","onUpdate:success":U},null,8,["space-id","hkey"])]}),_:1})]),_:1},8,["show"])])}}});var ue={exports:{}},zt=ue.exports,Le;function qt(){return Le||(Le=1,function(m,E){(function(_,g){g()})(zt,function(){function _(i,l){return typeof l>"u"?l={autoBom:!1}:typeof l!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}function g(i,l,a){var u=new XMLHttpRequest;u.open("GET",i),u.responseType="blob",u.onload=function(){C(u.response,l,a)},u.onerror=function(){console.error("could not download file")},u.send()}function b(i){var l=new XMLHttpRequest;l.open("HEAD",i,!1);try{l.send()}catch{}return 200<=l.status&&299>=l.status}function T(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(l)}}var d=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof le=="object"&&le.global===le?le:void 0,v=d.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),C=d.saveAs||(typeof window!="object"||window!==d?function(){}:"download"in HTMLAnchorElement.prototype&&!v?function(i,l,a){var u=d.URL||d.webkitURL,k=document.createElement("a");l=l||i.name||"download",k.download=l,k.rel="noopener",typeof i=="string"?(k.href=i,k.origin===location.origin?T(k):b(k.href)?g(i,l,a):T(k,k.target="_blank")):(k.href=u.createObjectURL(i),setTimeout(function(){u.revokeObjectURL(k.href)},4e4),setTimeout(function(){T(k)},0))}:"msSaveOrOpenBlob"in navigator?function(i,l,a){if(l=l||i.name||"download",typeof i!="string")navigator.msSaveOrOpenBlob(_(i,a),l);else if(b(i))g(i,l,a);else{var u=document.createElement("a");u.href=i,u.target="_blank",setTimeout(function(){T(u)})}}:function(i,l,a,u){if(u=u||open("","_blank"),u&&(u.document.title=u.document.body.innerText="downloading..."),typeof i=="string")return g(i,l,a);var k=i.type==="application/octet-stream",P=/constructor/i.test(d.HTMLElement)||d.safari,M=/CriOS\/[\d]+/.test(navigator.userAgent);if((M||k&&P||v)&&typeof FileReader<"u"){var $=new FileReader;$.onloadend=function(){var U=$.result;U=M?U:U.replace(/^data:[^;]*;/,"data:attachment/file;"),u?u.location.href=U:location=U,u=null},$.readAsDataURL(i)}else{var L=d.URL||d.webkitURL,K=L.createObjectURL(i);u?u.location=K:location.href=K,u=null,setTimeout(function(){L.revokeObjectURL(K)},4e4)}});d.saveAs=C.saveAs=C,m.exports=C})}(ue)),ue.exports}var Yt=qt();export{Jt as A,Yt as F,vt as R,Ae as _,Ft as a,At as b,Kt as c,Xt as d,Se as e,Qt as f,Wt as g,Gt as i,Nt as s};
