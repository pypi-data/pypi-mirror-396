import{d as z,a7 as v,a8 as T,l as t,F as B,f as n,r as s,A as ee,C as G,b as te,L as ae,o as H,aw as se,ax as ne,e as h,h as U,i as _,aj as oe,w as o,aG as le,a9 as q,af as M,s as ue,t as ie,a6 as $,S as re,aH as ce,aq as O,V as P,ap as Y,ak as _e,aF as de,E as pe,aY as j,b7 as me}from"./index-BHd9xypC.js";import{d as fe,e as ve}from"./autoCali-BOdHkL9O.js";import{_ as ge,D as ye}from"./DotLoader-VA_-7A1B.js";import{u as be}from"./autoCali-DjlFyowx.js";import"./Image-D3gvlp1C.js";import"./download-C2161hUv.js";const he=z({__name:"EntityLog",props:{logs:{}},setup(I){return(l,c)=>t(B)(l.logs)?T("",!0):(n(),v(ge,{key:0,logs:l.logs},null,8,["logs"]))}}),xe={class:"flex ml-5"},F=120,ke=z({__name:"EntitiesView",props:{entities:{}},setup(I){const l=s(!1),c=be(),p=ee(),x=G(),{t:A}=te(),u=s(),e=s(),m=s(0),R=s(),g=s(0),r=s(!1),k=s(),D=I,J=ae(()=>{const i=D.entities.length;return Array(i<F?F:i).fill(0).map((a,f)=>D.entities[f])}),Q=i=>{i&&(k.value||(k.value=!0,u.value=i,e.value=[],R.value=[],m.value=0,g.value=0,r.value=!0,y()))},y=async()=>{var f,E,b,L,N;if(!l.value||!u.value||!x.query.session_id)return;r.value=!0;const[i,a]=await fe({session_id:+x.query.session_id,entity:u.value,last_record_id:m.value});k.value=!1,!i&&(a==null?void 0:a.status)===0&&(m.value!==((f=a.data)==null?void 0:f.last_record_id)&&((E=a.data)!=null&&E.last_record_id)&&(e.value=[...(b=a.data)==null?void 0:b.logs.reverse(),...e.value||[]]),(L=a.data)!=null&&L.last_record_id&&(m.value=(N=a.data)==null?void 0:N.last_record_id),pe(()=>{var V,S;((V=c.sessionInfo)==null?void 0:V.status)===j.RUNNING&&W(),((S=c.sessionInfo)==null?void 0:S.status)!==j.RUNNING&&(r.value=!1)}))},C=s(),W=()=>{C.value=setTimeout(()=>{y(),K()},3e3)},K=()=>{C.value&&(clearInterval(C.value),C.value=null)},w=s(0),X=i=>{w.value=i,u.value&&y()};return H(()=>{l.value=!0,y()}),se(()=>{l.value=!0,y()}),ne(()=>{l.value=!1,K()}),(i,a)=>{const f=ce,E=le,b=oe,L=_e,N=de,V=Y,S=O;return n(),h("div",xe,[U("div",null,[_(b,{style:{height:"calc(100vh - 310px)"}},{default:o(()=>[_(E,{cols:10,style:{width:"560px"}},{default:o(()=>[(n(!0),h(q,null,M(t(J),(d,Z)=>(n(),v(f,{key:Z,class:re(["border min-w-14 min-h-14 flex items-center justify-center p-1",[d?"cursor-pointer":""]]),style:$({borderColor:t(p).dividerColor,backgroundColor:t(u)===d&&t(u)?"#00B42A":"inherit",color:t(u)===d?"#fff":"inherit"}),onClick:()=>Q(d)},{default:o(()=>[ue(ie(d),1)]),_:2},1032,["style","class","onClick"]))),128))]),_:1})]),_:1})]),_(S,{animated:"",class:"!h-full flex-1 !w-auto ml-8",value:t(w),"onUpdate:value":a[0]||(a[0]=d=>P(w)?w.value=d:null),onUpdateValue:X},{suffix:o(()=>[t(r)?(n(),v(ye,{key:0})):T("",!0)]),default:o(()=>[_(V,{name:0,key:"0",tab:t(A)("groupDetail.autoCali.caliLog"),class:"!pl-0","display-directive":"show:lazy"},{default:o(()=>[_(b,{style:$({padding:"15px",height:"calc(100vh - 345px)",backgroundColor:t(p).baseColor})},{default:o(()=>[t(k)?(n(),v(L,{key:0})):(n(),h(q,{key:1},[_(he,{logs:t(e)},null,8,["logs"]),t(B)(t(e))?(n(),v(N,{key:0,class:"mt-32"})):T("",!0)],64))]),_:1},8,["style"])]),_:1},8,["tab"])]),_:1},8,["value"])])}}}),Se=z({__name:"AutoCaliEntity",setup(I){const l=G(),c=s(),p=s(),x=async()=>{const[u,e]=await ve({device_group_name:l.query.device_group_name,space_id:+l.query.space_id});!u&&(e==null?void 0:e.status)===0&&(p.value=e.data,c.value=Object.keys(e.data)[0])},A=()=>{};return H(()=>{x()}),(u,e)=>{const m=Y,R=O;return n(),h("div",null,[_(R,{type:"card",animated:"",size:"small",placement:"left",class:"!h-full !w-auto",value:t(c),"onUpdate:value":e[0]||(e[0]=g=>P(c)?c.value=g:null),onUpdateValue:A,"tab-class":"w-[128px]"},me({suffix:o(()=>[e[2]||(e[2]=U("div",null,null,-1))]),default:o(()=>[(n(!0),h(q,null,M(t(p),(g,r)=>(n(),v(m,{name:r,key:r,tab:r},{default:o(()=>[_(ke,{"active-key":r,entities:g},null,8,["active-key","entities"])]),_:2},1032,["name","tab"]))),128))]),_:2},[t(B)(t(p))?void 0:{name:"prefix",fn:o(()=>[e[1]||(e[1]=U("div",null,null,-1))]),key:"0"}]),1032,["value"])])}}});export{Se as default};
