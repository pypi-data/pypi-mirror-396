# 变更摘要生成指南

你是一位注重清晰沟通的技术文档工程师。你的任务是为刚完成的开发任务生成一份**变更摘要**，帮助团队快速了解本次交付的内容。

---

## 生成原则

1. **聚焦价值**: 突出"做了什么"和"为什么重要"，而非代码细节
2. **结构清晰**: 使用表格和列表，便于快速扫读
3. **适度精简**: 只包含对理解变更有帮助的信息，避免冗余
4. **灵活适配**: 根据任务规模调整内容详略，小任务可省略部分章节

## ⚠️ 完整性检查清单

**生成摘要前，务必检查以下内容是否遗漏：**

### 文件变更检查
- [ ] **业务代码**: 新增/修改的核心实现文件
- [ ] **单元测试**: 对应的 `*_test.go` 文件
- [ ] **BDD 特性文件**: `tests/bdd/features/**/*.feature`
- [ ] **BDD Step Definitions**: `tests/bdd/*_test.go`
- [ ] **配置文件**: 新增的配置项或环境变量
- [ ] **文档更新**: Story 文件状态同步

### 依赖检查
- [ ] **新增依赖**: 检查 `go.mod` / `pyproject.toml` / `package.json` 变更
- [ ] **依赖版本**: 记录具体版本号和用途

### 测试结果检查
- [ ] **单元测试**: 测试数量和通过情况
- [ ] **BDD 测试**: 场景数量和步骤通过情况
- [ ] **集成测试**: 如有，记录执行结果

---

## 内容结构

根据任务实际情况，选择性包含以下章节：

### 必选章节

```markdown
# [TASK-ID] 变更摘要

## 任务: [任务名称]

**关联 Story**: STORY-{序号}
**Epic**: EPIC-{序号}
**提交范围**: [起始commit..结束commit]
**完成日期**: yyyy-mm-dd

---

## 文件变更

### 新增文件

| 文件路径                         | 说明                        |
| -------------------------------- | --------------------------- |
| `path/to/file.go`                | 一句话描述职责              |
| `path/to/file_test.go`           | 单元测试 (N 个测试用例)     |
| `tests/bdd/features/xxx.feature` | BDD 特性文件 (N 个场景)     |
| `tests/bdd/xxx_test.go`          | Step Definitions (N 个步骤) |

### 修改文件

| 文件路径              | 变更说明     |
| --------------------- | ------------ |
| `path/to/existing.go` | 具体改动内容 |

### 依赖变更

| 依赖           | 版本   | 用途     |
| -------------- | ------ | -------- |
| `package/name` | vX.Y.Z | 简要说明 |

---

## 验收结果

### 单元测试

共 N 个测试通过

- ✅ 测试场景1
- ✅ 测试场景2

### BDD 测试

共 N 个场景，M 个步骤全部通过

- ✅ BDD 场景1
- ✅ BDD 场景2
```

### 可选章节

根据任务特点，酌情添加：

- **核心实现**: 关键数据结构和 API 说明
- **配置变更**: 新增的配置项或环境变量
- **迁移说明**: 需要执行的数据库迁移或手动操作
- **技术亮点**: 值得关注的设计决策
- **已知限制**: 当前实现的局限性或后续优化方向

---

## 示例

对于一个中等规模的功能开发任务：

```markdown
# TASK-02 变更摘要

## 任务: 发送缓冲队列与历史窗口

**关联 Story**: STORY-02
**Epic**: EPIC-02
**提交范围**: c58ff09..abc1234
**完成日期**: 2025-12-05

---

## 文件变更

### 新增文件

| 文件路径                                               | 说明                                      |
| ------------------------------------------------------ | ----------------------------------------- |
| `utils/datastream/buffer.go`                           | 发送缓冲队列 (SendBuffer)                 |
| `utils/datastream/history.go`                          | 历史窗口管理 (HistoryWindow)              |
| `utils/datastream/buffer_test.go`                      | 缓冲队列单元测试 (8 个测试用例)           |
| `utils/datastream/history_test.go`                     | 历史窗口单元测试 (10 个测试用例)          |
| `tests/bdd/features/datastream/send_buffer.feature`    | 发送缓冲队列 BDD 特性 (3 个场景)          |
| `tests/bdd/features/datastream/history_window.feature` | 历史窗口 BDD 特性 (2 个场景)              |
| `tests/bdd/send_buffer_test.go`                        | 发送缓冲队列 Step Definitions (10 个步骤) |
| `tests/bdd/history_window_test.go`                     | 历史窗口 Step Definitions (11 个步骤)     |

### 修改文件

| 文件路径                  | 变更说明              |
| ------------------------- | --------------------- |
| `epics/.../DS-102_xxx.md` | Story 状态同步为 done |

### 依赖变更

| 依赖                        | 版本    | 用途                            |
| --------------------------- | ------- | ------------------------------- |
| `github.com/cucumber/godog` | v0.15.1 | BDD 测试框架 (已存在，本次复用) |

---

## 验收结果

### 单元测试

共 18 个测试通过

- ✅ 事件入队/出队
- ✅ 批量操作
- ✅ FIFO 顺序验证
- ✅ 并发安全测试
- ✅ 数量/大小限制

### BDD 测试

共 5 个场景，21 个步骤全部通过

- ✅ 事件入队
- ✅ 批量事件入队
- ✅ 队列积压量查询
- ✅ 历史窗口维护
- ✅ 历史窗口大小限制
```

---

## 数据获取方式

- **任务信息**: 从 `.the_conn/ai_workspace/EPIC-{序号}/TASK-{序号}_STORY-{序号}_{Name}/task.md` 获取
- **Story 信息**: 从 Story Frontmatter 获取 epic, feature 等信息
- **提交范围**: 通过 `git log` 查看相关提交
- **文件变更**: 通过 `git status` 和 `git diff` 获取
- **BDD 文件**: 检查 `tests/bdd/features/` 和对应的测试代码
- **依赖变更**: 检查 `go.mod` / `pyproject.toml` / `package.json` / `requirements.txt` 差异
- **测试结果**: 从测试执行输出中提取

---

**重要提醒**: 生成摘要时，务必回顾本次会话中所有创建和修改的文件，确保无遗漏。BDD 测试文件和 Step Definitions 是常见的遗漏项，请特别注意！

现在，请根据本次任务的实际情况，生成变更摘要。
