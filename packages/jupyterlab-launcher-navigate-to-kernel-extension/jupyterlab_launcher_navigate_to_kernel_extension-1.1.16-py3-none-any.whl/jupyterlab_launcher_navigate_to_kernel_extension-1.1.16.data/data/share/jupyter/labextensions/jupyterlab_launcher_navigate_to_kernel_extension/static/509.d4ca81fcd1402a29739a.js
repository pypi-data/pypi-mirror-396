"use strict";(self.webpackChunkjupyterlab_launcher_navigate_to_kernel_extension=self.webpackChunkjupyterlab_launcher_navigate_to_kernel_extension||[]).push([[509],{509:(e,n,r)=>{r.r(n),r.d(n,{default:()=>m});var t=r(555),o=r(477),a=r(265),s=r(324),i=r(596),l=r(603);const c="launcher:show-kernel-in-file-browser",u="launcher:open-terminal-at-kernel",d="launcher:unregister-venv-kernel";let h=null,g=!1;async function v(e){const n=i.ServerConnection.makeSettings(),r=l.URLExt.join(n.baseUrl,"api","kernel-path",encodeURIComponent(e));try{const e=await i.ServerConnection.makeRequest(r,{},n);if(!e.ok){const n=await e.json();return console.warn(`Failed to get kernel path: ${n.error}`),null}return await e.json()}catch(e){return console.error("Error fetching kernel path:",e),null}}function w(e,n){const r=e.replace(/\/+$/,""),t=function(e,n){if(!e.startsWith("~"))return e;const r=n.match(/^(\/(?:home|Users)\/[^/]+)/);if(!r)return e;const t=r[1];return"~"===e?t:e.startsWith("~/")?t+e.slice(1):e}(n,e).replace(/\/+$/,"");if(r===t)return"";const o=t+"/";return r.startsWith(o)?r.slice(o.length):null}const m={id:"jupyterlab_launcher_navigate_to_kernel_extension:plugin",description:"Right-click kernel launcher cards to navigate file browser to kernel's location or open terminal there",autoStart:!0,requires:[t.IDefaultFileBrowser],optional:[o.ILauncher,a.ITerminalTracker],activate:(e,n,r,t)=>{console.log("JupyterLab extension jupyterlab_launcher_navigate_to_kernel_extension is activated!");const{commands:o}=e,a=l.PageConfig.getOption("serverRoot");document.addEventListener("contextmenu",e=>{const n=e.target;n&&n.closest(".jp-LauncherCard")&&(h=function(e){const n=e.closest(".jp-LauncherCard");if(!n)return null;const r=n.querySelector(".jp-LauncherCard-label");return r&&r.textContent?r.textContent.trim():n.title?n.title:null}(n))},!0),async function(){const e=i.ServerConnection.makeSettings(),n=l.URLExt.join(e.baseUrl,"nb-venv-kernels","environments");try{return(await i.ServerConnection.makeRequest(n,{},e)).ok}catch(e){return console.debug("nb_venv_kernels extension not installed:",e),!1}}().then(e=>{g=e,e&&console.log("nb_venv_kernels extension detected - unregister feature enabled")}),o.addCommand(c,{label:"Show in File Browser",caption:"Navigate file browser to kernel's directory",isEnabled:()=>null!==h,execute:async()=>{if(!h)return void await(0,s.showErrorMessage)("No Kernel Selected","Could not determine which kernel was selected.");const e=await v(h);if(!e)return void await(0,s.showErrorMessage)("Kernel Not Found",`Could not find path information for kernel "${h}".`);const r=e.env_path||e.resource_dir,t=w(r,a),o=null===t?"":t;try{const e=""===o?"/":"/"+o;await n.model.cd(e)}catch(e){console.error("Failed to navigate file browser:",e),await(0,s.showErrorMessage)("Navigation Error",`Failed to navigate to: ${r}\nError: ${e}`)}}}),o.addCommand(u,{label:"Open Terminal at Location",caption:"Open a terminal at the kernel's directory",isEnabled:()=>null!==h&&null!==t,execute:async()=>{if(!h)return void await(0,s.showErrorMessage)("No Kernel Selected","Could not determine which kernel was selected.");const e=await v(h);if(!e)return void await(0,s.showErrorMessage)("Kernel Not Found",`Could not find path information for kernel "${h}".`);const n=e.env_path||e.resource_dir,r=w(n,a),t=null===r?"":r;try{await o.execute("terminal:create-new",{cwd:t})}catch(e){console.error("Failed to open terminal:",e),await(0,s.showErrorMessage)("Terminal Error",`Failed to open terminal at: ${n}\nError: ${e}`)}}}),o.addCommand(d,{label:"Unregister Kernel",caption:"Remove this kernel from nb_venv_kernels registry",isEnabled:()=>null!==h&&g,isVisible:()=>g,execute:async()=>{if(!h)return void await(0,s.showErrorMessage)("No Kernel Selected","Could not determine which kernel was selected.");const e=await async function(e){const n=await async function(){const e=i.ServerConnection.makeSettings(),n=l.URLExt.join(e.baseUrl,"nb-venv-kernels","environments");try{const r=await i.ServerConnection.makeRequest(n,{},e);return r.ok?await r.json():(console.warn("nb_venv_kernels API not available"),null)}catch(e){return console.debug("nb_venv_kernels extension not installed:",e),null}}();if(!n)return null;for(const r of n.environments){if("conda"===r.type)continue;const n=r.name||"",t=r.custom_name||"";if(n&&e.includes(n)||t&&e.includes(t))return r}return null}(h);if(!e)return void await(0,s.showErrorMessage)("Cannot Unregister",`"${h}" is not managed by nb_venv_kernels.`);const n=await async function(e){const n=i.ServerConnection.makeSettings(),r=l.URLExt.join(n.baseUrl,"nb-venv-kernels","unregister");try{const t=await i.ServerConnection.makeRequest(r,{method:"POST",body:JSON.stringify({path:e})},n),o=await t.json();return t.ok?{success:!0,message:o.message}:{success:!1,error:o.error||"Failed to unregister kernel"}}catch(e){return console.error("Error unregistering kernel:",e),{success:!1,error:`Network error: ${e}`}}}(e.path);n.success?(console.log(`Kernel unregistered: ${e.path}`),await(0,s.showErrorMessage)("Kernel Unregistered",`Successfully unregistered "${e.name}" (${e.path}).\n\nTo re-register this environment, use:\n  nb_venv_kernels register ${e.path}`)):await(0,s.showErrorMessage)("Unregister Failed",`Failed to unregister kernel: ${n.error}`)}}),console.log(`Commands registered: ${c}, ${u}, ${d}`)}}}}]);