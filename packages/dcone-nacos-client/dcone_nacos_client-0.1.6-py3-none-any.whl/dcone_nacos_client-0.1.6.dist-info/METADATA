Metadata-Version: 2.4
Name: dcone-nacos-client
Version: 0.1.6
Summary: ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Nacos å®¢æˆ·ç«¯å°è£…åº“ï¼Œæä¾›é…ç½®ç®¡ç†ã€æœåŠ¡æ³¨å†Œä¸å‘ç°åŠŸèƒ½ï¼Œæ”¯æŒå¤šå±‚çº§é…ç½®ä¼˜å…ˆçº§ã€åŠ¨æ€é…ç½®æ›´æ–°å’Œä¼˜é›…å…³é—­ã€‚
License: MIT
Author: wangkaiay
Author-email: wangkaiay@digitalchina.com
Requires-Python: >=3.10
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Classifier: Programming Language :: Python :: 3.14
Requires-Dist: nacos-sdk-python (>=2.0.9,<3.0.0)
Requires-Dist: pyyaml (>=6.0.3,<7.0.0)
Description-Content-Type: text/markdown

# Nacos Client

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Nacos å®¢æˆ·ç«¯å°è£…åº“ï¼Œæä¾›é…ç½®ç®¡ç†ã€æœåŠ¡æ³¨å†Œä¸å‘ç°åŠŸèƒ½ï¼Œæ”¯æŒå¤šå±‚çº§é…ç½®ä¼˜å…ˆçº§ã€åŠ¨æ€é…ç½®æ›´æ–°å’Œä¼˜é›…å…³é—­ã€‚


---

## âœ¨ ç‰¹æ€§

- **ä¸‰çº§é…ç½®ä¼˜å…ˆçº§**ï¼šç¯å¢ƒå˜é‡ > Nacos è¿œç¨‹é…ç½® > æœ¬åœ°é…ç½®æ–‡ä»¶
- **åŠ¨æ€é…ç½®æ›´æ–°**ï¼šå®æ—¶ç›‘å¬ Nacos é…ç½®å˜æ›´å¹¶è‡ªåŠ¨æ›´æ–°
- **æœåŠ¡æ³¨å†Œä¸å‘ç°**ï¼šè‡ªåŠ¨æ³¨å†ŒæœåŠ¡å®ä¾‹ï¼Œæ”¯æŒå¿ƒè·³ä¿æ´»å’Œä¼˜é›…ä¸‹çº¿
- **å…±äº«é…ç½®æ”¯æŒ**ï¼šæ”¯æŒåŠ è½½å¤šä¸ª Nacos é…ç½®æ–‡ä»¶ï¼ˆä¸»é…ç½® + å…±äº«é…ç½®ï¼‰
- **çº¿ç¨‹å®‰å…¨**ï¼šæ‰€æœ‰æ ¸å¿ƒç»„ä»¶å‡å®ç°çº¿ç¨‹å®‰å…¨
- **ä¼˜é›…å…³é—­**ï¼šè‡ªåŠ¨æ³¨å†Œ shutdown hooksï¼Œç¡®ä¿æœåŠ¡æ­£å¸¸æ³¨é”€
- **ç±»å‹å®‰å…¨**ï¼šåŸºäº Pydantic çš„é…ç½®å®ä½“å®šä¹‰

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
nacos_client/
â”œâ”€â”€ __init__.py              # ç»Ÿä¸€å…¥å£ï¼Œæä¾›åˆå§‹åŒ–å’Œå…¨å±€è®¿é—®æ–¹æ³•
â”œâ”€â”€ client.py                # NacosClientManagerï¼šå®¢æˆ·ç«¯ç®¡ç†å™¨ï¼ˆå•ä¾‹ï¼‰
â”œâ”€â”€ config.py                # NacosConfigï¼šé…ç½®ç®¡ç†å™¨ï¼ˆåŠ¨æ€åŠ è½½ + ç›‘å¬ï¼‰
â”œâ”€â”€ confg_environment.py     # ConfigEnvironmentï¼šä¸‰çº§é…ç½®ç¯å¢ƒç®¡ç†
â”œâ”€â”€ registry.py              # ServiceRegistryï¼šæœåŠ¡æ³¨å†Œä¸å¿ƒè·³ç®¡ç†
â”œâ”€â”€ discovery.py             # ServiceDiscoveryï¼šæœåŠ¡å‘ç°
â”œâ”€â”€ entity.py                # é…ç½®å®ä½“ç±»ï¼ˆNacosConfigEntity, SharedConfigEntityï¼‰
â”œâ”€â”€ constant.py              # é…ç½®é”®å¸¸é‡å®šä¹‰
â”œâ”€â”€ config_decorator.py      # é…ç½®æ³¨è§£è£…é¥°å™¨ï¼ˆè‡ªåŠ¨æ³¨å…¥é…ç½®åˆ°å¯¹è±¡ï¼‰
â””â”€â”€ utils.py                 # å·¥å…·å‡½æ•°ï¼ˆIP è·å–ã€é…ç½®åŠ è½½ã€å®šæ—¶å™¨ç­‰ï¼‰
```


---

## ğŸ“¦ å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨ uv å®‰è£…
uv add nacos-sdk-python pyyaml pydantic

# æˆ–ä½¿ç”¨ pip
pip install nacos-sdk-python pyyaml pydantic
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬ç”¨æ³•

```python
from src.nacos_client import init_nacos_client, get_service_discovery, app_config, NacosConstant

# è·å–é…ç½®
db_host = app_config.get("database.host", "localhost")
port = app_config.get("app.port", 8000)

# æœåŠ¡å‘ç°
discovery = get_service_discovery()
instances = discovery.get_instances("sv-maas")
```

### 2. ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
export NACOS__SERVER_ADDR="10.3.70.16:8848"
export NACOS__NAMESPACE=""
export NACOS__USERNAME="nacos"
export NACOS__PASSWORD="nacos"
export APP__NAME="sv-maas"
export APP__PORT="8888"
```

### 3. ä½¿ç”¨æœ¬åœ°é…ç½®æ–‡ä»¶

åœ¨ `config/config.yaml` ä¸­é…ç½®ï¼ˆä¼˜å…ˆçº§æœ€ä½ï¼‰ï¼š

```yaml
nacos:
  server_addr: "10.3.70.16:8848"
  namespace: ""
  username: "nacos"
  password: "nacos"
  # ä¸»é…ç½®ï¼šä¸šåŠ¡é…ç½®ï¼ˆé»˜è®¤åŠ è½½ï¼‰
  config_data_id: "sv-maas-service-prod.yaml"
  config_group: "DEFAULT_GROUP"
  # é¢å¤–åŠ è½½å…¶ä»– Group çš„é…ç½®,è·å–é…ç½®ä¼˜å…ˆçº§åŒé…ç½®é¡ºåº
  shared_configs:
    - data_id: "common-config.yaml"
      group: "DEFAULT_GROUP"
      refresh: true
    - data_id: "database-config.yaml"
      group: "DEFAULT_GROUP"
      refresh: true

app:
  name: "sv-maas"
  port: 8888
```



## âš™ï¸ é…ç½®ç®¡ç†

### é…ç½®æ–‡ä»¶æ ¼å¼

æ”¯æŒ **YAML** å’Œ **JSON** æ ¼å¼ï¼ˆé€šè¿‡æ–‡ä»¶æ‰©å±•åè‡ªåŠ¨è¯†åˆ«ï¼‰ã€‚

**YAML ç¤ºä¾‹**ï¼ˆ`app-sv-maas-config.yaml`ï¼‰ï¼š

```yaml
database:
  host: "10.0.0.1"
  port: 5432
  username: "admin"
  password: "secret"

service:
  timeout: 30
  retry: 3
  
features:
  cache_enabled: true
  max_connections: 100
```

**JSON ç¤ºä¾‹**ï¼ˆ`app-sv-maas-config.json`ï¼‰ï¼š

```json
{
  "database": {
    "host": "10.0.0.1",
    "port": 5432
  },
  "features": {
    "cache_enabled": true
  }
}
```


## ğŸ” æœåŠ¡æ³¨å†Œä¸å‘ç°

### æ³¨å†ŒæœåŠ¡

æœåŠ¡ä¼šè‡ªåŠ¨ï¼š
1. æ³¨å†Œåˆ° Nacos
2. æ¯ 5 ç§’å‘é€å¿ƒè·³
3. åœ¨è¿›ç¨‹é€€å‡ºæ—¶è‡ªåŠ¨æ³¨é”€

### å‘ç°æœåŠ¡

```python
from src.nacos_client import init_nacos_client, get_service_discovery, app_config, NacosConstant

discovery = get_service_discovery()
instances = discovery.get_one_healthy_instance("sv-maas")

```

## ğŸ“– API æ–‡æ¡£

### é¡¶å±‚ API

#### `init_nacos_client()`

ä»é…ç½®ç¯å¢ƒåˆå§‹åŒ– Nacosï¼ˆæ¨èæ–¹å¼ï¼‰ã€‚

```python
from src.nacos_client import init_nacos_client, get_service_discovery, app_config, NacosConstant

manager, config = init_nacos_client()
```

#### `get_nacos_config(key: str, default=None)`

è·å–é…ç½®å€¼ï¼ˆæ”¯æŒåµŒå¥—è·¯å¾„ï¼‰ã€‚

```python
from src.nacos_client import init_nacos_client, get_service_discovery, app_config, NacosConstant

db_host = app_config.get("database.host", "localhost")
```

#### `get_service_discovery() -> ServiceDiscovery`

è·å–æœåŠ¡å‘ç°å®ä¾‹ã€‚

```python
from src.nacos_client import init_nacos_client, get_service_discovery, app_config, NacosConstant

discovery = get_service_discovery()
instances = discovery.get_one_healthy_instance("sv-maas")
```


## ğŸ’¡ æœ€ä½³å®è·µ

###  1. ä¸‰å±‚å‘½åè§„åˆ™

å±‚çº§ |     ä½œç”¨     |                                 ç¤ºä¾‹                                  | è¯´æ˜ 
----|:----------:|:-------------------------------------------------------------------:|:--:
Namespace |    ç¯å¢ƒéš”ç¦»    |          `smartvision-dev` `smartvision-pre` `smartvision`          | å¼€å‘ç¯å¢ƒ/é¢„ç”Ÿäº§ç¯å¢ƒ/ç”Ÿäº§ç¯å¢ƒ 
Group |   é…ç½®ç±»å‹éš”ç¦»   |       `MIDDLEWARE_CONFIG_GROUP`            `APP_CONFIG_GROUP`       | ä¸­é—´ä»¶é…ç½®/ä¸šåŠ¡é…ç½® 
Data ID | ç±»å‹+æœåŠ¡+æ ¼å¼æ ‡è¯† | `middleware-base-config.yaml`             `app-sv-maas-config.yaml` | ä¸­é—´ä»¶Data  ID/ä¸šåŠ¡Data ID

### 2. ä½¿ç”¨ç¯å¢ƒå˜é‡åŒºåˆ†ç¯å¢ƒ


åˆ›å»ºä¸åŒç¯å¢ƒå¯¹åº”çš„ç¯å¢ƒå˜é‡ï¼Œå¹¶è®¾ç½® Nacos çš„ Namespace å’Œ Config Data IDã€‚
é€šè¿‡NamespaceåŒºåˆ†ç¯å¢ƒï¼Œä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶ã€‚
å¼€å‘ç¯å¢ƒNamespaceï¼š`smartvision-dev`
é¢„ç”Ÿäº§ç¯å¢ƒNamespaceï¼š`smartvision-pre`
ç”Ÿäº§ç¯å¢ƒNamespaceï¼š`smartvision`

**å¼€å‘ç¯å¢ƒ**ï¼š
```bash
export NACOS__NAMESPACE="smartvision-dev"
export NACOS__CONFIG_DATA_ID="app-sv-maas-config.yaml"
```

**é¢„ç”Ÿäº§ç¯å¢ƒ**ï¼š
```bash
export NACOS__NAMESPACE="smartvision-pre"
export NACOS__CONFIG_DATA_ID="app-sv-maas-config.yaml"
```

**ç”Ÿäº§ç¯å¢ƒ**ï¼š
```bash
export NACOS__NAMESPACE="smartvision"
export NACOS__CONFIG_DATA_ID="app-sv-maas-config.yaml"
```

