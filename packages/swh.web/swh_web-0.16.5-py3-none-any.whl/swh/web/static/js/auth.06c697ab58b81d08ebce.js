/*! For license information please see auth.06c697ab58b81d08ebce.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.swh=t():(e.swh=e.swh||{},e.swh.auth=t())}(self,function(){return function(){var e={887:function(e,t,n){var r=n(16993),o=n(11791);e.exports=function(e,t,n,i,u){return new o(r().w(e,t,n,i),u||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports},4373:function(e){e.exports=function(e){var t=Object(e),n=[];for(var r in t)n.unshift(r);return function e(){for(;n.length;)if((r=n.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports},4633:function(e,t,n){var r=n(25172),o=n(16993),i=n(55869),u=n(887),s=n(11791),a=n(4373),c=n(30579);function f(){"use strict";var t=o(),n=t.m(f),l=(Object.getPrototypeOf?Object.getPrototypeOf(n):n.__proto__).constructor;function p(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===l||"GeneratorFunction"===(t.displayName||t.name))}var d={throw:1,return:2,break:3,continue:3};function v(e){var t,n;return function(r){t||(t={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(e,t){return n(r.a,d[e],t)},delegateYield:function(e,o,i){return t.resultName=o,n(r.d,c(e),i)},finish:function(e){return n(r.f,e)}},n=function(e,n,o){r.p=t.prev,r.n=t.next;try{return e(n,o)}finally{t.next=r.n}}),t.resultName&&(t[t.resultName]=r.v,t.resultName=void 0),t.sent=r.v,t.next=r.n;try{return e.call(this,t)}finally{r.p=t.prev,r.n=t.next}}}return(e.exports=f=function(){return{wrap:function(e,n,r,o){return t.w(v(e),n,r,o&&o.reverse())},isGeneratorFunction:p,mark:t.m,awrap:function(e,t){return new r(e,t)},AsyncIterator:s,async:function(e,t,n,r,o){return(p(t)?u:i)(v(e),t,n,r,o)},keys:a,values:c}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=f,e.exports.__esModule=!0,e.exports.default=e.exports},8545:function(e,t,n){"use strict";n.d(t,{Iq:function(){return s},Jq:function(){return u},Tv:function(){return o},lY:function(){return i}});n(54756);var r=n(18987);function o(e,t){if(void 0===t&&(t=[]),!e.ok&&$.inArray(e.status,t))throw e;return e}function i(e,t){var n="/static/"+e;return n.startsWith("/")&&t&&(n=t+n),n}function u(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=null),t["X-CSRFToken"]=r.A.get("csrftoken"),fetch(e,{credentials:"include",headers:t,method:"POST",body:n})}function s(){history.replaceState("",document.title,window.location.pathname+window.location.search)}},10467:function(e,t,n){"use strict";function r(e,t,n,r,o,i,u){try{var s=e[i](u),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(o,i){var u=e.apply(t,n);function s(e){r(u,o,i,s,a,"next",e)}function a(e){r(u,o,i,s,a,"throw",e)}s(void 0)})}}n.d(t,{A:function(){return o}})},11791:function(e,t,n){var r=n(25172),o=n(75546);e.exports=function e(t,n){function i(e,o,u,s){try{var a=t[e](o),c=a.value;return c instanceof r?n.resolve(c.v).then(function(e){i("next",e,u,s)},function(e){i("throw",e,u,s)}):n.resolve(c).then(function(e){a.value=e,u(a)},function(e){return i("throw",e,u,s)})}catch(e){s(e)}}var u;this.next||(o(e.prototype),o(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),o(this,"_invoke",function(e,t,r){function o(){return new n(function(t,n){i(e,r,t,n)})}return u=u?u.then(o,o):o()},!0)},e.exports.__esModule=!0,e.exports.default=e.exports},16993:function(e,t,n){var r=n(75546);function o(){var t,n,i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",s=i.toStringTag||"@@toStringTag";function a(e,o,i,u){var s=o&&o.prototype instanceof f?o:f,a=Object.create(s.prototype);return r(a,"_invoke",function(e,r,o){var i,u,s,a=0,f=o||[],l=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,u=0,s=t,p.n=n,c}};function d(e,r){for(u=e,s=r,n=0;!l&&a&&!o&&n<f.length;n++){var o,i=f[n],d=p.p,v=i[2];e>3?(o=v===r)&&(s=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=e<2&&d<i[1])?(u=0,p.v=r,p.n=i[1]):d<v&&(o=e<3||i[0]>r||r>v)&&(i[4]=e,i[5]=r,p.n=v,u=0))}if(o||e>1)return c;throw l=!0,r}return function(o,f,v){if(a>1)throw TypeError("Generator is already running");for(l&&1===f&&d(f,v),u=f,s=v;(n=u<2?t:s)||!l;){i||(u?u<3?(u>1&&(p.n=-1),d(u,s)):p.n=s:p.v=s);try{if(a=2,i){if(u||(o="next"),n=i[o]){if(!(n=n.call(i,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,u<2&&(u=0)}else 1===u&&(n=i.return)&&n.call(i),u<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((n=(l=p.n<0)?s:e.call(r,p))!==c)break}catch(e){i=t,u=1,s=e}finally{a=1}}return{value:n,done:l}}}(e,i,u),!0),a}var c={};function f(){}function l(){}function p(){}n=Object.getPrototypeOf;var d=[][u]?n(n([][u]())):(r(n={},u,function(){return this}),n),v=p.prototype=f.prototype=Object.create(d);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,r(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e}return l.prototype=p,r(v,"constructor",p),r(p,"constructor",l),l.displayName="GeneratorFunction",r(p,s,"GeneratorFunction"),r(v),r(v,s,"Generator"),r(v,u,function(){return this}),r(v,"toString",function(){return"[object Generator]"}),(e.exports=o=function(){return{w:a,m:h}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},18987:function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}n.d(t,{A:function(){return o}});var o=function e(t,n){function o(e,o,i){if("undefined"!=typeof document){"number"==typeof(i=r({},n,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var u="";for(var s in i)i[s]&&(u+="; "+s,!0!==i[s]&&(u+="="+i[s].split(";")[0]));return document.cookie=e+"="+t.write(o,e)+u}}return Object.create({set:o,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],r={},o=0;o<n.length;o++){var i=n[o].split("="),u=i.slice(1).join("=");try{var s=decodeURIComponent(i[0]);if(r[s]=t.read(u,s),e===s)break}catch(e){}}return e?r[e]:r}},remove:function(e,t){o(e,"",r({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,r({},this.attributes,t))},withConverter:function(t){return e(r({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})},23717:function(e,t,n){"use strict";n.d(t,{_k:function(){return r}});var r={serverSide:!0,processing:!0,language:{processing:'<img src="'+(0,n(8545).lY)("img/swh-spinner.gif")+'"></img>'},fixedHeader:!0,lengthMenu:[10,25,50,100,1e3],scrollCollapse:!0,searchDelay:1e3}},25172:function(e){e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports},30579:function(e,t,n){var r=n(73738).default;e.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(r(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports},54756:function(e,t,n){var r=n(4633)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},55869:function(e,t,n){var r=n(887);e.exports=function(e,t,n,o,i){var u=r(e,t,n,o,i);return u.next().then(function(e){return e.done?e.value:u.next()})},e.exports.__esModule=!0,e.exports.default=e.exports},58168:function(e,t,n){"use strict";function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(null,arguments)}n.d(t,{A:function(){return r}})},73738:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},75546:function(e){function t(n,r,o,i){var u=Object.defineProperty;try{u({},"",{})}catch(n){u=0}e.exports=t=function(e,n,r,o){function i(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?u?u(e,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[n]=r:(i("next",0),i("throw",1),i("return",2))},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r,o,i)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return function(){"use strict";n.r(r),n.d(r,{applyTokenAction:function(){return m},initProfilePage:function(){return w}});var e,t=n(58168),o=n(10467),i=n(54756),u=n.n(i),s=n(8545),a=n(23717);function c(e){return'<p id="swh-token-error-message" class="mt-3 swh-token-form-message">'+e+"</p>"}function f(e){return'<p id="swh-token-success-message" class="mt-3 swh-token-form-message">'+e+"</p>"}function l(){$("#swh-token-form-submit").prop("disabled",!0)}function p(){window.location=Urls.oidc_generate_bearer_token()}function d(e){return v.apply(this,arguments)}function v(){return(v=(0,o.A)(u().mark(function e(t){var n,r,o,i,a,f,l;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={token_id:t},e.prev=1,e.next=2,(0,s.Jq)(Urls.oidc_get_bearer_token(),{},JSON.stringify(n));case 2:return r=e.sent,(0,s.Tv)(r),e.next=3,r.text();case 3:o=e.sent,i='<p>Below is your token.</p>\n      <pre id="swh-bearer-token" class="mt-3">'+o+"</pre>",swh.webapp.showModalHtml("Display bearer token",i),e.next=6;break;case 4:return e.prev=4,l=e.catch(1),e.next=5,l.text();case 5:a=e.sent,f="Internal server error.",400===l.status&&(f=a),swh.webapp.showModalHtml("Display bearer token",c(f));case 6:case"end":return e.stop()}},e,null,[[1,4]])}))).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=(0,o.A)(u().mark(function t(n){var r,o;return u().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={token_ids:n},t.prev=1,t.next=2,(0,s.Jq)(Urls.oidc_revoke_bearer_tokens(),{},JSON.stringify(r));case 2:o=t.sent,(0,s.Tv)(o),l(),$("#swh-token-form-message").html(f("Bearer token"+(n.length>1?"s":"")+" successfully revoked.")),e.draw(),t.next=4;break;case 3:t.prev=3,t.catch(1),$("#swh-token-form-message").html(c("Internal server error."));case 4:case"end":return t.stop()}},t,null,[[1,3]])}))).apply(this,arguments)}function x(e){h([e])}function y(){for(var t=[],n=e.rows().data(),r=0;r<n.length;++r)t.push(n[r].id);h(t)}function m(e,t){var n,r,o={display:{submitCallback:d},generate:{modalTitle:"Bearer token generation",infoText:"Click on the button to generate the token. You will be redirected to Software Heritage Authentication Service and might be asked to enter your password again.",buttonText:"Generate token",submitCallback:p},revoke:{modalTitle:"Revoke bearer token",infoText:"Click on the button to revoke the token.",buttonText:"Revoke token",submitCallback:x},revokeAll:{modalTitle:"Revoke all bearer tokens",infoText:"Click on the button to revoke all tokens.",buttonText:"Revoke tokens",submitCallback:y}};if(o[e])if("display"!==e){var i=(n=o[e].infoText,r=o[e].buttonText,'<form id="swh-token-form" class="text-center">\n      <p id="swh-token-form-text">'+n+'</p>\n      <input id="swh-token-form-submit" type="submit" value="'+r+'">\n      <div id="swh-token-form-message"></div>\n    </form>');swh.webapp.showModalHtml(o[e].modalTitle,i),$("#swh-token-form").submit(function(n){n.preventDefault(),n.stopPropagation(),o[e].submitCallback(t)})}else o[e].submitCallback(t)}function w(){$(document).ready(function(){e=$("#swh-bearer-tokens-table").on("error.dt",function(e,t,n,r){$("#swh-origin-save-request-list-error").text("An error occurred while retrieving the tokens list"),console.log(r)}).DataTable((0,t.A)({},a._k,{ajax:Urls.oidc_list_bearer_tokens(),columns:[{data:"creation_date",name:"creation_date",render:function(e,t,n){return"display"===t?new Date(e).toLocaleString():e}},{render:function(e,t,n){return'<button class="btn btn-secondary btn-sm"\n                         onclick="swh.auth.applyTokenAction(\'display\', '+n.id+')">\n                  Display token\n                </button>\n                <button class="btn btn-secondary btn-sm"\n                        onclick="swh.auth.applyTokenAction(\'revoke\', '+n.id+')">\n                  Revoke token\n                </button>'}}],ordering:!1,searching:!1})),$("#swh-oidc-profile-tokens-tab").on("shown.bs.tab",function(){e.draw(),window.location.hash="#tokens"}),$("#swh-oidc-profile-account-tab").on("shown.bs.tab",function(){(0,s.Iq)()}),"#tokens"===window.location.hash&&$('.nav-tabs a[href="#swh-oidc-profile-tokens"]').tab("show")})}}(),r}()});
//# sourceMappingURL=auth.06c697ab58b81d08ebce.js.map