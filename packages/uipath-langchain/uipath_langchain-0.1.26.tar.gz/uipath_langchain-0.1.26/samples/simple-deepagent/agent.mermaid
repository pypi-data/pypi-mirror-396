flowchart TB
  __start__(__start__)
  __end__(__end__)
  agent:model(model)
  agent:tools(tools)
  agent:SummarizationMiddleware.before_model(SummarizationMiddleware.before_model)
  agent:PatchToolCallsMiddleware.before_agent(PatchToolCallsMiddleware.before_agent)
  agent:__end__(__end__)
  __start__ --> agent:PatchToolCallsMiddleware.before_agent
  agent:__end__ --> __end__
  agent:PatchToolCallsMiddleware.before_agent --> agent:SummarizationMiddleware.before_model
  agent:SummarizationMiddleware.before_model --> agent:model
  agent:model --> agent:__end__
  agent:model --> agent:tools
  agent:tools --> agent:SummarizationMiddleware.before_model
