# SPDX-FileCopyrightText: 2025 GitHub
# SPDX-License-Identifier: MIT

seclab-taskflow-agent:
  filetype: taskflow
  version: 1

model_config: seclab_taskflows.configs.model_config

globals:
  repo: 
  id: 
# Taskflow to analyze the library functions in respect to their functionality and how security relevant functions could be circumvented
# Dependency: identify_applications needs to run first.
taskflow:
  - task:
      must_complete: true
      agents:
        - seclab_taskflows.personalities.web_application_security_expert
      model: code_analysis
      user_prompt: |
        Fetch the entry points of the repo {{ GLOBALS_repo }},
        the user actions of the repo {{ GLOBALS_repo }} and the 
        components of the repo {{ GLOBALS_repo }}.
        Based on the entry points, components, user actions and README.md and, if available, SECURITY.md in the {{ GLOBALS_repo }},
        can you tell me what type of application this repo is and what kind of security boundary it has.
        For each entry point state whether they could be used for security relevant functionality. (E.g. checking that an input is well-formed) 
        Add a note regarding the most likely security problems in this entry point. E.g. if a function is used to verify some data format and
        whether an attacker being able to somehow bypass this verification could lead to a security issue.
        Note especially when a Regex can be circumvented. Think hard about potential ways to bypass such regexes, e.g. using Null bytes,
        double encoding, special charsets, etc.

        We're looking for more concrete and serious security issues that affects system integrity or 
        lead to information leak, so please do not include issues like brute force, Dos, log injection etc.

        Also do not include issues that require system to be already compromised, such as issues that rely on malicious 
        configurations etc.

        For each scenario, consider what privilege and access does the attacker need to gain and do not include issues that 
        require high privilege or access to the system.

        Store a component issue entry for each type of issue identified.
      toolboxes:
        - seclab_taskflows.toolboxes.repo_context
        - seclab_taskflows.toolboxes.gh_file_viewer
  - task:
      must_complete: true
      agents:
        - seclab_taskflows.personalities.web_application_security_expert
      model: code_analysis
      user_prompt: |
        Fetch the issues in component with id {{ GLOBALS_id }} in the repo {{ GLOBALS_repo }}. List all issues one by one.
      toolboxes:
        - seclab_taskflows.toolboxes.repo_context
