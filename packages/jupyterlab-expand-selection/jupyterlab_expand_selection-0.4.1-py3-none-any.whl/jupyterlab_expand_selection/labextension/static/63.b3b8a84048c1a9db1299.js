"use strict";(self.webpackChunkjupyterlab_expand_selection=self.webpackChunkjupyterlab_expand_selection||[]).push([[63,444],{63:(e,n,t)=>{t.r(n),t.d(n,{expandSelection:()=>k,expandSelectionExtension:()=>y,expansionConfig:()=>i,shrinkSelection:()=>C,swapAnchorHead:()=>b});var r=t(195),o=t(839);const a={cyclic:!1,inStringBracketMatchMode:"loose",inStringBracketPairs:["()","{}","[]"],stringTags:[o.tags.string,o.tags.docString,o.tags.comment,o.tags.lineComment,o.tags.docComment,o.tags.blockComment],debug:!1},i=r.Facet.define({combine:e=>(0,r.combineConfig)(e,a)});var c=t(24),s=t(84);function l(e){let n=[];const t=(0,s.syntaxTree)(e),o=e.selection.main.head;let a=t.resolve(o);for(;a;){if(null!=a&&""!=a.name){let e=r.EditorSelection.range(a.from,a.to),t="Node:"+a.type.name;n.push({range:e,tag:t})}a=a.parent}return n}function g(e){const n=e.selection.main.head;let t=[],o=e.wordAt(n);function a(e,n){const t=e.selection.main.head,r=e.doc.lineAt(t),o=r.text,a=t-r.from;let i;for(;i=n.exec(o);)if(i.index<=a&&a<=i.index+i[0].length)return{from:r.from+i.index,to:r.from+i.index+i[0].length};return null}null!=o&&t.push({range:r.EditorSelection.range(o.from,o.to),tag:"Word:Default"});let i=a(e,/[A-Za-z0-9]+/g);return null!=i&&t.push({range:r.EditorSelection.range(i.from,i.to),tag:"Word:AlphaNum"}),i=a(e,/[A-Za-z0-9\-_]+/g),null!=i&&t.push({range:r.EditorSelection.range(i.from,i.to),tag:"Word:Compound"}),t}function f(e){const n=e.selection.main.head;let t=[];const o=e.doc.lineAt(n),a=o.text.search(/\S|$/);return t.push({range:r.EditorSelection.range(o.from,o.to),tag:"Line:Whole"}),a>0&&t.push({range:r.EditorSelection.range(o.from+a,o.to),tag:"Line:Indented"}),t}function u(e){const n=e.selection.main.head;let t=[];return t.push({range:r.EditorSelection.range(n,n),tag:"Cursor"}),t}function d(e,n){const t=n.map(e=>e[0]),r=n.map(e=>e[1]);let o=[];for(const[n,a]of[...e].entries())if(t.includes(a)||r.includes(a))if(0==o.length)o.push({char:a,pos:n});else{const e=o[o.length-1].char;t.includes(e)&&r.includes(a)?o.pop():o.push({char:a,pos:n})}return o}function h(e,n){const t=(0,o.getStyleTags)(e);return!!t&&n.some(e=>t.tags.includes(e))}function p(e){if("none"==e.facet(i).inStringBracketMatchMode)return[];const n=e.facet(i).inStringBracketPairs,t=e.facet(i).stringTags,o=(0,s.syntaxTree)(e),a=e.selection.main.head;let c=o.resolve(a);for(;c&&!h(c,t);)c=c.parent;if(!c)return[];let l=[],g=e.doc.sliceString(c.from,a),f=e.doc.sliceString(a+1,c.to);const u=e.doc.sliceString(a,a+1),p=n.map(e=>e[0]),m=n.map(e=>e[1]);p.includes(u)?g+=u:m.includes(u)?f=u+f:g+=u;const S=c.from,x=c.from+g.length+1;let E=d(g,n).filter(e=>p.includes(e.char)),k=d(f,n).filter(e=>m.includes(e.char));const C=Math.min(E.length,k.length);for(let e=0;e<C;e++){let e=E.pop().pos+S,n=k.shift().pos+x;l.push({range:r.EditorSelection.range(e,n),tag:"InStringBracket:Whole"}),n-e>2&&l.push({range:r.EditorSelection.range(e+1,n-1),tag:"InStringBracket:Inner"})}return l}const m=r.StateEffect.define(),S=r.StateEffect.define(),x=r.StateField.define({create:()=>({ranges:[],index:-1}),update(e,n){for(let e of n.effects){if(e.is(m))return e.value;if(e.is(S))return{ranges:[],index:-1}}return e}}),E=c.EditorView.updateListener.of(e=>{const n=e.transactions.some(e=>{const n=e.annotation(r.Transaction.userEvent);return["select.pointer","select.keyboard","select"].includes(n||"")});(e.docChanged||n)&&e.view.dispatch({effects:S.of(null)})});function k(e){const n=e.state,t=n.field(x),o=n.facet(i).cyclic;let a=t.ranges,c=t.index;if(0===a.length)a=function(e){const n=[u,l,p,g,f];let t=[];for(let r of n)t=t.concat(r(e));return t=function(e){return[...e].sort((e,n)=>{let t=e.range.to-e.range.from,r=n.range.to-n.range.from;if(t!=r)return t-r;let o=e.range.from-n.range.from;return 0!=o?o:e.tag.localeCompare(n.tag)})}(t),t=function(e){let n=[];for(let t of e){if(0==n.length){n.push({range:t.range,tag:t.tag});continue}let e=n[n.length-1];e.range.from==t.range.from&&e.range.to==t.range.to?e.tag=e.tag+","+t.tag:n.push(t)}return n}(t),t}(n),n.facet(i).debug&&(console.log("generate ranges:"),console.log(a)),c=1;else if(c+1<a.length)c+=1;else{if(!o)return!0;c=0}const s=a[c].range;return e.dispatch({selection:r.EditorSelection.single(s.anchor,s.head),effects:m.of({ranges:a,index:c}),annotations:[r.Transaction.userEvent.of("select.expand")]}),!0}function C(e){const n=e.state,t=n.field(x),o=n.facet(i).cyclic;if(0===t.ranges.length)return!0;let a=t.index-1;a<0&&(a=o?t.ranges.length-1:0);const c=t.ranges[a].range;return e.dispatch({selection:r.EditorSelection.single(c.anchor,c.head),effects:m.of({ranges:t.ranges,index:a}),annotations:[r.Transaction.userEvent.of("select.shrink")]}),!0}function b(e){const n=e.state.selection.main;return e.dispatch({selection:r.EditorSelection.single(n.head,n.anchor)}),!0}function y(e={}){return[x,E,i.of(e)]}}}]);