"use strict";(self.webpackChunkjupyterlab_expand_selection=self.webpackChunkjupyterlab_expand_selection||[]).push([[353],{353:(e,t,n)=>{n.d(t,{Fl:()=>w,Mi:()=>O,QV:()=>J,S9:()=>k,rS:()=>E,rn:()=>I});var r=n(195),s=n(24),o=n(84),i=n(708);const l=r.Annotation.define(),c=r.Facet.define();class a{constructor(e,t,n,r,s){this.changes=e,this.effects=t,this.mapped=n,this.startSelection=r,this.selectionsAfter=s}setSelAfter(e){return new a(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,n;return{changes:null===(e=this.changes)||void 0===e?void 0:e.toJSON(),mapped:null===(t=this.mapped)||void 0===t?void 0:t.toJSON(),startSelection:null===(n=this.startSelection)||void 0===n?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map(e=>e.toJSON())}}static fromJSON(e){return new a(e.changes&&r.ChangeSet.fromJSON(e.changes),[],e.mapped&&r.ChangeDesc.fromJSON(e.mapped),e.startSelection&&r.EditorSelection.fromJSON(e.startSelection),e.selectionsAfter.map(r.EditorSelection.fromJSON))}static fromTransaction(e,t){let n=d;for(let t of e.startState.facet(c)){let r=t(e);r.length&&(n=n.concat(r))}return!n.length&&e.changes.empty?null:new a(e.changes.invert(e.startState.doc),n,void 0,t||e.startState.selection,d)}static selection(e){return new a(void 0,d,void 0,void 0,e)}}function h(e,t,n,r){let s=t+1>n+20?t-n-1:0,o=e.slice(s,t);return o.push(r),o}function f(e,t){return e.length?t.length?e.concat(t):e:t}const d=[];function u(e){let t=e[e.length-1],n=e.slice();return n[e.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),n}function p(e,t){if(!e.length)return e;let n=e.length,r=d;for(;n;){let s=g(e[n-1],t,r);if(s.changes&&!s.changes.empty||s.effects.length){let t=e.slice(0,n);return t[n-1]=s,t}t=s.mapped,n--,r=s.selectionsAfter}return r.length?[a.selection(r)]:d}function g(e,t,n){let s=f(e.selectionsAfter.length?e.selectionsAfter.map(e=>e.map(t)):d,n);if(!e.changes)return a.selection(s);let o=e.changes.map(t),i=t.mapDesc(e.changes,!0),l=e.mapped?e.mapped.composeDesc(i):i;return new a(o,r.StateEffect.mapEffects(e.effects,t),l,e.startSelection.map(i),s)}const m=/^(input\.type|delete)($|\.)/;class S{constructor(e,t,n=0,r=void 0){this.done=e,this.undone=t,this.prevTime=n,this.prevUserEvent=r}isolate(){return this.prevTime?new S(this.done,this.undone):this}addChanges(e,t,n,s,o){let i=this.done,l=i[i.length-1];return i=l&&l.changes&&!l.changes.empty&&e.changes&&(!n||m.test(n))&&(!l.selectionsAfter.length&&t-this.prevTime<s.newGroupDelay&&s.joinToEvent(o,function(e,t){let n=[],r=!1;return e.iterChangedRanges((e,t)=>n.push(e,t)),t.iterChangedRanges((e,t,s,o)=>{for(let e=0;e<n.length;){let t=n[e++],i=n[e++];o>=t&&s<=i&&(r=!0)}}),r}(l.changes,e.changes))||"input.type.compose"==n)?h(i,i.length-1,s.minDepth,new a(e.changes.compose(l.changes),f(r.StateEffect.mapEffects(e.effects,l.changes),l.effects),l.mapped,l.startSelection,d)):h(i,i.length,s.minDepth,e),new S(i,d,t,n)}addSelection(e,t,n,r){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:d;return s.length>0&&t-this.prevTime<r&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&(o=s[s.length-1],i=e,o.ranges.length==i.ranges.length&&0===o.ranges.filter((e,t)=>e.empty!=i.ranges[t].empty).length)?this:new S(function(e,t){if(e.length){let n=e[e.length-1],r=n.selectionsAfter.slice(Math.max(0,n.selectionsAfter.length-200));return r.length&&r[r.length-1].eq(t)?e:(r.push(t),h(e,e.length-1,1e9,n.setSelAfter(r)))}return[a.selection([t])]}(this.done,e),this.undone,t,n);var o,i}addMapping(e){return new S(p(this.done,e),p(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,n){let r=0==e?this.done:this.undone;if(0==r.length)return null;let s=r[r.length-1],o=s.selectionsAfter[0]||t.selection;if(n&&s.selectionsAfter.length)return t.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:l.of({side:e,rest:u(r),selection:o}),userEvent:0==e?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let n=1==r.length?d:r.slice(0,r.length-1);return s.mapped&&(n=p(n,s.mapped)),t.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:l.of({side:e,rest:n,selection:o}),filter:!1,userEvent:0==e?"undo":"redo",scrollIntoView:!0})}return null}}function v({state:e,dispatch:t},n){let s=(o=e.selection,i=n,r.EditorSelection.create(o.ranges.map(i),o.mainIndex));var o,i;return!s.eq(e.selection,!0)&&(t(function(e,t){return e.update({selection:t,scrollIntoView:!0,userEvent:"select"})}(e,s)),!0)}function y(e,t){return r.EditorSelection.cursor(t?e.to:e.from)}function A(e){return e.textDirectionAt(e.state.selection.main.head)==s.Direction.LTR}function C(e,t){return v(e,n=>n.empty?e.moveByGroup(n,t):y(n,t))}S.empty=new S(d,d);const w=e=>C(e,!0),E=e=>C(e,!1),N="undefined"!=typeof Intl&&Intl.Segmenter?new Intl.Segmenter(void 0,{granularity:"word"}):null;function D(e,t){return v(e,n=>n.empty?function(e,t,n){let s=e.state.charCategorizer(t.from),o=r.CharCategory.Space,i=t.from,l=0,c=!1,a=!1,h=!1,f=t=>{if(c)return!1;i+=n?t.length:-t.length;let f,d=s(t);if(d==r.CharCategory.Word&&t.charCodeAt(0)<128&&/[\W_]/.test(t)&&(d=-1),o==r.CharCategory.Space&&(o=d),o!=d)return!1;if(o==r.CharCategory.Word)if(t.toLowerCase()==t){if(!n&&a)return!1;h=!0}else if(h){if(n)return!1;c=!0}else{if(a&&n&&s(f=e.state.sliceDoc(i,i+1))==r.CharCategory.Word&&f.toLowerCase()==f)return!1;a=!0}return l++,!0},d=e.moveByChar(t,n,e=>(f(e),f));if(N&&o==r.CharCategory.Word&&d.from==t.from+l*(n?1:-1)){let s=Math.min(t.head,d.head),o=Math.max(t.head,d.head),i=e.state.sliceDoc(s,o);if(i.length>1&&/[\u4E00-\uffff]/.test(i)){let e=Array.from(N.segment(i));if(e.length>1)return n?r.EditorSelection.cursor(t.head+e[1].index,-1):r.EditorSelection.cursor(d.head+e[e.length-1].index,1)}}return d}(e,n,t):y(n,t))}const J=e=>D(e,!0),O=e=>D(e,!1);function x(e,t,n){if(t.type.prop(n))return!0;let r=t.to-t.from;return r&&(r>2||/[^\s,.;:]/.test(e.sliceDoc(t.from,t.to)))||t.firstChild}function T(e,t,n){let s,l,c=(0,o.syntaxTree)(e).resolveInner(t.head),a=n?i.NodeProp.closedBy:i.NodeProp.openedBy;for(let r=t.head;;){let t=n?c.childAfter(r):c.childBefore(r);if(!t)break;x(e,t,a)?c=t:r=n?t.to:t.from}return l=c.type.prop(a)&&(s=n?(0,o.matchBrackets)(e,c.from,1):(0,o.matchBrackets)(e,c.to,-1))&&s.matched?n?s.end.to:s.end.from:n?c.to:c.from,r.EditorSelection.cursor(l,n?-1:1)}const I=e=>v(e,t=>T(e.state,t,!A(e))),k=e=>v(e,t=>T(e.state,t,A(e)))}}]);